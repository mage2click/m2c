#!/bin/bash

declare -r m2c_version="0.7.8"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Magento Docker
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_loading_install() {
    tput civis
    m2c_start_progress & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done

    printf "\033[0m"
}

m2c_start_progress() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏') iteration=0 length=0 log

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        if [[ "$iteration" == "0" ]]
        then
            log="$(<${m2c_log})"

            if [[ "$log" == *"Progress:"* ]]
            then
                log=" $(echo "$log" | grep "Progress: " | tail -1 | tr -d "[Proges: ]")  "
                length=${#log}
                printf %${length}s | tr " " "\b"
                echo -en "$log"
            fi
        fi

        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            (( iteration++ ))
            sleep 0.1
        done

        [[ "$iteration" == "10" ]] && iteration=0
    done

    printf %${length}s | tr " " "."
    printf "\033[0m"
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid} && \
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    local text="$1"
    local chars=$((${#text}))
    local cols=$(tput cols)

    if [[ $chars -gt $cols ]]
    then
        text="$(echo "$text" | fold -s -w"$cols")"
    fi

    echo -en "\033[0;32m$text\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_dots() {
    local text="$1"
    local chars=$((${#text} + 3))
    local cols=$(tput cols)
    local last

    cols=$(( cols > 80 ? 80 : cols ))

    if [[ $chars -gt $cols ]]
    then
        text="$(echo "$text" | fold -s -w"$cols")"
        last="${text##*$'\n'}"
        chars=$((${#last} + 3))
    fi

    m2c_msg "$text$(printf %$((cols - chars))s | tr " " ".")  "
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "${m2c_log}" ]]
        then
            error="$(<"${m2c_log}")"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$1 \
          only_y=$2 \
          opts \
          res \
          text \
          lines

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        text="$(m2c_msg "$message $(m2c_info_bold "$opts")") "
        lines=$(echo "$text" | wc -l)
        read -n 1 -srp "$text" res
        echo
        m2c_erase_prev_lines ${lines}
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_dots "OS compatibility check"
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"${m2c_log}"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_dots "Docker installation check"
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"${m2c_log}"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_dots "Docker-compose installation check"
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"${m2c_log}"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_dots "Ports 80, 443, 33060 and 53 availability check"
    m2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"${m2c_log}"
    fi

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    m2c_dots "Password required to trust the CA certificate and create symlinks"
    m2c_loading
    m2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    m2c_erase_prev_lines 1
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_dots "Locating archive"
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_dots "Extracting data"
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"${m2c_log}" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "${m2c_global_dir}/bin/m2c" /usr/local/bin/m2c

        if [[ ! -f "${m2c_global_dir}/ssl/config/v3_ext.conf" ]]
        then
            mv "${m2c_global_dir}/ssl/config/v3_ext.blank.conf" "${m2c_global_dir}/ssl/config/v3_ext.conf"
        else
            rm -f "${m2c_global_dir}/ssl/config/v3_ext.blank.conf"
        fi
    fi
    m2c_result ${test}

    if [[ ! -f "${m2c_global_dir}/ssl/certs/rootCA.crt" ]] || [[ ! -f "${m2c_global_dir}/ssl/private/rootCA.key" ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_dots "Generating private key for CA certificate"
        m2c_loading
        mkdir -p "${m2c_global_dir}/ssl"/{certs,crl,new,private,serial} >"${m2c_log}" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "${m2c_global_dir}/ssl/private/rootCA.key" 4096 >"${m2c_log}" 2>&1
        test=$?
        m2c_result ${test}

        m2c_dots "Signing CA certificate"
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "${m2c_global_dir}/ssl/config/rootca.conf" \
            -key "${m2c_global_dir}/ssl/private/rootCA.key" \
            -out "${m2c_global_dir}/ssl/certs/rootCA.crt" >"${m2c_log}" 2>&1
        test=$?
        m2c_result ${test}

        m2c_dots "Trusting root CA certificate"
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "${m2c_global_dir}/ssl/certs/rootCA.crt" >"${m2c_log}" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]]
                then
                    yes | sudo cp -rf "${m2c_global_dir}/ssl/certs/rootCA.crt" \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"${m2c_log}" 2>&1 && \
                    sudo update-ca-certificates >"${m2c_log}" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]]
                then
                    yes | sudo cp -rf "${m2c_global_dir}/ssl/certs/rootCA.crt" \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"${m2c_log}" 2>&1 && \
                    sudo update-ca-trust >"${m2c_log}" 2>&1 && \
                    sudo update-ca-trust enable >"${m2c_log}" 2>&1
                    test=$?
                else
                    echo "Currently, we are not supporting yet trusting of the root CA certificate on your OS." >"${m2c_log}"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi

    case ${m2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(</etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                m2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                m2c_dots "Creating the resolver file"
                m2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                m2c_result $?
            fi

            if [[ ! -f "${m2c_global_dir}/mutagen/mutagen" || \
                "$("${m2c_global_dir}/mutagen/mutagen" version)" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "${m2c_global_dir}/mutagen" >"${m2c_log}" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "${m2c_global_dir}/mutagen/"
                chmod 0755 "${m2c_global_dir}/mutagen/mutagen"
            fi
        ;;
    esac
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="${m2c_global_dir}/log"
mkdir -p "${m2c_global_dir}"
touch "${m2c_log}"

if ! docker info > /dev/null 2>&1
then
    m2c_error "Docker is not running or Docker service is not reachable.\n"
    exit 1
fi

if ! docker info > /dev/null 2>&1
then
    m2c_error "Docker is not running or Docker service is not reachable.\n"
    exit 1
fi

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "${m2c_global_dir}/build" ]]
    then
        message="Install Mage2click Magento Docker environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "${m2c_global_dir}"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "${m2c_global_dir}/functions/m2c"

    m2c_global_load_env

    m2c_sign "m2c.test"

    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"

    m2c_msg "Mage2click toolset is successfully installed!\n"
    m2c_msg "Run \`m2c --help\` command for usage information.\n"
    m2c_msg "Visit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "${m2c_global_dir}/functions/m2c"
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="${m2c_project_dir}/.m2c/log"

    m2c_load_env

    case "$1" in
        global)
            shift
            m2c_log="${m2c_global_dir}/log"
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    ! m2c_in_array "--help" $@ && m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    ! m2c_in_array "--help" $@ && m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    ! m2c_in_array "--help" $@ && m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ^ r#G(8˯&!I ")ua)@I If@e&Ȣ;Oggck{}5ۯ/YwKFDF&ԍ 2^{xl67}f{Z+jΚFEi'^lE?$qx8PnZ++6{ٚc$֏J5ZX$ _Z?Fz %|[_t`?Z{>8õ㱾Z4mo5W54ǆ`>fD}(`B?F2_|֓ppmLkk9O jI:u<Iƕ>ʛ~c:^1PY'K5VWW0co4g ݍduGIpď`c?2|7`{QR9W((+|$_FRnYj?'9? "toЅz`=$~ȗl|j>7WV^Zi΃Ž('V>KFghY|>,%&	`p*l	k-}7""]xQ?m;˕z*]U?$ž/]kw/YabOM VFUQkT%x\6UӦjTMiC5~GI]^ήd+
UBUP+TJYȠ/N*Ӏ] <8p m>PbI7_,s$OXU?hYou? ޲?X+IkJSS^?r¾iF8X?9-yfr}-_=y.amw9=ӂ/D%{`ZQ?v^Qw'!"%T\vcwoHql^vxSx'#0hژ[tGAN8S;]^t3cch/(zIC =QO <wgmnn*95,b>}/B$;FegI4יȅW˹rg{/G{w_:ng~|ng~?jr͂׋˸I ubazx+U?-vxxAo
vmmnlT\Xl}? )5.%n0g5?O*\ʦ&_l=,zܨ4n~Jxs/	NA\ 9gf}~dS|JC碢͔eE~T`a{N]rgErf["7Zܬ6ƝзsV+ѤwnZP{#OlE-%MLfA| og->QʮbYϺ/2AtuCqhL8Dga ]xn?zAhv[!on&H[0`kxm:6vcRYvWu//qMCzFT^!\.U3$
R?iɶ1^yW@L|imp&gǖSMff`]Ef_fEvNmCT͸ N(-T[hy>k{>&wTܩ~.tAnqĉO_|YOt&U1#.NV qyy8O7>rZ iϷ~e`{͍݀SJ.߲W@.C@6`DW0һ?X85/ywc|'`2u/=K  KoY& ,g4W5^@џ"7l/oWnZ  C 30WL$^<\CfWye:t륟|a2yh0LƛY}zZCub~V7l9tmaOZI#0hƇ_/.jSeYKN.ٺYpPv^&	p7!nߵިw% o;phFq3}CbiÕBpo֓!FwLL&rxgB?+>@y4d<BKLeA8ș.̉Dގ?~|s(E^H[\OY<#O[,yV҂ PkFt!ұ'5_S͊vC3L*
,onbd]^fˋSaUJ,Z$Я! ]j4 ʢΜ40EhМZc\h 8ƨT`Ue|ڋ:\ĆeW_J|g/~{*i?8V]8~Z%~?s8;Vц
q2]|Teѩ"Nz&8
c.ёT7lCTGUNiMUCe(cGiFLuhB*?ʴL{6r +gk+9M`G8of0rnd>y	3fPT`[]P釙adMQq%8,@ĥgEof6v Hlav`n4j	3d&a(rB7D4t^K?Y~]͝o(\'j>`..>ZP2vg	WzgKo</VCfb"n~[_UY~Y$
;JӆE_:֧]H
%%\QRuXYTχz}u{c^Tfgh݊Aq@'op܀b1ZR>uOF>{*R?<:7ǡ."P3V̲oDewb;
;jՆЯ%Wc_[׽cgů9JbVy")FDghJ<eIPZπm-lŏmf]u3"tKqcgٛ:|RnT5 C:oS=shxqy0JIW%.
bL$hPr,*^vH11M F
7'JbotC*uN# /,hȝmW[&݄-k?/.}O: Q?USTl}KiA.lѸi+]ۑ%Ȼ)E+^!ᔶWr*F^s9<|7	zo3x}+'lEP*ՠM8a,U6]̋&CY:;-{lpNFCᘸ;6ReyaA`XlkSGt,?m?\_!Z/E5okޭ7zmц^&XĆ c2x#R{3Ki%`]XۙMHAaC51TzbczmmJL ."7IFdjYFR1E&M\CdWj<\' BAniY|D7,v/N޵B/MI~/셃|Ћ7e_3vo TR|btl~ο0]J\Z82cP%LYOn%ˤFZk1SV~t֑7BT/SzG&dH *I;oJ2f1F^17.}Laǐ8ȜIҒXSܯftktAU{Rƙ?LWq;ʺ&6=Y=݃\z﷞9=$TέF}g~.aWQmi{saV́s9C=5c,GT2SxqYl:	niªo4Ѱ]ÐxԻUsȅb٣ac@hKZ	FLVB/}
3{O<XWt"C.lz}8 &t8rO7pq,[/ij}5r{ZУw=}̱T<2T6Zf]f2u{Wj+ uI]&n&%|+77u|cc/գMՁqxg1Okު3HA'ih"Ɨ-%x{}P۹ap!q[I醃[2mTrVլh|QdMojb*}c}a3<czM^kq̿TN?tJ@!-<PCW[]^qT_R1-GW;M^*-iy=R^.uFCr:,o#a܈qQëfW#v}is!,$=ڃֵ"QxD?k+t=nEG[G7,Xꚜ fshZV$K#T2vAQ@ŚɸϞ\h^C|^[ن$}KɽGASL, I_/=n)ʸ~v?Ty{T%OsK\,
,W8<W>lej6V]<3uWLt$N)%gar!nv3o:e*us@V{Zy{:9hrE{+s {Xdx'-F|8'x/_^Ӓ,*ausSL:q|n'ђ7?c|>^`=?L6ңb?|2VOo
3<n?\v
G
j3juM̾G}e,x6u[j3SDhh_#j8MOۊ_K=п\UXt~*N,dZ~z9H5=7
h0j$bƅo_օ1"Q7EkK~Ξ{o&^&(x&:{L2uZǿ.y8qYxT?qt'hVQ-֐;FC~5~kn!­ݵFWkHƈSϋi
)&	T Ƅ\jHLQa$wLY^_On.K]ԡhNZvϺ'Y4F9KsgMYoLyՊ A4h6x0Gxq^t)NiU/>%7gOP$ћf|xDK0bF5@9 ,`aSe83~"I	G@4xÕn|2g2-aIs7J(^ҏL5j7!/Vד1d-7fT3zkyZ Ӷt=g|G81W̍%!5O5V*A+5L~K*ha8F#%RO3+\Z^]$K)t.3
 4EZl60֘xQPj2(E\DBf(u-& xbF.h-p<m
J)@fRCWU'QX$`?g,כhc\cJin%FXO+n[!yȿk©&<#$JTGcĽ1(5uxZӮ%ig_p]Vdj.+61>j}gbNh:UkF91:=aA9Ebtν UK?e%>j[w~tPb1i4KL g4Mȃm1qɦ&kxߎsԪdX" nW˱=.L=1x,@gǿ9
lO3uK^m%̛T6ͽح1|ɦGGl7+&&	;!B1+Z8(sAEz-	0jtZHn6O==rf+?H}<UYܒ45[p@LuʢwomH+%NڗNK:B&9T8AR Y<@)q\@:f\@!_n@8&@N>"g^N(/IEH`	jCBQ#KLQaOkR
AWC+RLAZ˓5<eCGCHi#!DR3CCX/'%rgL%6F<h=q8r>Uʟd2_HmrKr	dK_aI~
c$~xUV.@PE#q1+4
rRbå+/dPS<萺u@]W*r(&lH%ʧ'{T<c	(zDp)n-$Lb="|L.#jϘw{45m	?ro(BqA,P<G8gm,,Esn,4[' 
{px	ɪjZɅZt3gs\a~&3,D[;tꃱ zc:Xc":j6(2E&ߠE!b@Ѥ-&BboRm6H"P+"#P;[î2<.C *L]jo;kՊ/˚*/m%RFd	قl@/>]7%M	|Sߔ7%M	|Sߔ77ͺlE6"ېMd~Q;L}}koI6
(~}mo۪sWYr@hڪC[UΫ4U;,}ɲ!fkot;"o+TVĺ'@t߂!zbT&ȾQƸj&YZI)hD˼I40q5t|m7^a"pnuTQ}ڝ{I\
IfDq'r7f;|4ITru*LY,K_YZ-fC.
1kxSs>3zl/:GrђRl?gJTĐi˒*qJC@ȫzg~ݹא$ٸ_:EZT)Tm=5Ɋ=fyu}>}YvOOy.B+"9a>H|aT-2q{
wU'pp2cKa<K)T|'+	7~EY#Ag`8fn|Y`.GByWA[;{_<'luɝW2;sQV̅QQWĻ#ɵVkI;sŤ"ĥB]iijyyЄk׭uȀ)0\itm[3tי',M%0塄BA[<jkz}+԰^s<p-SB#JX̓[EF9GLygHPCm#3}p*s
Urs0fpcziӱN1ndNG8)w߳[Ai茫N9)qr1L+i=	=ٝPD;#	Ҏ0
>;L5MIWL9yz_tiY7E5[8/XرBzp6,u~u[՝?=pe"b5J)2qD;Ǹ[:qt/ay K8hֈ*@Mc#sM֐zz#'04>7yOk6	 7]nT,.#}AA7h[\d4]bzT#ɛɅu>C+6$U uZDnhJC~Cӷ'Kjc69σ=M_OWLde@orY>R3g"DD=+,h8N_8J2zgyM[VG)K%.O_Y{ao0,#Pa	"Of4XBlel(PtT}!홪}@v`X(qae0He1{86Szy}/ZʵB ٧U:˞s]:(R̢Pnc^oN;WbtϚM.h[K9Xqm<{3VIwadL;)Nߚ2PtA*8WLNCuIBڀ='A_CA#Mq0ALågN8:@){l3ja}Kp-RwTꀾRVSbۚޱR]Yp!@d$`<@y/~7+gfVׅ	Qw>r8i:TL(ms)Q3ʜw((U#~i)6%@Co ܬ1c>bt	~͏r[vr'n^EϦ(UTtJ~brћhXE-Yӿu)۬kκdQ׍ K.mMc1qJj6"~fj[
mq\~բ%qL)f-~Pâ1b/oUeZBCl6	]${rMt{⼺δLc"M<>v凲0pL{2˹e&bPhW!.Wc \ZL3"RiI P.|HM)NEӻ:sayjqmENLNߊ#*	rVf`v"t >/ꊿyz˞t\ˈDrZO)c4(y#7Su՗.`jnu~㮛au]Ntb./\ٜkp5z& I.tj5o00)ؑe!es!#V2'%:HqR=eApyβsֺI)[0)"bOj败1CiM"99禭u;<Corwˌ8ElzyS0wq~%4.WwpxD5UkwyTO-c<l] YaA{R
zjŧ8_!4j݅^x6,<{,Xnлl:8}sN$ҋ=/_X(H`n9Exc6_*ʹJ.x#C.w*?h3El~ݢ+Sz48@$cqai~XiD~/s0#'䆄B4!@~A [vi#|
ga)*1g!C.m:#NP=+ZЫGxTӂꬑ.{Qo5M"ςރ Ft8uaVFWX+g+yN@Ґtu4Na]5eB*GgL('<`+R(9򻴔醛DmӈtbvtDAyvU61Q^iW:2zg#띫%cF?f%hiw1F&ŴL	pT@AuQrLRYxe#)tBlr(ꑲ5SDޓO[dD-zjlVJaoUh(:?e6N`5+:_Q6pq-Uau#0svvו}M&3z
<w3(rtqJhgC 쳠;Z7Ois]n$?)LyS+ݤ"{b
kR<e򙪿19:f=VQJar,\WzeH]wyFYufT#|nVd
ruJk$9uB*!vJ2R9J#~xBZ<s<#tjKC?pǿ("j=[gj3aOdٸpޤXɻy6EaJQ]xYg -%\w1<hU-7Qҽ\E}^QlKR^2):iU$ȶv!PIUK㤒ɾ̖9kU٧lINig@T}g+UvoP^LΚMnai?#08gLNpYޘ|n?{FxL^\>R-K)`8'	Xk?0<z"SrZu<
 1
Bje5{(q[Z\Yw)VG,JsZjʒ,7]3Dtfne&-T2&\'c;
lYFF,V$Ul)ȐQ(|McrZO/W$.f_ a CWG,%ʖ6ʊxMT3AU֮kɒ~) samv-,TqL6}HMjvV\*4+C4kde sS+<G&AWQ]a^Drg95\uGh!2ݳ5#}ss]agfx.~fhe.ǔȘVm8q\uZKue;^bv;̧=N.tgw\-«WbEP˵cN].&ǘjRspy[$ʃ!6b[
}QEg|b=c6|_6l23R>Sͻ"h";H	C)S ie|R
s6Kbʠ N)l,S"?YSNѸ0ļNql1F)}ՋLFp2kQ&]#) k5F[[f8;f_oWb?훅,Z( 0}Vo~i,XmƯ? BA -\q˄I'B!"FìrpN/QWeoؖ	T)xp<l53{Tl0 	"qT1V@>&6aQ5UBbMC2p8BBY

ݤ8;
YǱQO:(uT_e8Ruq,uVξR[eqJsf
Hc\Whn`ͩ
 &VЏqD3IԫQLʨYWS'~ @rԣRnOS?Ix4g17]e]&HMkG[.7:qq4!0^r{w3Yp~Y<^%f-S%{{y2-xKI4^Rru;M%;)'f2⎞&kI5+{gĔG1MweZH@ukAE:גNOR*8tX.t׊inޮ=@趵1<s=5R)'2K[jkҝs`Lʏ
Wْ*MRO0ny .Z&u*LMNOLjtXd:fՓ7@"Bof&#rԊ196JAbe1uיe(e҆7 ܎A`,H# FwHrWcy[.Y<p[5V=Mzqr) x)SOdU_/hZoD(DVjv:DI.+gbk\Yr:EܷJ!EƳ8iC8fB)I՜eG>թGw+guKHs][ЅUΘmY<=;aպ]O
jmXμn3DkO.q̴_7sv2eQAc߸'u&xX5wr\h2>GV8Ch3w
l3K^dܧi蚡h3D-14#Ѭa;+\޸GN_D_9(qIwN㞄Emd|tߐ9'YgNUVd,gG!)FYC:tw1&Oʕ+1];6KD׿JI.\O
?~\u[iJxiYWe^Keo|K/_aS޷,}T)X!=[	bEkG
߅{[H֜V8<C3j>st`L\pɪE7T.9W,d3mMʵbD嬙ܙf	ܛ)!F.gO;͙QaKa{j	|C&F||;SoeβW(5Yi2=&S]ڠsF.bμl4dߏ|{iY.r@KW0e{%\Wxun@x;KWu6fVe:*0H hz@丵(aa
]{VF~~@ fҶm>
='*lk,E~N`01Gq<#drW2IBr"6XI'm>q8ÝvNKAoEK@n)W EM(UB8	CЇ@jp]@ z7w''AX~Tȋ]y +	ĖYrvPx'#xaQ|BC:V
fnQ(JU맍Ccސj5څfp"tGR'5SkhLPhf7d,+#V`9Uz!S f:-%t=Ç/[(9N!n!ݩYb5ٖ"ad4"n|4nD=tX+UűGW).,xq3z	Q]7Sܥme5reoKٔMAtGs<X:d?kKcou+zce0kέ2I2ĸZZȳsbWॠDx;k`Ef.rii{7`m ׀N޹$صȧa>9+1)
ygID2r^@宠)5ܑc~r9ꭊGl!NaP.
?UrNaEɑړyT($I<WA=q|8nwoE=";T.Q6Qs=t|1[(t;B{y}Մ(IGzq}g$i$( F	ZJ>^Mgu"Ĕ6Pv+(Hdf:fC" &0G#5`]N<=:hnRW
Vטgr(@EZT3?,Mx,|9rq)9j0yw7J3u$9(2Y,Ȇ\(o!"Kb:R\u1`+[5~;Db)kTmV,YRGXE:L?{@8ۊ϶"x,:$BI֩vC|l m51&G^ifs_#e?05Vlm$mV\^ccT-3b*F*T0.gHzeʔۛ~gS1<H.,iR1S	bi%N;{>O)k!7j4uFΚk5| ׎nt!F:	( j#	k$fB W/	1~J@p~UCK=)ZJ*#bwwv^qlH*qL+-Ԥ2	6HWn͸ZҨ_:ΆkAm=@Ȫ,Oߑ>GԀMMLN;*("GI/bBP8 b޵P꜇7I+6eqX)gon%zwB5#;`\ݥ·bֈ77S,p 5C. <}je᜷>FUx&_'|O뵘9~H?ls~eZU93]'gNyaXX権ƹ,@bDt##GȢy=}yER:AxsnٵhT~/8(2 \Ud6$6l 	},}tN-X#qdJ<Pdi;3JdF$=nnYxx+auFFO ,u3)	7WxD>Q W왮xu~5F|iA'Pd\c0]q۳9>ܯl`ҙV/LŅ/W.'Sa5`N>	7I$ȥf>>=pt2SeGƧeQ9wOLg[QM>]_4q.:?/z=cЛYkzGs1&+XbPy9Gc2A67w}<RE\;`k.qӪg*,+)ϭ/,ͬPo=l6WnB$?U4w\zk:DDN?(7|atdj˘
 2Δpwy{\!6GwW)3mNN9wCޖf6Ucs  V_B^QbBrS*JI1TelJĜG#ӽYڽ-N>W[ٰSm!P>B,jGT[!̓kW!QZROai7y͘.߇;0v|"0*PԁE'fV cQ৙f=S wHҷyq0]û"MQ6ղMAw۔.@eȾ^YMԋM!=_=X!X~Xt]x+ftK47	ޠj+c{aUq{JMUY}$'^{ػ6RMj`.<E&tW+LS^iE\3Rk|[RT.fY:?Rv?a7VfW̪)A4kUE~V+f8h(A0R7~o' -XPk06<&;<;^}qV+l>g9Uqs<SƣE=rJ>f#?R䮅دR/9Żfԭ*d|y}?+rJC,KfD;uW9wI{fI]W7+SgWwj5KD6f:֢?d B=dIz#*.X=q#d5AP/&N
Aܡ:B	])Zk*KYM"!Y|*_EfkC&}MzZs %0Xg^ޕZ ~/ruc_'[o]xOII|S|ŧ{/;]&WL촢RB1uNBY8S.kO݄]ODqN)b)?4r9H9(2iJ>گHqF8CUWa+nO	">8jzFޚIAq&9QУWQu7:|R f`ף1ٵ,U-\r[G+o4w2a%-M&ZY+&uUM8$yafyV멛+>0cSj\FyYJAHHYOVyqŋw)r3ݟ\镭YGP<ȩȖ?VP9ާ325y'Dol:hRi8Z4Z`'z$b0Bӭ8PR%-8\UL39[U[_lg5Ǧ7n~QV\54"1ȥ ]}p$P%^[OU5XL%zq)1#ac/xvo6^5e47NoOjs6T>u{q=Jsb<M.gZK`,FE7,MdVt)Ve݇noa(B-~/xu$|"h-KutƈkK[c&uiSmjWu}ONw(]2j¯dͯޝLUX4..q	PsW[,WmT*6ONٹS]<*rZxJ>v@{=MA['gxR7d Fe5V*nX`u:^nUjԲMterj冋Dl'_y`tF>ST`rWNi17-tiB˙3uy{<J
N_|V%RhslTUaOs뼋<~vGr4Z5y-j8pȏ&`t@c~rr&#Pb2SD+ū(VF Aj_ev^ ڍZyP83սχ+1O8I~8Lr_K ??v..[g8򢚔nD?C@izGR-Ga1`E(~A6NI..u	)vH&]υLtte:3!2{nie2hqg3
%`S72r!L@,i.~W?R'w
,ݸr_`BDZ?|juE2k6Rx0DU!H8՘w\WBFhk}֥P`0Mj7y@)~Nqq.8{h%#FϺx<@.t{BLZZmHζAryxQ4ogAs]Ee:,^g%JFZ3|jUZMPe}OpC\YB,ڐEUIaԀ#Xq9E^Ζz28VC'
׊59sϿΟkD)ѧ1#XL#G\a]Gݻ<4NsjD6E	,ĠbuA"3Ǆ܈^#%a8&cl8~D8OroJ M2"q94$v%.GZ1ʸ3!zX|#.l67}f{Z+k:kV`kJ6MPP^oAӂw{oolWI
8 mՍF{c󿲱1HO[0뫫ѲyoMKXga-^t`裭Q(s3Ovs?mLYuk9LfM~&K.GKhpA]Qo
on}hZOdQN"*vx<wzo0>6YQg<hP'~5p/;4^QYyCBXYե7?F8}c&yI+z=Ej	_ܳ3SԭTK1FI/3qGTS-'jOB /xޘ֙'Eo-1Cǘ->'K/靧8joec<Ȼ|͓:i3FZkAoC֜?F;R_,,ޛ"#">n*p39FWsNuڐ6QZc3pQD8pkw~'z^MU@`NЋ桟~k]固	NH[_[[k }ee#]iC~sJLټlaz	/~{ϛVqS!&R{܅n?Q_ee[qYνt4;r07шR#`n:?Ag7L[Yh)SW<o6H-X|?F*\F%A.4lhopw`zLLp7&gw#_ȁrܝvsFI,oS#p4q9e?i5z{mN#9RG|楳^n<u0?Q8:_"ͦw;#zm=#LDTj:<;p4j,^no=!Tn:8}szx|?|~/@rqx៞Q@ZܜW
R냗/y>~G`wpj뙣g
hʵӴ$dգ;V`okNYO`wgﰳVouncOl}?uLc?HO+ZշVL+WQR!lZ$olae( aC)Bx5ES͚7VD0Dnm?Hti;TV>~o=M`04W֥' oQ4?3/O4<v:j`6k%
2H4YkDݔʂ{PpI|3VM:E;xH~#ZIĬ˔j-̣]
;Ih~⇽;<"Z>4mJ@dOyQzxЖn@fEGa hj/>"QamIaQxZ/vR:Nx0̆T$~y$n@54ٙxxwI!y@_( ܏Bo>4Oj]ik}U6磤Qd.Z JGGSyEJA8yXFۼnc)ә{ ?~<>nκ-Գ־s(]w?zWo#Mwr$wwndsGI_QD. aM"N7k+u`^9<Fc,|2z>Y-I"WR?0}+UxÚQ'OhѯB(l=y	ǐf}E~=xXi+MhyYYfʦQ-0L@81YQ':'u⬐5;%knDCGaCXǪ%TQM.L4̔υb
2k&yMFAvOŢs*A<zdB_0ư'5>%mYUwEMYm޵Ɲ奿/I/^Doڑ?a?3J7QFZ:	_<>[̳HbfIF[\Lha<p8ge#YO	}:ia]S͌nhg=_74ϒs2:{Ag B_3Fc$bUm!sWm09*}Ib[j}Vy+bo*UƲ/~Aϼ&UWl})-2iA W)|9V VSpҽFTLYGqL>X$-u5-W&ˁʟa09S9;D!||?>כo|vS3~*Se#'iwE17U=bSvgxɷ:^7.RYV;QŗΙmU?qbH
k*+I8)~Ra{O @+w"2\]cfDleʨՂ)2}a߰/[T|.( -.KeYʩ(}IekVMAZ%;-lQi*cYMq[p	:m)5v\nNBÑ ECc:[ ;̍[=U`;\N:<6ń,!\y[h`/V ${F{e#`߈ƃA=}3F罈f mt*no(߾1)$g6mMtՉ`8X3L]U㈨k %"XXeA?{ѥF`LB"TL.W-Nk1W
9/,M# gh,nC"kMM&jg:H'A,dR?;м|'~@,F0qğS:VۂR-C+<G"i5_Y!voPi_EOc05֛ANaNap17śT4!鍾idejro4b #U,qmYߩ$"Xݸ rD5v>wGoa}2FoV|P7)a|^0RƎȠj[ Ѳܪ][vjQXU7KSq)"2q賯r>GdFA:`䢪CIsYw鸐ǖ^oRoG-"|}#j0Tg0ʃLC
Fj4 I$YZVg7"?Lh,>/rQoml?6k*( otLx[YVKx*aT[`nFWl S3ݕP]DYČcYR#9hw"MNn(%6z5oC%uHAU^b' X6$)
,$m%w@xMvhURcЌzBrzQlp.}L(ad/#-}}=3We4j?WaGw.}a ETv*u
^$z]D>;2!# ?z>bS@~f#@@K5,m1"ޫzUΣjQ);,q}Θ}|VWWzVw=N#˘ƱT _0
BV:/SW\}-#0rkzo{ tjNYm?8xl<;<}jIB8@i=[oi|SDZ8KWXkQ`>f`X=8J[G1zC/~7e} }jgF-	ݪJkOB"}dg ̀a)f&$ +FoOX<l#&Fr9b Xo	|vS5 \I-+0lx{iv4=vKұ{ͰPOA>eVmV;RPQieů:.2b]+Mš?'cdxIdN>a=&jux	"$	ҍvޟww(胒?gD@FyS̊lv>v@C\4&t1mEJg&)tÄ3u}HÊ^R<'	^JEN^VW|ʇ(KvBkAp~`no{QRkJ1@&[=$Rjj#X  &l;2O.yWAgI7uR@qJM^4xOE[OaG
MalTLB=c5Ϗk trr=hԠ͑=,&lzbsz@8jYFZON*Ug僧9:"%:e(<A5
ftf2VfA뤋:0._ߦmߛD(Ӣ/
t%5WKR>߯R4!E:j>,8Gw88o^&*o0i:.L&:[WEͺ/LW>qЀ24s4)aU5\]0c裞5%& o0scdtK2~ I DA}2L\sYr腩~NH(p9!
F<,Tf{i#0ikp9Mno$, {39	ExCoby~jUJ)x'"8>yQqdɖmNR_(c4uNkTvFݘMrX܃cwZY7]gg)u+_%w˔w6CoKmM\x'[(0ZG VP */,bUΓdo6gAr>9A0EbeոC$stzjWh^?tw(Հ7D`;irx&YB3
PD3SdQ2D `J*btQ _8B%H^tB/3+lճc@UѤwn`.,@H%dbe<'gP$$
ވB2p֕(׸!M@@3UѼPеI0(mTEu-6^i647w!ZL 	\:Nl)nn_jo{XQbGMMяi4'ф{Ms@3:;^j([FFtҪ+>uF4os#Z3ehqa}FtIj\|p)퀐q&s|i>==Sq,)au*QubKypbDєg!QT2%ozƝ XOz=S䕴O$UQ&!;s0>E##1!s%8AO/{FGx0:[ALB7ap#{a 3DIRXLm?t`{Ӭc[0u[-o|S~?j243cLڦhZ唡+~;A, ˩WZ*hEPS=mSpW+(ktO]-+l4_#CU[az"FGU8 觴婰$N6_'2y5Rk>.Lkj*>(o^'g%at-kԪ_,Za5Q'O./|׳܊~NNVhMeUPTu:R!hC0[Fm_&:XN>`U6P%$ٖv"f88oU6zlB/fv/]I3DȼJ j'K?CPqЖ`xacmAڞ~T+u^ &n7]ѐ$2J]Unۍ7ws\zi.z~vUKv'ۖXңُ^~{{+tOxupDGi('K3!ͤ#Ry@}\m1z^
cx }GjG\<$Q̟/ͬ2:uyD$z/?h8o4Iz0aT:]TcUZ~'nMJZGg=#WXv:VݮS?ooUoUU=edl6o3|E'rң>D<k6"[&'Nk+cҟ8BXZ֤C\-P7eOI%`z#痀zC csϞaqG&l4+M[+뭕͍GI#ݛA:'Ak7WXG &+>Vb&'BnB'IW_Fd^Yx	ÀxhWkc<_`6\;(uKσ%Uަ_? Wk."-?)z`yrސς￯'I]4,2٥jfemjB.L&dc:?XX@s$uA#8"yj]n2[ﰕtp1<m:8c|# WzZ&^p `O1~4oEg^JS"7yWaإQE- \-sK31^Dzyc.V &
	Z'@Nn_~.OZzVPաbϼ=[	YFL>9	 UWA	hר:	ٝg⧨?{zЬ;PH/Bg!m4ԹxN)FĻm!L]8j?|u )-(|}F]oeZ#Kw$h)S&YlF7+@Dk'd}P-,9GP䠷=² FbaWtp%<Ǔ~@7[<6`|GxD?W{}xtGjIr>K7%AOfJh2U2x2~S=o	9%O10f.;P19@hq<%7x<K1qmGGQVh@jp #K=*%YhFHtqxD =@z<`E_ЯQBL<RKg)t6OGF:W@Q/`=N_n_
=1Mذ+OJq3z\YTޢ^OQN4șXy[~h@7g`o><<<<<<<<<<<<<<<<<<}6*  