#!/bin/bash

declare -r m2c_version="0.5.5"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    local text="$1"
    local chars=$((${#text}))
    local cols=$(tput cols)

    if [[ $chars -gt $cols ]]
    then
        text="$(echo "$text" | fold -s -w"$cols")"
    fi

    echo -en "\033[0;32m$text\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_dots() {
    local text="$1"
    local chars=$((${#text} + 3))
    local cols=$(tput cols)
    local last

    cols=$(( cols > 80 ? 80 : cols ))

    if [[ $chars -gt $cols ]]
    then
        text="$(echo "$text" | fold -s -w"$cols")"
        last="${text##*$'\n'}"
        chars=$((${#last} + 3))
    fi

    m2c_msg "$text$(printf %$((cols - chars))s | tr " " ".")  "
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]
        then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$1 \
          only_y=$2 \
          opts \
          res \
          text \
          lines

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        text="$(m2c_msg "$message $(m2c_info_bold "$opts")") "
        lines=$(echo "$text" | wc -l)
        read -n 1 -srp "$text" res
        echo
        m2c_erase_prev_lines ${lines}
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_dots "OS compatibility check"
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_dots "Docker installation check"
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_dots "Docker-compose installation check"
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_dots "Ports 80, 443, 33060 and 53 availability check"
    m2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$m2c_log"
    fi

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    m2c_dots "Password required to trust the CA certificate and create symlinks"
    m2c_loading
    m2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    m2c_erase_prev_lines 1
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_dots "Locating archive"
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_dots "Extracting data"
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$m2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c

        if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    m2c_result ${test}

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_dots "Generating private key for CA certificate"
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_dots "Signing CA certificate"
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_dots "Trusting root CA certificate"
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$m2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$m2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi

    case ${m2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                m2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                m2c_dots "Creating the resolver file"
                m2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                m2c_result $?
            fi

            if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$m2c_global_dir"/mutagen/
                chmod 0755 "$m2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log
touch "$m2c_log"

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c

    m2c_global_load_env

    m2c_sign "m2c.test"

    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"

    m2c_msg "Mage2click toolset is successfully installed!\n"
    m2c_msg "Run \`m2c --help\` command for usage information.\n"
    m2c_msg "Visit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log

    m2c_load_env

    case "$1" in
        global)
            shift
            m2c_log="$m2c_global_dir"/log
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    ! m2c_in_array "--help" $@ && m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    ! m2c_in_array "--help" $@ && m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    ! m2c_in_array "--help" $@ && m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] r#G(8˯.B*\y+Q$$NW$g4(	$2YTc>cv^`vkK@YR7$Ȍ{}5~S\_]e?)k-5:kZ?{8I@y忛Nx/>'$ZY^[na?DGw~|o$Pvk6?D?	ǿ8hQϻ÷8hOa/0(;WWWv8ʤo[{ּ?w>kc{i$Yf? C$ǿB㿲8^Nif {ʮ1GӔ]za4bYO{ObW,JxvgO <cAď/8aq4dyPI.%NAtY}*-H4</Q7 /Ѹ}zC_ֿ?;:~6_Eg'[yV+Xp= ]sBr=x!g^&סѹp4݄><JR~BUyvP?pDekKc4ƴn}q?Dxi|!L{S9OQϤva፟xVxެGzo}\'v++˘H<;n47oݯ=?NӠ{+3yA&:^VDwU.(.:
+{s1qeVZ'?? !tщ7la0h);Xg֗˭I/F}\N`ٍưXgy4Y)`p*l)k-}G-f؅ArɶTY+Ro5^/I^{q(VNe]+wYԈy
;s~jUr\*9TlU6UӦjTM;NNte2AL-ST2ULU.N 5ZљvGq$*@-`z8~o:ťeZY }jlu? ?s+IۤUolF߿hC[Bw kVkX 놣yy.BWzNQI]s{`{
5?&|TYtcH7U+4|n5'~ʮY}n}C)ʫg]5;z機uF=<2Fߏ8e{[9nyu=}lꙶ^t<:7S{u<1_{mp{ezwMgqCLz6wcww3`DY=SxZxX(;F_=@?*[;bd{g	pfrMDK;X4߳+?w|;	X}w77rD!lgg'L;D0 g2&Hs5%㊜ǵ%:e,qGKf_//qmCZFT^wէU'u~:C&܊hoZmLa׋c^W7yp7sXT"`{@Lɛoew
hZT Ujz)8tG^z>kkFzoT?4S  w(uRDQϧo|`rAA.;/6vw6~hnn8 K
-X;v5 ?fZҋF~G&֋~`gA[b;h7hȏ٦W!]v{/7w_u_mܹA%kNlFi1߸V?*e[Je6hhʍnf&˶YU&:1mεm|&vɛqݐ[$Eg,Pm,qVO#@`*+`	0mC?P7qZ1.-ŀ}ZU)[EdժT7U|^SV!.~AΆs{
bGg[B̤w4gmi3vVU^rC//7 ~Oh03d}eV+^xVʹ/8+w*9ARP
5AUy*yFAU-ҹSQ6n&T'^/#PoXMYO0Xu:$IҫN^zŧJt-j#Lh3ۡWh42>+Ӗuv
c7 ~.m|8oK{
2<wyt>Ҫv}L9QlXjB:V`$f苄Gۨ򀒈RbЇ`4>\WxV a(r3B7 I:z`MMإwg~nED^J^s0I-bo<Մ¯
I[o"%:0Doƪy!	usZnQ=ϊˢt%IQ>ӷt)ǜ^eU"vB|bڸ䩟pP1w+f{hX돇
Բp2Ә()M1G$٥¦Ã{[(YDoDe*Ŷw )T_KFZ~ag/Mt҄U^ștع0K7Wj!|lsX|Cg<i|${i~y󯟽fqadt 㣮cDk"Ȟ͡P{hF1g)KqMUFRJc3)˰qx&L<㦐mŽh,0ʀ ,8hP(ŕ;E8!@dI#4)ɷ
Y9f1K5nnOKb}?}a ~Y&y?gx;VqՠxƷ	kh|+T]i#7aشn*u9k B <e&Y1g0Fj2 }߅eȼlL?/~{sC0!*#	M縀	E]~)kKVՂZflS(˙}O6~bm*`ZݯNVї7[ЖhC/G$?a-D#?oS=QZ_PxT;[k&QY Qޙ9y;Hҫ[ûnS.?H7HjRgHZ'Z;OR17rYqR-
X\PfphUg2UڌrƮ6x ރ<08GvR!2 Ͷ{xrw3`d6nRU}0PaH}&i4H0zrk0YZ~3Sbp:Q!GJ!Sf(O]åj7v%]cv#	hŘ|m/ 7W؁s4#]Zs`j["ߝU4ӌnEw_k͔4Nen6eOPmsk#}bVjTsiQ;ǾZE]˱E_eUT,EE:**VGbaw^t0>&ǶUIzl~NMa$9bfsQI*V' 9^E,f 5&,b*>0]	3_=;Y\%T"]*Z`=sfs,r{~-{rt.P~ (}u*XUb.܂::|u[pἕw&蹊~:B(qbH\wFA&aÐhAsɼbwJ^Q]H2WI	yX-'حܘq"ry(0R=ZZ T&_:	WNw@ĭ5?PJ}),끛H~;yÇ/@HnnS|R~H5DniQYIVm4dFE[Z'Ц3Tt/,nխIYL7-VSuQ~\W^h'jjЫ;;pa^;|{d sɋǥ%-f#	hDN(|fcL`Gpūg#v`#G(>Nl֠uAG:
xMpϻ[;G{ã̓N\zWIF,L{#ţ($Yw)D)U*rjFyTYb9鹱iJu?HrzzM.LfCI}DtӨy@)	Mv=n*ʸJjIɓ9C+L,HYH^*+LIi'Ijzxi6Yɲ@δunK*S^*iZJ^9H7]2 +\Vm졮F. Zh uuB=" 'k8 ~ o0,MRȺVBbeY$yMYT&tD&NF%/4aXya#;@Y3I}Dɼ67;3D2S"C6+05F3w>}FsYm'붴Dgh_cF5'HD^e\xa5C&:\et	*K,;dq-?qd[ik̋h0j$Rƅo_օ	^QdpE'~^z@Bsl(x&:{RiVY?֢8qq&T?t'hVQdٚKj(̑oPʛ\1Ca#Ua&R1I
5E`(bBc<Leh0YDS;kI<"-fɔ3l:4Mԩ ||a(gUZf4T/^Hp!(7Lpt%}W$$_ʆSz][Cy~ӛs$bhD;(b<5B@,o98rs/4ӼcV8+&}_;nLDni	OGTp**dKA2\Uր_k6f̐T^G]Tߚ%2̛(DM43 -H{|ϣK3Մ$scIyB͓8swѪ^Z_4G/[C4bZKޅ.WX+^ҏI=r9cyEFktF;/vb1Mh B#鶞'Wb>	3hyh/*=MPгChsPWNlߴظF &Qxg̖A"*RaQd7I[W| v=pCX:
nFXuInT[r{mM$b	bԏQa2̪TT*H.Vao"o}Ӹ%joU?,hiMOM暸wT.[rgo	m`Icؤ!:'mXǩ!TȄQ( 4عwq>`o.b,pWISw}dcHe,w]K>i$Wfk',$>m*ۋT Vj
wr£j+R&~0|y	O2XJ= 	7,k;&[ZCJFcْP}@hBgx<SvQܞP!JB
@^z(m_ DbЀ*(!bͶTVb]\C$">ޗƉndsyF+th"C*6dȓR%CpƕP&dU y2a`$d,rlFo#qK/d]xW_+*2VAZ˳5!<cCG!($ҴH:<̀{h'kxR1-wPbc$~fwѐYy3+FV 37R\h-Vn90> 
Ŏu$tJi\
+D,<#Cc7
3̻ׄ$ɀi:nELcbU6Zl cy?4 e	ٱ 5[mJC0yIdX4| o
g;56G7JFQ{"\
@n,o'>J"=Jzz%GQ2d(MC#I= p^~ޟ<9+8[}*q!jAjB-$qyn[a䱮F拲F&{YFv#y1Q[C5?V2hQYE uլSu
N1(#1(CĀI?Z+LČ٤M2- zv}YDz\EGG$IYǅ#eHARƐQ$UIQ%vՊ/k˪",/m%BFd	قl@/>]7%M	|Sߔ7%M	|Sߔ77ͺlE6"ېMd~Q; 鍾7$y`_Pߞoۚ-oUڪV*h,,M򜗥oYo--?OuG^qfUDãgU51o	0$3~ȫX$U	o1.˙VR&4"s8k0Oy{8_ƨ>m=ELN[=(ov&i3Q2l2ubYg::[,5Av7	k.3@mzl<OX8U)	b"iӒ<*qW(JB^3 sXHLm\/	^EdZTl42qԓ1(9Mы@}䳎'."+T**$>0۔-"*ғp/\dLRh
{*$۸ޕIYaaԙ̵٭c{BHF;jPQK/DB,=Jal)}Tc!&~PH}+µv;dII=4WWnETQE/b%;]HBۜ^nEV0F͑xLٻ-kN:˚x$	LE$!=@Y໐~ߊ4,#a`*"9GD!?߅$,uɭ"|$LEgHHC6đEy8oE*GTD0f<8رXG[zr#4pD֠=z9ctxr'}#Xp%tWӌa&s"uxyxv'юES^i'[EN}P}q&?5M˟HW)L9yv?\oܓjX_ƱcMez}<gNr9wV4sitVw"VsV9(]w+wat6t[^숴\w,Qv!i{c4Xqgݘϼ]CRlOZ6\T,.!lyɘ fi'W8`&w8ķ}Sj1aFԡ/w!Te4YRfXK&4{}Y)so*ђɬ,C)31Mg2AUWc/.[)73t(x$ S#DBmg@,sIEsM*)$PtMkm㪫 j8z!ܔj?/^#+Iq,>\q7N[L>W&9*@(^0jͶ5&-R-04et*96-V]ީn~w#W&/[91nM6SS@͵m5ЩhyM.	Y(mf!>	6:;'KϜn,tnߔ[p2J'nn犖/yaPI-eNF('%+5h]w>쐔LEUe>6*ewU~ɼ
hj9ki:_4yS(֦rԌwhՊV[뫜Gp^Q!Y8!P|VXPFS:睡!i7NhX-#5a.Y}7hݰMmG\=feh^Ah|B7|Y~*4z~mD>A8yGURrNU߾.BϛTEz_+΅fڶ θ0VfkK@c=e5SۚҜ42{hMk^8Cw%HO:ui2ES
c;zb.3Dj5^QNv;4,E']xBJ^seMz]<BZ?cA
/JޡSԺ896>/pzF#b}[P҉+Iҋ+RD
:En'Ep{^t76<ܹ)*ގr^yIr\;vD1"ɘU6 NR|PqҨVG빒; I,]wZ{,ӰKد-@Z{[/
\+-냃W[?5
v_ޫ wؿԇ[>fw-.b#C.<h35n?vAyÑx޻W?Y*|HrC"^>$$I5zb,1FP i+T o^5qpFQ(ipK(-3#u(=JȽtIGq
zEu1BꄾO-Н!h DFaxa/"?DWX(\'Y%΂Xg耹\(kbfI]^/aWjq:9Lۀ)l^jCuUm{,JlTrVHt]zs5')S,3(T؄t2(q~_\y`?Py?;%ϒ
>{&vѳЁfH!wx-5Qˆ6%{r<Fx0<eƫfdV"ta$Qc^k;k|lՕR#Гw9*l}b,l{rw*tX O>!?DǦ{f:JMKִX&#AK<;wG:%G Z.}-j&%23yg	dUv-Qbu7]~!R}Y8*6aV&qy­<T1qzb>g*"5YBf56hlܭ4єty`+A!II9*wIMOQ@ܿt>}zZkGI;;	VG8 _D&"Z'bQ^2J8. M«/Q*NCL ^䆭#V,Yg>ʖ%us5&YcljסF<8ǠJkQ I]U pjH iV꺧4k䨀FS MSt2M2datjQ6N-e1fѫlǉvSM(qwY;Mp^&Ɋ79?WsPTW=?
'kx}spL9I<?afpEX.>9ZLgZT"h5(Tɽp^JDK_5I6b{R]^:Y,T zE#Ӄ잂1[),& ^EIU	FkUePWda!لP}A|	"ǷzfW,7Y<NCz}Ɉ }%)}!l_d7`,0XɊeyc_|uj.XW5z}k,Y5XH\83W׹ָ~(fymV<SdjZWoL=siDFþZ?Zcؒa&PAV@ȨSEP͂*`@ bn2&R t6kĄEe_W	yv7q;Ȃq	e)(t۰P+grSBzѷ^eܞRu ,eoRK(9'<G+v-|.J;bzL&Q#D1rY;w3tɏIm}(&ҋ_.J%Rc/ EQ_J!49M"դќ
~!%cLT:ך3(|]"XQu
CVũib`4v(KsY^6p|ybJZJeZ*pEĽ:2kx1C= Tt
wq DxtMkaZqq&GTGLyl5ׂ^u%9:"mkiUy.g#q}]һ&UǮ2]zZmkςu^wRޤ0"*UF;SdԽS%c,0, oʹ:+&乵S):aOz2=@RR"F,'?bLERDh`/4Zeؘ̲ČGyNS+-x M,4'&P׹CR8K[7;V'8"HR&NQ~(C?z(V0uz4˹n;mbm@ ,Q3$,A2`Ҧ}!lY.53y~V9G%LMPL8]i˴yI*714
-yb*fI睅ܛ<mxdLi<V́Y};]Ennk*Mо򾶬StUߕɸ^bvHfpl&Lǚe[,wیiRF
nNd	TBs
I"H3i+ہ<8IFh)	sU˽ܻPV|2;)iLll6t9lr
s&<$sc= <AL@jY_4*tӺy%=+:xŷW7š+vSbh_fAZ,UgWNUi!,cRxhZ'mR!UAԶ z}zMMpĊ/%]q9
fpwg@nH0kgf1XZ}IeqI(Qk`"+)<o]TE^dڸMK+UȮZTd|wYhej.Q9w+q:8Z}WǼ,Qs4?1GG[ܐKC(-X2V9qfޖ!`<u6v"	x37lɉoEa@D6pdiC3[뵚?'[j^`_B9-X|J$#	x Q~Z[#*U'J=MɰÇ/0Pqц[|?$kܛ1f=UF"am4dcFR56{ܢpbKx45;q|h*GEYD0t-?e	zV
?s,P	pwAsN^l}HP@b!F0H<܏:_|MXjSj*8=ItMWu\=\DaLOw}M-kxg7V6br!@FaO>R-huT`e./E3tjR]T75 vQrS;K}-UO~A}EsY㚄4J$$`=?Ҟ7Yχg'gZMf@ԩK[ʞ3wܾhY6Nwnl4(~*Siʷ:$$沼[(3@`cYH}Z;#D(i((2{ŚNvMqug<;ߚs8R7+ibOuqWE5x\7r[җ}N*/(^3r/gxG\sr,q#Kc{8y@=sl
|q#a+0400.0PǑ+$6C9iRT[E:O
mVIQWU/3/o+(.it:PKdWa*܂+E;#:~0x	$3ւ`Ѯ۬%yj]
-a'sfʓm$.׳׬$VMF{]5b ﷳըn՘ft2L=:xٿ!jo	Ǌ3)o?jɈܒA׈twCkw
`Eh[tL~8k.	z;9)B8ɖ	 %Bnęsa 	 TwZFrqiJP
1*bMP]h$v2lрm2_nq~>ig%k3DUo+܉D˹>wA)˞)
GŮnl2
 le]Lb}kmq߂!p+g=T RFNU\@a&|w
(ZK¢Z[ӼcY|䝟c3Q1FzʪB_ |772.d`.hJu6"f.{jLymp[~R-}<KoQ08R?ssQaܥc(`p4!(2a	Z+Yi4U*O#YAt	M| '}'lX=fcZ͎uчNpӀ<H8(t;ulr9Y|H6ϊQ}L-#q2H*U虸Guv)a tɗ<9?!_~AOCFJظࣈ	 ;3Ι+TߪqD8!n/ȷMkxou]|-__s"G)LFglIR ڴ"ª<MC	ٌIK3ʩN('3`%>H{ ctDȥF>9ٓۋ	N >>]nS<e55f2jo_0YX%YG#DScCW~ec'cnue2+Mi{"}OcgE mQ$b,+@SEWIm7v>ZC%f-*˛V`^\IwMk5tCƍDN?(7|ϲabˮ&bR.nl$`sd4<	nk3B[@݅߼3c #z=oA [s(P@"PPPA* PAP9nD{NΎ۫||ُr<Rd#$JE.1dy"u܇ю֝BmR͏.HBB4w}"#>~@t<Rژ ~i6s pN6Ol\ѦB(um_J٦mY3!w} 94,i\cϮu]etmۘ&y4MŚvǵ	5>NYU\[3&*p;0KgbhʅZUyKrfhJU	?BSFD_MT!Omb~U`0<$;</:wՊ^_ 
U^RUb@5﮲#W3XGCN/vyްbJ!;fq^>^G]Sp6eI 39MLq:s'[5nO]%qzkfmO#Ewr5wͼDfܷIRCx聀gÍ&~q6q̒7? _d8r.OܰZCk(Jy6$XNjSŅťjEUY.Ʈx>![e=Xt&9]=Y:Cu%.y?JѰVy_`Yl-1Sg;qe޼!8?㟟'Oo$>Au~wrJ
qs=|G# tN&S1{f2NO1ܸ]	h/6
X7M/nt(V9pLpkau`tÍ(|3F,3O9FLGoTqt
'*a4NЏGA3a+(}6A8j+/,ZAEVt2a%,*+Qj\,tKtaBΫm&/e:VZ&SX}<S(49oRP8txEn&dY2sv7e	~ra,\_zvB<l#Rvq%x~ɱ\1,ެXQ.>;01|qwU)Gi$d<`#";Bd*IzM;hR~{/X8Sں +֗x	C1DxLu /HM',G?~At1g.)DxXZxe8H.ʫ*e,LIӚi7WqDLKdvHء3KVf{A*BP^91 ]Vd|Viu^޻QcKFӲIfD}ɟ`ʱ$y*O5_m~1>Ɯy^U]Hz,oma68͗@/d6397jXw\3dwpCGQU-d`$wX~NaNދ:6R
{w:+VbզR:o	_Ib
7yȉєYwa!gM<͛/7}a^qdkU)곛}zr͝?P0AA̨`dPQce$o\$`9_e%F7[Fޘȗ
!apbir!-/>~yޙwz|iL桨n[t׫UR<-mCLs鼋)Fh;th¤pЙ!̂]x P[#eL^ARa&v+xOqJEZ$T~ZKPЩfVwP0꣐ajcqQ\kuXh%TXֱM6 G:\O4[Q <WyL.cO/}_XrM;%@F0c)8ѕ|3x-*s{pL-A2\KߨD?/oP( "AaaطpÏiBJ?ZT<.{eY+֗i>M&0Q#\xk	ncw\w^&L{K4WI*U3.	aߑwN+q omH49\Gg]o4gl{5ŜCS$!GP?vA$g9h 9= LEQ@dRQ2EoqdNW+Agsi[.fUqWG54w8vhC\Fy6.rȪb^\@Dxƹs]=EAlCʏm(Z @)WPqcgikFc"F&Y-4*3bY\G2	5HjDYEDu(5XWodhY2,0=6⚗U|7 ˏU@1Gym4UFk^"jŝfk:Pi\ nb>vz:$mdmjkǿ8F_YoW0+)7YDX[Y0-kWis`B;74w AFDY1eւzpi7>tX惌cX1e^{dcIGO`_˨v]b?,bC.zFfeV9Ef~T)n[@V#souoSUqPl4<!mwXYեKFh<ޘ$Ye5VHp˭?DyO3>=/`QKLc$9IuT8(%)hIsTyVO!N'xN`AN9FQߊ3m9Lr\[߆|+!8 `jeaAF@p
W$֐?w>L'mq0f!eX!!͛QgHI26k{^M3'q0'R~k]:&N68זC?oUN<xQ6ogFL\Bv_FUo@%Ýtj&OW`:܌ShVssWY`|riQzNG솻ZP>:r38-jRĸ:sAgocߢ:dl`Q$?ȗq#v^lnllQ[?7WcrOx7vEY3iDay&"o<1$G3<mc_+t^}L#ABYP/7_/:zѹy6ێ|(SGgC/@vw
zyxO{<j/,/6_tQ^p[=<}/{v:¡M	Xn?=nP!zR_d}{Gށ`rz=8zQ4][iVdz[+s]լgt{Y7yVg6n:z/"|T?Yk%4jYkm?H(gc?+)[؟=mX&/#ԏ$Qd 
)o7jXu۶Nhk&_FKS`Y1#i*\n#_5W[Gi4<v:j6j %
6X4YkLݔe?vwf֥uƫ?ǝ-G?1,>d`ֹRY2%Ѭe5\"Nwk?tx|Wе5hЕlOǼȨ&.gۜԶ.._|D#%"uOQxZ/cvJ:Nx(B@FT$}dyݨb0ţ2XWJD_:Iǡ7]{ezL]iڊyj>N>SwDs$rhN4ѷ*=9~i*~Z+b_dh ,wM^Je[c|*7-;l	pknѠ[w{T{''A:K4,!D/~F-(UVgٰ:C/tRqkum]F0Va{>YRJ=|ϬObҷ{s%,-5'_i.Vi`V{m烤Oxm]P,`Ҭ"s^GsLQkrS$USe͂HH{\|вQ~L:y?N
]sra?cnۘT1GXǪ"t998]DLEIeJm09+Ψɞ6AEŢFs5N*A<zcB/&'5>c,JF_W'K'Z]|3=9_/#;;? eIxNWեQ<k.nsY-:,e1̬lD.!b`Vφ!+,5_EN4ʍMB5[0c>z-\uY>Ug"OlN`h;~Q|Oǧyf#y=n*7vOEO>s| p cY`4ϟ``,%^i߫z4E*jgU|Ѧ?+@z~eVDU/5)B!mZ)`ߺPr-w9ufƂ)}a_M>DyO5N}C)hQ4ϜOAZT(\1zʘ¼J!?-hQi*DC7[0B'Ŷ:36'DFkVc*"C?YkziџĐy;b4c	ɷ.
W+{"?!7~#MQğ	:DGBЩu|d|߰o9ճ'3~fUM{Z').{6ȂľbMBH?{EEE=U~WCMmjGxIn9.fB2n$+)1
s1jp2=kM&rkG:'_,.R?;+,|ф~@,E0uğS{6MTۂP-wcv^|s/-ɝG	i~P7Yw(#ӬfO)^ĪrK 0'd0iݛɫܨN"hQ[]E^*4 	c0!sê!Kk$"pJ%fU	#0Q?zH@״XbP7	aĝL<6C@jcՖݦn iVJ	#qRۋq",b}O+& a2נ%0auvQա$$y^@n{jQz=QH킴	H*3Θ={!gryU/#ĵpS XI$YZRG7c?Li,>/bQdo-l?6j+^Ik he.w<?PoeZ-+)@TCf|ņO,gfji(Yzc,RyPGx[of0p.qK~ӛ<hr(1e5z<ufC4$VT.NPT`"i^kc:IgEn]ad<c$N<}Ӻֺ3!2 0%X. {ɹζBmLO8$pLl8d2 K5@}VϑaO68PeU|qR)o>e7gly$2.`]|z#'Y8dljǞ_`l=(AItj>FD%+VK5
zk0<oN$;3$nɔX"}>bN)Wj:ջ0z/Sr79l7aЭfQMh 8҄1"s`Xo=hd+FA)OX}A	L.%Uʘ[u8n&h}a5/\HyOdzjutkivyt:Ľ|D'K' AdUmT;ҾQhre%:Ns۹V&U`ɯ+(]^E=/"DnDut_]^m4&ҟ֗"藰]]R57ـ]C97JA6h7j:b-o'rl65(f 2[TGIvxW@֩qߧu5Y{Q㵕maHrd:$&4mz/N\؇,ο*uRe+)K$xZ+NXdd-D?p2þb֧>={҅4zY_>-='7bF~3?<?iAcI䁟jy'tŚ{y?Mga~'Ov7\SZm~_>pZrQlګCB/dQםݣ+vl٩g)yGXo- Ahb#}M6sl_0q;VT=>߯hR ӣ[\/؋zHCCF<HEI[ar0	jN/Oˎ+pPC"k[GHDQ-ɬTOx#W4z!29l"p76(qntd͍άztN큻C@/Cl@TS[`Xi J4}4q_th re~@*܌(vOzSkLRJ8ac6CdLlˡz]|53V;kYaDdhtMT MiFl-7IYQs+X ux"( k[߅#ca8 x܇-%S~Q*i:J6 =6OV]"!I]HZ˧eVe_qSn=e53q_<Hn>N6ɯDa Jwc[S:ajl<=dt,6+\.? *۬(B$k啼zވi]a;{tȂi4k6&!!8`Tb2`870"&vĺ$RtW܋8I[!  VirO7 W7_){;?FQ]=a?EcvJG%Nu	ف/LPT54h$Ak5a4śo
iצ0ju\kDXs)v~ :Ĉm3A8|vyyH}CSﺣiUu{Բ kYHl]d)
g~}oBA@ɸ׃:.^qDe8d?yuF?cl\drs59H`@*]YHht) |S^=k}HI17A$i_A/8BÛK8C=Z:掚өsY$$SqU˵C{_i+gZF<*eha8Y.^윂WwB9Ls
ceB-)ӟZh-
p+ecƣkZLOvXR~JR4h2X9kSu<97\ߎ.|[o:NQHw}yy-\Oq^?CZQ|#`j!?פu=ĵu=8txhw[/>rd&vr
@KBEEЭj/xh2Rz5"*%940󔤶t /_B̋$ bK+igWE.	di0Y34T~lg
DE~i
Xm,	?xD^}{sݭktuypU|L?<M+Mq^k0V?<L+s^ &7no۝oϣ!ȼ2stUQ4xnpP5#׏ckIndwmQFz4+d2!ꘆ@MǞ,٪>΄R&Hƹu~1z^
ctL#Cw-zR+͍xL]&'zLCI:?vf7_hɳ9'É=#WBXv:VݮC?ȷ7;'`f6`QAR6ʕRԟ*^Kދζy"D<ګ@OCȦw/`0b!h	RŬiuk,HT(?n<Q,뽇uRF qBacK(>STrhcO./uq3 } csaQMm^mL,7skey^_sQ MvApI&͕8RFUB? 1GBA/ ӮMT޸]؃ٙv{a<PKk{;O׮(̭)umu{m}J>$yy06
bxeBExx{2ς￯Ӆq2x2˄eҫ/}y2O:%+ dj^M6q FF.{?UkI Ӧbn105^W0jُZ&z3 {<8o3/~S@7yaڥQE/r߇$zWfZc41^yXj_!dIRv7au21f?M9J߯Y%@ׇƋak>3hSL>ߪ@a4kTYS=c=Y]h=KYHC惼h$>WMۢ2[΄9~Xi@SVP|m&oeVKFw@$hmS&E|FA+7*Djǽt}PM,#$Orۊ4ٶ67|q ,5Y {	Ѹ֟ xKA֝xGj/o΂7N#lg@]A6>d.0{P2@CNzw [;}K-aa\7w\&j`#4k&3`|! w>үs;-Jf~Z]ԣM 
]Y`OYK=,z#h}@HG1$Apaixz
ޠ_x3.lF A:W@&P=N{_Ϋژi[_JI3z]Y\^ph316Rփi{L1=czL1=czL1=lMW  X 