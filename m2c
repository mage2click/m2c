#!/bin/bash

declare -r m2c_version="0.2.22"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]
        then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$(m2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(m2c_msg "$message $(m2c_info_bold "$opts")") " res
        m2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_msg "OS compatibility check.................................................  "
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_msg "Docker installation check..............................................  "
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_msg "Docker-compose installation check......................................  "
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_msg "Ports 80 and 443 availability check....................................  "
    m2c_loading

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 80 is already used by some other service." >"$m2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 443 is already used by some other service." >"$m2c_log"
            test=1
        fi
    fi
    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_msg "Locating archive.......................................................  "
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_msg "Extracting data........................................................  "
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$m2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
      ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c
      if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]
      then
          mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
      else
          rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
      fi
    fi
    m2c_result ${test}

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_msg "Generating private key for CA certificate..............................  "
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Signing CA certificate.................................................  "
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Password is required to trust CA certificate...........................  "
        m2c_loading
        m2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
        do
            exit 1
        done
        tput civis
        m2c_erase_prev_lines 1

        m2c_msg "Trusting root CA certificate...........................................  "
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-certificates
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust && sudo update-ca-trust enable
                    test=$?
                else
                    echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi

    case ${m2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                m2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                m2c_msg "Password is required to create resolver file...........................  "
                m2c_loading
                m2c_result 0
                tput cnorm
                while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
                do
                    exit 1
                done
                tput civis
                m2c_erase_prev_lines 1

                m2c_msg "Creating the resolver file.............................................  "
                m2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                m2c_result $?
            fi

            if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$m2c_global_dir"/mutagen/
                chmod 0755 "$m2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log
touch "$m2c_log"

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c
    m2c_sign "m2c.test"
    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"
    m2c_msg "Mage2click toolset is successfully installed! \n\nRun \`m2c --help\` command for usage information. \nVisit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log
    m2c_load_project_env

    case "$1" in
        global)
            shift
            m2c_log="$m2c_global_dir"/log
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up)
                    m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|down|info|remove|restart|start|status|stop|update)
                    m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ӝ] ]w㶲(x+ŽmH}[8n'm;vh%Q!)ϺO>9s׺sךYaf5LU ԇv'{I[
BU *#_Ojv?kNf]ojݴ`O=(vC@~f>vr2hG;y*Q4<`ۍz^k9NP{/d,okVǿn4>c\7ZNPd~0>,FӮ;uF0]kjMuaC?' z>}<'qI?ڃS8tu =ZƬw2>Jwsc|·މSY >8g6~nP7ZƳ3O`Χ?΃Ks.)㵘]	6`qBsb_ >/ى?S/)E^x;	0p=<vxLAȃ1eeXx5n豱;$ٳ+_X 8f
}):OOhTXps0 \@]3"r}c pë@3y\tfB,b^D\Fo(us<*+`J٪Mhxuf;{a3N0naYOJO}Fw++o4ǻ̅rXiS+A!c%~w>}x}&QFw-Na+*0[Jc0̘
/!.bbTSqI|]2NBQVx_ݝ{2uuNnØ?~|ʊcYՏGhf0HQӐXVn1h;on0eo`:qן˃6#^9WV^2D~tvٶ^jV+5*v(}Lҁ2Jo6o:צ;}(!&l&6	ds9qC` \C؏GMScY0::/T!EyȮy$l^fF2X M>K+,2_0넕VUuGCw%E۬*
ABVAdRaϫ:yksXc7(kWW2Y뚓9rϽ@,O4+]'g:|RF&|#[W.!q0Z{!G^̮iMڿrh=M&`u6WM~V28l(0	x;ۯv^mתL[o^>`WˣfBJ̓-mnǣ]dN	6aoY0q!4ta&kU
""jAmJl{=1J|pӈ	`&6z*pƽǏ>hڋ/>Fw]]ul aGR£?*sw`<s
<jk:u\#d. O.dm+[[7޺ֿ֯Ԭ;%ZkOZag嵲qP^<L4ɕ7	F#7LU߀6[љ71hoPH#mݵ;'ѻP6Yt[ti0M' IZ'ghg֦ppx1A 6ߑ7-j|qG4zB~Fmþ'dA#kk|)$	}+'m׫1BѪzSe)sh1GT,Vq?:HpR*xjsWGz_P2{e%T["SSYnſ.]F{S*-Gn@(rf!5yC(rtnAD^s0l\`E	&0#7ǥ H Ml` 0Տ_$O/t'@|J%0.iY3&@ˉMP$WƄn(>Ĭ&\&L(qN΂DYhFݫхy3B3Pz'J8닮6`\z4ׇy [P+}ŷM|< {
@mٟܩQ ϛ{wd[49YDxm~? En?'P'۲h0+ 5Ϲ$쥳
ԌM/6&zb֔0n<} f699 ZXk9o;B	"ހ^4< @8O!f{iKtjByw|x@TJ9PJ 1#v럹SoP)efDc/A~Y*ȧ۲μ!Pe9aJR@q[	}ݩe根1DW*0B$h^%3ܗ-׳ |U\u'45sItv)dqIغlfvkZZMtOzyԙdsnӛ(V7/66$`:(ɇYG(%),ڙGpF:{w8VeYDe7_㿛Jr; YyV|9v?Y}/!"qB1'kDYc|5(}@1Ȭy%{[%tO˗%Y屵b{oٻz~ïZ!dMӐҲf`&2Uc̲ 0#Z_,1Ne߄&t\xOCWɹ)}lTX-ڿo[VNloᑃ%$)J[WQƞ0#u'>:~77$}*uNłhNؿZBV.*zƔYWdWǕut+Ǐ<ѫG
P9Uc߲	B&ATSD2Bύ[?LAERZBw6$_~}N@ܽTu+3ċ
 %l0ߏbtJ9^
ۛhp$fGF0lv%?jTRkeEnAvR(b	嚥y+]15}>0CeE#@my+coyީDj9		r')I'TYI\YInb/i|.<\W1Ip6{# zɷ]lM,_DiքVZkb7FNywʼN2t[ᰰtX|2,6LclVJvcC{!L@pЗĖo,Ɨ[Ѳ<4ǧmR;3I~no )jP?A>	}R. ]\`i<CBQ ;'$_H2m%2_ۚ(ЉcM,4-m$ \aI/VCnYsnݮ5+-
X5@S[rV[9,DX(A(QdKL
VP+v5-DjA/aOSu4"ա]fi:d愉5`̿S&IWׅbPLXleݽX2vbO0n[bEF0-Zϸh#r{nA\r4,:x?[z} V?(@_$ʴfgiIGܠ﹋f捱Ihs삥%us~qgxca	ܠxu?K;`&u'? +XQ\fg%e+M.})ɾd_9+/lJ-]_NE:qaƗr`ەh}~]6|id8N!#;)}S(EŒ$l-v`Dׇ1&(7k90z	KQ5S-=?:V2|Is-ξ*[*gbCwWO:Yz􊚽U+_Uja~~$ǭVK|qc_]nbÊ͑܊'mѶ/mݶHCmG"jx-(m8×9A	iH]zV<w(:+GVl{^I|]'>I,ݢe6˲ᱸ;ZJn$(
W2C%D2cw'H'umN4iE}7GX.gBXa8DsB(R_FQN:sNtRG,"$FAs>EnO[ȇMnIzipodr{N^TNlz<i(@(đnA}?ZcNiN ֕p:f"@m$og`0Z4R8dwIؙ9>)?Ѓ_3J~$/iػU{CUgh[̂ƌ27c90|';!GLxLw%4tFx. OE e*cHq;vxSTV~tq3x!8`lHQ}I%	
ϥfRBnr(~Q.G_{b5D4ـϧw8CNFb>49ScsIJ
!eYv+DOnr8&^lQ̛OZڂ{AJo8.eܝK&S)lxHqX
R"`.eZڝ2\)8zDϟ۪|uFW؈z2T0Rr=2XH.Jn巳$om@u`-Jȁ1Qz=Neip*(8X9*X2riC삚eUlLy&B=goEQaMzςADK)▰sdn|*#VM͵KJx֖IvE!@_b Jq+ntQT9HÓcj6-d^K%>m;ni/P\揘8Kltʴ<4@@͐8*(CQ!\;i'Sۣ|Gډdk 7"xV Z30
nF/DEJ>,<Ylz7L#(DN[z7"Oh(๦h)jwmDHB:~hY)ķj*L
ҡ~p,8_WݐS;Gïײ׾>ͯdT3Ll4f5045%W?Q8.[6tv32{8m	2hQx&Kл#v9{YP<Cz{dAq>l/fę0Y&L1hnɇ
'P #!N E.}p4ƹTy~ςiN`,Bh("#Ðt~[ϊSߧir2i! Rն#)I]\]L*wv"f;wR&iHi]D7Bv×<	EqcTsRbZ)Ŝw2ʰBӲ{z_؜[SigԨ z<|&qQ#""<G
cBx꘍O n,*yl9,L	M_4R15OFl	+(X~(pT<TH¾$Bp't9)pDlpdn?a`\(i=FiH*s>6D/$N:/'%L:y$7IBI|RqHO&Swwi-,((g@!e!pHǮ|EQrAރN5{Qfސ	i/hF]*@1ڌ6]9ĥ"J=WtQL~5|>aZ0>ݧRׂk#q*uqG]aCogG|gK|6gC|Dtyc$`EЗҔ_K]~q[~1ײYCV!k$ŧ	zM"_$5|M"_$5|͌|M _Zd%YAVA_jЁ03f'|z2k7Io[#VO9,(8	<'$mp N ;be%Yj,^di[~:;iYJR@hҸ9Iɰe	E6L$JfT"s	kr<ah<	PZGcEE^$bQ^VSmơO#,1)Zb:^B|2!7s4;7m-- =LC53eD!R} /2ݳJ%JdʰP%& Z*	-G+7#Lh?h\KEOfOZlǵQ0Eqk[Ԧ/O哰H&f=0ÈحrUDxxr#n]+l* &w7|ݬgzDГYYQ԰FڛK̂0H̕!Fc>a!:t#ay}7_q10Kr)b\i<-=mE_?.u[267ff;lObEq;arG\Ԧˀ=a	erz;hSf*+~%_t;$r)7TkOKS[d}KFzmCsO]e~߈521g9W`
yQmX"㑼ʥ܈-r~18R3!xH{W7bS0Ņ9d/=ɬb\nzr#<OwStPz]cTUK?CpW}R.#Y2݊Ee&'?̍nWy&?O«W+nbt=vEKןހ}̃jeaøu~E2	#[\)7><]Q˷U'4rQH$%4_u;	2d{	Ucv,hUBߏ(I0]Im{!^vȋEC7k[bWe~=%QW^>uT24]1=[HY/\_ʴ =a{=n=otҚWE(b|#^l,u$<Lp38tYL-LӁ,7=}_%f)$(rpu7
&M֦sOhVD'sΡE2\-(ΈgMowzNCƦinP/1*Z]^2G뵼̯RH_jh>=kh+5k倲%;bT^-nʷxaa>ZR[sr03O<ʘ3{˪Vs@~m=y<Fff7ޚaM7k%b G6??4&~pv&WsO8{ND.Ց's.s"Bz&դ?|/]2h[Ӕ|<>˝GJ3igP7͗FU\P+Rr( ny=fMQ<|UOdX@P~%{]"li?`T$$JFBjf9JRNVH%؋b,A"-͸5{77WK}2@Y~E2mu}!'GvJepCUXF8*J솕_KFE3oW%#G	e؇_O쭭挔k]p(͡玧e;`v`wrfhcSHټUfI@%,o{WǤ9Q]0RXt(IBdKS\nΕ`YۣԞ	cxq	$?߾ dƁ u՝L(/јihJG􆌦jU=80\B(xศΕb~ˣno_+(r~+,1q"Rf$Z8tIanaXx:(4Ϝ?3X
{w6Wr9XbWʼ<*M3X'!3ccai.:tǧSV7[/jK%֏{{ۯ~2k0V7j Yw|pMl1GGԅU yx@aҲA\{7,-fzu/8U,pf=d{E/TCM|ƈř7UWͫVo {{ܡ8E&7CAУyht-մ4lR3]jWBoTDg-
 ,܀	!mV Bg'kQ380uǦޥp{zEJ SHj6a~e<Z /Udut!a.w:rwubR+PΎ@NaB"k&o`$"*y^rw(Ҿ A}5@` cyE(-=_j7ī7l[`։
˵k˷k7s>yI&bR8<~9ݵ4YuB7(?!6AL1^!TB72A=Cc/+&s('??MzJy
~&SS*BofF
`UAIEX$Z(v~4lx]\;2syd>cMٽ1ޙ<0E@)t̷fR W|]rW*E2^.+yd=̞ECϛ09JOH&'w8ª#FuqsY2:^RN#)l#	Y5p UV}nNM0v,veL85|D<r*{8d}1k"OXnK!e6NuH\C3ޔQT.J7'fw UVmlɛu:gx+<&\]KQwL01n[/I2Ile㊜@o"b(q|UYpLaRjp$Q=Άhh5Pl y2o[܅_73ڋl-Wn
8[_U͓F2xt~UprWLίT+8Tݖe<΋MzLJ:|9ӥw9-e}rk7jL|=c1^Pg$)r+tT`l9ò盲v	.R3v4I>zu1o4/`+3;"Xx)H8 .[\Mք8d,wY\x0cd1a
{lBR.wUSVx{Ҽc|TIve:gq~vy;y>Bw:1<zYZH!;mp|FKk	.I" 7N@;+IK35@\W߲B ܘ=7{W0ki8M=<j4XTaD91!ngBr1oSj$v8Lr.j|0>]Yo%=}7k@%MRɄdd~vV+L}Y<ԃveAmJ^HLjسf<W_rЊeCaA'KZy|0Ӆ}/"AIW 	y0{֪t'GdkئB ZPavgCvEX-C*YaB*cbYE-TBЧ*(D:.IhJlT\S/7yxcd,80X.Q0	ʴ#?$icc	՝0.j!XwVr$+mL?8EkÌQ&g(xa.$Z@!1"Tq  <&|!Z1<D<Yc
h8f害'Gh[EE7g$$JҝZ/	s`m傢T_8
꽢 ebWȽ$)z333۸d@6;!gv;'!./%,fDyJ<*L,0T]]O_m򪜁UpI>3\%\Ma63TVq̭HCAW@+gW++UWZ\俒/F֮jsGkdn{0GjfcrUFNC,5<*0̍*h;IqdiForߑ-:*	us)Ik1\zkaCsqZk(,vF0ʾ_J+<=Ơ\Js9as$w,Ëi(M_f`_B[N
fZ;jb
Ƚua ,9+47*ofw+6+9h|k^77<ml K͠:!]P5AH>yGTxjbZͻ<m*OӢ`ye4eՙ´-
sCb|U8F0ܜ#$OZSi}-fz/qL^h.ol^<Ȧ=FE9>BeHHY;vr^-Rݾ1^ownú1rcݴ\֝nNB7,*޸v)J=fYMZLlBD:=9<l8k ĵoO!
߽B9Q}%|*VV`4%̡5nqm{tᘪV¶+_\e{:3m%.s#w╥^%3KqP%'Oup6(	o.(`IY#co}<oE⫈ƙ# UiU:V \l" ~q˥GvQ K
E Ni&?9k=Qp,N9=3gl;#2//)d>Th%S,ӻ#,|25iy0<{FQD'1^QKS?D+Y"8y@LlhURQY?l@T/`_u2i񐖈&n3|d~RnGbZOΣ=wl-|?Vv^\_3>17KzY.:IH9:V2LԸwd-9$q"Z2SnIm!U+_Uyak֒ Eٔ%9`8;oMxH62GodVr
?\H{wV͛L	Bzw)0z'1zǏtUKkJ A
n.RAˆ*-Ŝ(q6N8b	لyKܘ	e@fҘۆ}I4t h·V6O
F"-X/T2P
I 6Pd:[^ϤʶBB_c2BuzKwdkiӍ6]"z/|z7<zy{\/,K2<*M72n9P&2Lbn]^؋/ZHDզӈO>Q&0Zz22ILmZui-4x)&^?kJxH"Sc<xy8XMω}q8:sǧ{l<-%axp&/eZ̍dnV@̊WI=zq!|7#ɹlsDgTs?CIß%N(0ՆE9 Y 8"q9N}h٫j Cf+M1([h&u`E_-EvZg
gzT[X-+ |Sݷ@@svwM 6RSx1y6UՅ&~{鎲ӫ~:x:ZQ'̆,k+?ekzgnact~)6Wpʙv~޶)qE2PW@>۝:;k=U(KDdnZ]gԃ99؛>$-*hDrdx}QHj%g\fɹT9vsXǞd7DMy,t$&䖼wMԛ~;"j%˱D\-߫('3<a}ɮB4Ȋ	(RFĴ(r8 OA͋'D2݉9l"j$zkR
y7 X^/ct(Aʊָ۱D;:5,~|s^x
@U ^mon*Us$0HD{~od{'!NfW4Ҕ}[0ѻyƝ04T.4I?Þ60<-:EO\	qY|eR@
Puu/|bD8)3UQN7MdҭG׫eEpZ^}
>(W11rVX}VBz? 2)l3+.0-߈g"ϥ/ʎdIЄp^4l4%>]M+78]+~(>/f{=L?Ok1>mK(^phv8VW6PG4,i@H002#Dr%䂍O^v#D#|pD_0#{+ ^}|)v9bԿCtPzJ'(aVW?|+\4HFӈ∇F<Hi,^4~k/sCOb՚d?m[hQ[.&,j)-ssx1(ތXa0"р"o!$NnFTJz>:Dg7Dx2qi-bnw*9
Y..{s`?JUU"YA77S#oRolNs$},)rw6F͘ONn<-uSmE(-B6[aY'!=Vvn4^j^TprJZqU:"x%F#k~%r4A_|3g.Y9PF5 hrRg6z .(w>w5F`?,]&0?w#:әGv](G #
 5ovg^S^(sjVf3z5$IE.q3:0VZ4e62:SܠOtWu= 3ĥZA"8EǽZ~J,x/f fZ\9@0^Zu#[&0@]6oC9;ƢUAcY#w"&:sּh!Pb-4`]ӫȽ*VV_Ս̸6
<j҉4ȍmi
E|HnvT E,3S
<#9gue}=ީWVB0;5\?˥}Hl?V73㾿v|b^b:6Il}0i/ʵP`J|UzEz=oA0fwyj"JWjQ>[-[KHJ)Ƶtr'ٷENWb%} 9kɆs<L.)9w~'}t#Yīo'V6ͦM1IU߫\QW{qz44{t/^ZYB8RQgQ]YRGg@tV9ѱ%bۑ=>9'RBS8 +EeT^};vጞƚݒ9
6G^}Oc%N`7st7'	S]+lCE3)?$48y>1~)~G.HdΓ0 '1Y]	sOC^μ\
4vG;<zMzgc<0_-P _OќnMs9pJxrL1q+AmǱ7Sc\)ěWS"EVw]M{sš(s?gls~^%ĥ[?w0?r3FfHPr4K\o2y-xo7+wĎz2	"j/ULz^9/iWkL]{JY\*?j7u^c'mw:A&3!
ٌB $W"tO9XrBS5Hu-=ƃ/Z椋R፝-[.34循6Q^i(vK:1	09 Vm4|Ѯi|x]jWIoS2{eh1A (*Bb+嶈Y(o21Pj!tjZm`Hji/Iy`y54[[ؠ9͔0PQ(?
90@+LhzVNW9nۃQ%$=čSfdIf6!C0Xլ%a8ld¨\.4w=lmV`J0Qd[<[Vh}	?prx) mhp]s3>lF8VC[!<tw⿟	0ak0WVb/֝}Cemn|$xixZpf)sr[l-|OwY7z}7'0ȡ]Tbaw?Vom]/̨EM-^"x`67E*zb]8>ykcx#dղ\ᝩ0e3H'7`;.ҾD?YY&"lX$hڎdC~A4VcUfKܘ~9hEk.$ 	:q<x}
OmW>	L.5,?HfU$K2]=YRJu_ZnHܾn;Bz\|XBD%uѐl.%;Q8*
V0`QtHtcW~GTc؋/<Ov7Y2fgX}Q}|2XA(+rc8!ҷ\=J;f@6`U2/jdfCt~<-e9<Z IE*6A$[ozYH2#FKDy>30Pm
.mhL!:@ۈד+t^2y^=SUȝLAp8N"hQ8gOly<"[FBvτiv|/n3-UunoynN\g-u٫"hSC2YB䷶EB
dXiU`Iy=MIp֝gQq_asYw+NDf1>h2z^ paecyc:Bq*Ty\AGy"W#9>/(ɪ|b"ЗxE`ϱt16k7Kٱ iٰдjH?<<fw_GVk7>[4x]o6ڵvVFXQ?S*3AE;ɣyiMԛ/O0'} H0ǳh53mgI_3f<z}fG#w8.<D"YQV.\?>{ztj7'_Y۹:3pZ>\XaґmE;?n".K+`xNDOAmy?HcLp_"+^Ș"
9w89s7XZT	ı>٨VgD]'QYtCޒoؤIo.(2;d|IF&2IY<W}^MPOix0N`0L<
~N?%exdq^P+yCVPhIe2v OcNNW^9&AB~o;2'nZMk<x{fieE^뼁>Z\*j|>#mA#E)~E0[USizȺQ4	_軖rĀvkQ7wlR'ق-Afl-aw/Ϣ?Om^h^W86(&8|Oﭴw^eW/6S4#	+ȇG?q+dTxĎ0}G`p=$ZJNh솹TR֞m">Ge7sΌ^{Z/'ʃ|\)aV1Z8:ā>rfE<5U|,C5{~1Od9VVP&oeE|
2Ggҿ?e_\w//j}ӑyřz̚yOo^4ԓ,/lmyc $nzޏ/ăWvO.~OzIL~+-x`j~A>OW=AOO}M"2$\=;{?n4SiI{h'I?G)۞]ݴbg׬Rb^
[iSOO=~\fOK7v̕OL?܂0j&Ì-f;˔ɇBx4E$ؕEK٢XXu*
]+̿,NY3W.9Ffgg_Z/.gxxu2)06, 5$5mWdF=nG; M^V`$qBwqл{oq{ErK=.#XfyiQR2R[ɼ<yODwv^lmy=~khaF׃wxNwȘ?]Kݩ@'DbJ$lq3!9(Oݠ{Dj0>ԗʢXY3ǼXS.?Z!Ȃ<lK|xÂ	&rᗽ&;Xu_+jQȁcwt}n|g'7m7wK5GZAjnsDQ1ygnR}b7q+sgetgIύM-TvKcV#nG7uhs3ɞ?tx-TӮ?xfK@DE jv	+¿a+`1Dj3*aeB7Po4VwZS[ݨ;vNp>eD-q]@Fh90h~<t,$y4Oy >
i|buD:c(S5j4kÿ>Mws3VX1)5i.BR*oCT]:fz42o~fWQ^0si\=y+|wV$^~<X= 
^.*=	[tCӢO`L׳Ky@/>]hJ1`/x,W"xJ B;i|
#?/; 0t_s.i	 Nܑ?``D=_[
zB}?$HQQ8N0:LIj[ck:L<N1D7_(S8F_-~o%lu74V{8ӳ%t<taKdSB5:?}a4|_|G5QEaWWHkCom jk b/OAEaoSquq6k4AջXdYE \v* q
jʬVa{vcRo;-f7A` ԯfA3:h~
հYdN7՞БvZD),oj~m^5Pw{cCLuЙuUB
6@& 0ScQ  pRp\ݮe%D͍cF;\LFə
".`
3scrg$#$GK+zY<qxs	ܙ͢;u,2@|w0wn9>S#gAj1;eE+>(LIRP*coFf0#7SڥНLr=MC/C#)u2Dz"vEր"Qyri%2?NSs`9>Ԋ`OElWXW8^hqN'~<?3Oġ;{*zE90	?c'ɘc	et\VylQ^x4aGBX'Qa.0yrLr]̐ir*}V*]<C>9JY1t8%vz'җ~C)
ef2enޮ[YÚWA	io-0fWla]H-,pfYsNحmm@aTRl֛hhT:dQSW鴚`aLJj
0 'Jî7j'NY6;^bfSOCmn+A'K۶+mYwzn[iVjz۶	Fi;]ݩ4f2k0cma ֝}ٝni@Si:`yu-ٶ!sCr׮ԛ]m vNgn*ml=HaYwN(nUMZz2|EOli[zk]=ݮNf}$wv֨a@Uk!fA5,D]]5m`Jc7J?vZZn3^AG/6map 6p0ڍVxF Kvb[NVʆ4`ttōnЮ6jVВhmF
f	Np ta!1@n[A:Tdo;O\6Z"xf&k0"
	:$	-aޮ2Cz:Ui!jV|$n9vS
l5[N] u(uqXnbw|ԝFG\zSx<]܂6;v`+dM@Dpk(	[ͮBԀgWHpp fiv[6GبdhElmDiL쨦n94&;Zf論SKp6i6+BSaAotp(5pp8UT6A}Mhw fCC ;P>vg&TCdWb.Hڮ7!j2bĂ40vu FWAc85dVj;HMBuA$kݮMc[GiB Ot;Jfz^~N袮nv !)0D"ܠCPt -Ld
RwH*נ@&'YlkRn@F`Pudvzb2 [Na2T؁wHA25::sK66%QmxAl:	q	C	0lMj2ti7 VduEP	} ?	: TBkW9fCAnMw@4Ze !tL	5h6@u@ޢҪZ-Pd6CQd@r[]4`xu!3FnAe!%VW(j5-6ie-U$F:}	LL@
<4ehFfI PrۘjCAp!}ri=#0jVSA JY(. 	a*E5`-e6FAb 8dCphٱr&hoJ*It2mq(= EnT~:XӠ:rSɶu-Qe$;!]l.vSBlz߲ UMR(Epq(F+qe,958rl0MQX 5Н)6\C	 X3mK]lZKSjhhZA*TJEp'52@}63`"A6QTgfIdl nQKA669rA luS`$IdFFrp4plh [8+Lzqѱ56I	Xa8?hթ:%/JI10@,[8Q/?Af\:ܪdFc
0`zDAC   "m4 JN@ \"]4ǁ<k@@`w5FISPD]45nS=`Oq>@.v:8{gѱ;:>oN@tj8F$C+ER"`FH.6L8S)G-pwO64
='MTo-[hZV`AR6bj_ɗL3Z>A:~F
:h&_A@_56Nar*pͩBڐ	]k&+@
JAai=O؊Ò @N,$"0&'IGˌE_}hZ>T6mD"}j"T RGJE>7TrF}ZMG}0#ۤ>$fz]Upm,קdF/:[?#PMMa`FBJJ:*fg#RLӒFI?6Ѥ"klP*T^QC3ðoU!i5r8aTv^lN埚?-9M?O Daa;#[U(
@;h4%C[$uhvo3η Q@'kavUA"T ɠA?sP/=X	q؏YK=ى^>,GNs]w}]p%H:-J~1
ǷO>:y!\'ޛܥ8@@i5zt/f
}{wE;v8Y^x>-$ 3l¼rԋ*6(XM/'^omDpTtUV9ďt(za e^Z[KnF5
mD.R|qǧt0q~|I$~ԿgWL`lu&iȍSEr$g~	\cZ٠%%LH:a4//Ԭ;( ~ ;L.at([ÍM/gڎ07iВjfr&Q%{~ڸ1URs[PZ׾f/ZZWπlXҕ TX*[DTlgP<.g9[/wXlqC^0~¸QIq)fHdc
XxèzZ)60wm,Xb˙n<?+Ps?@}QV|Ue^\6Uy,0aؒ,yKۤF0 ٕg(giWl1) 6*j>5g|$iNg
w2xVG
nx`w{qL)Zxa腐JZ:]/ʗ/9].P:8S)TBTԟ5tlIb%'IM }w+Ѿ-/ tAU|Z:yn߂9vi5iZm>uO$D,!UnZv졆 ֪4ooM\Ib?HDH?<V mrCú6a/ls
fhr38 ~Њv_T[l73d cvV
Kf/kʠG7oEcG:vj9@C7:JfB2GV:c_o_:m-xtZǪt07uLHHyO<)EVػ`/\R |7p\Zx>4OYD%Ϫbyt,<=pU?kǁI~5Pc'6:)nt2@qB<|~$w+j:> >VĮ{}0 ^%k\ap~0Y (Y10pѵs4)
O9*Ge[hvVp;KT!3UYUg*AVYCK0&",k[i>ZE%IF?oFYs0
6*\n'FHz>LcEM̂#9>&-?g=o3	Z+ah[_߭1Kkeoʐ?c?1J7QF'*C3豷oḬ] 4K;*6H$1@M~!%]ia$Lr}`1[k0M6M&Xϫ:9bLD?C,ǡ?׹+N#||?=z:)WץlG"_9 S(JǑEӺ3Z&?>	f9DEls9
0.̼Lc>'[١®ǽUGKjWûhEac~is5J"O/cѹ X)x	s&9Ġ\z4ݹj%yuJrYr<R)H)QWǋ,+t;]F0i#/@9VCvW0^]f{1đ /%{6l=WzSumx'i¥FV;@2DExXA Y:JeEsyGp4#FyU(Rb=VĮߗg"w=[K9749Fu'xЫ# )V]7
㩰"%cYz>[mhoݡ?pc4Zeo@<`Z@Fyxo+KߔʋM()Ïyl	9@"A.T$J4mu
9gMT4H-&[b~-|`+H)3k,b03K*e>֥YIIkO5㏦݅:=='Eghfu\1ʛ_`5^1h q\0)d &
*V=xXhZWR \'j}=1++nU89 ofPg	c=cd=kGёhI蝓zUcMƔU,I®K;nPC-XM!FȫkC)M2LE*SM:,5$V?&O)a+-E8KE}A_,Ph?˾V80	grVbstS07LMCepflfTE,J%1C/cVKq|Gv:e3K\Zfx'T	֙3Yyw8N&jzpcCheهRW̢E49j1` ?`e0jɋ1\Bnq^q,Np{ Rbf_zqĞӟ"lR"}1/r
?bw8An@^m1L27VQCk#ߐhKNXй#Qh7"J*d^+BD@I2%A`v	H%#ߘd*$K -[Ɉ{]"֩Ѩ3Cp4'y`cYbghBJ^\D˯\A=C{b/Q!_RקQ(8a֮Գ"rg`5BH^N#јdS:Ǘ,
Fh_=CQelg@=ǭ}Ĵ6I.u@KueK#ݬJ_RS%.'0_T/\3)A)L2]ʚ3EAx'`XnSpGѸk,Z.~0k^Jv4c*cY9P狤dA_V4]Oy.s̰/6:qHV)*LѢhU,698xE omV l ]fT{r!6h6rˆ:tU!nv-`**$yjd2Ҿl\x3l*N/ti&Ai̚#uѓ~8|2.Lun LU-n ,׋f*S>aHd7,hY0A5<oX\a87 ֬uk0"Cg.h^Fj2ghMJ7tAu5R]Y3|@].o2ű#L	]EШSaܾWazΟ;L֌umQ6oʙwMʽ%oO^f>璳<@WCx̣&Rrf4:oŞz B,bo@@ik9>{V}nxYw?s_JH73LyG3x\sjJHqˎMPcծpELpa㢸?wSs:Ajo,|PyG,۪ocΘ7{"rmBKvRd.I6a/s(#Ai9Yn{6|Q`-/eh4[$Z-=>DIM;@S pf8CIZվ8.rRL33wfx.ҀJFiX'7 cD8CdyS@/k0<Qd9xcWA#?FQ΢Z!G\hNHS"MjFGGb!*K*CfaDT.̄7g}u&Ί%ݶDhϒ=kVl@^=nHƷfCTXv^,{`f}lV
T)f*y5?T8@!^>@ҪqC.b=E;=aqT,t:y*?/Cj5EIu"+x@{8IҙMHS bA"D_0Xjq̙ߧAAYja2|)-K6P\U&戌ixĸ&|*yo"2Pָ!WYj˨NUJXYo`>jս9XV= KTPbMF#Lح0L,p#O`fH8ڰ** D;(5Ƞ66"2#s"E&D7Z%K\U
>%f'WPD($M WsUq>Exu#AlQw*Y_̡oP*Zޓ'	~:_`lc?8J%17"`ЍgHv˭7|T8%䷃i!׿i/"yqjdthg=X[SsDLYb;z_$VY6hyT_h`?6pb!wvM4Z^^Xr+uDK*	[B_"ݾWSP> 5aKunMNAlg.BZiCjJs2d^\$%Á؜^Gm]B_<8YPZqFݫLhV Vi5 ^͸/Z͢P%W
!R7B~uD(dWIdXv?b<y(uFσQ	kVT<r0_gx+͛^Cn%XT*YRV4lMFO5C ~|M}]q&6&;SZ^(Y:r,FdKxb =ϣ|W}nۃ&k4; /YmwAٖ~{z?hxI;b8LSrJovvWssyF
i}߶6e=b7%2WTkf=(ބ^4V4|+7@צDX0:gYaTp8d ȜM;3
pL]9s_Ҡ`A*20<)?8-{@}88v4׆e:6:n$KuG`#c0_@)w1؜U`2͜вAs%d'	/QܟۈQ%Qw1iZv<!	s1W>Ҍ>|Ulݑ%*%TPBBEuu$XgLݟs:#GޗIbtnRB.L=1qs_vz%,I7Ut?}ܩG;Z66ߞ/P-MOtauJ):|~VҚG`*~7wD\; Q4a1yCf*䥌um:&I:yJ_shul|uÇ}QFO#'e,ur<#暔E6|>Pn YT`4PFw-!xC<$e~HE@eiαF-ahȒi,~>EοdZ:?,<`A$YD`@`C#G㊡
tcg9@B06RwqW01kh\1t%Z{[.1vgjᦐw;?y08ְEN}9S|%<#]zS[958q9i ݵڭ$KHsHOB,av"1|bSo[
 e&b8fÜ
3%0b2\Ԏd2 .ÙWR,cٝ3)J&U[X@Z44hWLGJY;̞LP_"8hJ3
v?DY8tDr{>L2
zb8U4@&8<W8P%O}@G'!uߎ._[ "hKp?oTu;S<`UH:[/­1^&B-O] 4k,'oC<$@Y6o_,/25s9}4W:8l	dK/<-ol{ﲇq7r<MYqW1Hw6A'?Nyؑh1ut_2#)zZYԣchHg}s=-zF;т*A>,	811$A2Oqx|K[L)iW]DA@po&C4L|~rN?!+:za]$V7UNWČ8w<+L:~+J(J(J(J(i/^1  