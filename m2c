#!/bin/bash

declare -r m2c_version="0.4.0"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]
        then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$(m2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(m2c_msg "$message $(m2c_info_bold "$opts")") " res
        m2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_msg "OS compatibility check.................................................  "
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_msg "Docker installation check..............................................  "
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_msg "Docker-compose installation check......................................  "
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_msg "Ports 80, 443 and 53 availability check................................  "
    m2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service.\n" >"$m2c_log"
    fi

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    m2c_msg "Password required to trust the CA certificate and create symlinks......  "
    m2c_loading
    m2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    m2c_erase_prev_lines 1
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_msg "Locating archive.......................................................  "
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_msg "Extracting data........................................................  "
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$m2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c

        if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    m2c_result ${test}

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_msg "Generating private key for CA certificate..............................  "
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Signing CA certificate.................................................  "
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Trusting root CA certificate...........................................  "
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$m2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$m2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi

    case ${m2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                m2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                m2c_msg "Creating the resolver file.............................................  "
                m2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                m2c_result $?
            fi

            if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$m2c_global_dir"/mutagen/
                chmod 0755 "$m2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log
touch "$m2c_log"

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c

    m2c_global_load_env

    m2c_sign "m2c.test"

    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"
    m2c_msg "Mage2click toolset is successfully installed! \n\nRun \`m2c --help\` command for usage information. \nVisit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log

    m2c_load_env

    case "$1" in
        global)
            shift
            m2c_log="$m2c_global_dir"/log
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 V] r#G(د˯.BU&Q$EIdX%$]@& *r<}؇=;{}Xî~|ɺ{\2"22q!Ȓ%@f\<<<<<<<vMfss}lH/Wk-l[?;8I@y+NOKދ~I'.i`on670fa#;?3a766p77^I?4^ ywL9kmu>}$qK(Lk͵&za%q?k𱱶V6mKo`ͻ)K㿾!xH3Oc?ݕ0
;d%|o诮mm<}$cge]5MZ77__|X%}NU4f(|K/L F,>kiI4 `Q̼E/}Nig,H'4,=Â0Iى?.OB%C0& xBogU&kal`D||^惵%C@fADFq/^	tu(|t37D7O8;꩟PU7O8%QaA&Xg=1io}aGxi|!L{S9OQ)Ϥvi鍟xĘVY'K5OV1#pxvhRO	o޺_{~AσIVfƇ#6a	>L0u8\Q\@uW>p璥_ot76j/?kՇ/G?ʖ? !tщ7la0h);Xg֗I/F}\N`ٍưXgy4Y)`p*l)k-KK}G-f؅ArɶRY+Vo^/I^{q(QlN直ڛv,aT:UNUrש٪lS5mMմ6Tw읜˫Ul [*WUr\2hsan$`; Tj#1k|ө,.-P#V;ee-gC?׬E(Xa:_^VXG
TUQ}-lC
}ލyA4@G ]@¯6;AĻ` 8̯k~LT;cvoV	i4xkN]cWb&jwV1T	kS?z'<2Fߏ8e^i|oQhGfSϴGGF=bj?u~%4^|>j{&ڸZq!q&rX=\GۻQZ)<<،u@`|uįuJ-s2JⳄ	`39v&x襝ʇ,Y^FCNIEJMBO!lgSNv6
`.A˷ageL$k+9k+uX+UWe园7^?7k__ƃӍ֍qwU'u~:C&܊hoZmLa׋c^W7yp7	r*GJnV=Udͷo	;-r\A =L8tG^z>kkFzoT  w(uRDQ'o|`rAA.Ϸvwv~jnn8 +
-X;$B>fZҋF~Gp&֋~`gA[B9h7h٢U! ]f$^{}bk9eB9(.FX79ëoo|*uQ*7PJ,^UƬ9ζ`ĮQ0'ooo.Bld<B)ϲqX
?P(RhQ|,xZ֟_*;}*
,oobd]Ya+{ZU)[GdժT7U|^SV.~AbΖs[
Gg[BL;B3s6B\ⴙF;P|*/8鋡I?Jf03d}eVK\xTͤ/8}W؅gMIA'U*//Tɮ3
2nşzw{G/\RxlB@BA8wCԽhH2Q-mF(A}y7N 6:U9T1zP;	9sߙ;9CF,/CmG ~/|s
5Pz\xgJ"?#tCTH
Б{3a~޹ck'j|Ƹks XYVn']|
62x8Մ9420Dj:05}ƪy!usInQ]VgeqT&F_l:Hr|}I6T)vKƕeftׇhd><Wϐomm}k2\x8!A!O3KGeWh%u),ʙݓhG^fFk8ԅeYDoDeU=WTS6~-
h-45B:D&PbX%W?j5*s@g`d:;9O%]TgƳ^ao?7ώ?kk6X<M)#ciIwO9f<O,S"yQ(%2,4$]P_Ӧ<p\O>ѓFTl5ب?mhD?4HA7/Ds䶩xĈ*i t-FHiCJ|H)ʡX I }BUʙ]]6cH/\rajOu ~1W%+F}*2-5mPa'Txio5;a($0UԂ@5)B!H	2zrb,ǟN-5:@R3߅eȼlLV?/{sC?0I	L['	EzR&kKVΒYel	Wlt,|7`
Dz@%VQ[w^hG0!N{j(F|#:%$:$ٞ|!4TU!ab_$b́J'޹ޙ3Y@WFZ%mdrdqANeZqmjZoFhg;NJUj;>5dII*+cqAUx7V9GȉkWAks9VRX
i	ɏaYIEX7eLPAm\뽫LW}geB>1M:KF6nI%U'_ 
!殉$a&gFT	SN'IaZZ`Z:T`
?,Ch\,Erԭt.2eg2$E:ʨV:T51k'1򊁾qиVɇps(q9G3ݦ%1&%ݺ_E3Vt[L LXfZīO~L"gZ4°篾~^l[ L%٩9žk1mJTv%Z.l[,Sm?w4m4}$ME˱va1Iu<枒p/ؕPLD"[diiªoa՚V4`hTeȞ`*>	ӕ ;kxk^+zdb[EW}?'lϯ~Q k%E/Q5V$5Y9>C@̅ιl,-lc,9F]KF&s46#,E^ꊖ1k$v7u*GX]!!MXS3=_ąA#6&_G+K''>q28f@OƓRt+gF
z&_8N@ᗗ }$77)>DS|?$$"4
$Y6_2|Qs#fTv%v}la8i?k#q^p*ӊC_\mc-Ǳ^ف`Suǰ,]l`n7y=xnIH031o	snlٮc=[<gFىuк9_GuAeogUhSUKU~qxE=0( f`@z :*?X,W6=764Q]=M%Ѽ	C|BNOl(	r|qtdg}rqSEAT=W/zR-#=y?thX) KeE)3)IM/0&+Yf.Hۙom[e`&r;m72tABx+X&[Hd3_Ъe@eB@</XhXd,Fɍ	Yvz
w]5YHԗw"$52۔lN(mtCuks&Mc~d+Sda$T˴QARz<٬.=T!03t*e7+N=դR-)ܟ04>bDW>'i,lC="LU\t6=qA2S9rr>n^//xH~U㾬?CIQi!`~ށ6^}Sx WM2PYZRgAWf2g6Յ\iي6HR=AB7˖rD}
Hzy"v#1YXa"#IQ=/өhC4rխ^*+0A2ްM]@qnMܽCE
rn:-k~EP/(:k.Y۴eKiqTZq$xPxHҀ>T3e)ݵ<҆Os:`Kd7T/Јv,Pxji9<
9YXͽ*O2pZDBwP$:{t|)Z_)s4E+#J,Ph/T=_	ϯ53Cf,-#.Z,iD!*&
`ڑ>ѩ|j<đH<?C_MH[27<	3 %UV`qяNGƤf"5$[ݠSNTC^Jɔ&K\4P wϓؾKhlƌ<ZAK(RYH!LYnPfUtYp4u6;a/ j=3/T}^8˶/ُ m-GX<>7nq4SA\n34bXnͶ#: >2o|nmP a1[F}V=MylWa6[ް;R6,}GB%t&8k2	CHNʰ8y7D;.02I%cv#,mNz}ҧIeHQ,}]rKJCyu#Ao^QFhF8u3=-T=P7
/{HFfEX]	q)F㔝E&NVHգ=uOiL᪑/d QX`ir2)aE|Iʟ8$}JxƩwBvL"{UW_}Mh3'RR >eC	t/x("SwZČw"|J?)LgeIݽ^
XgF$1|Lb/ϰoÜB³8I*4z<_̓<H"tH( ѱ[
0߰-mre a5ꎂqF0yH<zD9~"=c	r;J6	q"FNFQbGEnJ:r<$DdO4rؿg4iw
hNlHZEԂ츤Z\<!ѰJR9?צl}a<{XSg	@- <_i=LThN?Xm$?MI6)&FXv!zP4<|G4sA)Z[#iWEUjUrV/x`+J!d,K`Xmg^^
!/k˪Җ_Z/kيlD!-TU{Sߔ7%M	|Sߔ7%M	||S ߬Vd#لlA6HIbk[K}#HW	FsmS}PԷU]XR B[VUڪvQ-U4Y>e[AM1[K}gSݑ{C_Wļ't߂ϸjY=HVl(cܷ1kVf4"s8ϱ0Oy*_ͣƨ>h'5qH:M:osܢ.6mE}gpOe6f3ٯ,ĒI_$5&Żf6Vۉ^ueG.ز*uU)	d2iӒ>*q(J^3sXK2Lm\/[U[z,;8;v[bazB~%9]Q]O|q{SeR$bzc2ħFdC那P98|X}ei힊6t%>,$:ND;YPcv<k.8i)?-d i4^.+n?{W%׹'"\)<-Jb,dJ1-؛\["\k@CAuHGS+]^--X[QC݆$k.r0Ā0]tnY3t׹'s.k$0`#[<idaoCz=iX
TD<(e,SBIXܓ"| LEHHCqBކ<sJ`0X6G6f9J{E:Ÿ?oɝ<G/@sAYEctxr+}Xpi0*C/<٭HD;} Ly`w>;L5MHW)t
<"=f#c;]Y(&?F9ap];95J-{ey^?"Ci-|3L>`r/FgNSX,N\'~Sh6E~~/|*3M>Q<,%> dK&(-l\TY^A'15.߱A$KAt+*HW8b&8.mD[c(uS;ipZjN45Ҙ^RFd7}i̭8GK)2c)nǽ]QfjQ9h5^軻ll'tb}-!LT̎眀-06³;6?皠V)vl3]*Z?ʞaȬӍZ~̟$E^ehC^u[Jj`VI}?^a2mMjLZZ bid*9[-V=SdhM~PDY'-6&N{m3ێkS37JMUN8̸_{(}6{X3g@q8ۛ<-{s*{UM Baӕ4&?Jy+M5hw>VW2;⮐F݁5s3_dv)Pytut4w(a뫜G2
0)"ZD^.|MU9|^ӹGe>aeN茞w8Ia:I:JԄIs*;O$ҎYt@]'Jm3W]V1ez过J_yw+DHIOG*`ܮT$b7QeTJlSO~kŹL-䗒װyͽ?thk;3WRfo!Je-#g u~[ݐ;:6/{:/0)XZƜ, ʋ,EKfr-Eu9Ue2\/B)IFo˟ W@J`wf8$ֈ9ixQ.^pu$`oIߪ('5t)r?)*w؋lhݛR#WAa$Qϕ><W%QQ2Nga~!4&Y}wpxDKY
6Wr ^VBz'2/<	 iY؄lԪxjgyԭwey}pr'w4F^ދ~]-/ aߗwLnݜl4¤KC;̾܏]vgeP$	nսO
/.pG ٤'Fp 4N( yGv^FA#!.pI9D.	]#T}M2!g
PPЫ(KQ9p0t4ɘr?00Lh56A:#dYl0O=pA~]rY]c~0]rב|﬍<pnF.o#-CVr6̰m-^TeR|+QY~Z%A=w>Sh95O'Wt{	X^crcn
ɽkI{5剜Gqē1
z$x<`zڏj-Et-ߡv;܄f	`Ұ}2e̤=&$
oSN%W\ 7[ruezU<@yň*4(]TQ[H|[疈gQgCȐ{+~X{lyt>g]y(ٱOt	S@Vj* _Mch¡Z%tzY9 o[2k#Qi^+reLK\WXnKwIgEDSˬ7*s=`Ж˓7(1{h\BɔV}*쁓&i!2Z,wkwr*
bl8۠=a*#M6YBSMd7BSj4є^tfAPIL*w[2zyǽz"n"
WSF	zYG=ZOّN<M6 >#a-&ǝ3q/I@b
P{?>d/jHN	-'>_	E;;ju;81UEtCCE!-W-,U~񐂸F2g5?*.<#	f[h9<k6@8>,Zj$ XfkH9-e~Қ[oJf;N<@Ύ3qnO2(Ub\&+z4gp^-R]y{=(, 4sp1tL"A毰V]}`s}.&DݙO!Ԡ,R%*yq\eLN>}$`^BܷXsup3ddyY4dkP#\۟3s:aϸBJ(CذS]TbRL.%  ra^%dR62+H0brlq(s Q	Ni`dU))z}!=~%)/=~!0dW#a,0X	K@cld_aujN&k?f}k,Yr 5XH\4W׹Qr6jBU=4N0DQ8/:Ab_m?Zc^a&PSۭf;a_7QU",++wAI-em:hSDqZ;jG}E_%4:,歘n⚙6ʩC`.W

!#؏-Lն&W<jw /bE{+d|]}a>|dbDlX@o1|$z(&1\.k'qNV`ƯrW 1-|ұWٍ; ?:@tchlIjE/:qF}uIIf1&)|.A[kܮZ<[(fqA+6}u<&7LJFVfwblIgey%{: ޣ^ULQY09
Jp]0}-E1_<J}S;*pC25}d|v?&Zpki^gZb0-T5ŜnT}V$VReKvřYk͢5uzOD7^9RVxfwo궭
0Ԓ̩Y_So޲F37VLjsx͆+L,L a4q}$P:1Y84&])x8uNb#,F,S4 >M!mdV:Efob#S]DLIb}XŲ2M-ݻOre{%p2oǎ<\2.]R6bJ=i_#S0r$wQ{!'$se=,Tl5E^X]1f}Ը-:3'2>+;H
,9A~aˀM
NfZQ:ZZ}v:L{|N0SO"#^rFh)펭	#|uV#l
#sMcZ[ʹn,_ڢ(FY/ep*&z6B]>:Lۓ T\ P|ly'T
.mL<-IN,tTp;!8툤%I	C[[DE]>i+Y=B%)c.܁e:oy݅e3l;j.A@%yZ^4J,vR$w:hFօ\]t@AfHqz%YUU+F0`# 9B'v~UL W2d
./R茚9=ؒd^^b}'Yh*,3/wY㡯Cϟo @śfCL:+z?;$F/6j;V&n&ma7ny}
-[ױӴ!+'$Dim'r0
T<"G&kqJp>0C2yjmLP%id-FFK96nD=C+Ucmpƾmô-Z{xM@<NsqG>4UflD0t;b e-\p^=ЃL4;*P-pʠ .[,9kwPA~S5:?|U8_V-t甾]'p:{ݩÎ'ןᬅ[hk`eg7V6<oa&dv'dX4:1z!?Xg)zQXT6UMAM%^`h<R~R_}HFP ׾ˢCZe0U&#Y	~d>-y/M֋!hV#u$hg?9(y틶yetVFC?wz5;8i|,6&l&1m4-ooiDsQՉUCҞFxix"]ͮv=:wν̼-#BuOOPGQw.ax%?N̛}NX2
hU'A&PW	]EkQ]NipL:q1ܽvL{96q ޴+Qtg( Cu>S}ېۼhEbSlvo\dscb[-l*h]5?)h[,N+hY˅[OrS@PfKg@@]3yUӅ;okeݙ>x%$Sւ@۬%yjw{)*)wJfzUT1#xsysݲ3\h~I9QMW5324wª3wH[l&msv0uf.YBv%m~~O"h4¦k7?*ܑ~׈4C[rurFoE+Vffwbt/BT`<<B+Ql<Z<vm4Z\'?"xY?gsa1_<6F&
y7'A(#rZ`v~yMch*iD!+~swO%_>Bx( aѫ:yW,\$	"؉0UOG\Y NRFꚩhWS@͝a&nS0yƕ05}5}Fko,܆<{s߱ K"1|r?Щ啲8ʑ=Q'p1"[|iLB7mv%Tg6a}oІOVUm㩸x=E
v#U_YhyN*4Q
d7 Ab+>W]a[K܇OKSdPIt8-:豜&tixOxqn[j	bq❍y7;ꖏZ`:ÑN5.e#'5P[8Աa|kF8f4y>+F%a-s
Fb䔈q''3<P11{n6Ё_OJ0|E=ahY+aY"^' c2:'_ᡁGZrkfxG/ajWRk5LѷE."S.8K{b+C%;_DEҹ5Y/xB<W\JPBzx F Cp܎,CȥF>9$so{MA<y}d]YՒPag'Y*nY%YG#D0IcCW~Mcdn%e2Y.	;F,9N
R"v[4͋ƞ~+@[1M3[Ma2(@ks;y*gWiM1\,ZEzqu6#|6>9KW]o,2nO^c*Ÿ4*\12`DsS6 s͒\))oL6?і[{rs99j;Z>-h7`2v#9ۙ.R#R5	-qZd:G#׽Y´z'gZ$cj5)/B!vY!ZRK<nfN}(d[h*YQ(IjyM'`qSt9E'f~K:+x;cP%gf<WvgǺ^Cg%pMQViζ)g܍HVxӝ)qrA0׉wѵmg+_6k^;VWҊ8V	5C3R] tѻ-f(,&Yui6f+xn:?oj}ބJ#"*h[W/̄`he_1>-w_ѻjE/EjϹQ
#!:W>+5)[|]{-[0xbP:Q;or0^d$ǶH*~8Tit|ڜpfΑ/p׼'Zg5dJ0V]OV;b:Z[_oџFk@k7Viv52/E܋w<XMTg'HJ ݀pkr@K#y	$]nێ\wumOޗ/S( 啞jEVV^D@Fv9玞X%dlH,!:F^^%E-ξOg^g놠Q|ؾ7FqrS|ħxyb}]żB\>xe< y:IFNW|^>d<%c*cXf)18	^oTT_xQQF)MMR9pLxp1pkau`0ieMH|;F,3O~NGoTqt
'*ha4NЏG@{a+(Տ̧H3ۍ=NScdo+ovc'LtQv	M J  u%]A=~cyom3&﮽<hZ&bmw<SwB49  gO9&#scCbtH{_jt2捃cVY9r_M;(/w\}x|`[Nͭ*
b5_a9j
_$+!4F&dJw)}=@M|ew\L.( ExXF,bx.ʫ*B&Z<|R38%dp(0/5`moخCkp`AN(/
K`2>+4^u0w7z^w;2b M7ؚN^)uG^tХ6ֲ<MChCy{W	(r
3Y#y<ٮ@ϕ(!0QAc;\B,5D',[7
Ydf>2FoWs+]kQc(ګwb/Vm~b2="7P+IP69a2ⲟPc}_q_ID}űUn.qVXu@70\/Ȩi&omNcۗͼ`9_e'ѼKs3Nc5;- XbamdXμOaz,G	NW^|^%ui-%VmA2{ȟ*O̥6Yw*GI3Cĥ% W^m1rGv)ppfbRj>Hؙ5ZUr]Ê=X}2L-z,.=w<x\B*]z\ADe+ё.mHЂqÅ=$`< ى4	9Ċ(~a2N'N$]=7uEWy &qHHێބD{1ӷ\ap|Fb9@! ltFNRoqehY*/ IS삾QbyYˑ涥E2/][N0Nܷ̄[dønwomZ2hC .iI0,<kwv48c\=>z C8]ۓ$&	/9	>a%[| ]G,nߏV󘐢L"l:I1hskrge΋`댟*;Q]m
K[)表h6RT o8SD6Ĩաo7oNlz*/2o7}os!1^7
bR~$d@
vLQo2;sOZ]$`XQrA^Ƞ:jѕ%F}Dr]P#
' #ĺz@ZaA\)RT6
NU@/u

c5i!}Df#bh6>7g?Ebյv{s5[kAɧ1y|$mdmL9&{ua#2?m67ۛkm͵͇񿏔 ${aYggKlYN\%|Ш{AʔuXҥ4ha?o<;O_;<YLkik퍇	OMԅ$[T[,jU-hpA:(le>YFh`dQA")I"
xx`tmzxР*NjFīឈʳRv|	U]zuIg~CG($A	'0O)}a8{;ҟzdJ=	.iW{cg>sV1"GK/gt8dc%Z]hܮV$/k͍umȷ#-VYWd-љPEksGY#wR._9j1*$n/@ϫi&dJn nYw*UhvFkzKvgV1.#ix@E>"{z_Ja?mZMĉ@Xb[IfBD}mZn6oŝ:<f
;ޜ t~nI%elLnI)coL\[o6{IQtJ~/F>?>><9>qQ`c\ɗT9%!'Q%zMSXl퍍jk6}r0!wKK2wpxD!:_"_w"z>aBfo㫃g|j,_l?!T>8}S3h?znd/OV3<)wۇ
Ykի|/Q|~D0Xd~yGzO?JA1]=qYoke}i50>;כY<X}w?mt>-?잆W4VL%=R?لܔU@ӆd]4Bh蕉 ;P/rf vHU|ƪX](l|).Myg

oVy7&XLֆlmssAs?iOK4<v:jj A
6X4kLݔl~T#̺G"qNxawяEKj"u4-y)Ѭe5\"޳Ϋ^B
֠IC7Ofþ2EF8-6v@[5݋𠶬vq#9(x[J<z_OSApL%LIY^A,;퀷j649) պ?גsrbq^}u9pնZ{I'KL]k;Дs$rh5'*9~i4p|_յy}isozO
- {mݘϪt@[v	e85	hЭ]ջ=~i" r%`f˱Q#"JMѳKlXSjBNdq<TZlO#0=,d)ng: B	KKm_Ul}Oxm]E],mҬ՛uD1;>(W<bTMxeYQv,w-0_8,7	]nyV??%knDCYᣴGXǪ"t?9;]FLDIeBg5aVQ=qmE/ve斄VTytzЧ[^tYM`151G?ˏ(k2}9Y:+3_K-shu5v0@͙w(#MS sU\YvuXƃ[^h*k(fe#bt	YOz6Ya/jpQnlpAvG{y{or8%PbpCî3||?>ͣ7[[o~vS3~*SeC\
Ri~.kC>KoEZr|[2sQrQr}F6HI:gQ<CAS5,G;?+Wv <ivI/8Us#2/y]x?A/D#z-*UcppսG1%{g b7;7?5·ao;Υl^U@ 4Y6*UEfR8a6*^eXf(|jʐŀV:Qw̨+'LBQM# M ,11|}uՈL?JɱĆɲ:˫םϻewVhs#fAaW G/ndѹH[旖DDD?`;iN3cu]9B%rp.L&ѽ)grWPFТ&  \\0ҁ17C7Y."+RIEn_:"pe~Sg_rWc_q^ATJ(;qY{lph5
6TmF'OXU+	Cp5U1}JO&3&_|FA+Oƞ좪CIsE^Ҙ=q~	]FobrR m`B7J3&skHrA\xqDrU\b%wR_</R?+f-[ZF@$$519,\eEݦ
0g݌7eͲU	ĔH=QLe"<`738݉/j8Im/I𶭢H;Z@6AzcЌ48	F6ȼ!
mwL=I/uMfU4blcBY8D9b>C-b,Pˏ1KىW~Z7Bb,% Xq&n,aϹ9->sm;FO89$%r=(} ʩ٥&Oa-|-YBR'jYJυ*y87ʦ@j(S5-umhbOͧlmm԰qo]89)dre7yq1x$)G;9{G/Y--TC*PP[Ñ9Mԡo쨫Xк%4_H+K?L^zA> -b4t+,*"`Źׇ]=a.]hd;+FNX}A	LbT*Պ!T"}<S
oAXwfD(AS_Lbi%0>H#}w+JzGOqpϪ4S빒.fMX+iNt\b/XBCA.Ql^
E.7E{}	k})b<~	h5oD|x)).ޒQ&c:ĸqJ
K8'Dn`E攋cGx3^D!G ;H=.xdezd1Hy]}Z_ڋ9x;^۴X5]=Y[FIфa]ũ`兀/obΚlrC}:7WƮ\N,v&Mj}]#sf5g ai/<˧"$hP	;8X48V=|25p-,)Lfza%]nIm PO*Wug僧:1[i^=38f-OX(DDJ$ha4ʤ!8H`2
LL&Z7qWS_4!cx>.A	~*"C==:@l7|YypzSCKn=EIӔar(0m@?U2NXivs<ԮM(+	i,z#qs*D3j=k6&\aR0:x}.@=ᅰ%s3!ontfw[\B^܅ۀ&gBIJ~h.27`TR>;7joӑVe*՗DAdCJF3ٲ-uʹ,Ya4#{HVItNVKNnT~}Z'uݢ<QPJLAW+^Oбy)D^C31FGCbr˔x7!f@ZVVqvʪkAp7iIq#st$zZW^\?Q+SV	5Ń0S8aS	VvQףZ&=LζC6L!;1rOz>bA͊"D[sQ^ii썘O{GvD',xF޹f$orI#
FSh*NA:Un Xwn
[ Ucms
4 
~:HP܁Uq8~yZfK45Qb(Gh=T
2$ѩ<:;j(_6|A-^fY@aA0dL*9ZlklsKr9@Ov8yYq/hZ<O///ohs]w4ԤZd]Ͷ<8M(RK:AO>HI+R Hƽ|~
!;Os0:YB8&c#V@l$0j,A.L[HMt0GJ"S|SP^OkE/j滩Ƥý0Ho
9"n',X_F(&oO:=ih1AL*˺K'騼ꏫy\ ~eiPhgZbCiJQe)y[{	'iTi*h¹PZ]Ζ>uc!xt\^#Fy~ ek~>nݵk	ʅ@k`r{u,Gx=oz_uhx=FwMʤkoq<xHx[+,/$=0ّPݣCQHr+n3^@0F-Lh^|426]%$_f)3HK<h=]y٘㟗=^z]{O4Sܫ"-YzTJ,%}E?DEi:hM֤`#篾~==aw5:^:>8xK*@>;K_&16`oK*9/u{n7ɷNѐd?9:FsnX\:!zd~vTIv'ߖVjGbIItɒJX2j(~i{PWp?jNK=2wWĭSOʅCys+3u7ެn)[qAIF|9~FEEz_eZq;IpgZNN_Q`Ӫ{gvVfPWU~l΃Ytx+e\/=!hl[$BD	>:}:D6A{YEK*fM_c Q$>'DImRA!ug-<LRɭWr\^-f{}Ï] csalMmQmL6okmu_sAs/MvIpI&͵ϗFq4+a~s~@fc:Pϐ_KA8]19>ژ,-qz
2f@-^ïyv{aamL<Z{?m>Hoz^6{L6&^sxsR/s}0,M ti.A2٥jҒfSmjKb_ޅ=̓Ua/>jY%u`Dshd0˞ORng#8亣r-"`WzZy^r `	W~]aϷ_G١x0HҨʗqC=sj31^o]<]/!dIR4vt-X:\iNW
C0q5y{)b&XoUWA	 05eTv)jϞ.5x=KGYHC惺^/I|:ȯtC?dY	{%bWk6O&~/"X2"9G{dm2)3
zXsT&
T;^ojbIS6 yhNe ɶ%`v Kx7;6`thD?W{}x|Gnwqz:m
[i$c?vكZbGpջ9gc9!s#øn5oj`#4&S`|% s&.R}[`GYɌxIz ^K9K I?+xEa
> ZP$W\xG ν4{<`EoЯ QF\<RSg)tN#ޠD@In(K'I̯v=;_΃ژionZՇO
fŽ>`gbm[3W}CzH!=CzH!=CzH!=CzH!&VS9 X 