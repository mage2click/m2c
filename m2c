#!/bin/bash

declare -r m2c_version="0.7.7"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Magento Docker
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_loading_install() {
    tput civis
    m2c_start_progress & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done

    printf "\033[0m"
}

m2c_start_progress() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏') iteration=0 length=0 log

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        if [[ "$iteration" == "0" ]]
        then
            log="$(<${m2c_log})"

            if [[ "$log" == *"Progress:"* ]]
            then
                log=" $(echo "$log" | grep "Progress: " | tail -1 | tr -d "[Proges: ]")  "
                length=${#log}
                printf %${length}s | tr " " "\b"
                echo -en "$log"
            fi
        fi

        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            (( iteration++ ))
            sleep 0.1
        done

        [[ "$iteration" == "10" ]] && iteration=0
    done

    printf %${length}s | tr " " "."
    printf "\033[0m"
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid} && \
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    local text="$1"
    local chars=$((${#text}))
    local cols=$(tput cols)

    if [[ $chars -gt $cols ]]
    then
        text="$(echo "$text" | fold -s -w"$cols")"
    fi

    echo -en "\033[0;32m$text\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_dots() {
    local text="$1"
    local chars=$((${#text} + 3))
    local cols=$(tput cols)
    local last

    cols=$(( cols > 80 ? 80 : cols ))

    if [[ $chars -gt $cols ]]
    then
        text="$(echo "$text" | fold -s -w"$cols")"
        last="${text##*$'\n'}"
        chars=$((${#last} + 3))
    fi

    m2c_msg "$text$(printf %$((cols - chars))s | tr " " ".")  "
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "${m2c_log}" ]]
        then
            error="$(<"${m2c_log}")"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$1 \
          only_y=$2 \
          opts \
          res \
          text \
          lines

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        text="$(m2c_msg "$message $(m2c_info_bold "$opts")") "
        lines=$(echo "$text" | wc -l)
        read -n 1 -srp "$text" res
        echo
        m2c_erase_prev_lines ${lines}
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_dots "OS compatibility check"
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"${m2c_log}"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_dots "Docker installation check"
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"${m2c_log}"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_dots "Docker-compose installation check"
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"${m2c_log}"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_dots "Ports 80, 443, 33060 and 53 availability check"
    m2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"${m2c_log}"
    fi

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    m2c_dots "Password required to trust the CA certificate and create symlinks"
    m2c_loading
    m2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    m2c_erase_prev_lines 1
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_dots "Locating archive"
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_dots "Extracting data"
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"${m2c_log}" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "${m2c_global_dir}/bin/m2c" /usr/local/bin/m2c

        if [[ ! -f "${m2c_global_dir}/ssl/config/v3_ext.conf" ]]
        then
            mv "${m2c_global_dir}/ssl/config/v3_ext.blank.conf" "${m2c_global_dir}/ssl/config/v3_ext.conf"
        else
            rm -f "${m2c_global_dir}/ssl/config/v3_ext.blank.conf"
        fi
    fi
    m2c_result ${test}

    if [[ ! -f "${m2c_global_dir}/ssl/certs/rootCA.crt" ]] || [[ ! -f "${m2c_global_dir}/ssl/private/rootCA.key" ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_dots "Generating private key for CA certificate"
        m2c_loading
        mkdir -p "${m2c_global_dir}/ssl"/{certs,crl,new,private,serial} >"${m2c_log}" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "${m2c_global_dir}/ssl/private/rootCA.key" 4096 >"${m2c_log}" 2>&1
        test=$?
        m2c_result ${test}

        m2c_dots "Signing CA certificate"
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "${m2c_global_dir}/ssl/config/rootca.conf" \
            -key "${m2c_global_dir}/ssl/private/rootCA.key" \
            -out "${m2c_global_dir}/ssl/certs/rootCA.crt" >"${m2c_log}" 2>&1
        test=$?
        m2c_result ${test}

        m2c_dots "Trusting root CA certificate"
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "${m2c_global_dir}/ssl/certs/rootCA.crt" >"${m2c_log}" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]]
                then
                    yes | sudo cp -rf "${m2c_global_dir}/ssl/certs/rootCA.crt" \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"${m2c_log}" 2>&1 && \
                    sudo update-ca-certificates >"${m2c_log}" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]]
                then
                    yes | sudo cp -rf "${m2c_global_dir}/ssl/certs/rootCA.crt" \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"${m2c_log}" 2>&1 && \
                    sudo update-ca-trust >"${m2c_log}" 2>&1 && \
                    sudo update-ca-trust enable >"${m2c_log}" 2>&1
                    test=$?
                else
                    echo "Currently, we are not supporting yet trusting of the root CA certificate on your OS." >"${m2c_log}"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi

    case ${m2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(</etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                m2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                m2c_dots "Creating the resolver file"
                m2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                m2c_result $?
            fi

            if [[ ! -f "${m2c_global_dir}/mutagen/mutagen" || \
                "$("${m2c_global_dir}/mutagen/mutagen" version)" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "${m2c_global_dir}/mutagen" >"${m2c_log}" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "${m2c_global_dir}/mutagen/"
                chmod 0755 "${m2c_global_dir}/mutagen/mutagen"
            fi
        ;;
    esac
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="${m2c_global_dir}/log"
mkdir -p "${m2c_global_dir}"
touch "${m2c_log}"

if ! docker info > /dev/null 2>&1
then
    m2c_error "Docker is not running or Docker service is not reachable.\n"
    exit 1
fi

if ! docker info > /dev/null 2>&1
then
    m2c_error "Docker is not running or Docker service is not reachable.\n"
    exit 1
fi

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "${m2c_global_dir}/build" ]]
    then
        message="Install Mage2click Magento Docker environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "${m2c_global_dir}"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "${m2c_global_dir}/functions/m2c"

    m2c_global_load_env

    m2c_sign "m2c.test"

    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"

    m2c_msg "Mage2click toolset is successfully installed!\n"
    m2c_msg "Run \`m2c --help\` command for usage information.\n"
    m2c_msg "Visit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "${m2c_global_dir}/functions/m2c"
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="${m2c_project_dir}/.m2c/log"

    m2c_load_env

    case "$1" in
        global)
            shift
            m2c_log="${m2c_global_dir}/log"
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    ! m2c_in_array "--help" $@ && m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    ! m2c_in_array "--help" $@ && m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    ! m2c_in_array "--help" $@ && m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 v] r#G(8˯&!I ")ua)@I IfLE9vfalk__ԍ 2^{xl67}f{Z+k+kkZk?8I@y῝Nx/>'$āZ]Y_ia+|#[?~0(WWWW8kDv{}N%;@_]ۀo+8u>hOa/0y(Wכ|8'ۦk?ÁxE6OD?=4xP,z
HsɘYOۘF6szA~i:u<MG>ʛ~c:^	PY'K5OVWW0c/ĳSoFz:Hx48z^'odf|C0͆re>Lt8o\Q\@uW>tïoc_iVm_m41'OHs%)V-~ DoЅz`=~ȗl<b5U++[_GA^R~;Y>KΣ(7{7N'TasW>HYk4XX3 9^qhYVY:|eA/g\Ae6:]wEԈy
;k~j5r\*9kTlU6UӦjTM;NNtN
uv [!Vr\*WBA luVᙟvGqD*@-Zqt*ˣ~@/ϑ>aSVYeixc'_WXGj,xz|
/x0`oV8伶]`b.|! ]5*sz _J&GQ?v^Qw'!"%T\vcwoHQb^vRxSx'#%~]ԁVm-Q:㋠w'Ǯ{/>K1o*^ک| 1|/2ig\ME7ƕE( ThHcD_P}VW+E~r\Hp;/{~{|嫣zg~|ng~?jr	q
a yO7@,WXVv?o<{VG!*}ux}u:Ū`irRSቃ欸᧣iS˳{uuSt$绸ev^>{Auƍ@OrT)N7$s:k7LG65ɇiA?>}.*LYVG ` w%48.7CR-f-􆾝ZeF޹jAj?y#/r7
r%2KuַF+F2EfS?ξȌ{6!'1O2(3]t>Ⱥ~4?,CB`/Lae\956E1umj~KkV?4k__ƃڛ֍q9BX]:g>q2A~B{Ӓmcv8c*K<8M90!-Gۓѻ̔͊چ8+q PB1[S|4]}L9S\`M鎃ԉE=^L.zoY+ !d Wz *+xK{}Q1u%)u4=Z]SFۑer|Agx)}rӲ^1)Ϸ~e`{MH47pD7kixp=Y]\My7 4.//p`W|蝁	$xG`ƣ,>=.HKEAt^rm@Z}5~Wnka~kT7HsaS9hnnE䂝׿IB-E##{֋~z^Y0?l7G<$f6\ tQ*əf=EbTx4ok"Wɻoq*YFT?XʲӉ*]X.d'$3N^7pi+Sf%rɂa%+iQ5pQH@Hw혀*eTBXiȺ̖9kU٧lE&VAH yS_JI%o>eCU4Sp͙)B3Av*</^&kp9Vw6X_}UkUq?O`fZ^x;v`oki )`wgpZswB>]jTePϩ"z&-ёT7lCTGU4HL} C㧴1(cGzꋣ(-SکP^22>+Ӟ<Egtjcv?D=7);4NOhpGTa& rYj)$td	` bΒ3ܢa3Pl`g}؁K_igV+Q)Qn3i뽅0a~޹;15PxO*ժx}]']|
eT&O,TY]z1PȭX5/Ĕn~v[_OIvRtO)?JF|k~밲8p@gk#;?<ة0[ȁꏇ`!X-<ءC&cs my()8	}uOA=jlPtd+f7ۿJyJ5j`ҫ-ޱ_Wf҄U^Hx"ѹ0hQ |l3 t=zcg=>yzRaky/TXA"12:vjbیd<^}0{^79`bgtsx57ʶ.wLF{4CMFRJ]Sd~ Hp Z[|e3Ɩwp7ayO˨`Cӟ>}a@~-&}?eh{VqՠHFh4ʕ-RItI+^!R+Qo@c/L9"]*ՠM8a*U6.Cg㡏Gֿ,~wKC}Y`Qm6Nf8'h	pLgb*VZ/H3^V˦u58
es(fllz4`^S^_~pjռay腶Ez9"N`LI4CF>%4e
(aBouDK\394P;;Ǉ k	*R$.h۔ͦ$2	+LlrL8XҔ2V*cLL},8Ղy\e!,.(3
Av*nqYz*h_k%^ _|K7e]vo TR|btlο0]J\Z$Fy1'ɒeR|-ZltK)bp:vGb(!GJ)!NO]cjq7l8%^cv#
pX|,ncHdь$lwiIm|wWJ3u
Pkd qfblsO-U܎"d|Ofr~A'ce^~i\ov,6%^:E{3GծڞPT؆]EŶQTtGۮb)*z$6z7IY1d@*wRxL%ey$YT
dGv!G{4C2`0ۺSB$͕"eO -=j&-2y
Yo}?`]U_0E2GIQ'k,B->C@̷eOtǝϻϲ`6n1z%1jAGzc1xd,Zf]f2ou{W-j}su|I0&n&x|+77uo#/գMՁqx1Okު3[@'Yh"Ɨ-x׉}P۹ap!q[I醃[rmTrVլh|QdMojb*}c}a3Z|czM^Jhiq1TNӊlJvK?+<PCW[]^qT_R1-G;M^*-iy=RuFCr:3aGhWͯFZgӂ)BYHvak3k?D
*>Qxc?o+t=nEG[G7<XꚂ s(%UD+fFoVyTef9tf<볧) 0 n!	8QxT<%]ɣ-:Rw_.yJ
A|ΡB"cEAʊ'gRaW,53ݦ
#˔`pt),V!җkRMgLnJ{/@6oPW' -Th u%vB}/ 
6Eȥ<Ҝ$7(5"-+j̲VQ>7Ť'~-){xj3e	sAIa#;@W3Ig(۾@?Fei Eu=lV`P;SkJfm|薍ۈOmL=>LQ-j8MOۊK=п\UXt~TZX;^<j[)9rizr;nh0j$bƅo_օ	"Q7EpJ~Ξ{oÀ^Ecv}< vRI&]qc_WC<K,<84NdٖKvk˝ѐEM aߚ䡰[qkwխazx&ұ1I4`* cBdf(0YFRقuRtJ,'7%S.P4Q-gݓV9ʳ,7S\RmjB4	<PnBUJ<8PHM\Cyқ'(fMU[o1<%1LZ· CND DS{0)39wv87D'@o4xÕn|2g29[ƓƑs7J(^ҏL5j7!/Vd-7fL3:
Q5<+i[ўG~f;*g"ljC<IѪ^Z_8:h^hĴ\VosJ?2"4J^N^OIb1M9h BC!
X,f39	3hyHA&(R{YE!9YRjBٛ	'aob=f2G& 	hԷUH2T"o0(=IbSpv>r|m|vL'֭teŭaA\3!Y^&/6e	OI~8(wu?r֬+lIZY-`ܷCo/}{8tˋ._|Y ZYS &lMsfa#`Ȝb 0:`ޅN|%T첒ic5ZHpuO:(4	3tm&^}E#\޷#\"*9! Um |ƨr	5DBm/%Dw^(?Y/c\R/Wa	reMso:vYkh#EiGۍEʸ8eg ukPJ 6@_]*!ob͎7_-\C[.(BY)tDɱRi[1VD,
'(T
:Ȑ8Bƌo(+9M1 d:ϳșWK3Q-7RtuڐPhB91WT|o=űtcdMp+OِQ.jHj:0./jIƴܹ6rSa>4BOyGCf'άOճ'qWn"9R۬R\9)?WXwRB!c5ϰ]2*1³8L +!6\B5I2`Z"Ń[WXXu"b(njʆL0@^|vGcGIWLoDBz)$#bDi$89;ܡy'G#PӖSq,"F(
QTR@v|Ezsq"YĻlA`>4" *1s3& ';}8k'&B9$h5$[M7i؜Y~`f}$:ޡSGn[>X+-\DeשWA7(.:&6hf03.z7E`|kE{E^1wK[D 1ep\FWE2xY;/VL}Y_UeE~i/-]lE6"ېMd~骽)oJ)oJ)oe+نlB POĤOa`[K}#HWFKmC}[WVշ]XR B[VUڪvQ-U4Ye[A1[K}˯gSݑ{C\ x&-=cxj5A2P6qjHʄFd[XCv&)/VO'Zmݹg>Ԁy+dFt
*Ex]l_n(!IsyDe*ZgBTŲu2kk/H]<АN7P833=#ǖD爵Z4ZR*b ',R2mY=W%NCi}yUW̯;wv\ V$KgC:U)xFz,{p;MLŞd8.JN>P>pAIw$0=I;*ғe8b	0{*>PޕIY#Ag`8fn|Y`/ByWA[;{_<'luɝW2;sQV̅QQWĻ#ɵVkI;sŤ"ĥB]iijEyЄk׭uȀ0\itm[3t׹',M%0BC[<jdkz}+԰^sT<p-SB#JXܓ[EN9GLEgHPCm#3}p*
U
sT0fpcziӱN1nNG8p[AY茫N9qr1L+i=	=ٝPD;#	Ҏ0
>;L~2k?Sܙr
<rE3#f޸lἌcaǺ􇃵'`yή{6s DoÞǭ(s	Qr OA'"V9҉x	U\X?_ABnN1Z# -d4!s/|5YC"EQ?EL'tREFݠyorh]bzT#;Γ7٧'67\@&DX!!y$rDP8^2~n?*ƸJ"d/O-|<S_y==NBXAY`wQ8})wC(5oYŮ,,9`2}e텽?Kctn_Bi%$_>4cb/eC22d09mT%"SB3,suT;c3K]Iӵ_V} "!rCgӚwXSY4 ݭal67[m)`JYuVEb6v!G}o*.ig5=uiY[X*Z]:[B*9)r.CHP$(r(h).0=Zi̙O\PC<@`m{Nq3U>,y	ZJзYʫaJl[;VjҴ+|\=$]4xߕL(%x׀p?6QG5M'5&qtJT񜶲`ʹ"d}_@AZtI= 7kLH]1G9Uck}q}7"dgoUT*:%?1Zr'i4I-Yӿu)ۼkκdQ׍ K.mMc1qJj6"~fj[
mqR~բ%qL)f-~Pâ1b+.oUeZBCl6	]${rMt{δLc"M>v0pL{NtJvH\ƌHG1x(+(1 ZN3"RiI P.|HM)NEӻ:sayjqmEOLNߊ#*	rVf`vbt (ꊿyz˞tBˈDrZ(c4(y#7Qud՗.`̓jau~㮛au]Ntb.|9M\s晸cx&$Щռ`G $y&X!eI-;,YAbES)R6D'wŬNNܚMRC-Nn]4)(97m|gݝwq}˗{u{P\f%eNAYjp|6 NR\0T]ˣ|jqI&Z(`q^|5`N]xgcb̳[ϊF +?I++EQ+0ؿ+STH?bmkrL0Ҍ7>r=]T-:P2̙!I<pЫG @_>,\na/$X9=1# !rBrQy8
BnHL.Ds+Aj7!.PF9
Y7mp}r{2rڦ3bz^ۣz쏢WgO<qLY{A@Q ~h]mb!B8牛S8BQ8wtŦX	2BFu:W0TKlRneM#ҍV	3yj
WGEudZ]Pꝱ`WwNvJaaTedN%LgJ+me*hbήʐc*c(hTIk*ePGL}{O
,>nRlꡫ&y)]fU L^:-լRIPm y[üF`R@+,䚰	Z*\͠.5>I*
gQgC 쳠;Z7Ois]n$?)LyS+ݤ"b
kR"e򙪿19:f.<VQJar,\WzeH]wyFYunT#|aVd&ZIshT CdrE`ɘ"8y1y<G'
Ֆ~QE@1{fhÞ;rɼqᢽdM'ڼi)EbK\[lKwIgYd7*s}YU,ObGuSKsZ$[Qiv5DAi/IyʤVɓb#~>څC%UA<,9NJ.2[^Ue5$9MQM)2Tڽ=@y}2M;k65A	4h>0>iec8{c6VCSuD9?2yw{q,J$~/=@cъ|ii( n(vӫM?Ţhgmiqeix/XapT+Aim*KB:߰Nӫ;w89
]fxR]uBp՟g(eUkhZ-2VEX Cơ5i=͗\}膁#^ay
([V(+}7Qy[WY%KSs4.:Ρi^۵pgkFxWRqߦYy:Y$+ܝ"_i9E\7b<4	j5z$R8˙+=B۝ͧrH8;0K'L1qtsCm$.v9ܤ}@nɊ7\?=\TW/fgrܾYe쎡4X< ԄEGN].&ǘjRp{[$ʃ!6b[
}Qgc|b=c>|_>l23R>Sͻ"eh";H	C)S i|R
p6Kʠ ɪWg~C ,N('TvB`hWU\alib^gU8U&#8S\tR\x(.seS`ܔJV\ˉ5#ZStܭx37+X`BK\hiBKYpʾ^7ɵOEbCM,ضV^W ,Bo"e2aRP'0Fzo8{eU
n4- za͌^,C%,rBǾpDUL+A+O'h.ILXTd5}谘o7qL,(8PB7)Oq~(qkԓ`?J],նDWNT]zk Kݦ/(k9V99x~	$1}H}E+470XA@b]H+QDb']N譬@c:~>f2j9@?-51PTitATOR+AMmyn	CZK-rg8bed/o=@ҹ,w8?ѽ=|
<eUQNR坦םTSOO3&⎞ƣkI5+OΈ)?|S=bt#ILė_M~Ogkb66_K:=stJJW aEβQL^+b]elx6v֞.Jb--:oUOuJw)N1)?.*\eK4IFaJ==¸a*灸kay24e:=2pƪ'1,j!O!"4jn>OcӪ!<䢘vhLufb@2?BwYzX;4҈f66UX-wL,PxO&׎8̔I)'ŗowR-?7\?\k"/5;W$1_^?bk9
"R"YHla8fB)I՜eG>թGw+guKHs][9[%1'xv\]xJ`V+_ru͵ 1.O{tE&`˴Z)`8_6?6ܬ3+Ʃi7`[ݐGg;AAbp6dɣ}v*4Ms7µp̺0va[$)፻n8E=eZ _~w0l4GHi^&G[͘
{aUʞ|4-.ߙTՊC#Q:d.]YLbR%JL׎f}aJ		sb?{@K䴬+r.{ͥ7f>Kr%b݌B0)j[>cW1nbHE=5LY3>xj2{)NXш+b׶>Y1[E"rqLNgIvsqiSٝfLI&ro0aѥ55SO!i\(ŷuX®YCbFΚʹhS홫.mdK|qWS^6GPwk%+_Ȳ.l+;:϶<x%V:3+1ip|#N 
}00]{x6)lDd;ںCt[XTH*3@kՂ0z`mcn^dFdlqql~]kgb)v}Z^Lm,c"0I`9/x|dvQ4wz	 SC+xWyyA
4j'E4KQkB<aĲGNA
*tq/R#W0,/EUaȆߪttXts`DV]h@n7k)BX|$cRs8fƄՊvAa|Cn±8aq 
6Ok>Y<k852iv)RJ>|0N)e%Vmr+LH#6_1|GFCO5R5\{dEtRKbvXJq>5KOQV.WAMل>Dwtk8GCUȪSA$P{h]P1&A/Uml}ͫU=\3UKcua?
l) hVpMWE>cL$-to&pĩ;6'os b6}%9~ꮋeD)![
Zr\9ڻh觗QVoU<zfpw4dM(is
PԜ9=9zРgZKe]raxMrh(,d9ܓrŀ1b;&DEibƉk5'pI|2dnXE)߈J>^JL/uߡ+T6yuvŎgK*! *0Gy.z.4IzIwGw)5BٞZe\j m2׫gdl{:rȟrݤqy*[Th}g~?[IQO )*C
pxܵv!"BےY7#=/lYeGYZ(xoFxa<2n I
ͧR5Y+vddjMRq~WV8bՓ)vKB,d o>~xٿa׮?OІۣm[&ohruf:.;#]chφ܆bhҬ+w~/4J^J0ږT\܃9{1MR*T.gzeT؛~ꖐg_1<x.KiR9S	riEN;9>Ok!V4uF5T ׎nt"F:	4 j#	k$fB W/	1~F@pU9_CN=)rJ#*;#bwwv^qvHC*q+-Ԥ2	6HWax[_:ΆkAp=@(<ߑ>GԀQNMO;P+(@/bBQ 9 b޵P꜇ViMBeqX)gon%z؉'kgKv K;ŲonX<s jH1]2rz˲9o}ˍM.Ok1sqQ[|xOˈ Asf,  &9&eZWbLajK̂$nd9i^O~^.ǜoxv)$:ÑNX	"uilk.6q[{jʈB&Ko>{;؈o٠OCTĽGjuv8Ya"tͷD/ICJe%磈	 4b1pu?4
<"TpP G=5nSۯƖZ߈/o0EQ`l}3Â~{6g؇uð-?P:``kB6oCx	Y(X3cBuR?dC*rO\zr~{.lYEeYTrS7YbV0Yf32.%^G#!i|?~?ə76.x$9cR%s4,\OZmz.o
I_cqe%nLe%n}K;K3 4U6ʚ+o!~a۟*ZBw
ZbmKg"'|dj˘&@dP)U=nUws\vJY˿uwqbϗH4?<ϡ Z}y@aEO;*1&P5Ub+1sJ\fQ[@k;9^míL@P[#-Qm!T3Ov\Fi)J>6F57v|"`*PԁE'f^ { R2{ o3`WI&@g06rG9ذktV6mSΪkw;"j{]G]2o7ņP8k#|`u40dcVFcun2[qxU[9C܋Sj"Nɵ?~_'_F׶lWKs-2頻ZydJ+#Z"Zeoo|gDnw1#1	)6"nxeVE]=TA,UM/Z)4KA]L	ןZ1{}GxY)EsĂB:al<7y<Nvx6^}qGo{I6M_e~ʲ)I=rJ>f#?R䮅دR/Żfԭ*xt{}?+N-)Y4~sӉvji+J	rɓ&gv]NѬL])^1ڈ5Z4RtU{(qم'O@J"»`ōCQ88	+LIZn.~@sâ%t	dҴ֚^sV݉kaDuVbqkHl-[rĠICcAb/]Uttl[\3z=ջ򃿀V1`YyC5unw/a=	2Ny
?#`ǿk:VTW0 qH4G :Me A~|Ğ YOAC;PѤBɳ#3b4g>ZAQEz)zV.X(3O9JGoTqt
'*:a4NЏi壽0^cX=NȮe*Vnẓ:2_yc	.9u.m"54ҸX4㯪tْbɫ/fa{ߛM~[Un@\MmqQJ5e)	=#]n"e<%ZZL񪛫*9oȮl:#gu@NE}>ǆR4^6>Y;ـ zeUa&v5IyH\(I/uNV|r! `K"#d09ȍE*U\0Y܂+?9J_^{_;S@*H;ZI:L?U~vV}lzSeŅo]C,Ӎ\
ЕG {_p
uۭ~Ye\c%TĹ3F1.O*<iAmQc[F{fImOULG^tpG"*O`kY~E9>M&rK3YCU0xJUy[0Gt!˗ K<KG:@a>l%m
:cD%Hڭ1\z4)Un5ɫۉNw(]2j¯dͯޝLUX4..䈅	PsW[,WmT*6ONٹS]<*r:ؕ}욃5LN29lcnȖ2jT⭕t08,e4ʛ5N2*؂U=<NSi\9ZTmd-g9v.v<y,%(7+8]~qZt*7Ke-Q)3$Vma2?*O̭.th䵀uS8Ȃax-P˝,BQO;{hf8X-TAhPʥV7 qg"{Wc\'p?pbSG 䰯.A~~8\\qE5)݈x#E(4ޅ[	mGaGm8
_y'ͱ?}aK/o9DikA'IWsa]AL~-cڧo4agF%|{}sBF	)태bKZKߡ|UpďɝB6KW<.2߯Zs9QlU;!jg53וPx~#)Zu- -X4bZ-E##(oi0xdYٞnqPIkqp	6AA(VD~ -4hޫ 곕|S8IhuLeދ`н¿Z	HkxQT4ZJ	ʀqZ#}"]nC8K20ˤ6ddU20nj,%x	q{(GgKt!qʓ{kŚӋ	9/_hD)ѧ1NbL#G\a]Gݻ<5NjD6E	,ĠbuA"܈^#%a8&cl8~D8RL
oJ Mr"q94$v%.GZX1ʸ3!zWl#l67}f{Z+k:kV`kJ>QP^o'lދ~I_j[󿶾S^]c$})6QrW76|#?~omxN5k4{`B;47y`]J"KkD=_􂴛C}:GyzӖico[?doc$<Q\`R;lV6Yz.Z'|2Qo
lfuFhgdQN"*vx<{o0:6YQg<hP'~
5p4\OQYyBrXYե7?x1GdX="A\W߬1tΨ޾0R(^jg⾠0ZOӞ lߛk13O[bV1[}N2c^;*+q6<<(Jػ|:Wi3FZkAoC֜?Fg+R_,,ۛ3"Dno3Fj,+\Pݿ6t՘=L#\T Q7IG#W 	$y!(~W5֚  __YHed_ޜxK%Xl (60xxOkY?Zڸ+N~<B7J蟨ѽm݊uУޑ<ν9#
]t3{G[Cn,geL]M4S׿vt` dl`Wi7~6:`-Ietȧчg[G{ۇ[?m_db19,E̕0J<c|[)OQpmL\#ksA:^l,3/rk9<}uAh=aj~4Djz#LDTj:<;4j,^no=!Tn:8}szx|?|Nv/@rqx៞Q@Z܂W
R냗/y>~G`wpj뙣g
hʵӬ$dգ;V`okNYϦ`wgﰳVofuncl}?uLc?HO+ZշVL+WQD?٘\I* i0A⿃_I<NK.⭝Jnm mŇ%
-M\@gcGTV SJse]
ZkN%M3NGCM,fDAf&{(ZY^vcw^ofJХY|x/qw)OEDK"uTvyCeykZ{t6	vvv/_cx]+؇M_6#/2QH٬(MGd=rjP2찭R7)xR;*h'3(lAEJGWo/NRf^C)wºW8ܪcNi*'nw݅&WoJZ>J;9_`LJvHȡuJz "ߞګlX{4e[ㇵjl?F*Krɫ=_Gn+K
ɖzw4B*n}HS읜iQD/~F(UV	gzٰ
:C/Ht\qkm}]1Va{>YRH=|ϬO$+bi9?0}+[_Y]Zl7ߣOkׅPט;+F}b(蘂"晇J#I//67K\,AU9efa8 ?B!uR۝2tsra`nۘTYcbCXǪ%P.L,˔υb&dxMrjF ݫgbQùU6f^p!v`bʚ|#"&FqtI2ClQgy/Goq>j1vOһ|t+AnG	,ҰغYA8'Z$=0[2±Y8CMCVXjT|1ƙs}sƂ׍;M6óDg>2TTXp̗[bbBʾ,
ta7RE/Y]:`~Y*=pEMX> b?]3$
w|/CEQ&-Pzy9C?gjW\3jJOyN׈{)((_LEBbXG^!qe|9C3՝Cim1?>'O_?yg7;"'9UF:I1L,0R}z^`F@~|SՃ&`w|U=v"e3U|Ѧ\)kvY2
Ŝ8W+!G]>R|*B"ʵ0<mF}Vj\-yr-ɾ?A炀p	1/qQ&U﫜JAؗ$X^&Hkj$DțUr6ͮ<l5:e8<#	YlO٬:usalX0ԚVa50
ۈĮB,nFs%oo  H$E{eXA0oD[ d>\D\Y޶{B:?77Yoߘz6&x`0LCEqDԵND\XmqKx~ |~ٿR#0&yc!ceփU~&!5Cטv]̄^IDKS	 BY,nC!kMM&jg:H'A,R?;S|A~@,q:Zϩp0(+mV{av|sͯ,эg	q~P7aw(CӬg1̚M 0O'd0ilݛɛT4MBhQ}E*4 i`A:F6X'"۲SIvEYqA~j|  eUcajmŠjo*R}>p8`^u'Aʶ eU6p8=n.fb!>$ i&SE
"5dЅg_D-} *߃uyEU粔q!C-ޤ7,׏ZГM,BlDFPɞqd*rI*?x!Ҁgb'f雧k[80ɳPGb֒Ϳ	ڬntLB7By.w<1/?PoeZ-+
㩄QԂ_!: lWBue1"3BfK)o8މbJy7b::KI2BDռ9!iVyy1F^ N`,N(n28"XHJЪ.ƸMBiEn](ex/I}}Ӻ3We4
Ej?WaX).}E`v&u
^$z]D>;2 E# ?z>S@~n#@@K5,m1"ޫvUΣjQ);,q}΄}|VWWzVw=ɂ˰FT"ׁۗEtFaMHЩA~p!j	~ywxBpn+cU0{L	jԹ$nqҢ"}>*8zqڟbfnG?L^n@&&ZU** E A.➁0!lD#:=bI4Yc&Fr9bVo	|v3Ak*@@.|ZV=`0hi`{ԗc,=g |B.۬Tw~4!u?2Yˊ_u]ĺV]6|CvOhQ򉝾}a;&jux	"$	ҍvޟww(胒?gD@FyS̊lv>v@C\4&tmEJf&tÄ3u}HÊQ<'	^JEN^VWbʇ KvBkA'!GB:ު"֔b@Md{'3HMǫ3߄Im1i¶#0q٢GH@pEtqQX'-'4>D<ŃTvLO)!0N<VBG1H~n-0/׋(MF&a9Yǂ(	j.X5QvZrQG5Bk0_X?6^5_ gV'RdsU5D,`Ş'U`0%}swi}f:٢̵׷D[G1ʴA?B0lIRk:}Mj1n"k<Nb/jѿ{4)0*=*0LC5I|e֕-yQ.ӕf4\:Bd
jXUW4'u<Byy	(Lݒ:aRǚmx!H#oa@x%;W}jzaj4
\BȢ]hLZ'ű ܢ4}NӧB	KDįA'-yA{vXAZR
ǉ΄OAT"ee6XM(c5Sd"$U}7fS\C;7|}MDYkJÊW)2eŝ1mg[7V1H=)C䪝}+K@t~V@*i:J6 =~N^"5L1p/F?|d._]o__튗ugnE(O ·Q"AW<KcM$af<C15Nq -3N ج3O- Xh.aE啤zވi]awuE7 &\e!ƽssazD5.$ &`,K9!?!TFM#-Go&"̀uA@G!l*h{nEPJ;}BAMǼs1bOOiugKIusxV{ kR@;hj~LOQ{WOј{Ms@3:;^	:Pq U1W|,h2&HG(f*m*9^+rs8JS<!L>:O|z:{-XSrM;NUŖ/nň-BĉJ ?EOm;*: z0I+i!HJCv_[`t:GFbLJpK=Wß&$-^8	`atO7aJ
uo:)F*M A+%%gxb}DۼbڧYRQ˷a>· [
T\0Feig%gƘ(*M-C.)C+6x;@lvL
\ieBm.;(NM]>u!xtq^ma:WTҖZ8YT~}H!G>|]k7'^U|}Q޼z-]1]OπUK!}GZרUGYk]u-^;N\^VϯgG0'Tӡ!ttBn3Fa܍ڢLhu^|4mJ`I-D<%37qhqrǫmy٘_;?yw%!H{(4,M&k.NCB[E~iYkmemeQ:﷞uw{z:һJ>6`I_i_6VZ]nc2nR*v\u:>|'%]EpvFBK?@|?^ߏݮ&sɷeDhXL=ɔB1m E6}dV}Cq(وj(~u]ك:?6=T/A4ɿ#A# z)*/ͼ2:wyE$z/?i47X,)oz0aT:]T`UV~'ώJZGg1{F{,!4UuVY=z]o~#,=z~lfd1yTI'reTң>D<k6"ۄMFQLVƸ?eqDI#Z{nJn<d_BomBzC csϞaqK&4I?뭕͍(u{ HG$Ha~z?onu nLyD:xxͿX89lkw7/!cv^~m}
~}'{kƔ뿽^#%yy
bxE"<B/R0, O[Y}0wc14L_v*xY7z˺ <{:?XX'x?6H<FIL yj]na+kcxtRQmG-" WzZ&^p `O1~]aϷ_Gxу0HҨȗQu{%/MdV<O1u+}Y-AJ|~&Nn_~.OSrzVPաbϼ=[)YL>	 UWA	a4kT3S=e=Y]hR{@/6Bzi`Fk'j6gu&_:ÔCj.d2+%;@s4S
b),Q>UM ^:V#(Orێ,ض6zv $"y	ѸШ?gA>a/1p74^^ oGx	xہ&?lz$؏]`d6p +\.h@ w,9uC[#ün6M0"Gh	 M 1ӧPӁ'	3&}_aqutV4#*mW@RN`uxCСİ> KGhp̏DGGD	Ct[T05 d#tVrNg4^52OԹTGd4%trp_ܜ~ߖr.iƆ[X{T+sʢzrAH;D9+W}oiiiiiiiiiiiiiiii飦Ǯ  