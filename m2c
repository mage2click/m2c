#!/bin/bash

declare -r m2c_version="0.2.15"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]
        then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$(m2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(m2c_msg "$message $(m2c_info_bold "$opts")") " res
        m2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_msg "OS compatibility check.................................................  "
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_msg "Docker installation check..............................................  "
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_msg "Docker-compose installation check......................................  "
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_msg "Ports 80 and 443 availability check....................................  "
    m2c_loading

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 80 is already used by some other service." >"$m2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 443 is already used by some other service." >"$m2c_log"
            test=1
        fi
    fi
    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_msg "Locating archive.......................................................  "
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_msg "Extracting data........................................................  "
    m2c_loading 2
    tail -n+${archive} "${0}" | tar xpJ -C ~ && >"$m2c_log" 2>&1
    test=$?
    ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c
    ln -sf "$m2c_global_dir"/completions/bash/m2c /usr/local/etc/bash_completion.d/m2c
    if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]
    then
        mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
    else
        rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
    fi
    m2c_result ${test}

    case ${m2c_os} in
        darwin)
            if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$m2c_global_dir"/mutagen/
                chmod 0755 "$m2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        m2c_msg "Generating private key for CA certificate..............................  "
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:m2c -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Signing CA certificate.................................................  "
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:m2c -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Password is required to trust CA certificate...........................  "
        m2c_loading
        m2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
        do
            exit 1
        done
        tput civis
        m2c_erase_prev_lines 1

        m2c_msg "Trusting root CA certificate ..........................................  "
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-certificates
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust && sudo update-ca-trust enable
                    test=$?
                else
                    echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c
    m2c_sign "m2c.test"
    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"
    m2c_msg "Mage2click toolset is successfully installed! \n\nRun \`m2c --help\` command for usage information. \nVisit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log
    m2c_load_project_env

    case "$1" in
        global)
            shift
            m2c_log="$m2c_global_dir"/log
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up)
                    m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|down|info|remove|restart|start|status|stop|update)
                    m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
\] m2c.tar ]s#(80-.UV7ۖm[3uztJdI$*J-4q}؇;{#ވ}?klfPERRsTm$
H$DH&ΰwi4vg6kwZmְ;x3b7T^zKAaGSof@;͆}wP{/d,w3B}CO_܏;yd6b?FVm7&ѼwPn:vӺxn;MN۽x'i@d^?}:Vi;0C;*`ivy/i4q_>s۠&nչxa0-k"߁9V׹w|vE0g`sw3,X#Va=`|Fħ^%;Cvű?=a~ϼ0ba0aQOnFǎqp^}) )H0xP=毭MW/w|=6u'?v?Ƃ?8SKmЫ?=UkaH2qev~OHD q=NkFkĀ^
9Eo&T0N(:ZEe4Rǣ& ꔭn;]ޤMZLƷXǢnw3]<#؝g8xSrǳCFQ[/n1wsaV5*bXzO_c1^	~jbF]cwyJZ<x6?.w23&~$AaԆa\9{?pW>ww瞌~~]}fӲ[ϗ_ߑ06+[px2!+5i,U[QӞAC-mP,QXt#6b|}^qy0 6&|DykBԏNQ#6+SaVͮT0pzPSmm_Qab/| %&m&6l!0qC` kwMjl0kfM$M$e1{Bvo50/>_6#H&$5T7gjeރExfʺhyӳ
.0¾-{YcYp$`5eJk5>x̜'=5x3Apy)8#K$lz_@0%yr&s'e	1`1kX72|
s0r쒝ތmgp7ؓL^ѴqniB
[Go)(qg-φ? ޫXVrm?~w_#q,Ret+؅ lWCs)a UV+sdA+]O"&ѫ*?'>K/>|vPm6*Us#6ZR&=m`ldܱ?33(,s<"GLl~ֵ~ݶa/-zWxرLoj8\nTz<6iH+olɿFC7݋LS߀6ѩ7oQ%H#mݕ;'ѻP6Pt[tD0M' qZ'gpƧ֦ppp1A ڡ7-jbIG<[x|{[G`3!B'43!HT[0y!/okA'uVݛS/ciC9uN}wp+x5f*D{DZWRۻ/_nxvu'\VB2`8E/cF^E?jY,$HZU&].xI^Ly	ƻ+0 cwwJr"Cgh<N:V҂ 4U|V?~R<5 )'H
⃸ed>{*` 2ZMlf"UM*&Ip!f0I0e2Β@sr%#3uF"ol@ /^>r7:%֣G)0>xZÛE_>	{O[dQgOwwEyʌP\,cQ˶n͋?"w1Rh8mYpUHgJX^9QbjƦ̗XbL	t1kCGyW> ~*Ŝl ~-@fXkĜ7GoqTԂIt|D?h g ϼ4+"<_};`|:|@TJ93b7A_% :sAbF=6<u'ިV̈FGj_lnROezcr3::Ĥ&	6׻SAscHU5`:}EмKfz/#[@ |]\u'45sItv)dˎQEغttôhƟg{fͲ鯷SoSI|2	QSB1}#
oQ0|KQY肮LU#WpY L8`J,kO<+y	a;՟?їI4Eኘ͵Q7!ZX%} J$|
82k`o^x{KcQw_>{}=?ow_|]6
!k0C̖g0YHg%|[$)_D,dy٢pd:t6Ѹԕq#o8=\%eU$dk
n>iZ]:?G*S\oFi{gFWbě_$^&;F9c"kA~3\
Yj4Af]]7|}z~(N~UxDcrwb	EE-sc)冝SPQ:T-A1Н퇻\ ?|/ridZx9]di~Oi׿=sͧb^M.`VnyÖagP"a="K%&=䆏d7%vm@^YꜷS؇!;3?!
Tі;7ZhGԡA_;w$yL5ŵd )wb%
Y1*j'jxS?|ڵkJ6dO&b4'Xe<e
̓ScBLSPǅ3e鵩`feRRw{a2 |"6X÷d,~ `oΉGYG;>ra|	<OQsrQ%N9}d I|)h|)(|){Rw)46+i[*B؉WC>#`2DZ,Vi㎡F@XFN}ebyh'
HB|uÚXXwv4YMWY ƘʂVrl g$JƟƒD	F1 S|DzOouooVsaBT4u1^Pql]:]=U̜0PSp3Px	W
Su}N(DM!~scl hQǿ>tpɸ(c7)=+H,ʫx,HH~23ZMZ;W,-ɬ[\F/~BOufN&3oBPV̤o6JVe\SMɦמ#؈U[=8"u´.+iGj7p8A~;f,`p3PJ9,mI}Fcm//҈bLDkP|'rs_tVzZ:}xX?bJmwuRͬ&ඞb_cq==KKjFT}]K>!Z`JZ]7Ngw4BUd5dqٷ˒G~6qk˷ETs"M2\Yr_H1
2_	,s. UFJT;iynQ"u2V:)ONi}"q~5!YE0'l^scyѻp8HNQU4D!2HS1ld-w+H'u^mT
ʢ#,׬N[AXƢ*B8Ӝ4
0aqӖ$iT1	I{N'-o8~7rTS3^0܀cEϙ܃?>aڄ1
z8 3=qJZB߬Vaړ`bu-O٪ȠOۍ$I p$1+$+e+=>vfN|Os[AZq`a~Έ"?!5lc,(=ITr;1ci5az9N'9Gρ΂|}y#i#ܴļ"6F5}h$O8r)b?ETc?E^o83y	8`k-Q}Y-	᎖JBnr;($ .'b5D4nـϧw8CNFb^`Hzd
)9ekx%w,;}JA'7QGzOnCnaMs'	lQni9K7ùNA0Ľ9S)R&Hʴ] {$rx7|r#,S>dKr`,4<v^3R%eJ5!(~oSD}I߲p3rXlryފKNLt=9 uqK(7"ScsbEqY)<NRkZ07&^팖mTˉ1K%*
rqJ%-VALC39D2$3_5ub>fXj)5aݧ'*&f z#kE30h2/BB1y8-Hd?'c4Og A6|hp~q<?zÃ皂ɭQK Q@ď2xRߪ2)HZd|ƏwY|S?sC4Ȃ$[UgY`{;Wi=kd i.k2^L1Jp\Jmh!0#gd`
E7#g&_KpF/?썇 @S3wbPifv=Eh2LVH,p;蠗XC͐<L	:5(' ȱY0bpLS4$0S@Ș	$Er&q0HFO#ZV.{Uy.Mj5.%w"fwRZ+\gihi69Df%B×<	EigTsTzQ9lML1f%%e)ѱdrI&	3&zjWrv GnbY!VOI}@ iJ}Tó(3%0wF<F[sbi+Tz|x 283Id-	<iD/
3;goWҘ{B
U&kl^0Y0E;'xtJZN%qy=-p MtE)5*DDjc6WY<P?Td e(pq((EKb1WbJx8yUarfG٨]9ܽ*Uhv n 7iT k6FꇏhhA}*@t)bw	![hGGf+ >aF0	]k#UqjMq)AS\K` /.vgO|vgG|gK|tyc`EЗҖ_ZKS~q[~1ײYCV!k$ŧ	zC"ߐ7$|C"ߐ7$|Ì|C ߨZd%YAVA_jЁ03f'|f2
k?Kuo[+L9,(8	<'$mp N ;bei$Y,=^d[~:;iY2=|%eJ) fBhi$ҔKYPZmCMl,TKv[pAA,CD;<d|D#WOY-
&2jځ'8}ZuIt/
N_꓾#<a*Hiޅ=H@IrfJi,*8OC*	ϟ} /2ݳN%*dʰX& ƍ0*	e-D"GKePgC|4.x''6[>ŁA's-Fc6T#˯(SDt$,ڄ;)nN$>09--w	V^bq8/X}jq&TS$hٍPGD(˲BbđǠf.iv?,y˧	So0DM&\pO{oyYrKJcml+Bxu},ߐye73۹g[|+rޑue+ӥ܂Rd*	K(K׵A3>ÈwXAH֙5'qKZx:Y"7"s^5n{2Zqx3>E'{l&򆨛D#yK[Oc)qfX#{
̑u0:/ү*{arlcr~v#YŸ']OVGyB#/+ Ak.Ǩr#=hOo4WymGxyiH(ˢLOi'"~k]s>;bMOW>(nrt=O~>AZxmY0"Zy:;./-\mzrd|Ce~gu%(gn$MK/]e3Gļ]4jзĎ"XC|o9渟1aOc/ě<y|l⦛{mG-Lӯƽ$jr|˧;.{m|@x,n7WUZ.nXb_E7X.a7NZ
AC7dW˹0;x/;\eh0-͠ЍʘZn#Inw;{K)R:lÉYQj89(7
&M֦OWhVDV's.E2\(Έ&«;务V)flZX#CtL
VWQz--+:=B-|c琷gͻmfͲP6dG^^Q4^T͚AOq4U!زE4gi,<dhΣF[VZ`kY1:]033iVaV42^)MV/z\npR*f@qFН
#q-N\W|EZ~#p&ˤ?|/]2Kh[Ӕ|<ʭ]蜣J3i\(PK*y.(op)W9a|KD$B8Jy<|]QdX@A~=dUREZƥՠ`@33Y9SL O{
(t~^͏\qm}^,ׇ5sW$7<;yTR%9$Y_ZLxnJZnͮc=/Ê~ei%؇_alkݡ謱N3cuy0xDg~:9~8l4SRSԼQfY@,oVǤ9IY/RXd&%P7I_V?ZG

ux{PRJnL-wtda5NQXynn{UQ)q+37΃p+z{_=5D5Odsĺ0?sQi&>|ʗG/4:0i3@yYydȻ>yET?Y!ccae.:v'sJW;KK%O{{^l.`?zYP
Џ=,S<ÍCwR9uJi߮سrXD.(c3NpK1Xwp6!^NAPB=GlXzq$Zzuj{&~0wgS)Q#"|nc#Ӡ9g)ͪF8TCz&:#g(\B2\	CZBdV4ԙoVAֺt]S҂j8/}3#hcPz6aq4^fAAx۫:-֐j|~:*0I \oi(FD˃\Sl[ud:I䂼ʚWO,˷8N2hOWglUvb+Bi%U[½ ,ZްrQĪ։Uڵ|ZrpHj,8y>v{-4;yelK`%ZAI70	f
0}2Ǣmj<bRji"Ӕ[Rxm~&SS*B#0$M ]I@v'A0bkncmڑ`[ctmMRթ)JCd?(	/nR}5ypyCW'lfnQ	u[_wd|h)K2oUz0;AIde$8AQwLc	[َ;u+޼)M%xA|7Zlnu=`v}ȓVbqvϜ?ә|7eh:ղ3?Ն58r*$%WxH;p}nMv2	L2k%Ij']8VbŻOĥfHڳucb*q-IQGB
éhdCmJ$#TmMC좑y2kqo[.R3ڋ6쨮-2Sn)8XC#[<TtreMK_5\ p<{0^19S\XPmvo\pL;/ڶu#j2C+J+<D4igLު細MۛӫqH3=MɒHvSR$psUw&&Jl-~gCcd_~^ wHSkN8-	saqq,'Yb_22OUgAưpG66!B\ͺ*D)TɽJi^|_.>Ɲk$^M34}?yʌy>s4)<Ux!v?Aj׼e7	!-wc]6E n2+&w`f#q@1{nx	0G)8`Bp`98x|*`Q6{ vDh/H>\|Q0ud.!:&ZuI{B{,9O=Qk\7%̒&`g)WdxIZ;UOPZ:[sdb|D98b`ZI6HN]2U	_eN'nA*BZaS=IϷְmAĳ7kL$'͊ZT"2qEc#ň>[J-OUPt\`1}بG?qg2Xp<XS	!\
u^WiG=FHlR{;oWy[R{ -6wE+.WzYD?8ɞEkQNT&	x_.$Z@!1"TQ  <&|@Z1<	X9/7=YP4KLjW#4s1u#HϑnlJ	Ё;MPڲjAQb*o[q\Q{e˃M2PR
L2.Y,/С;eș]0'e**ȻΓ;c35~JrMuK)t7cxf`ܔae|K/žK(8NJE*Ct	D}v9:κ]uueJKIbi튜6w&/涇\^.	sdf6֬[e,P0#ZIvAYJB%'`KlyO-O@|-Ħ&1ʳ2pAoŦGOOi1V(>~#(V,mxAǛ)dz[Mt/KRiQ1hYy5DʕWy¯#KE!̤hkjXDό.Obe*{knNa-S|Km]o\cNh+$Su⅓d%o5Rȡ%]k!̰.ƷU~~7`ںooSoeVs?|4Þ^N3ݢjUX<s_Gl`4-mF3PV5mQ$k"7nO*2ELs.eG=DrdgˇDٴu`W'Ph):kL]֫E۷:+΍zX7FVb޺)Ze.Eܖ~!_K&-&Zl@*"u7|io̊&#3R+
6ADeURmyX1nۓR.n-eR)OjQj%ҾEY [["wzLR
Jv'y:QG⒋
ƶ):pe<ucxSGxyޚYi]*\l" ~qvDQ K|\e hNiF?9=S,]N9>3{g[gePgdFC3CZ*s<Yjg\Lp0.?~) ]%V%ҸUp6i{ۈiǏݧWWkwbL=>mh`˲k["#ɜW".󿕪f#цշX9ߊKBb#׾(xl$ǶaH)0~֩dMLO2lrIB25ʭ }&$eKGǭ .k,95/D1P)5՞xX !Z}S&;pdX0{ltp6QS,!po6/cVV^dfBX/mXdN?;p./E
qZ5TdZz`>+(`Y>JI]d#Ate|g00; 1=~;J[pmXSoK;ʛsjeIPÐ\e?eOa_%ИzyGdӣXdo/ 0s1Oc՛?́X@GOe{% 3)gCI_LwN~)Jn䨙r&8kqLވiqTTx+)շ*!ONKd#:A$|(LyC<>cY	=76]xaR'7! Gq*Ƙ^S 0e7GoH(Aul}i^P7^~QAOn҉'p-}KԽ`&ap]K`PO/ {yč.x2q|Jφ57b\o<d6ǪOMtX03<uC6=t ~(o{ͮ,NqYow~\*2' )Nf++QU٢|PnF?2H$i~sϋ>IKg0QS_>)}ܑW	:foFDaa(5xk{rdf#΂1XJvPVLWGr2zdűk
]<!p9gkQ[s,NWȻ E?jIBiRG%ڱµE |?W ܡ盋ShOoC޳7~wVŒ\l *Eֿx2W8\$ea ʖ݂|33.fI CH&\gUcQ6?\rBg[HSq2/IޞPZ0k#Z|/sᅂoCLG嘕**?jKo[쯾zY*n[W 旃F	9aQ~Y5dd)Ȯ bpVrZq`oɆoZX;,;.͒3C/Ux<iKΛ]}-p~K]M P}^z&
)Ae_4(P3u;`d+{+#,	}V4 ٥oR׌v9N\,|p	#!ҲW&>ƠT{`GD/{c&]skM!A(=EyJ'5_頬
~D<ա(>di*4å>ƚ'転(|^kM^}E6ܮ@f\šd	-z$G
VJÂY[&>PRZx!qr3"W_t :t !k+O5XlsPq/Pk)%k	C#6ꪯb(/x)x#߅Дc$ud#铨efIMi^qM\tφm4ojs3/Biַhu!WB×:Z۹SҼJh}B9*
$⒏tD^&RFZZ/i^rw^|^V_SJ7S;'ʐ5F \kJHT3E=ހ?k	ߏ@q焮0~\ۻL#;.# o Hˑ@\Yhq䚷Wj5)}Fsz5+߆WC?WC`"yڸFL`S+mɞ»RroW֑<:W9/4:()&j(A>ʹra&:eF*[&0@]oC9;ƃֲUAcʹUXF@ed1D >қav/#/>[Y%K#|]7Z2 (J' 7Qf|+=O~ AQ4N0;8UV̠^!n[K5pV
="ѲtGL

y|m{z`˓0x_s!@n)*_wy7j2"QjQ=[-[KHJ)WƵ|v"apʒ>Dc0Ƃ5d92ƕQ:EseZ@,H<0fYx/\Fmmcf8LB]!h!'"iQ%d*Nn񋱊#,xpa%%}Trl5ގܝɱ=y^M gH7nfiM奭MK4Ӵ5g4քDPq>`x>ht7]6'r
^c>4C}co<)4'Ow&>}wܽp=y3@x>%k+8_qY}+ג(ZxR<;S ԭE.N鷜[ni>=Nv m4>dQķxsinr}v.P&ɽ=ЅFarܻS=BH{w](\ϫ'ӌIX,/us1w+muV3q|;dLCeBS$R3Y丆d/k_osk^>e=<VTQe5;yPo3	R5WJx.I}-QJ*ܨ\hR;gSK`9TxcdVlMtwg]=`ggN$;g|_dk_3^W~u}xj1'ha$(vZ,jj$
XJ--ʛ ?LZ2a-g[c Xr>-,Zo_d&^ΙjiwAAڛ)aQafs6*`.&W/R5+i#oAG%w4xe|h78kvڍ{,kHy+Cm3qdg6C8WE1CGl\X6yet%(g|#.XخXɒȚ*L^!)Xޱ/Qaa&ʋFkeŮW;_t⣇ڼ P(eд)!gMRjr_VVrMa{fPOaG
ğw F[
3l~B׶^y6u2J~EW^Zr6o~wsJ=Iv]+͙\ZZG
?ژ 8q䮸 6˽'*6`s2$@v$$]u$b[48x¥&kZs!ЉWO_m1GryC`̄.?PCCQz?`jT^R.@O`\<hnU{!mř冤ڑ	w@x%tXXYea0QkP8EgD@a0wMI5Ǝ^K\mo(3
alv'""w7[=߱k v³ǿQQ>#W|OТ<VENb-xIbDf6DǾϣ_]QΒ+*yNSbԩNU5)%1Rқ&3NAnOѦ҂vtү佴e`0yB&~[`ٻ'."c<iZ}HۘOl΢:.BF(/Y>~b!ɤ2Z}&<NB{XqhiHpskqceγx;i+9qe-KCQѴ,DUK<1Xg]`IyB뒆d@EZ#CSǧ<f4'l?bW]/d0_܋V}EZWVTyM\C'y!W#9>/(ɪbb"ؗxe`ϯv6k7+{ٱ iٰдjHߙ+j7i4vg6Vi5V;־}T'zK}i>v|\^#<JKױd7VٶN}w2&n]<A	m:Vkex^p910:tA++SǂownFwZN~ŃK[kL--ֹ{a<QHiz[br6H 3ܖWd{ 
2҂ iCN-Vguq oXzZP*+h49;{a0otjRxjsgNO͑,FaԨ@'SR!?߈{Wޑd֩ۄm*cn<<M4xecD+tlBf)E_Z`w ׺wO4kښvGd9T\$"B|8
4GER al׺Ӥ7N9Fuh7Isw<]KٴN5Č Ixf_?ǱQ s?g^cgW9z|"]S-JKa?mYv^Y`Nb!?B30:JKGx@ba(wesoÀ.`~nI%űn9]Rz͌i;yJǿ _,||x|{N9jcw3qwK}E<5u|,C5;~ֱH7tO@lbpkkk2᧽n:*i%ez42A2Q}{2q18S=!f޿W{OxvIv?xS $σ&ov_<W/DKg)^t{w	2݂W	{^I[⏯|f'~M"2$\=O{o~~n |4=SӒdLO^zЭ9JF-gOwZ#-u5&m5xcoYh_	Pv;{'OjZnI?S@ij=dY2Fl▙`;PO/(He	A"=[KVXR\u\`W7<+x[@7n8.Ee/[x6Q|;`mY`AjHjs9fopD֫U5
Fg	jtz?A!"r,,y%d^'QaB݇OzT%@#-;btZ';@dL.ԥTЖ;1%	l|Cv|nuIdұĳ.5<31,i^4;̓,k.G~uo"UllG^8u|/I=?q&vdl}N5^9ВRs$r(WA;[R9~[k<؟?/j?|O	`uNٮrv5{DCP7&>7?Y(Cȏ'@,ͯ5{O}/DZfY+[VĝBNt6boved8Oʸ}OzUJrV;xqnx8Nq{_[9x~YH[(BC0M1>tIk5Z$i7	XQzAq1I4"5;WWYGo6|_m{N_<}vdPLW'^!?{Wb?{OkyRȠr{hrUȞmP9G`iя0wVؕ<CT`<MYO8q<>BӉMS\Y:/dc9
F4Y_lI0;D`۝e}@[?c}a0-qz=r-uc-6txvcwo{P'qLrɿZ6BfnhnONcwӅy8ެL	W4l`$٭:
y'uF*f`ȕhp@̂	c<l|4C@~ZmPp>YPz 5uڒ Fs:2k{qX./tu|]^m5{v!HQ8H4AS:6:1ny?@Giv!h{n5 B]Џ} 3q몄 ] M: z=hFOaV$ojLeQJ4v3D\fk-D6YFHNV0yb-+SEw<6is!ZYRe
7>dQrrT#[Aj1BEk>(LIRP#o*S3oqRDyf9G঱	:iy"j'Y"@kDmCL<[?}'{ɉq0b	tEtã&7#s8$:
Z;@	/θdx3"0FĻ,4qN
ޅFQL,tO=&3aI2XBB5{%[hm40CMoƑITXSzc3dgkׅg:Ɔc7`R4]NCxP܏q(Epp3Cl}Lv߯>0k}jS3(!Ho5[X#8?lbK1]k7a`"~lP56V	YԦ@*dm1Bz6XXM5Ln/vֲFh^v˩ٝ~֓Pql>Zv	ܶZn7N%ڵFٵmr^=jVuFvvtu"FvuZXvSKmܷkv`[z[[O6iךVʱ;v쭎ߡzhCu$Nv_O&Vݩaw2ɽ~o 4Z]Hw{zolPÆ~p6lcmiVm0RO07.Ec;|$@pE>nw#҅DAjw؎o聲=-="%hqhb7tk~p⮚vodZvDcjCSz}jwpп~~G	ٻC$W<ރC!dmC&Ci`GAnvk68C	lo@F_(;p#EV%;NׂDo@b.JVG؝ jM fՀv " cw`"
;A!CP %JbNt5 uBjzpD'mwm@vcs$H6	Y̺6L6TjCce8M`3vփ.1~FR aP5A`дvpoz4 %c_]q6iC504@v0 &jk]f&#@,hH	cݤ `tZ4Z8 /3@fZԄAs@*A}$ Q \DR4Mj*DCdkMg>:fBo!  O!:E2PD  5 ~20|z]ar"Eʶ*%d&t@f:ɘi֠ѽ>& ho&C=hyс$X1'ièfQՆ$˦P7Zxn8D vѤQ&CPyt@A;AVQ-3A۠@9m+&pk{!:kAAt~Lnt}q@wPq);jj$\-7kfB n2d:E4l>( GS W2lihVT Z4yb;8BmZf5!Ht:c"xti9Ќ&n4hAѴ1Ն~BzGh`4N* :!J@hGpH.kP>ü@/p1a=%vЄCˎ3A{VRO%MFmEanA>r6Ğ]kv@}H-(8lwmj*$ a!-`ѶkОbCMvfUMR(Epq(E+qe,958rl0MQX Н)6\C	 X3]K}lFKSwkhvhZA*TJEp'2@}63`"A.QTgfIdl nQKA69rA Sw`$MdFFrp4plh ;8+Lfqճ56I	Xa8?4:%/JI10@,;8Q/?Df\:idFc
0`zFAC  "]4 JN@ \"}4ǁ<@@t`5FISwPD][~h=`Ouq>B.vz8{gѱ;:>oN@tj8F$C+ER"`FH.6L8Sj)G-pwO64
='mTo;hZV`AR6bj_t=L3Z>A:~F
:&_uA@5Nar*pͩBڐ	&+@
JAai=O؊Ò @N,$"0&'IOˌG_}hZ>T6h]D"}j"T RGJE>7TrF}ZmG}0#ۦ>$fz}Upk,קdF/:[?#=PmMa6l`H&*fg#RLӒVI?ԶѤև1"klP*T^QC3ð4U!i55r8aTv^N埚?-9M?O Daa;#[U(
@;h4%CW$Mhvo3η Q@'kancdE@
A; A#`
_z2|#6'1z?}lXE_9vAwR- hv(Ci[<8(:?=.yp{qlU:s:У 6B1T̫9@y<dQ<z@4@ƲY;
C;ss/KlPp{_̼Ƅ䫬s"*	Q{C{O%{iCl!/E73oF*D\	Ji{ŝSu+==7`gc0I'n*/#=?cOWz-)aebE	˦y8|f#A=U+N0ѡ@`X`76A"G]:,ܤAK>Y|JJ9J2N(4FR`ڏ\̮WIU /lQKi3U"hu}^=D{_`IKWJjScnjoSRhA<dS.;ƵJKiT5G"S
FU9IشܱMb/(|򘶮<YnC:p8@ QEYVEꊮ+yq6ڪ!b+Q<<y&0t kF=N
oA@O۴O@,2KƩd<UO7 * S/:!'T~ 8JTu*_)^9_qZ)\d&tpR#*"5He8qk؊*N@lP}Z_@J%X;hNDuesZjӶVsbX,^ׅI6XCu!C-&Sk,(ߺ۸xݯA02usm_^+A f,6fp@ް؄3ng 48@:>kʠ7_1Ʋ):MtF.!As\ۄn+^5mKdt.)]&5ſ(!t8ZPC=knaG09 r"]?-d稲j!XS=uK|<sjj`<bJyH,?Kt>ӱCYLT5:cKl&M:ײCO1ħnGm:};yzȍNF(cVnJv%> 9V.{m|0 ^%n7W\ٓqpG~0i (Y18pѵs8)O9	6*Ge4vsxxX2v	u묎?e%?
5*q$7q[A|k?j6'H$(Gd..9g
ӭQKڕvb<fCL,8hOCֿf8r֊f͍_C?_?~JT`/ 41@͘w(#c!*?۷,bnfخWt׫}~g |fo}wUIލt|	Y.톴}_	f֔tD&`q&]?6zRyg)XyӜd"ey8I\_sKWoxE'E޽rj$# *Ȕ1qtaLֿbO"͂"xm.GJ겋,T;3}u(:~<XwTvM?)Y,zN6,8W$Կ`*:1%?a$4B&;WmҺD;oX)ZYG*)RP>%xҜβ8~g\=41g:mE(pҮT
Ël/8ײ?8 R{Ͳ*oOM$MʊsGHf(O+x3XG
Ptq#P8ǾrĈ7E*l*?W{@-zWL!?#hxjxc#c4_f0~RK^	MIW"ԾQO1.D<7zK{s1* 9a0R7z]}K[3^YR]fd4'@7^\=b18m<!H^?E2DA)4R!} %dQѯW[XY@vNYMFHf HhWXRِ(K)*H*b\P|14uD.I foy	):=C;QUTES[Yv( `9`Bf`a5	Wu%Ub 67SR\%iCau0cXWtC2:53ROp{ɘ%IMixt!2-F~%cuy8*b8T4.YT")04C8b]Cnc"x+ʒ*o[dtXJ'8eW &,ZJl|:[YزҢԟa^.Mxx:@3pLYB`X"`p)(Ng1afKD6;9a&T0!QM.}!0VIY&]-=?#7<j0 Y#y(=KΔv1t5NEn@Js 4b/UؓtSQJ!E0C[`Q<(5k->uSCI*`}"~mɉpK	:pD2
p=vFDc\k-C(Hh;V$:.A>dkl	R%uܘd	%ݲ#|:qKzrӶZM枹]uhDq#8oL5|,KPPԒhkr}("@%*KԴ14jzyԳ"|wͳ̊}f#z;;FcQ](x,|vNk *շ4¹}I[iW%6I.u)@KueK#ݬJSS%&0_/ӳD1<`#N#eڸT5!gLᝀCj`f{Lb<0w	lEhѻ!0{fEɫ}U3t-"yY_$SPbjTi(˙9 R?kzxfl#CY:nށp,iu{9#PJ)7Ǹ^)?QD}%6o. V'.t=54bS)/D8I2 92Ɂ}2kV~pPz^{A9h؃|c~#s<t'NPح\;_A{1+^IfN'V+,Xžx-u`]ʩ37dRAl3UȢ$\ZVCXNRKتYDpp?<wW9En -\f^;P(`'[(-4[pC6$4b'|\[-[W9gևv_:u>#"bNkD8-Uo;/Z˚Z	>tNX2e{:7 o_΃pưpJ5,w__h>
64&J5VɿB%Cܗڑ͑\oj+ t0deTZ4@]y
/[` dtlN"FVhaVXYES`3GzGzt=hI[%<&7/R_g@{qoSs>õ+l?:d:g'>bIV\l uƂ쿹XkwۘoZ"sOְ{*Gd)JJ0=DxW{(1]'t=݄:H;;-ztS3ZEqGx'-.&|J2#iEyVġ;cJSس}lO9R$^e@$hӎAl0y[4e.<N䛂g~t}`g9abӍ(a7+o1uڧF5o_[~$u~н٩>cm~~28y@fn.iij%Uӏ!J_!1;yB$hO@i_0-|B5TA=l IoCkțAi2Jvj'R+MVN)9TDO̖l\MXkD?6$MS`\e,BI߸k-r5-UJF\3}~WyG4j;koi0	#L_1W+BN/XΌPDp{L&ZjuGY
QsPC-tc2L:}lj*
R(6Fθ+,H 4G6M?JfFLS*PD>T.N*TzL_Ky*| 4h0!taKS)v P\97
$U 3Wñ^X
h6k_0΅.D,ί7`R5GρFѽ\MiۨZ]H7|#^Kֹ1'Y'IkJ<'y@-	|N9['A&gA,/{*onnoϸ7W{#dޓKqfFa>̍'[CxvUz%ftqwLK86VW1`gW_+XF~=Y)ip';XYW$gPTIK~W%_G݊~{{Q_s8,r#G>[{fHw]s/ּHob镒M+NL{FZcp<A2cy"`	9_{93$2.MY,͂)a987E4hm\%{+nȑǯMqwR.--D1JFT#SZASDh }*]6S3	Zqrk`)"(X}Dk}TToh-CFQGGY4[]HX)Z"mxC2'[Q)B"] QMmШC1=ϲ1l Gct{ݧ/Z1]uMFw/EUXQKt[ο0$!:TK.=[Gc|	rc	2S890PanLdy>id&Vnm/zqci(R4\@Bޱo B1h _5㬍;"-?w:Tt(@E r	$E2@,,7`^q;O,dlfx4D\&dwCJ"-K3rEoS5!KZܾTVC2}
=^k(,-*ўH<8FiB0aDu0M֘'hY !e1Yr8Ĭ88 1tZk2{3tA6ne(;ԛ"Jy4'QP/P8<Tm ]kq4?fh;[Y::32xHOB,`u*C6×VAخUb,%LrsOqٺX;Jl/ZcevMe фQ-ιٸaVi@¡	5(%ؘ3Nwxק7_/ \]0"Y
$'ᘽ->喨Qþ)cE(`mY<1P?(Owu}W/-`Wt%`qq=6 O,S &f3o3xrSƮz\miS7](aU*Q>0d;Ko'GsH}`1k-+YXAôA)x{~綸 <_; 	@E3^kuшN|TR B/8: >n	~FPu/,E[Tl (E:F셮qD[@ȝƋQ`|u.(-3o+hcKãnw+=ƷҮ`m\
pʉ%v&(4;AUo~4~Y] d 