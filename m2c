#!/bin/bash

declare -r m2c_version="0.2.19"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]
        then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$(m2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(m2c_msg "$message $(m2c_info_bold "$opts")") " res
        m2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_msg "OS compatibility check.................................................  "
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_msg "Docker installation check..............................................  "
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_msg "Docker-compose installation check......................................  "
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_msg "Ports 80 and 443 availability check....................................  "
    m2c_loading

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 80 is already used by some other service." >"$m2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 443 is already used by some other service." >"$m2c_log"
            test=1
        fi
    fi
    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_msg "Locating archive.......................................................  "
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_msg "Extracting data........................................................  "
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$m2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
      ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c
      if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]
      then
          mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
      else
          rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
      fi
    fi
    m2c_result ${test}

    case ${m2c_os} in
        darwin)
            if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$m2c_global_dir"/mutagen/
                chmod 0755 "$m2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_msg "Generating private key for CA certificate..............................  "
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Signing CA certificate.................................................  "
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Password is required to trust CA certificate...........................  "
        m2c_loading
        m2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
        do
            exit 1
        done
        tput civis
        m2c_erase_prev_lines 1

        m2c_msg "Trusting root CA certificate ..........................................  "
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-certificates
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust && sudo update-ca-trust enable
                    test=$?
                else
                    echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log
touch "$m2c_log"

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c
    m2c_sign "m2c.test"
    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"
    m2c_msg "Mage2click toolset is successfully installed! \n\nRun \`m2c --help\` command for usage information. \nVisit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log
    m2c_load_project_env

    case "$1" in
        global)
            shift
            m2c_log="$m2c_global_dir"/log
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up)
                    m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|down|info|remove|restart|start|status|stop|update)
                    m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] v䶒(
8-o)]EfyWU-ʶ붥vLJddJ%<0su50|MD  H*h2@ " >zj1lϺaN8uhͿcO=8"@~n>v|<hG;yl8}JXfݨ]Qw.a8xGNޮ;f?
&心u[}C?ӑ$|l7-670Nٮh7{NQ8>7?ML!Ah<᧫n6-wPʞo>7|h'?X.c/3hv}ţd^SW}6[w|vE8cpso0,	Y{CVA-ptFy&~%;FCv'I09aA؏(fQ8fiSLnƾώQx^}	 )H8P=&ū\;p6~E>xc__}Ǧu?(WKߵ?=i7p${2;?D$"8>~&l5C5f@߆oN}Щƛ	LD0NN@yfP?xk`FjMp<:Vy?l<$0$V2+Ywkm̅rYe[@! ;zb>8_Ai(͕v2yQ;Gu RLk0tATDE!4
 e݅'__:N~?Z;ӵ~eOF7:z`<!;8Ax<j87ALQ%!j#P%j!Oh&ao`+.F_(C0g8X[RV3/!sdfeViN폼8	ELBݡmۢM۠.uoh_ JE [E 9-ZK`\ ;:
/ja A A bw	mVeka~r8¿@#mVGL"6EHj|ӯoNχ-:fu%gM`
.0¾RòT0L)j0̕6{Rgl4b?8XǞÚE	_ eɂXW̱wt6}p/A_"9S9Ӳ`0~Ř5E,ZjO9vN"6养sI.h(4!Z^f{4O4{9|"B7{Ͼ6jY0J 2`l4طE}ZI/&Z_<^t3̟P^E_1 =/<d,Amn]]U~FldJM,{.Ȝy`f!1PuGc	(Y
!M1xyrEBfgms꽃_Z\)8\nT,:6iH+oɿFC/\S߀ip7oQ%H#mݕ;'ѻP6Pt[tD0M' qV'gfp%֦ppp1A ڡ?&-kbIG,*[x|{[G`3%B{'C43!HT[ }!/ok~'5V͟?giC95F}wp+x5*E{DZWQۻ/_nxvu'\VB2`8E/cF~E?ji"$HYU&].xI^Ly)+(cwwBr"CϦh<N:T C4URV?~R<3 )'Hed{*X2ZMmf"UM*&I!a0I0e2Β@sr%{GD3f0^.D5Λ1؀
;VyY_t|}óo^		uFG2 /ap}(ݗ_7
{]iv~Ȟ?{Ϟ/'(?.L%4Y4ǲmƏA6  G_J(H%eѲaV!Aj)aIxD2_jm)3M&aĬ`qz\8 mz:0s ֚!c)swƼC/:iPY	
ypF#\<'CܯF芄|E Q)Qψ}Rs?ԛCԾeZ5#	n:G@oLgxtIki!M$4l1w^}juy!J`s_F_uyYԝ@ʲ$K%ڥ^w-;Ga*zßU5ͧW{OQdonn{.L%wF$DN	ŇGlG(#)ڇGh2.Ffw0Q\YDe7ؿ3bO w)Aq0bHK/`HG_B&+bNBF݄`yc|(}vP'	Ȭy;9t_?_?/1~,mĵϾ}l-{u}}u(f.Z61_,4dQjG#yY$meĖIg!fLD㹮sY/9%.Zm !kBW`uM+҉9rU@eǛz3J7p<f58 B#"b5O.1ڏXYwVʅ-ѬnuE~kxdo;={z~_1}12;V1AHՄ"jHN{r)@w	z SM].,/9rInmx9]di~Oh׿=f1A{&0A,a˰p(jUZkrGcA6 /,5[Y)UL`G5OU zu&|&t$	|#Sad#$^0N],yA!! 1b0f@%Am#Dmo?~ oUvMٺYӼX+&Ɖ(z'^2yceS7{Qi4efyYzm*~r٬+]^.#⠯-]D o0*+ˁo.'e[gsQюO!w\g@TSE>f>9?|R*_
_

_
^f]
MAuxʅ/vՐOH>,6UڸchP5ѡhyEG_XhV+	|	_.rݰ&1%ݸ]e#MkVxSj^+,1)լGr8Y:	&$QQ7}-߯0^0Sh*[I/ۛ\Z%u?G>MBF[4u2mWOCEg47'LT%st%0aL)*`(啸ªiz_+=Q6@Sb?׹1JraZ(_qF]~:8b<:Mߊ.*z'"F?cs?r̻V%KK2 q.B_xu?Kcoں`u'	Y +\S\f7%emtWĦgtFi~sJ9u+WWgr6	~gQN=ev-\(_U&_<oǬ̝>nRvaEZ`fA_xG`?|h>b%XAhBZ^J\UKǹkGq\"VS>Zk,_"NizIވk5sP;bߨ	ut:@)d\EXCۘ}˰,y}c668X-ڞग़iܼmR͒oEQp Q02!!pO\8iTϴӚ%BQ'gHيm/2'w/WY3y0<\X+EoYECb(C0vHWX桜n-!-y5y' ,cQ!IAH_ˉ0|IǸiK4U]D8L|ylvՖR7C|9)M܅@/knLs$HNgG36!Iy:1_7kU<)(~䤘X!bmG	[ti$	^|;8Cd,vMܓ#a':pE>tvJ 
bB`tA[&9Ƃ3ԍAsZ.qV5fyL ͡/L/GĶ90Y8q{| |b3hZBC?mӍTZ f/>g@K
0*בxя*S6)0|KOOp`&!^_nMN'<4v;Z*)Yiht, oeM(]g>9Yi<C#w@W OM)^#++One['T?ɍ:֛|
rE3ojTPv<Oi7drKYiwptHYgs܋ܞ<Em! hLڨA"GEç0rjXQPzNkFaZfr6DTIům*/[nF[M.O[Q~݉g4<GĴ!n	&sB\djl]b_L#H27".!20SC_qMK#3<y$kѲ64j95yTXs]1ξ@BrX?b$j33(iyh&'9!RtfnCK<&$W%\@ZoD8(vVrERTT?7&&R{/ُ&7)HGЇ27o<Ϗ`kv0=Sй5u?ۂ6Z"j
HQ0-sH'eF ӂtZE|2+``g73/[N蛍<oN\^Uqvqs޳B&h)%L3kV-1fL@FSu2rSWKr	襽לA~*>1=
`#C*͌sd 3.FU,3o8T8#S:%&Pb3+<SNJI(88r,g!.S 9g	;	)D4Pj!82fA
'My?<RS^EbKyA)蝰d.
Q𫯔
YAM@l,YyF% E"QdZ"\Cb;zSYI	iYyJIftwIy $đcV>bi*s}Slr`-Ce`dfe/,GL	]6Q15O{іF+(Xqʼ%(:phe_*)$a?HLRYhxS:oK?E8"2L2N77.4Bdɚ@!Ţ!xNI%S	i\^O+{pS ]YE@%hHmLg*˽eC꧕| C.(XLp_#NEUQ6jW1w
@](@s̓A+ H-G|rV3P" nB؍B1qi p?$bK t	D]ePZĵjp^_@Ϯ϶lϦHΡ/m%4嗆/be-YB +HOD.KD.K@nZd%YAVA_jЁ0v}soI1s#~:v~kRis6) fqʲ,us./KJtDoN8QrN㈴,x6o!A4YJ,K(-Z&%Q2[hA,FD;"tӵ|L#OOY-Kަ12jھ3<}`'wilG
Ӂ~_J<a+K߅A>K/Vpirn܈UrXT? _gJTɔaIL@aTт7WZ.+GKN~<и앉ܮ3)>12XM_~7zP2'e'LLqs"aimHDdt
cn]{7* o2="vļ,(jX/$fI4|jҐv`P`ⰐW|<íTawʾO_ W%14vٖʶ/Qwʺ2W\~_qs{'"w/=F!nIYWƻ]](eOƒ29~]=3SxLT
Z|k%)c	y?P->X#U&졹.s9=cS{rקj
L!	K<kEy1ƟRGj5`7as$ZRg|F6W`o7R:UbTOaug)>jnjj)7snNo_Xp7z{,z$v"]֥:w3[ؽ#糸Ix3YAϯl5~`yPC^[6yq#-t՗i~!KN= 	2<?QrD&ĥ2#"_@M-cAkY:AL!\jL#ď3~2.,^;L.Kq/5o㷺BK板g)KQxGF7vo,uϭn[n nуn]jsaw2^`cyw'u5-aZA5&cjej0}'b-6KfE#[YT0yon6-_p}B7 Bu:As-I
den@uF<o"zZjem76ŌM.xb`2}Y	V	R
];\eqE\GV={YG@oyW@ԬyʦOP{9:*Ys(`)9hU
HmշD]>Zq g248Y((cb^#-[-0,}\.o޴{kaV62^,MV/>\apڹT=7S;/RG
[s/<ʴS^yn/oTt,7lNS/h(vsj*rS"Br\WX-WysYByL	q[".Eax)02QcD u)<ayAw-jw,N±=I*ITBr)l9&QN^Е#%|"A͸5.ߪզ#:lOt%Od=eRO1~(V DP
q\Z98vE
-UI鈫+F`CY:gp 5cfapkge#e
WrJs{bG>|XN4s/hl&P`	K1)xAT	L3w W[p/YV+':~X=hI~Vo%}BQF,j
<<0AxT}eOl쪬/i^ia4,zKAǏ@5ca~8$L>~woSh[TP +f[@E/2XuH16z#or2TJ<M5PI0'*7/%5 ?ćՂ`1ËlaX$&!ua-BCpTj~=+E26@TyxpS1!^<<ǃ,Zi8GpIuL`{rLsG8DxȀAw1RUMq:ӥ7sCy$S
Ee ֚?
Rq8\>y|C:
/
֥zVlWy)):0.B	5[J^hF^4
duTt!aFu:
wG0+PΏMѻaZ
koa2ٴ&Fm^r܀,<ɠ78]麓yc/Hg~JK)/</F/6ubjZurZrh@r,<}_v{-4;yelK`%ZAI7t	fQ
0}y.E꫊IT)ZOzM,/UXH_G	(S[Rwt<'Eᐍ}oYhGn.5ofl)?W(0592Nd~	Twý>w%w˽OTD]]50|ʜ|"*7Cs7-w^j\x5I5\'(sטrӆUQaE4`+qr˶ڵ{GrAdZ<;HNM̩XyΪUR׮SN:SMOlnC̎jtâMgݷ UVoli2|C<S&0\ߤˆIL0f	X/I2NU㺘@o
"Sb(ql]:pK+`Rjh$wPҦdhgGlyrkqoG6W3v쨮-2Sa)8ŐE#[<TtseM:l\ p<8^19S\XPm~sBtN(ڶu#j2"nJ+<D4hi\ު紴]9b䫁Ps=͜%qAپQi6ozMpMV#irq!*3OA¹ǐ^s:]YdM8lˋCf9;ŵsFd
,8(cv&UbW^H;e*W˯ǸuN՚dk״s&'8o7?;f~:]C<ߨh$;8~1{ʝBYxu=%mS1(b
'ii&>GxɏXA
t9Vgn*)' ;"4Ľd&X.:mҦfҮKţOڧ[zsd/~>=Y/1ޒN*z@=\=XB0kP[n<zA-{ܲO
%X.Ht󤕇ҩ:]8@O肝/s>q(P1zJCm$EG?`'[öuZZ>{ܰ;Ia
detHg}1SQ[
!BpO븤њc*QqϞ\!sxfBbvbW8+׎4"	{!؎,Uw̯Ҧ`ZڥV\억W$,&,>|~*Ex32D9ҙdm(kI؏Q]ZGQ^2\9"uhXcGsm~tmX@pT2=Nw{dzC=@H1H d{+%Bx^6A_Ӫ%E1(nyxe-7AE`.l{+HRf'qblx]jCʇ4;/A^^Z\!ȩTqksPAw}3{=jVU-V6^قlzIr)܀U呯JP]Q/y]..EW]jpRyZ"i˳!KF
/y5V-8*
<Ґ
0WadjS)$AV91#Cqd>' >#-&rʳ2pIoGOi9Z(>~Y (V,r, Cb56T/#tgS6}A~
n[S(ej{,o)452DvʢhVj[(E~}%3|cyݔ߳),6wC\!RYV呬~/LwKu˙n~k5*gӋ\.6k1MBzUg"KӶ,85uD[+r^b.<i-jN%,W1뽴2E]n}M9g(W |
A#]"^zLvVx޹Qȵuj]l[ֻwݰZzۥ(\eZ7i1ѲeCiTᬁLR. (->:P<(|F%N(Wl'G\TRNX1n[a2e0GnָZ	n|yQwtύj|cyWucDU,ڡV8>me=ؠ$@`[뛂qnQ6QAgjv_+[D6VyxJ#F;('@rr.lZLW3ȝ5(9d{BgNo=s᭳2y2ٛ#ly,3n ]E0.?~) ]V%Dp6iHhcǏӫ+_^.WW	&2}6,]]m0c;ײ"#ɜW".񿕪6@ڣE/wo)28+j/	f]Q j?He3zca:jm( R61YʝFӱgpS({Rayznq7!ݤ2{ve8gH%(j0I:?akfsk* AQVpL3 nUCW<.L3Ƀ+Ol½%ZYM9gy,a;=؟m)|GaPiQd끹L |PʒE2`O@ 	+EfS<'٤XqQچlŒz[\	wg&Wޜ#WF,K2f:*]),c
hf*O=&F2{{yx	^-i<*o<g+'x6	\-q\E9>`sMNHQZH)g>0L8w\X?|d/c/bΏ^Qw5\ީ6Azv(	 Py<`Gd#|%˒N8)4=aƾ)9ioq[a_1@
d^La.US?\A*0IFBԖ%y%UTUJ}zt-NLg?YͥlK]{F	Q\yܨ)Ps@ܨʍRǧl85L<Nh-8C
.>bWz^g4-uo~q©Vq69;mv7[Qw(q57ŉu?{%_%A5X8'0/t7n
4D9}W.n>9ʡt"ӿ"j4'eOr>!wVkBfٛQsXmM4^vڰ)_f8xpz|ҽvh<>Q\"uYGqB%Oe1;YO9E/0n=Ha:W3_őIkvp-bzbE'U w(@zBm.{ćH;|lͫMl	*[Y7KsdLYVw:W`^F|⨋[s2ZB:tKV΋=DL`Uq'2U
sş,FEQPap)Ul2OQ+%E ߆Zb#X|-scᅂo\@L}З**?j7Ko[zY*n[W F)taH
d0BfsAVyfɆoZ8'q!}Yv\%+Zg_ć/9ow'jZƺ-u5m"Jy7p`}VrCS|6Q[`RC?쭠:ȓ-Yр䗾I_3)2#Do%4l4e/T`{$1{c]sKM!zA(=EyJy'6mW:(+E+i<):qc3Wh%LN&>!,i16
ZW55jְk-va7Wy(:Y-tBenj=֣kךHÂZ&>PA?)2\iǧuӁӁoS 񯬟?t`ERŽ@!jePh`qfT_#6b0/x鍸Д~c$ud#铨efIMVqi^pO\tmôhjs3L/Ciַhu;Ѯ酆/u29J*%5娔+QЊK>&/yK11dkdyE廬e5>sp[gVQfj<dC& %2\bo5݄m|X8sLWTO݈OtǑCJA 7q $H!.〬@~48
[ūݚWCmꔿW#.9oë!f٫!^IRK<mbL6TlGtR))ċcTAzpsV\rKtUD^?A5A>˴ra&:e5M`l!ކreƺs1񩧰DcB|f?қ]_}JFnƵAP(Q˗NAal+V /{[8pb9i9a(v(-p(.Y+ABܶ٭+uY{DAw).+AaaQE/O}W..Sv0|=׼ȻQ˗5EVj9Ǵ&%\FRH20fӓΙ>ɾ-s,C46/X3H7\7k\S:]fȃc[B)VrO-k{ʤ+>".r.^YB.B7Tq>5?Dd42jc謠s c+mQ:='RCS8 ́(E{Syikh9 R
i3zkBwK"g(8$=M&0mpN`z?stדS=m샭
͇3/|`~O<>1~zS)~H&ﻋnU(ǳ	Y]1sC^^5׾ƛc,wx Z$HNgGxV 4/8ϳ95#ݚZr~)ƙcdW
O E|?͐mǁW{e@o۳8<h&z,9ec?
/)ݯ%;"y5d3<)9zn.7\j7JQb{ڕ2bd	"jLv 9<S&Ϯh<.J[V6; U`ڙls!HkB	U.QvΦ-sɗVYrWU(/*4z9`EqS"Ei5<>h2]kÓP9|d|eEbQU&EPTXD+嶈,o
21Pjtjzm`Xji|5-"l@{?gQq-hoBrLq٨\!
ƳJUv`ڎDJ:[K~OAN8c6%lF˞kvg>=<S5ڭzsF,z̕뒝msJζ= #Pbb&ab@[HOиs7(#&+|6.6hC5as"{j,	f[|\hTχa%[j/&Օ~]틏j(osC1ūhӦ5K;e;oGx96/]+4A/u}`zh]aF-orWhږx4.ZW7ι%X78$nb\K [G?wؘ 8q殸 :˽'*#6ds2$AvD]u$j[
48¥*kZs!OщWO_m1GvyC`D
>PCKQ
´ ajVsnZ.PO`\"hnU{!mř$yһ <Ճ
&Jh,ao͈|Us<D20j	w^5WHvIC"(򛷤cG~rb'ⶻEzo06;|JBX	5}+d;nߨİ_|oThS VENj-xIbFn6D׾ϣ_Q;yPTbԩNV5-sbe~gU
Y熝>ߢMA!~2_[zm6Ńp
m¡߯ﾸA׎%;}pm>9{p6?2j#}r|0[I&>3qyߏpEKClDrǥ{$E[+sF['|YKp]v	~(+eL{	Y2%<<+w^v]֝gQq߈AF)Y	'x(U@+~=+W1"Uőӑ*+RY<jQn(THK !ʭbjk0
=^pY&,s]}h㊡^~v,HZ6,4Z):aw
M+ozi}gmO0jv㺬4߱R|f8T^lsދvGJ:l4ZNm."OPJ㿉ѹw? z9qrߢsK>|á7>~h &k^&ǭ;}v;?,Nƿv;9nl17L׶XrZޅq8:蝌'0Dloe!Z_/A@wOel\7z[̮.87[ڜ Z"*+WJ969p6Ԥ!0g1ΤOܧ~ߡEx34
A@'mSR&!?x'{Wޑd֩ۄm*c^28 4x&ec+l\.)E_VBGXa*kkj-ZPqËdWćm+
!^IY+]_krsA̒?Q@֍=)\C̈<ECdӢ=ͷp\4k;M:o;;ybxhmk/%eE!q#{zoe_,v:WؗYǇЌt$ү tPƭ8a }%`zuq-vNGh얹TRcPj6KZױP;w{'jr@+<(1-"=l{o-mw511CmLo&zn})q9¡`Qh%>Lm./b4Pf玟pvu,&nݨ7q^ bw[[9?==wPO/Q.ӻ{}F\̚{z{_=	eCmY~O L޳;?&}_|Qej/ßAftxӵmʽFtK^_z'k?>^>pp?i̟VLJG3=Mz~v2{O;u;립gOw-2ؚϒn͋?_Lc,a4m'B89߹w̵_-i
?K2̙`Q?{Ly(:3L]Y(ݲܿ /%J+S\Ŕu\`W7<+x[@?w,+%cŷܖ?l0(o} MDսZU`"q¦+8{
7?-tceI,Im%?ݍ
>}pw^BK4Ң\#GuDƔQA]NmY8!S")8DiG~]c%Rɱ=T_*#et28cx5"KDW/N-&Ě+P߭H`+/#~-G	 Mu韅8u;pqӼy'KïQhM9F ݅(ǭ5LfvSoj]<)6a춮ɶP5uwTԎyP;ͤ'{;:
/7Pvnq/+e߯u٥'DV8C
հ{ȉ1fUw8瓅rn(oӡ^iGnҧpNN]<i VI:8vv{_[Qǂ9xYHd(K0M1>t
JAk֛$i]׀MV{f&.gL1i.BR*/v>ҏ.3Jfr9r;yW;o~~a?Y{`GMNR>qx'Oo*	$/q(Q+g&WI`>xc:Hod oS) 
PV{C_T
a͒0R>It^`~`?EГB6pxH3|u썃0zQ1O
Ӟ~_&u0(ؗٽ֑?JR;ayt
grCx&I8.$jk"/WS?89MLo0:I&CKLfhBV0%ⳓƣ_5v+!vj(F'5F*f`ȕ߅uhp^@L	`4o|6@` ^Ú-PpYkSZ	 3v\{IC=@XmB5z]n/tuݬ|Y^65{͜V%H<v# 2@kZmƴ;:ʷ98ztN.p~:s7yJHФ; svvl68
9@ VLu:ȲyINiI(93ALiȟ^B6Ҝ\j`	aC//ob.2;uX<F#V8'UNpCm jo4l#Fxȕ$5!}0~`3"0-]iGtZ@~ȯu nLSܦ ҫp+6@?D%+էQx',-(@^F><&|d.ZGa4#+v8 oX֐xE&	Sл(*I%od},<IK(S*pಆϻd:f(ң	8:Jkc&#a\#U㚰1Z1`D7.lO?Wd&cJq4,[04)jvZ6JHi@vu9c]/+uZv66Wo:`ۀ°Rl5Zhh^ׅTd
XX5Ln/Vn:fЭ^ttmkZzr*@Ncw@Ǳ;N6PkM-۲FqFmu=ӵnh;uVquu"FNq-,O%;dnpH9v(ؖ.`zfv^F23{-mv:\mZ`odC:A'	@F8==NVƾo璻=ӫ7 jכHwǻzolP݁~p46LgNkLk6:8pD}@&M;	Ѕ1 CO:l{t!z4[mv=P	T-n솎u
w;*;ng=%. 6Vnv8z0	س~G;C$W<ޅC!dmd:mAC	m`GAitlCfhh!  DnwJ|Ԭ@v]6!PXv'6;8=$s]h 68vq "@u]t? 6Y­4 &lznQR7چ\!(©ˉp[mjk;	`:EB1s -0Ҙlhn.ղЅo"Pjm&p0l>5n @v}v:]&-Ȯ4=@--haCdi6`4n@GqȬQq0.H% 9
H{=\TM u(?yVC]GB(SzM`&P!DA@ :x;$0Zm&0TC/+MNesCF$8nP'a2 vni2T؅\HI25:sKh%QmxIl:	q!:C	0lMj2ti7vduEP}$?: TBkWVC:AnMwAzc!tL	5h6AuAޢn76(&pk!9(2	`s@ ؝0zdgM@[7;l+k:ZRYPAM* #qA&XmH]Z=24z"C(@E4Lu: >`45yݵQ@=D@A;
DFGp3@w@XhDMFzdȨ./9&h&Zv	$|(i0j.
Vz  _&4n\&CmAapkCKTY%MciF]j0p0h/w;8}@Gs;:	@ti\Jvkq]nˡhNF"\!LSdNt'hʖC#PB- L:Rۇ"4(vzZ2V
ՁR`BcpIibPME3HCԀ>jb|"%YYv54H[ 3vR`zPC\f}/nh{]`<m ktq6Ap>!$![8$J@8FцncܾkvqRV<NɋRD<.06(h 8فXo.^aЪǐ%{4A4ƹH5 RS.P DHq ~B+8:m=Q#0.pW:fm$ĬqSO6.*^Y`tNt-F#fZ*;E'
0e R怄/hΔ`Q'y=B:i=I[&jY}펖U!/XPl|yy0ӌOѸ6ۥWhc@[	Fs&P6$}`ۥ
&*dR ``cx"$>8b0#>4I2lWd00,qED>59}8@@6LtQ,+M<}@Qe-dd̈`h`e 0I^Og88w8)NcK~إuүL!Si'-w4f=H?Tm4W񇤨v0;,uWA0sM\9NUש:3*OKNqb,DƓ" ef5B8&ȅq5djy
gPE G4pv	Itg/8!iZn݀}UH#HI2h`=sDwOumTAKOo~aB#6572OvC>F+.;>.\NWM6p?MtG;\&'߅x<.c1R?~JrN,tT?Fy5HN7|7E,NOhR9X6wWa^xI|`gh|`nAӒb5N$#[8!
N|\(|qId/m-%~hOpC6"Q)mxQ:z nu6gWL`u&m؋SEr%A\`Z٢%%LH:a,//ld;("~ ;N/`t(m7Mѯ旃:27iВjarQ%{~:1UR[TZ%}o_W'+%	αT
pکf	4Πx\rwC	{):RDť4#`j>IɧشüMjb/(z򘶮<YnCp8@ QEYVꊮ'yq6ު!b+Q2<yߦ0tk~>R{ y1 _J@<o>SsΗi
vtp7N%IΎjm0ME'	~G_/bxձE~9qpQUJ|E۬H1O"{53
ATIA*Y[CHVt-Vq2
ВR*M:aA[ŧu"XW^(,c-NXd3x& br,4v`5-lZPɿuq%] !.tg@;02ze/s
svhr8 ~ЊNwPT[usd cr]V
KL΃kƠ7_1&𜺍j9Dm@7f3ge3R!c	~Jρ1zM/
w/]ζkyMOk6M]F.+RO`*>
ܜ_6pgߋ6U`Ie*QH)_"&/)'L*#g1q.yt]7_ӹ?yQ0ph9ݶ翀_w|}PϬ݊NYߜP+f;6>N#l 6իj(<F B4Ooz9mmUybϣ2Lohj{sxx8?+d8?%j3X敨)AV[CK !",U[Q1^G,$IN?oNYs0>]n'FH{>6DM̂#99-?g|3	Z+cx`?7?E7KVߥ!ǿyHo|+NGiQ/O޾e01rvݹڀH^w00b& c<}JnKzpTwY7de;vN8-Mp-&lc$`f7!ې7}ܛ`=B>CiA2]<D8_g
9i%꫷_ݢ[}}UgJk5gw vdJ8R}p1&""xc.G唕YT w;PujT"2V5Y0)lUY/01qFIDt.V-cFi1h3ׅMGwڴuv^xRZՇT
G!2 }J"K
9eq9Dy{hb8u؏cPNMPSjNF^I%@IrA|eW\3t|+Ip)1q4E5V4gֱJhQp>o^eTXU~K|Y]2Rᙅ⏌G0~xI10*H o*-H|qEEex*u%EVQLvכڛ3o釴V߬! *;b8Yۚ2C6Sa4ʿyÏY	9@"A.T$4ku	9?`-T4H-&[b~/|`+H3k,b03K*e>6YIEk4㏦ݥ:M|=!Eg'hu\9ʛ|>rkc46@,4`RĬ!L"T:#!JдAJ$fVU
1~$Mqs :̠&>{>*>lUFGF)NVc4SU$	).DxEo(tc]61J $,0}UH
L5M\א[>n0rʯ*9|"^)}gEN	lYΕ*I8K<V;)NQVh6%&^y,43`c/)07SG*"dP2(}?1,z;JuY/ hy2;QO(&owN{2̻I:yHUӫ}K^ EU*)\1䠫4<d`E䒂WM  /eпֳs	Ùrt}Ix6Hu;}'v=ɦ?e88LDb~r`'hă]&S/>e</(tn*7!G!ё	'.sG$g^L<UrBqjeJ3JF(6ɖ UZǍIB]-K;·Ĭ['7m`ޙUvhN5)7Tǲ
l^N/W}/SШQ3ufPϊ7^2+)t f6Cstp쳐VsdpV[QqƮc|HZGL`3HR/b~/PW$*1ͪ9>\jR~PI@_?={KT<4?ZJUr5	8&a k s' f|Q4J &_aW7Gz2]7fkd#"i-tPU-M<v8?\#7gKNҲUJrh,Ykˍ=fK,5Ib(+xs1YE6n|>=5O D@(b2`Sd =`ʬiy>0D{rV4}׆g팓G8x荇xiO~őj_AC1+1\If!&V+,XUx,5Rm@r43b|4f-0jkC滾IqVвb橛=&7Xr&Z̰:i	[UoV>&ÉP`L]*7q( a3Q1cՆʀORS&F-7	PɤVeDpߤUpǠ&O=лYݪ:/hώ*Wl'JO7hۤ[fŵ|Dx\cG,c]
ͯba4D[jp{^'wqerUn/X<|njNcV{G_#Ue)n!sV4 I.c@7H5zU:t2rdC4}P8M|/ l#73<o8i!E+|0+i|<8ԃRm`qPGڿa#=¤#=UxZnL{Qv4-l~kaυ$/0U6.ce|=!<gS\rP6IW3 $nti:cA\g;|mL]I'kb㣌x'H8=Z t=:H;;-CZx'|@L:t2IKՏsn*H"oʔg&/r,%lpZ[9E#
K̅fQ"&/l9ж=oJ6! ci	~>
Uj9/EZ***=('UR7^:6>7/J靴}NL]nC :o<F lyfk[כghZܾ+DUl$vFQMԽpsC(K6:ґ'SwOئ|1GkSUKh%<P{FuʑTu#=B6ʲebA'Zb6JJG!##輦r۷5SJ>iQX*ﺡjU$6*1~W/î 3_5Raa'ipݘʃ3?q4t/>r͆
u5񈪯CWEd	F.xchLzk%PLEb;^B*V0Ep3Q<}Qh44Abj.G1jgoU@_^]Z:WIj۰h%E:7bл?{	*deyˍ0X\:L7NA\Z#aIS5NPSaq,$㪊#˧ɧƖ&:m b;NXmt]$d(We|i&^ˀeҡvq&وو~AP63UG!Rbԥ2ܜnl=1"Կy-(w*f?z+BuP)R}cY<}5sujdkї#-b/O¯!L.Pt%Vߧ//>dW]+HBi5Kۓ,,JB	M?X
`~%X.ol5vǀ।)2N՝Wܣ/O~MKNl;FZ*cx<Bo<~cyxj]].s=KXzS&.LY/Pnolx@ܠP-tCE
/ݑ^E;+Wnҕ'"6{^C}mmhm.^7	G^fOS}e<s9B˾	&@'c
K+`IQUBU`fUow5$aMD{HU3
Bx;n1Gd
x-T T7:7zC z]~nɴgYl-Hq0F'1۝fr	Qz|/_f]Um9RXySJ\sǍ&~Ovjo4OF>4M[fcw1v$[{8=00R#d?	ro~U# Io,Yɣ㜛3]:ǐ0?h9!@13:?׌@ocOacy˧߃)u05H%)t"|
\Ar1 x2k]a-e=4:2!QQz18oz]#(Y2M՘p%'bhց㠵+^ztSAՋ]=?*tlme@B06\w"oǘ35NyF-ts<}34<a8	>+GG,g0C97-T1#}z0S;5WZc$/)4yan@N\A)$@p#0/Y=_.}>oC/킮u=rvZ!.0̣un2\Ԏ2 N۠R:
ٝ#)Jdۯ;4 =44hOΤB1Z=FG>E;>ɛ?_G}:>;h3
l5~gĒ5X!}]JPÖ)SE(PmOҘXGh<M4`A ¼:_ ytyFL^6N}ޤ x
ku,+^&cC"o3x:B#Bl
ykd>>\Wih?7o,ݾ1!g!m[0ƏB@G5`xl
U 3Q0 #Ǡ݃|]H:*N+zMnp ~U$\ACˑh}@HGwSULtu<<"IP*{<`- bّRS]N*Y'\Gx>I/e~O_^Աh,;
V
*qX`gb F,X`,X`,X`,Xg*  