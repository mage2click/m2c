#!/bin/bash

declare -r m2c_version="0.2.24"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]
        then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$(m2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(m2c_msg "$message $(m2c_info_bold "$opts")") " res
        m2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_msg "OS compatibility check.................................................  "
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_msg "Docker installation check..............................................  "
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_msg "Docker-compose installation check......................................  "
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_msg "Ports 80 and 443 availability check....................................  "
    m2c_loading

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 80 is already used by some other service." >"$m2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 443 is already used by some other service." >"$m2c_log"
            test=1
        fi
    fi
    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    m2c_msg "Password required to trust the CA certificate and create symlinks......  "
    m2c_loading
    m2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    m2c_erase_prev_lines 1
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_msg "Locating archive.......................................................  "
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_msg "Extracting data........................................................  "
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$m2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
      ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c
      if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]
      then
          mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
      else
          rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
      fi
    fi
    m2c_result ${test}

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_msg "Generating private key for CA certificate..............................  "
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Signing CA certificate.................................................  "
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Trusting root CA certificate...........................................  "
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$m2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$m2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi

    case ${m2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                m2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                m2c_msg "Creating the resolver file.............................................  "
                m2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                m2c_result $?
            fi

            if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$m2c_global_dir"/mutagen/
                chmod 0755 "$m2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log
touch "$m2c_log"

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c
    m2c_sign "m2c.test"
    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"
    m2c_msg "Mage2click toolset is successfully installed! \n\nRun \`m2c --help\` command for usage information. \nVisit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log
    m2c_load_project_env

    case "$1" in
        global)
            shift
            m2c_log="$m2c_global_dir"/log
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] ]w㶲(x+ٶMIV'vgms$*$eYއy;gZwZ0k><̬5f* $@do3iKBP*Bujqzi}gmO0jvڎ㶚8zX#E,NPyΊy/ڑ~N*>&,Nn.ۨ;0ˎV^oN~CL~_:ۺwPt'A8?,fifq????So6ywP-U_.dѤ
qu.n͂h7<O)Ie&؋@7N^ɣɼ,m{pƆd#a$aX'ZX&,LNhsvO`r$fQ̎p̒ <,	܌}^ Sp<z_]6r^l}	*>OFBon&$cPfD/ބbpWS=tfB!4&~L<Fo(uq<k`FjM&xtu,V'{~3(y:IWa0go$Z}۵7~c*D9-H1dF0Ag?Wl60#Eڱ7}sq5żBxk~]Q[Cu RLk0t(DwE!4
 e֧ۯcwqr]<FG^|`l0(<F0ZR4d!}f7Wgu|<)j?Dvj7D7di8$Lx3XkkC@ߎ"vE >=DulߴZUbVX|nI0}/he.iW;M[Iץ[@ [E ["@%0.q	`
펼 6Amf¬A A ,fPyP6mY]#izl>Pd,@R㛾9=V5zZϘ}̬u%gMP'g.0bٿ{iհ,U8SJs%k*{\gl4b?8XǞÚE	_ eɂXW̱wt6}p/A_"9S9Ӳ`0~Ř=E,Z'j	d'?e98W4mz[nT
J\m/Yf{4O4<}O_߮L;/zׯ_iyLHW{/Wۯ(*?BN`XR3>X[UWUQCjV+`ŴC+LދNb&ѫ8Yѻ}>jۏWWVAaL=ԥG	U2g(x9xbuꚿB{Sld?U_o_۽KK8V>+%SjJ+㠈dM`ai+o9&^yfګ¿>8o<pߠrGл+AwOVw-P6Yt[ti0M' qV'gfp%֦ppp1A 6ߡ?&-kbqG,*Byl{[G`3%B{'\C4X!H }!/o{~'5V͟?gMiC95F}wp+x5*EYE[Qۻ/_l?zu\VBBʢ׿6w#h?Mv"eZ܀a8M Gj	#e
XS.܂$/MWQټ;!	{!gSM`F(nL HMl`  @gƗb >yiArXZM̩/X *&(A^į`d/~wfI7p1ǖqJ-f;"1Qjt!BqތьX@z1|{0l_
	uFʀċw_" ~xUR,*܋ɷM~" {0K@=}Sğ^SUffZi?ـ}) <ܖEE<ͮR+P36eoL3M.Ȼ 
p tj1s5 ֚!c)swƼC/:iPY	
ypF#\<'CCFԄ|E(r3b7F'":@b܏|68&'jfD#/6A~nU*f3mۧ1i-- ĸp>2s"ҫoAN_4/ҙ^	l(Py ,/HYV}$:VeGn9ݞYiO9u'ۯ\Il<Q~cQK|SNY3e]Kt`˲ˊo7bO w)Aq0bHK/`L	
iĜwV=YkP, Nf{J̳w3?zʿn?{_bE>ۈkO~>y_Q
Y4lf4Xz8ILƘF",I"9Lƈ-Fg'F:S&סs]"Q-Ugrn}[ںA$֬BW`uM+҉?<rU6Mpm83ZGp _wo~zCJ@ާRP,tYPMqɽX+d®*ѬnLuE~emxT]D{w/~*P=U9#Oe	B&ATSD:v"K[V?LAERZF"o6$_f]A@ܾTuksċ
 l0ߏw|¼dF9~^*ۛMhx$fG0lv%R?jTZkeMnAiw3([b	嚥y+]15y0CuM#@my#eoxުvDj9		l7)I©/TYiR]Knb/m|.<\W1IpŁ6w?	b z]l],_DiބVfZk/NywʼN2l[ѨtX|2,6MclVJvcCL@Nq[b7|K--F|kZ6G:9;)u[dKypZ*q*'OOJKAKAKAˌK)HXOPe2N#6=;&ҢCB[׶&J2:t-+JxE|8/AP@˅P$ºDli
oJVk4V(4Vq=K'U2$$J0T&|
Mx+9{K"'0ǩ[_42ա]fi:愩5dοS&I7bPLXe݊-VyL] e#4,[:78ƶXсQ.Bq3.A[PW,PGC?|#'!Пƹ֬ 5/kt>=w1̼16km]$z/R},,k/gi=4btd@zX'4`kJL|3luɖؗlܡHC*uu;-gqpFԃ_Ɓ1oWڢUo8p:mv̬/l`p3Wlc+rX3;Ç+_^_]$O0$%ZZ:{~xX}'͕(;jU-ĦhWbdq>OKjF\~YAZ_pJZ]R7J!3?[#?{Ucۢm;^9ڦm&D.,v[$QXip,. UFJL;iynQ"/'urV:)O}$q~5![E0s5lecyѻp8˵HPU4D)2>JS1lteʩVN>rhw+(\Κ
2pV©;Q񥾜0tv+$G"$as>enO[ȇMnIzYpo?cr{NWOtv4iΟ$(@k8őnA}?ZcNiN"h6a"@m$Ջop0ZZ8wIع9>)?ȇ_3JA,.h?UwCUgh[܂ƌ29(|';G1 OLxM_Ih\@J@&Vs498!v^CtfqVg6CbIȄ+ش,fjnK;.VJnr(~Q/_{'b5B4nـw8CNFb>,9Ss
,J
!eY~+FOar8&^|Q̛-OSZڂ{AJo8D.UܞU,BB)68MD,)i*2-N@
|J=/lUlVT)rlD=9TD*)9o	y9,djhdyc0CX]t\6W6ez~xV0:L̵sYVFM,H-!vA-ܲ*6<[7(f=9 %q[927n>l+%vO<Bkˤ^q)S /yxs9 387(݂vdaa|ɱiyYÌZ:/RkŶ74H(].GL%Xm6JeZ ]fH!uYF,R	Q>I~	md:5a+ k7[U"+fdޤz!89?0=t
}='xj0=Să5y?ۂ6"HJHQ~<Z,O[5N^@P^T8dv
Ykg^Dש&y_YryjzUw.U3@K6*vWR[:c;9=CٍEe(N3q%ݑǫ^qƳ2y(J}8͉3a Mb*7*!)lN(@@%=B%SGCAv].hsyt?DPj!82DF
'M!-?<R7lg(O97!eBC@\m)FS>pu1	1A¯J"f!It}1iD_P$E&-REHiͧs8bJ
MSJ2S}Y`s2nF7O=33)FY@)
c69B24@p>*i81%4}lH<F[%b	_RRWfH1-#PH!	^jw4\p
mDx^J<f)vJDIcJ;DJVY	Y,zy°Ttҩ|9)fɽ&$M"J拔j \LF$3j
=͡xP&8oAt*LW) <uThny0JzSuhhp?ѣ]q>ZA.<r"cb:<Syp?$bTtJ]\RZĭ6]qGCaKo!*gW|vg[|gS|Dtyk`E'їҒ_KC~qG~1ײYCV!kŧ	z]"_%u|]"_%u|݌|] _Zd%YAVIkЁ0&7bF:&k/Muo[3H,%()<7mpS n 'eY,]^dߜ[q<;z7Ƒi"JRR@h$Ҹ9Mɱm6&\$RT"sI{r<[LS(N(t#ّ^2	Iqm,7cPgrp}0-uѮ/Lk1P`C̜^lsO&MRƶKMАJo?gY 2,)d	qӖJ"Cpj@Cb%ubR~	#O>qW2ѓۛ6[>m'wKLcV/`%SFt,+ZnN$>0?--w\z%:(}v0y9][*[
'7d^E5$>5siHX0(aOqX;>HYz0;e'ρ{{vK+̒BʍW;lK'e[;e]e̫M.sŸ=ZV+~/R'uMXB^jT)cR
rF0Li>B5Zq(y
]uSb1)c~Y-UB^vy$/)b1)c?k:^9nFeIX}01~am{b<otrŤ멞=S}E$(y-]mypRn䏹)7\%Uư*H//i7beYI):DO s[g^{Ggqœ'<[ϟ_ujg7!ZmY0]Ghw츼L	rBMO@[<t}׍I%xIi&.M?W^A^hBLrZE`b
4tpwco;$~,tِ&M7ڎiu,v{IJhK板c(h#KQxGF7vo/,uϭn[n nуn f8;C+e]F8i91xS-Sl?|ז",6ETofQ䕾ڴ|A)

ހBsH'+ABW/hb}36-eqT:&X%XK+tY(rVԖriQeʋ1s(ڳ]RY(ZC?Ae/(r,Lf͡|8eڪo9"ԟ| dhuqP6QļF[VZ`kY1:]033iìlRe]88_s(=}4;s{Cov^.8^py\-i'-7&A_{YBs-nR_0qZn^T妞EH>帎n4Z粄G]}FD$tCݥVke.F2Rx"/[5
aKkY`bp$$Q2RZt˥0Bђrv,T.P q0mƭݪզ#:\NPoO;˴ͥLbRUص* DQ
qlUjEՓ_-Y4[(WWq#?tjƘ@F5.Qc&R0ys~;=;@u431)l*J4M cR.`f)-:g說)P_VAjO

u	 VyZ[o_Xa2@zPML*j5IG#zKFU5Ŭ6_qxTVgJ?n?*+WQJtԋ0J{O%¡OnskqI|k*?8:og%ˑW󀼋3P^Dei&C8afl,L2EGdܪxrgY	|Umpdqo鋝`NTw?/Jj ّb0pMpțćԅ`yy`QA\7n3*T	]Xǌxywxpo=jLbc%qЪ+U7x=
(f3ER2\!`jQx<DڋQjZ
6ә.B5?36b	ABgmV BBgW/kQ3П-80uȦޥp^{vEL@ɵc僓Pz>aqU<Z"/UhuX0I;;Coi(FDG"0!i0"zlBy</C9K^oi_ ɠ78]:yco02^^,^yU_6_-aaqڵ|~۵䊛߅р$YxL),$ZhlQٖ>^VTPmf !ӇlY 1W¹XKNR_j=Vox_Ԕſ
(UxPw%VEo ]4<	!xcoЎ\ k:lSvwgNLQ-P
j'm9H9_mx[rܕJMEJ@^Y'li'S?6 ʝ18@qS`׵TE
[@qn1w):mefSS'7묭]KYo%NJ> )1d{
'BeGpvr!יf\oʨ|esJgvTHɓL[*gB7:7|XDfW|oeƨ[&	tlIfK6qENxC	1pI{.-@c8S&0)5_Va4QMiSqgP4UB4:U6<U@duOesvTזixJ#[<TtzeO:HA_xyf+&uKo2P^E۶oV_fAAix[?95US~5kG/(7:*M06ܜaՆMY.Rsv4Ɋzu3<M.na+3;$Xx)H8 +N8+	sq,'Ybﲸ`[AWCckAU؄
qmʫiUxѼ.c|TIvu:gqnvy;y9Jw;%2<YbH!;mpkހEk1.ib 7AS8+IK35@\W1߲B |/
W8i8m=<j4XTQL9!ngBr%1o2UjWi&q\<Xa}8wJvo؀3K܃=jT=BWhأN}^(jWBd^PǅV,
yT.'xntΗ	2OZyL=kAأv8EG?'[öuZZ>{Ԩvr=+jR
ʅTa#*l)ݦB>-WnF	&qIDGUb⢟z^-C#a0$r),ԍŮNq\Vi,!iCKKX_QKRo 9^=os/ioYL@0}(T\fdr4=Cŋt!Q"
\e 1s|ъWe'RW eQ=v=9Bsw*](b9$Ő&6 ].$zyHo,JQW𕵇_<8)%*F IџI%%At9Chv_&"JY.̈rX<VzOem.R*ofG6}U*$bM/Z.B^*<VI!K %%u֥K.3_J#OkW|u5~yj=r	H#5f5*g!V]YA}F+LZMtNRgen}.=wȻJhG|B3?f tJkZL<+| ZX.|\
˝JoHҮ1(k!:}䮱rx;2ETw+JB,ScyKm]NU70$SՔE25gFBQ-ՌW;a&sgog>Md鏵T_0+7ɧh"{a[__t[yWa=^亿@e\iZHf:YeaqI/'j-x=Hr;𤵨9ײ\aƬwu6k݂laT$:\#(D\)ΏtTxn.W2U[{zF=#MuAoZtj2[otnKsnkޤD˖.DSÆ2.K0I]@!:Y]Qٞշ[rQI7:bŸJnI\yY׶N7Lj%lEYn\L37V-?7rnZ)^Y^!>؍n<k5[Pp:Q`Xb|o
vƹe >F	2;G}V.h9PQծkeKȦ*b<byd-'W/qwJ+p03QYSMfȾ't9ޓ8gyyI!DkbY<-If壩\l66":j.XNd)ƈf'3m[P'`UiE;Wsq[8ɍeCV"zH4{粏p;*j<)G8ܱv}P}ruF D8(.f{,&Yq-(rxX}0SJC5תhsH=ND-eLA]Km%!ת_xǃAk6ҳ EٌޖD0ԝ7^&<$[#s:\d!FyXk[A\MHw&^nqYc)Y(0z	'L0zƇtUKk, h7s[8r~Ɗ!JK1'*nM簳37)B6k^7l99oCy,aC!%ڄmCE3HKVˀn.<<.B.MxSȧ2-~l͒<{[	&ޜ7WK`2ۖ7ϸ(1q5̺N%*תW:0z*>R4Ob	L۞̭LR9WV]w~}Kq
df.ɪϚCD15'!@&)tsbLvNɉ~Ou?tv	Ã#8P1eAT/8.VnxD =>m,uf0rgǲ{
.MAdnaeA< }ƾ)	ΰL\qEk#UXd\/za=Z?EQqͤnLl%^n^kiLUIL/?VãjB{Kc%5SVs}ȗ{n`ކT>}1=/F7rqo/QNv<wϦS?D#Ns9?X-eՆaݽKMrX8VT*"y .n-%J#Uo_9JM+XE݇E-Q̖Ғ/
	^,S9}<C>9xٿ!*îO9ы3N)Ͻ]ܑ	yoFDͷd`9	{uWdfSb/B2[CY1#eʵ[+YP7EYnS)y^f;؅;1QDDo0R
9]!փ*X(EyA0C5HYњh
WZ:AA7 1jktY_#>tݽ;_/n7HPYk\,ņ2^\dlš4%)v$e4ut薸=Dnyq'2U

sş,EQPpp)Ul2OF˅,2)E E^jaEP(qꪶn
q1e"㙪@'훥jAVd/l*
xD5|Q
|?#c#ʯBz? 2Wls+.0-_"//ˎKuqhJE|
/q>OfyW䮦kRWӮ YW~|C
oOApPZOR :jLTjgr1TgQ1y>-H~)kFf䜈X.>^h٫^`c r} |0c
£W]]u!zA(=0N̯AY.XQMYLq#lQB4/	i
LLuy591ѷe񉋡'QҚb?Wm]hQ[ʃ.,]j)/sSs|1V 94,XieSE CH,#ȕ||77O=MecM[*U~]x]
g՚꫸!sD_2^O%n?0;4',IH$jYRfFm1ןx"f[0-ڜ1$PZ6r6m:7jbOCzKiҼJh}B9*J$⒏lD^RFZR/Y^rw6G.+06{Y}\D@7S !kY*4(#SO<lxFO\Q&|~?Fok~j/icL-x7`~rmF|*3%>T
J  	/G
qYd> Qh*^ּj#WqO|^1k^'jH\ifu4eM~59]il-et,A-+TAKpsD\rKtU^C5A>˴ra&:ŵ6F M`l!ކreƺ,$GDL|)y#BrZY|0fwe~-qmJyeSiPJ87˞'F \@Xg'xxNJU}7=ީWVR0u\?+VG$Z>~s{zП⁙ Xy;"~z(}`~1[$.^t$
U,r{!T%_Z	^O0ry7ݑw/kNt3	riOKDϑre`\+̦'73}}[t?.VYR߇hBZ_fn8GrXsGyij1 mYOvUoj9`DXz
udGCA2k5-d*Nn񋱊 ,dqa%%}T|@g[c{,u<4@!YxRR+-L奭MHi*liki	-`|gl2^e;7S<WIWzxqz0N<*ʞj?CaF$x>ӕ?⃟'Oo*>}{ނpyS@x6!k+<_qY}˙KAWxǳ1^SJxv4a[S\o8%޲78|{JAPqWo!gRӼ"8j<M{{'8s?%l{G^%ԣ[?w'C0?r=FHPr<K\ory-xo7+oĎ2e	"jj|&W;kT˴~yn'L]{Ѭ<.J[v6; U`ڙls!H|K:D	U.QvΦ-sɗTXrWU(/o+4z`ϝVI+wZs &h4f4*Z$bN,6{)	=8K|~e*XpՠI r[D]7(d|Q5n]ζ@|Z,X4LW$"vtsfu[|-lЂJ((ǔGJKB`<;j/x;w?w_vAR(ߊ]|
Rwq)a3^4O]?U	b]ĬnSְaC62`ac\lWjv0%p(f`m-
8wB`[gbC6Xخ6'򡭐IoI?ͅKe|XV k+Jb2Z]A%ݾ衆67@>P4<x-8m(X9\>]sjSώ.aG
8A.fT2X&wmG|0e|m=q.{1~[3MjXudya{i_o{ܪ?jclK6G,C4mGD 
|LUMb1ڪvPIMCJnL+\5 ~}
OmW>	L=5 Lf5K2]-=Y2Jv_ZnHyܾn;Bz\r`k&ߌhW1ΓHt-(rzE^sd'$Q8):$:I+#O1v'/z*n[GFc^>o>G 1 
q|^ѷB=J;f@6`U2/jfCt~|U:;rYz.Tl:I
ՑeNt[p|n	a/3-4[<'CU!3	zmぶ-S/Wo{~=aEv,q!탫hɡ7߃]qPE8psOxH2鷌 N~C֨_gg(Zb&;.#)ZXl0:^WE-KCYѬld)nm+Β,бҚ*{­;9ՃکSV(&l cW}/rzVpaecEc6#q*Y+RY<j<lQD@DC[tj11`M{LXXjd^Ɩ^~r,HZ2,4jI°l^Vg&sfq;Nk>*gSq@nn>v|<hG;y>[coFtFQ"ej㿉ѹw 	d^cW{fsNw\뷆P¬{F(Z	3:ڹ$I0qQnNA+k:SǂNNn~Ń9[kL:p-X-waG~((c$-1<[Y)nB2]0PdCd [W፦֪87[ڜhZ$*+lK-69Ep6Ԥ &0U奔bҫ)0~BP)C51K4ig$2RS<O᧤L C~Z?j%#

S	Uνdpi	)9L<<4v/s7R俜5;z߅|{uo1QmYkk:-tѢPqՌdWćin+
!(JY+]jrvA̒?Q@֍L*]C̈<CdӢ=ͷp\4k;M:o;;yEgxznk:4eEĹ'{zog_|⟷ltl0'AH_A=<[q#u;
7QHW#u?@cn).AXNng~59]R˘傖OOmÖݮv511CmL1o&zn})q9¡`Qh%>Lm./b4Pͧf玟pvu,&nݨ7q^ b	[[9<?=Ӆv_SO/Q.ӻ'{}CxŹz5?{ǣ H<{iߟ 4qǽ/v~$M|鿼|/^?X?=%O{薼J15{u1Ozu}=˽|%{3g}?$;fzWNUn?ԫY7=}oUl.,yoow_?S_OO=~BfOv,{G\?Ռܒ0Z.Üfӱ7ϔ)Bx4C$ؕE-[XZ9uzULYw)̻
VU~Γg] ?Ns7"_^[x:V|;`m`Aj=Hjڴs9zow<h"ժ%U{~CRH9[^ZԼ̒V2Np^#ݨ0'Ow^n>vD#-;bxZ';@dLԥTЖ;1%	l|	Cv|n}Z"5WKetx#^fgaTdI
ei>eÄXzK^x:yee{į5(7{>n>nb.;n~q?;Y_c#
- 5I"(yļU>ƳPrVӢ_?&ֵ;fʕ17#ja4}hByGGA2*`Nq4]<s} Բn5ȊgX߲U0rsLm;v]0N*dJktQ[e/wi6\jӼ?O2zRoE!D]o]^Vd qezѹy<@x 
YrlwE:aR5M.k&}]!f&wicRf\T3߮?٫hTK?(yuzmgO^Sx~59[>qh'}]KJd?.zT)JA },Ȟo?CAx#;yhǃ(LX	\SS)w#h7KNHd$EzCCOX|"9`7F[lNxyW2ߣ> H?Ga>?>.PT8Fc!Wڹ6؆ϣS\u#ģ0Iq!WWlGAͭ׿_ibzaOp6b0FYPN~؁Nݪ7atRsab\mQg`a /O4]:Fnc0!	&	 :a1e6 <3nǭ.	b8GM(Fmu叀o4:+˦RfojYP1q|$Yva^umޘvg~?@G:YV!Yw{iB]Џ=sA4@g.&S	)@: qpNݮG!H!߬JdQSK,$v3D\f%k- o6iNHV0y-+Sco42is!yR
7=dbr}FN7bwVP aU&`^͵K97%F~ S84f !E*3lN)d1''t5
|&8Эх90	2M]a_0y`qy[Kf7,SkH"AD]jLFķ`2.W|X$c%)8pYɿ]F3zzфfK
aD5xgy1ˑ?0CqƪQMˏj|vSgl0d 'qX4Vfr?¡GAʲC32:^Fo7Xou~CثO͠4Fp.q`}ŶbNڪD۽60`)-44^ׅTd
v-j&%5ܞ;z4CުZݦeϜ[uڽf'7x:ծ8Վj=7TfSKf8:{Vnh;*0 n=Dn6!ѭ\<8!T@t;37Uuꎞl$ӿ۪6nW'봫[m=CТ`vI;jsnM^O'k]žo璻jWoֱA. ծ7;܃`wd3ؠ
"i 9Ʃ[0^uZ`XC`Zm-@oԡǁ#fZv0mH.N8}qf GЃnjW@{0:@EPKfnT۽.ZnA5umnij.d FVقTnv8z0	ث֡Џnw܇HFt-y3&BȒuLۂgfۂTqnLتrjPw\FFfJ[z	@ĺ`8,崰;A>Tn#CA
=׭ DF.n\Dh.vC"KuĄVm#j@Rг+$E@8u9q nMmzm#lTG2H"f`q`vTSw\-3Um%VZ.t07g8n8	 O͠>uA{ۥ! Ѐ`(a긝NIi1z$PKKh4Z5 bAC;D ۤ1 yq:2+`lw\&R	k#@z :^ϡ1k4US?'z.%3t^h`?'PQ7ʔ^ y	tAn!(:.ގ6p&2	V	 $JSY,PQ)A@~ #0	(2=Iv
0 @{;m4*B{$]9Y%Fm^4ʒU6$Y6ȄDs!&b5ـʛ`B	"ׂ~Vo	Z m_5nСnƠ

 `ZN1Lv萈CNQS  oѿYm76(&pk!9(2	`s@ ؝0zdgM@[7;l+k:ZRYPAM* #qA&XmH]Z=24z"C(@E4Lu: >`45yݭ
{R vNg!0ۍ62
# 1Q\^rMhM8X97H`%iQaԶ9\ƭ& !A*N,LiEF
)MЇdۂ~׆J
ҩ6vmV)`Hm#6``^`8dw qp*!JC"v8t@RQrӸ ׀2CќDC(,ɚ^NД-F.T	䁡Z tU_Ee;htQd4W=4 
ZqƢ
8こ:A>`N^g0 K}DJ*г$Tj2h6`@f(Х[._jЩ;0yڢAl2#|9PCIHCp4Hp&NƸ}:0CyT$y \`m	3Q.@nq]0hMàU[!K hiٍsj J\ .
`@҅V`ϵq  u0{d;G`\tZ:HY׭:8l"]Tнг؝@`7`[h'F :JTwh#NN`")0r#`		_)5NF8;	zu`Wz6MԲ4-B^@)1/:.3`-X ]]]?qmK: ƀ[498jTMRmHFѩKLT %Z 0l4'EaI| 'Tq`F_}heF졁>4``q-E*]OY4Tчl">5U}jr&plb}#%XVDf	x&Pf9>[ɖ>mdLA`
3*p8qqt}vqS2-.ǖ&K0_#!%_33CiIӤNj[dhzN~5fKi*(IQawY*`6Ss0;SouPgOMU䟖?㦃?X'E "0lk[p\Mґ
j* 4hء	4b[=(_pCГ0[$YF*dz ۨ,øIGmjldԇ|?b6tnk]w}]ԝ:p%H:mJ~0
ǷLN:y)\cܥ8DB.7Y4lն9/r}{oǁ7v4Xg-Ф sl<(xμ̏(:X]MK.~cLpTtU8ďl(;q!N@'˖!ݦ?	"ۈ\D=MNFp䂺I0_g3]qc/~Gە/pˋi=g2"eDP̓N8ѡ@`Xk76A"G_긎lܤAK>]|JJ9J2N([4FR`ڏ\̎WIU /lQSiS5E|Ѫ{z\f;&:R)&"j'dd38q9yd3.;ywSuJKiT1G*3
F|(Oiy#mjb/(z<^nCp8@ QEYVꊮ'yq6ު!b-Y(X_i3 p)a*JԞ'%@A'@O۬Oj@Ԝe§":+܍c<	UI7 IN)ZQG	R-U[۴rBML#BdIbfn!kZr2}Eh)b0>|$ɭ zՖ{ewiX<ݎlTdk;6LXlPɿuq%] !.tWw`rej9P_V(1̅+@y-A+:AS]lvg5huZ5$|@?+,:s39^C_sH,f<6XsUTX&rmTm8s\6c/b9йrlkûD׻v؆`r@xEʻ~Z0PeU#7'9{JhE
?e*QH)_"&/)ǟL*#g1q.yt]7_ӹ?yQ0p5m;9l}N??ӵ#C[ѪWcd߇b7gt0Ԏ%߱t0zjR({2
0?8E%+v0E[[)'fEXڞ
s~a?cڼ5?
sk!Tq7q[3hqj4H$)G\2+\s[ڕvb,aL,8xLC?8r9֊͍/I/Q!P+j?{ .9_3#;? eAx2_#y`McsI'h}bo00b& C<}++}7YC%d=8Z,]YaN}c	[+0M6M&XkC6aZLD G<'Q0יKN||?go۷_^YW_L3L)8GJ_57ỹq8H! *+Q9u9eeUf*>v 鯻Z*UȟUeL=k
CULsLQy9esO3!pУ.T./QV*pJ(dCO:^d_4,ߙ#2/~MGNqʩ)8t_dtqxpZZg$WjY 䭡[N҄K魼|od)𬱂 )<uXEM9ƋC|8#<kXϬ,vy=K a**S-Y(Hz9'9C҂+NZw^^f(_X"QdDjg9FK z˘~HkJ~  i.>jֿ*O(~Orz&oPƠYLk2ƠAj4"|{G|-XY@vΘYMFHf HhWXRِ(K)*H,1q(~14uD.I fo1):=C+QUXҢ~	Ab,D; v\0I0qTP+BӺB*5DPXE)w}4šx0:K{$t`!{TF8YE=dLEŒ$43lտv8ұ?uy8*b8XYa,Pj!d!!}BHad<*9|"^	}cҡd~?8[s
p`+f`J/m;+MIɡE͌.K}4>s
͔+X(l>[bF~2&Rl,(f>NTnɛSfL`NRrRG(`cV
W̢E49j1a zy0`0鋯c_ٹL9`>CW$LX< :GBC;gӟ2R"}1?9
[0o4AA^m2L:7VQCk#ߐHNXѹ#Qhcos/&J*d^k9BDA8i2%A`v	H%#_dK*$K!.閥[Ɉ{]b֭l0FުCt4y`cbgE!|@*/SM/WPD|KT
ich(*xjg/F:vB3o9`q8YH+92z8-g8cWV>n$-o]q>wK͈x3Tv h_1f/h
+7yg`-MIcJJ;@S&|XJS°R0"8hpbnrj<4(<,@WӅ%
*'!5=`W^`
{ʪẖ=ś$SsxD8X?]	dqSfCJIG 3V7+g+X[DZ*2Z'IqYN8ϖA8e#xY*זsG#w\/L}2J{_,Z]CWnDs|,o{&4O<NG͏bMIr#$>(g?P=D!(]   (jCe@pƧu[Ô{q)?/1FdRk2KJF9HV_!&;>FC"fv3x$Gxvf^?w_v^Y%ٕ7m> $&W;b˕-Pn~y0D;{Q7+ !.)4gYS?_5	mQjyáM֟?$茵#n!5s	׬,8GbpTۿ Xc^Jqu,>_|ĜmjlSzEQi"y} 7Q_xV2%)v<\Y.{BwMW c͛,*΂쿹Ykݰ8]覝3taaSDTإQD9.s7W>KљȃVmCcmG~>
(Ia]4\K-U-Ֆ\YJ~$:izH-9CÂ;sOoB7mvHF6i6y M`<G!dE-X/fc`~\xd7%I9:3"Yesʀ4[r3oܗpu2h,CIΧ$!@_l.Av[)D[CTa\1[xA5S	bk`ƃ}*E;.nx i5o9zdg3w{#iNdO\; NX4X4Crn$ơ-Ro#VаXEG>
Hy3]#h0o0@Zh@ł`[5Ed6-РRB/Y0+O+_aYja2,K6P6PTsDpSŧ1KM0ȮBt5rgaމW^@1zOUk~}uolІKT!MbMF-L؍UAfQlt8ё'csOXi0%||wAmmvIe>F΋䗠إ'䨬ܟj%7K%7ϖ*7-CF%wv.h׹O`#-b~wwW'7krUiĐ?H*5tyN||qsG$Q^&1aI?r~fjGg\G50a6N!v	z+$j#Ѿ	xgIR[S
DLyb;OK_AWV_huXvh`?6pbp|J4Z^;rkMTK*	[MGw]k𙧋SP1 篊5aMunMNAlg.BFPi,jJ_^1dV6J h<^ǄMSѩTezUuV>JqEK)FIscsA<J*a9t@)4اNB6Mh6?b6EdE0FZӎފ@ِ mS:G\iq(_MXـEez%kMs	$vWHK<>ʗ 9є-돠ٕgblZgJ| JQ,R9C|P_Ό/ >pyW
xq@V~u)@(+V}t=@њ]Oft;==`R\=rқ̓>h8<#=aKȸ}oE1ߏP+5G^3{oes\/**=7&t}4+FKT<3sVtQ$4">2g΍Xen4}qiP
{놊.>GQ_,ΦM9`!xl^N襺#.q1QX, ۢBll*w1goe.Fhٛ66A^Sd#	/۝zQ%Qfwiv:v<!	sd61W>Ќ>|Uj݁%*%T7PBBEppuu$볰mH?6#GޗIb~(D]M3zcxD;KY
"oB&1?tWߪz
(p#>x:6.=on A"K'?^!z/EP].`B$2*GX~HB_⦢e]3} aCѱBguG#>Z_Cî(o:>o`RDsMʢ5|>P@mhf2JK7H݈ҋ@Ҝ(שZb5ELSv,%Zu +fYg9`ĭ9$YF`@`BcGʡ
>D/l-]DcZ W`}|{z34,ܑ΢wQxcFS'Yġ\3×8ѶP:uK=eNsǑ)A7[&0mJKH$}Fd,DBNy/F/:lM˰q==ryN0̣u,=-Le 	kP)mNΩ%z:m 3-HρwL+(RY.aVңݜ<ӇLfOm&ok]4e{Er}L|",X2"A߉`t#BT	=L1*Z DjqD+z}(ƒ>Bۀ@ :/G-%8˟ԏq:$}ō g!V'.DPzISbP/9>@{ߟ_暫J62捥s{}c!^ǻa\?9=<Qq׉1HA'?)G<gnO`G]Ɍ빿jeQ	W b. CwE49lDQx",<XP<	&- }
D٩RӭsMg0	AB:xx$H2;q_#ԱLsnZ=lL%qUUubN	;IK:~諠
*
*
*
*
*?   