#!/bin/bash

declare -r m2c_version="0.2.20"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]
        then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$(m2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(m2c_msg "$message $(m2c_info_bold "$opts")") " res
        m2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_msg "OS compatibility check.................................................  "
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_msg "Docker installation check..............................................  "
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_msg "Docker-compose installation check......................................  "
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_msg "Ports 80 and 443 availability check....................................  "
    m2c_loading

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 80 is already used by some other service." >"$m2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 443 is already used by some other service." >"$m2c_log"
            test=1
        fi
    fi
    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_msg "Locating archive.......................................................  "
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_msg "Extracting data........................................................  "
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$m2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
      ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c
      if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]
      then
          mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
      else
          rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
      fi
    fi
    m2c_result ${test}

    case ${m2c_os} in
        darwin)
            if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$m2c_global_dir"/mutagen/
                chmod 0755 "$m2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_msg "Generating private key for CA certificate..............................  "
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Signing CA certificate.................................................  "
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Password is required to trust CA certificate...........................  "
        m2c_loading
        m2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
        do
            exit 1
        done
        tput civis
        m2c_erase_prev_lines 1

        m2c_msg "Trusting root CA certificate ..........................................  "
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-certificates
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust && sudo update-ca-trust enable
                    test=$?
                else
                    echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log
touch "$m2c_log"

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c
    m2c_sign "m2c.test"
    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"
    m2c_msg "Mage2click toolset is successfully installed! \n\nRun \`m2c --help\` command for usage information. \nVisit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log
    m2c_load_project_env

    case "$1" in
        global)
            shift
            m2c_log="$m2c_global_dir"/log
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up)
                    m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|down|info|remove|restart|start|status|stop|update)
                    m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] ]w㶲(x+ٶMJݭNw'>'ǡ%nITHnӽ0wܵܵa|yYk~%SU Hado3iKBP*=vO^Z>6xh5;Nvڬ8zXE,NPy鿟y/ڑ~N?Gh7mmԝ'ceSٺxo`ouPnqwPt'A8?,fifq????So-ywP	-Ul2dS8x7FOWУl77w[.C){y'D~$ V| ^?x?@7&{'yM]Y0l^9=fFνI$dYOȏ#M.X8ى$Ib?:G%ALyX0>;Gy!'  xC^r^ۑl}	~?~'\ŷ~צĂ!d4<@0śט9|
9Co&T0N8:0;c1}Csa	e9n7_NX4[NNg{QlD`VNdZy3[[{g9ޭ11&qgn)v$}L|f3Z{7W([k{GIp<tdfLIK11бQR9(8pW~.<9:i9Oi܏;y>Vtm-8_G`ÓQxa^1iNCfrPo4:xSn	h;n8eop6I?%˃g>#$Y;ֆ1D̋&A|zٶYinUSs#/NA{@+ӶPmwoo6K[1>llHj@V%0.);򎎂d5A5llƲA]BCUYqN/fUj$fQ+aF"AYe]YSw4̭e潬԰,U8SJs%k͞ԆYm2&>ouQ4s./e 's)$y:MhWHuN,!C1fMFZApFC]ȟ}|{+6
-7MHbm*%s8l(0=}g{;w|sfųW?u5Ϋ_?;͛Z5Rޫ|~w_#'sJi{˂[3>X[6gƾ-jCmJl'}1J|𢓘	`&6z*h%Ǐh~'a~Ec;Ʈw_osR5s0eX)SbuQg̙7
`0g_w4Fo2b'Wx)ͯz/ֿԭ;%XΕՁ]}F8("?E&XXG|ɡEE~o@~48N 4ר\$6J ]Ef~h(,E:-4LC 8TMht8UkS8ATzMF88|W՘@tm Oc5b1|ݸ#j[@R<{fwg[-#P!Ʌ [$xN5~`
GON4̡Ś[;<X"pP"ɨՋݗ/_<:JT.+
Bʢ׿2w#h?Mv"yJe5rj43$HL4`M\fs&SwW\DQf['E,M6,u0dArhdO,xf|);W*X]$IE˺69Uk~dPZE"ȫULXC*`%/`r̄eo,yKf`Խ]k7c4w
򂳾z1b;0l_		uFG2 /ap}(ݗ_7
{Miv~Ȟ?{Ϟ/g(/L%4YDx񧲖mƏA6  G_J(H%eѲaV!AjsaIxfW2_jm7M&Ĭ`qoz\8 mz:0s5 ֚!c)swƼC/:iPY	
ypF#\<'CCFԄ|E(rb7F'":Ab܏|68&'ЮfD#/6A~^Vg۲NPek9bZZ@qG	}ݩe根1DW*0F"h^3ܗQ- |Y^u'45sItv)ׯ;Ȗ]ãuwie=Ռ?*̚_oӫ(27OlL@x;#|#g?FґߔSãp4Dv@H];F,"Mo8`J,k}+)a3;%?їI0Aኘ-Q7!X{X } J$l82k`o^Ay{Kgqow_>{}?ow_|Y7J!k0C̗g0YH^d%|[$)D,dy٢pd:t6x+?`ZLNI_cV[7HZ<'Xlr
tb#tU*!-P&r6πq"8aň7?KyM$ Sv#D3s:Eւ,(T^ragj4Af]_`/^|_ūkghL?ULR5%ҁ^"Ea
* ]E;5yp$<E?[#^tNW Y-e~E'3ڀy?lo6ghrt[b;߀)MYX*59&4ƻ-rR㼕R\Fpļ ^S`x*PE[
0[ެwjQZji<Mgx@p72Fxk+<ARŒK!&	cT8};NԖ#A@/v]kה˞募;͛l2jbq%X) 0ON	1V^Pf0Mpk7NsOQfצ'JIBuur? ()تE
b|kZ6	G:'2aG%<}I8-D8\c1'eFݥ$~\woa\2
`^dbiZ-@k[
%_c:qWtf%>[(l 	j(kc`a]"ߍU6Ҵf7_	Hcj+BZqt+*`Hh`*jzL
s>BYͥuZRSq-xIoOSwP.3v4TtVMss@MU2K_a
vΤB1&,^^+Nie#4,KscK(E8m`Ya姃/ƣ
xSUq[?@
b
uO\kVqft5xklfК6.YZYG gop>5zy]zkp:]w2Y=,
5e&}~PRForEp6Oow!o?G1Sru;-ggqEԃ_Ɓ1oWڢUo8p:%v*_Xi3fF*eV䰬f&ewǏӫ+_^_]$O0$%ĵ\tfV{'͕(;jo[Mm=eKǯŖtz썸fYAIZ_pJZ]RLOo8Bf5dqٷ+G~:lcۢm^9fm&2.,ev[$QXip,. UFJL;iynQ"/'urV:)Op}"q~5![E0s5lecyѻp8˵HPU4D)2IS1lteʩVN>rhw+(\Κ
2U©;Q񥾜tVv+
YEHėsfw?Pm|ĩϷē	+~;Otv4iΟ$(@k8QlA}ZcNiN"v4UA_QI@ŷq8dNVZb+=@vnN|Osg-c$s?cgWlQ8561|PEդr;1ci5fz9&GAl;Cpcϟ٧" 	 6{Y<&^R <k.U"m=~bS?=ULMbo6s<nvf*}0yٲXz'x"VX#4Lv|z>t`d)iܐ]<5>\>RgRi)&73[o)5̼QAAd<5߫-4-tII4ө"=cfq/s{ f@hW )2mt^kibYCTA990l;2i;AR%QhD?[l}YOQFx,<aoEQ7.iӺO%̍;
rv-3)Ђ"Tܣ,pK[L)}5- [ЎxXbqD6M6Rbu8	eVْ͌^̠T塙 "jtvJҙE̺12,)Tw֎yM_3 i4[S+(DE*>,ܤEySt@{#hD7"nv0=Sl5?ۂ6Z"HQ0-s'eAլF ӂt[Eƕ2+``gW3/˯N諍<药N\^UqqsEB&xI%LCkV.1!fL@áFcb2rSdKr	לhB~d>Q=
`#C*͐WQ>d42JUl3o8T8S:&P7+<pnJgM(r8,g!S婕 9g	;	)D<Pj!82A
'MGa?<RSK_EbKyKA)蝰d.
Q
YAN@l,yyF% E"QdZ"\UCb;zSYIiYyJIftwQy $ԑ N1|T+GD$
^B  $>g*gYlbj -͍YVPBDKQt|T<RH¾Jt5҃pD fdnn7\+i;B!H*5C6E/B4J<:B-'ҼW 

@:;J.&#>ژT{=ˆ8OkHy?
"
J9PH+%F<>ҏ09_lԮk^ށ*4;Q7#878GG4?QY
:t@e(cᑆ_.&8^(L"FkNwMŕ	H!E\!n@h;+-	zώlϖlOq.oXpЁҖ_ZKS~i//f=Z"+u*d4AKD.KD.붬EV"Ud)|c797'F37ұ _{n~kߚF-f)AM)<7mp 8i,K=R7g$KG ߊ%ԋ1H˒+I/KWJaDK4%R%VFCsՒ(SAحY4!FW^ar|vZi>;pώ,͖IFZ%o wexXm_W>>\f@nG/v%J_A0G`7Xdkz49Oen*9OC* rݳN%*dʰp& 1*	w-+GK?'h?yh\DOnOlQeqPԦϿAO哲H&90hȶ܍[izuQ`j2`1PN Ӹ7DXb^E5H$>5siHX0(aOqX{`>HYzfj0;e/{{~K+̒BʍW;lKϯʶ/Qwʺ2W\~_qs{'"{/=H!&IYW]E)eO:29~]=3SxLT
/Z|k%)c	yyP->X#r&졹.s9=cSB[	+0D&,H^R?=cSN9_ksd׃݄=˒kJa)cRۘ_yHV1.IS=Ց{T{
HPZ:(61᪥s!Sn;}a%U^y.^^n"ʲ=Stډ෿̵nܹSy&?OW/orl=~e+ן̃j ڲa2bGhw츼LCA\rMO@Wqm׍%X4i&.M?	ahBoZE
b
rpWc8$~3,tpM7ڎau, {I Oe}p]2=HXs?\W6 =a{}`{nusv5p4tC{ů;C+e]F8i91xS-Sl?M|WcoI7EYJm87+\-#@2͢+}siS
>	"hN"W ,s
3y۝^rP+k)flZx#CtLJVW܁z-+:G=B͕-}cPgͻRmfͳP6d~^Q4YT͚COq4/,FR@j0jAԊX>yWBٜGafoYjhܯg1ZTty[sIim|A
ӄtΥb:i	'uy:Wt{qpW՞ӷ4}U쥢Kf	͵aKur|GC;TS)z!-7
:hueJ8U#~q-"s	!%9^/KCOlQcԼ+T-fqHRId* KafC1rv,". ר0mƭtsV6f{'~"C5W,72}DyVR%X0$گ_jTJZ/WlJJG\-_159K3[;+-)PDDS#ߛ̦ƀ;av`wzfhgeE(-f4KXިI9<P`Q!B݂+ɲZG5=)(iC*AKz+s:x62odhQSᑅã8G+c?=?|fgWe0~JKL8>az\:~$o0dcGA'f˷{oF3Fݢ>[-|?W,G^1.@e^xD03ypR%h}燽g/w~4HK8Q}_^,hgEy$>̮.)^d&7k TY],bzu'8,˻p>dD/"Mƈũ?KUWgw #xܭPg8e> dF<@:1ҬjZ4әA5ȟB#5hR,-@Qג73uQxUf.Իb΋pLHс1(pt$8OX8zPeF6ͧQx'903Q<YbDt~mRX{$x̦5\wj2eVIJs|_F:PZzMyx֐7 W}1Zo|QĶŭVk򭓻Voג^~FLf1Etki+De[/Њ*NyK63UCsy,jЦ&W_UL
88Mz*W݆k25ey*E:J`>` FA׺>)~$l{xmB;rsyx7cM	:0E@)̑s"K+x_x"rU% xSQG
XweӸ)RoUzīIiu$8AQlc6-)[[u.+=jM%ӂxArwzln=`N}ZȓuVbfpvr י\oxesJgvT;m8r*$|cKIh722q&]7nOe0K5`NǂxLԐ)npRzUiCՐg2>]x]PE`F%Ѹˇڔ6%ES<>Ze̓[x;LVn^KfGum
KA)O}Ue-ࡢs/k2e"I%]Y-ujǂj󛣌w0s:EѶU#Yat{PZi!q@N8V=yM%_둯,d7OJ7gX|kkˠԜ}ol7@O[P	VqWy|
=-ZMք渼8d,X\;0gdM΂!1anlBZ#vUSKxRxѼ^|[TIvM:ga~vy;i9ɦt|SѮIHwpp\fc;!{KڦcP&`N,Lz}7/a#ߋ?8r g~&"?USN vDh{7L>\|c1uMw!EU-:ͤ]!N>G(̵On= B_}fI{_rc%AU("-{ܱ'z_ra֠xZ.eןjKZ\&,I+Sudq ;_?>i}Q0b8bvI~NmH-"|awr=u+jR
6a6#*l)cB>-WB	&qI5Ub⢟=^-Ca0$r),zŮNq\ViD!iCKXt3_MKRk^-ksHoYLX.}(T\fdr3= kt!Q"
e 1s|EЊƏ8eڀ۰x+]ezVÝȮ0_zb`l ^HtWJ<$m䷧UKbSQ~(/P[o]"V$NNԆٕChv_&"|^Z\!ȩTqksPAw}3{=jVU-V6^قlzIr)܀U呯JP]Q/y]..EW]jpRyZ"i˳!KF
/y5V-8*
<Ґ
0WadjS)$AV91#Cqd>' >#-&rʳ2pIoGOi9Z(>~^ (V,r, Cb56T/#tgS6}A~
n[S(ej{,o)452DvʢhV_k[(E~}%3|cyݔ߳),6wC\!RYV㑬~/LwKu˙n~k5*gӋ\.6k1MBzUg"KӶ,85eD[+r^b.<i-jN%,W1뽴2E]n}M9g(W |
A#]"^zLvVx޹Qȵuj]l[ֻwݰZzۥ(\eZ7i1ѲeCiTᬁLR. (->:P<(|F%N(Wl'G\TRNX1n[a2e0GnָZ	n|yQwtύj|cyWucDU,ڡV8>me=ؠ$@`[뛂qnQ6QAgjv_+[D6Vy?{J#F;('@rr.lZLW3ȝ5(9d{BgNo=s᭳2{2ٛ#ly,3n ]E0.?~. ]V%Dp6iHhcǏӫ+_^.WW	&2}6,]]m0c;ײ"#ɜW".񿕪6@ڣE/wo)28+j/	fYQ j?He3zca:jm( R61YʝFӱgpS({Rayznq7!ݤ2{ve8gH%(j0I:?akfsk* AQVpL3 nUCW<.L3Ƀ+Ol½%ZYM9gy,a;=؟m)|GaPiQd끹L |PʒE2`O@ 	+EfS<'٤X2-omkebI-~]WOoGo?oΛ%0eIPNg\e;eLOas%ИyGRdӣXfy/ 0h19aK&!hX5T&!pM ( s(LvNɉ~)J"g	OǐbT%Ty+~sˆ=!&Hec:+$|*LyC<=I,kKS[mp.h0.'f웒˜aY	/jANV6crKd Xm[R/ZZ/?QR?OUڧGjlJIt\%%^{0n%0፪\0 {y_č.x.uJ]ϳԏ6\?dϪ#vagpEVx6A#s
(hONRG뛛Y*jr\lwqk޼5`aqB1mc}S-Q7'QbU
Cjw.PIJɜ>sϏ?>I,t-bp:<Ws}Rz'rG^r&d梽5a$H#g.+,lf)17;G`Ƿ+uWCY1#\eʵY+YP7Unl)hr^f;Ӟ0QDtm08]!փ*X (Ky A0C5HY&h
$W"Vt]p"o.
IMA(J?A|趴ç{v޼_&us4z0H&D{qe{~unħ/(I0')9\/&CdLDw,SI0W΂X!.YŖ/|a\+YRqmx-=B2wG^(ĔpWvtflP놸)^/Ѿu`qah+_7cEրU L2ۜC8K6|b9˲,Y:84">\8'|y?qW2ֵoi+DUҬϫ^ ӯk%|t"Ejbِ\ qeY~Eqϊ$M
qM9'%y.a-{N60ק
=#|.CBlèboBB-S;oAY.XQMYLq#Q$B4/	Jg
|Ju}59O	weOQ֚b?Vm]hQʃ,]j)/sSs|1]+֜XD42F)"o!$NaFTJ{>>ħמxG2qe-bnw*
Y_+RN+{}pf>0*n;O!~ow|d% ID-3Kl7N3z|lKETszJ˞׆MFCXcvuH/4|]<ͱWW)-1\(G\V\1yt<^ш k_%+~Pn.(ef/?7S !k!X*4(#S_y(\M~!|j݀ɵΔ8sR)(= >$)e}U8 ޏfGyx5[j\jś~M`jYX^IRK<m̢L6Yl-HtP))+d.TAK{psV\rKtUD^DA5A>˴ra&:ŵF8M`l!ކreƺs1񩧰DcB|f?қ]_}JFnƵAP(Q˗NAal+V /{k9pb9iU9a(v(- p([+ABܶ1٭+uY{D#7C)+odaQE/O}W.Sw0|9׼ȻQ˗5WFVj9Ǵ&%\FRH20fӓΙ>ɾ-s,C49/X3H7\a8k\S:]fȃc[j)VrO-8l{ʤ+>"..^YBD7Tq>5?Dd42jc謠s c+mQ:='RCS8 ́(ESyikh9 R
i3zkBwK"g(8.=M&0mzN`z?stŢ7S=m샭
͇3/|`~O!~?=ȮT|߱?"҃	"eD[4
lB0rWx\CY!;bV;	h /NhNH8rJcoq8ٕ$o1XBg3"yEuq^{CЛ4,N"qz~8KN؏K
G7f
N`z^88OJGbM./E%{卒Cv$>6!4E+5>5@Nl%cl<}o!ϭ={ɳk/<Z%RGU*jB@'Hv&D!\ F4Rģ8bBKnThdC%xE˜v~&seUgUF:
ۧ3Ů>Xgxo«H+wZs &h4f4Z$bN,6;)ing}~%*XpՠI J-E-˛?LZ2a.g[e Xz>-,Z*_d&^ϙjmᜰAڛ+aSAs6*a.&W/R{˃(#o'NGV쒼_SS/M	y	ZN)EV=e9d#F=uζqfg^(1D1l a1XU-'h\|r>vК91>5T؄Lz3H-Xq~.°X\QZ]Zw.G5򡘇q4kiSDmȲ7#<`ozߜؗ.h ~vtQ};>R0@Dzbu0ʖ7+xmu<\-lSv;|Qh_W?pEp%ϭ#@lkmsWKrdxޓVW`[9bi;"}Tc:o[V-JjRrcx_z5 ͫEPxl!Hp0f"ww!(faZ}059n7]a(@`0.iWwy7ȪQrC}qn}<~
?sA]%407fDCtDnF|;L/B+$;$QL!iN_\R#?9}Wq"g=ʌBbEy >b%HݎDVxw2oTbX/>7*) "'A$~U#7k_Q䇯(Yg՝<(O*R	T'z+WGJܖ91Zβ*sN~a	oѦ҆vt?ү}6jA8rN`\ kx>ڀQz=8En	5\c>g9>|[I&>W$p;5تKH:7V<Nbme'rPV4)!,y"!d:Kxy:VZ=hC;);9ՃکSN6DQ1>hVrzVpaecEc6#q#UVTyl<lQD@DC[tj11`M{LXXZ^C߽ձ iaiJ)=?4:zbu?ÜF٩w܎벺Ӭ7;ZJPy鿟y/ڑ~NgXnh9Ѻx?A+&F~S[n6~ky-h`=>s^{ArcwoOq;u,N]<Ƥ#KV0{byh{V茂i2LAEL:"3#EV=)Dp%phzm1f+zjO ljsbj\ _7H`ohlڤW֛No4{Sxd,fCS8US`*?1Sajbg%Llk(I>磦yMI v(~\JxG^8Znb٫{4Sr5yxi;_U.o9kvZv.bݪɛrEK+CŅ+]-χCz(rx&ev	}Q1K#DcT Y7G|37_6g)iyx{+ȦE{o'-hv4ku{vw,;X*+
пE{zoe_~,v:W&<ǇЌt$ү t|Pƭ8`x}%_qqҥvN{h얹TRGPj6KZF/Wcw:6N_VtIyP,cZ>E><{fwg[Vjbbژ"LR@9sCJ
}]^h_;~ֱH7dvpZ{PnmM~2OrҿC1<ͿDL~3y/P'c/s?#2kzAfyjg?0i{{^aifųyY_yŏzN,~+-ybj~՛b/WozW{$!KՓJ3Z15+Ivz4Un?=z[l?`k:>K7/Wk|#Fcgk;νgjVnI?W@Yj-aΌe؛gʃ@!<e`"E%U|QL,-QZ᜺^*
]+̿*NYP.fngug_Y//xxu<+0, 5$5m]WdF}?4jUQęn`_g;(|_&"R喗%5/$̫Dt7*LpÝW//x	-,Hzp	SGu;h>eNLt/._FH!J;>SV)NRY4)kYkxcī1Y'-x}YvoY0!֤^:DrN^xkMm9J 9h_[7?YhQ778wtJl$Ci<`b]تb{p\Y(Gdi9f+iV^sbvnڝlU]wGJ׈C0dByGGA2*`Nq4]<s} Բn5ȊgX߲6co99׶V.ca|P|{:k?խVԗ;4iiޟ'O
=\"a"ЮS7ۮs/k+2X2=<	}&e#i )ag[]NH)cz$jԌ})/EHJeS^]c2YߨfN;yΛ_?cOQ~şT0Oh\='|ÛonEJd?ɮoz\)JA YU!{~<&E?Y1T~<SaH/D8e=]'a8v {4OA]7?Q8d8(^(c f{`t$T촧mGA8
-qvr/ucl-6txczP'IɿXFf9nhnNNxӅY4ڬL	$o`ۭ
;aIͅ7r7F-چܫ7h<ptq*8_ P'$ f\@TV ^pt2VPf^.:]]7+htV*?M~El3r	R ~c8H4@2ڽvۼ1~lu.'BNiA^*;Ӭܻ{>?h\MRu 4᜺]BCU2EN=/!l^xSb0JLqS1򧾗P4';$/9!9>XBX7KLNȤ΅kI*y[t?,:3߈ިj,j4r%IAAê`L9L}k2r7[F~ S84f !E*3lJ)d	''t5
|&8Эх90	&/QȊa0<N-Gdq%35$ޅgI"oT.5
`Rf	&`[G0}+>b,O
.Bk
=h~3%N<`嘉y!8GcU&5>x)|36хbKۓ8p*4+R73)dzca?5F_}ña]X-,pݪD۽60l[v׀,jju!6nVCͤf SpbUNY>t-6.{4]i܀;Pg]E'sqj=7TfSKzqt[n=tfjv;ZN3q\`mu&$vihɎ[ {h 
عY]ש;zL^nntݮN(iۭ[m=CТ`vI;mQ9NOOn&fն۹n:6f{lTw_B\:`!x8vM ٽ*mk@ z=ц@_4;:nGtaw:PӦ4m^9,]Ht;VCiA-Azc{];j٭nij.d clAk6t5;D8߫c?:m@u@老%"waDYrY#p[l@r[09QvA6|4z-Q۝.7_4:-5+Pj׻MH  k6pa)	nF	0+\x<]܆6;q]`+d-@Dp(	ۭFԀMgWHpr ViGبdhEDiL쨦4&;Zf諶 Kp{66m.t07g8n8	 O͠>uA{ۥ! Ѐ`(a긝NIi1z$PKKh4Z5 bAC;D ۤ1 yq:2+`lw\&R	k#@z :^ϡ1k4US?'z.%3t^h`?'PQ7ʔ^ y	tAn!(:.ގ6p&2	V	 $JSY,PQ)A@~ #0	(2=IvÆFw{ [v=WRD`Ĝꒆ/eɪrT^,dBu\oFxiAF]l@M@!YCkA_?D~7-o U綀К`UnDfc[Ӂ]0-v@tHSBM!`쨩Mp]ߴۍzJath=P. v du1,n
ZT#!evP$H'/iC\0V(R{@VhHJ.PS.Xn ͡pvFCMiwmTaQ1`uЎ1\֠"=$Qyц^F`$$2*˺K		"g	"@7=-3J:6¸Մ=6Hi=h#W>;	l[Pp8?UVISABZ:umj=lmĆ =nPe`;Q)ub\hB*j09]nׁd r\[r(S#x0Yk	ȅ*<0P5ӁN꫷,un0jBuTA8.XX4\g<pRG9!li0s&d5HIza]MȌ`#ׅY^v:uF"X} O[4]@fdt!j7I){V0q	Πai]Gccb(<vS3{C<a&ʥ#:Nv`4 -i`1d	`r;M0q.AC@Ti Q,Csȃ_
6N~Oc,uK4ܕNYG	1CTMbz] lDYmDi2LY$%Fn,T09 a3rhgq4AO`@мjC|B֦ZfpeU(E`#EE|n4g4Cvi2U 49Pc&gGќ!TjI(`= 8:vi
$Y$ m &ރ>,	*ΰH+crt(>=4هx!C)*p܁mA$2ѧ*OMDЁM/} ]ˊql8Dj1 gTu<r53"-X)LRaS'0.:.By}Jf 9҄vik$kb~F;"~0-i6zImMa}A)Ul"ME!)0]=30KUrfC `jFUau*LӒSat3X @DmMaI:r`\AM!@Zz^ TCM8];t4AҀf763]|Natzf`7`_$+HRXS]=wUғ[q>M̓QGCÂ.mmSnUGӷM) F17^'c5u|`C҅~8> AǏ25<e^ 8&ߌfS,t2U^ؙ71_:X"eдb7GEXeIV!N$
D\|,Kb-(p8P!⺍HETJۃ/d H.d_o@x>%G]I8T~\ishI	+k/NX6K5oA<H a
$j7pc$r堎Muŧ$ㄲEc)qnyT5=yk_[:nǫg`h	,iJIm`s,-\m-vxBM63(ܝ;,A6޸7x/?e\GFU31paT͇R;)v7ҶIVXM,<Q7rEO֕'m|\  ʾ(+تX]2/.[<0DlE<J&'o۴F0 y-QjOÓ /  Ss	m'5 bj2MƩ<	UI7 +0S/:ȏ 'W#8JTu*_)_9_q)\d&tqR#*"5He0pk؊*n@޴_}Z_@JX>;hNDuesleiY1v}O$D,!Un 졦 ֶM76$1$"$H}&w\а]ρBa.\bmQ]^Zb ݶC8v@ϮԪ!YaЙßyxCfD0QSQb4Ǜȵfbw۬ql;l_* sl5sO909F)@Aւw-	w-؆`r@xEʻ~Z0PeX=Knv6{f
0iL%
<K$%:E>ӱCYL\%>cK7]&:tCL0ħc~7ZN㿢GIy.??ӵ#C[R]ۭWCP13:jyiS:UzzQ-=GpD"B];Sp*OyTIMmyg]¿9D0aam^d5*R-Yhu5u$BZd..9g
ӭQKڕvb,aL,8xLC?8r9֊͍/I/Q%P+j?{ .9_3#;? eAx2D8?F>{ujN" z޽bìϏÈ, *黡/!zPeݐK971N݄,nC=^po6j
Dt	r?py( ?>/~vNn{U*/՜iFU)cgH"Q<s4JrSSVfQe1H;@aIRkX:\fs1Te?4Ĺ%?\Zƌ<9b g=BiR9hg9B?dHAAEJs:9rp.p봱Ǡ뛂áJR+./NXK_J=B6߯6yg6V4Rz+/z#"ch"<k  i
Ϭc*ТBM9ƋC|8#޼:>XaܳboֻJUe
AA3Ia2b<aUޑ@TZI+.؋TXK1zH77g(z	@oiY C@30- U|wżݧq5S+el⏧@hl#rD\D?+I1h~=rZ1hZ"Mz5_t<V3fdY~+`((fU!T69R}lJ+8iMQKu"ٛ>{BbOrT7iQ?{} {hl
e;Xh.pYC8D*tXFBbi]I!p"Hcd>WI uA%L|=}E|0ِ=TCM#S"h2bIvS]vzQj؟Ǻmb1
@^]I*Ya,Pj!d!1}BHad<_eI}U-rD:,zSgEN	lYΕ*I8K<V;)NQVh6%&^y,43`c/)07SG*"dP2(}?1,z;JuYϳ hy2;QO(&owN{2̻I:yHUӫ}K^ EU*)\1䠫4<d`E䒂WM  /eпԳs	Ùrt}Ix6Hu;}'v=ɦ?e88LDb~r`'hă]&S/>e</(tn*W!G!ё	'.sG$g^L<UrBqjeJ3JF(6ɖ UZǍIB]-K;·Ĭ['7m`ޙUvhN5)7Tǲ
l^N/W}ϙSШQ3ufPϊ7^2+)t f6Cstp쳐VsdpV[QqƮc|HZGL`3HR/b~/PW$*1ͪ9>\jR~PI@_??{KT<4?ZJUr5	8&a k s' f|Q4J &_aW7Gz2]7fkd#"i-tPgU-M<v8?\#7gKNҲUJrh,Ykˍ=fK,5Ib(+xs1YEg6n|>=5O D@(b2`Sd =`ʬiy>0D{rV4}׆g팓G8x荇xiO~j_@C1+1\If!&V+,XUx,5Rm@r43b|4f-0jkC滾IqVвb橛=&7Xr&Z̰:i	[UoV>&ÉP`L]*7q( a3Q1cՆʀORS&F-7	PɤVeDpߤUpǠ&O=лYݪ:/hώ*Wl'J7hۤ[fŵ|Dx\cG,c]
ͯba4D[jp{^'wqerUnX<|njNcV{G_#Ue)n!sV4 I.c@7H5zU:t2rdC4}P8M|/ l#73<o8i!E+|0+i|<8GbpT8X(#0aG}nF-[7&Ž(;6BBz0MDK2)QX9fYxa}Xb:[4
 o3VڝE>6ۮV\5l^QF<YAiNQ{^-JvFoMW`JUY!xC<`> &J:$9EyV$7;޶mWA5GaHEM4ÊpUqڒ+KI%ѯ.M7!x#<W_Xu8o4K-Ǒo6,I9"c.1AG1j1²aC(/ڞ9Px͞9Fot'@]%>! 
^7#K 
y}A3ݛ7hZܾ/DUKl$v^q̽ps#(K6:֑'tϘئ<X%k4\MCyӽ ̺!F@v,AHOl٨YЉMdґs:ohmo44-tqww 7k[4TV{Ć@e#fp8e~u3qhFJ574}kLe{ϗ6\}PUgdIT}r-z$CHx4 5tCe3mcTBMo3i{


82B[uVnh<ih0$\*7cDR=xS"-t^ նaRAKxc"uaĠwTM)aJunN8V)F
o7nXH&uGOO-M8u$&4wzs9?0i6QD]L˥C<,J111|b;8ǝ<	C$,7K9z	2<KzzcEBs[fi0uQ'$UVl$tULRsƲx9Ck,֛,^74kOFOGZo0?>E0@ҕtX}? ]}%6"	R<mO6ĳtfT4`ˮj@;|n{{og?,^<c /%Hex|_y~͠m^qb3P	|ɼ%fKB'r\Λe4p8d ȜfijWt{k˛f~*Rx5*}A:MMB׆ivvhxD/aiÏdIj^/bSz9<7Tج\вol"`)$X}Dm}RTo-#FP'GX4[]I(w-yCB'ގ[Q)B"^AMmȼ^W_G2y}m,kFqp51qno\B+=>qW}oDw.ETq!cSwwۥ{-C@u̓cNw߱Ce>w|өw;$=0(V d?	ro~#0d`"Yɣ\3wN!aqq^CbuG#[K?zGǞoK+::o
撔C:|>P 9~B'@*09(w%u(	q(t'N. ,np_Y8Sh1Z@Qq/=wPI6M .}O
d)G[b-#םȒ[1Lb`3?^4Q+>;t9mF۰M߆Ϫq2+284,(y#P͍{| LԎqB;/Mc6}<M`.PO!L!q4 YeNe/>t×vA	ئTRd8/Eṛun2\Ԏl2 1ۢR:
Sٝ)JdÆo:4N =44hOΥR1Z=SFG>e;9lɋ{X{wzq&Td(۩stw); 4M!*ԕ"Q=S0QOׇXGh<M4`ȡc^/8<9 S&d/dwoaz#kaH<KW89^v,ۇ uF8f,15Ӈ!@{ߞ]jN|1ol9~c5koz!WţM1[<6*Gi(cdSO\qQnH:.XJ+ztMnr ~]$\AC
h}@H_f\xx@vauxz[a0N%u%
OԹ$d1I|eӣ7~w_^=Աl,K{]JRڴ^cW._^KL̼Ñ y 3W~g,X`,X`,X`,'EM  