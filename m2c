#!/bin/bash

declare -r m2c_version="0.2.13"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]
        then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$(m2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(m2c_msg "$message $(m2c_info_bold "$opts")") " res
        m2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_msg "OS compatibility check.................................................  "
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_msg "Docker installation check..............................................  "
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_msg "Docker-compose installation check......................................  "
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_msg "Ports 80 and 443 availability check....................................  "
    m2c_loading

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 80 is already used by some other service." >"$m2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 443 is already used by some other service." >"$m2c_log"
            test=1
        fi
    fi
    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_msg "Locating archive.......................................................  "
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_msg "Extracting data........................................................  "
    m2c_loading 2
    tail -n+${archive} "${0}" | tar xpJ -C ~ && >"$m2c_log" 2>&1
    test=$?
    ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c
    ln -sf "$m2c_global_dir"/completions/bash/m2c /usr/local/etc/bash_completion.d/m2c
    if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]
    then
        mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
    else
        rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
    fi
    m2c_result ${test}

    case ${m2c_os} in
        darwin)
            if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$m2c_global_dir"/mutagen/
                chmod 0755 "$m2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        m2c_msg "Generating private key for CA certificate..............................  "
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:m2c -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Signing CA certificate.................................................  "
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:m2c -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Password is required to trust CA certificate...........................  "
        m2c_loading
        m2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
        do
            exit 1
        done
        tput civis
        m2c_erase_prev_lines 1

        m2c_msg "Trusting root CA certificate ..........................................  "
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >"$m2c_log" 2>&1 && \
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-certificates
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust && sudo update-ca-trust enable
                    test=$?
                else
                    echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c
    m2c_sign "m2c.test"
    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"
    m2c_msg "Mage2click toolset is successfully installed! \n\nRun \`m2c --help\` command for usage information. \nVisit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log
    m2c_load_project_env

    case "$1" in
        global)
            shift
            m2c_log="$m2c_global_dir"/log
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up)
                    m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|down|info|remove|restart|start|status|stop|update)
                    m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
t#] m2c.tar ]w㶲(+ŉtowI|Nmiqh[it<̝3w;wy5`f֚_T  AJI%@P(T
@8>h46l8-)f7-۶n4/zQ솀smi>v|\^#<?$,vi6:lw1Q0|mǱ[vjxo`sߠﴺw1a0чeBhc<翁ߴN!P-%t$vc<IU?٢;QnZedNv;fScp|ʇޱCY 7HwygMO6fۢo_|Z`ZUE6VNs{.9ӍӘ	6`qB3b̝^ >µٱ?/	E^x;	O0p3<v䍃}xMLAă16j5x3n豩;$59-/ـl,}3>=ZVnF@(SxJD" Ypwv_2w4\#,(c;jPtD4;؋hν#& ꔭn;]ޤMO+&[cou1ȍN7ùbx2q9i0%?`^bsZ\E8lt*,`B&e+^{7"oc؝c p#^N<"P`H^@>|rt. 訬}ꎻGjoE.`s7?X,5_P#?1 |LPe{	͟߃n۲Z5d}]A8^|Fcty*BdBE|2@@)SlƖ?<&bGaST,S,Bzoݱ;J^/h	(<c @^Ȃ]Pǩ0­aZ0Fz.rf`(nJǿnwYonvx>V@Ϭ+[px2!+H:ij4=y6~4Z1X#09hXt#6b| fЦ!: 6&Bcfkk#oH-dؙN`Ҷ
,RnsáVcLmm_Qa(^ JM M 9m^C`8 &=:/j&a$̚I I b.veka^|6_6=Ha*뛳hz32w1+9&˛Uwٗ_bn-c}6`VRǲT(H(j8ʔ[{Tyg|<fΣ/mcaM=ތ뢄if2\^dA+N=:It9/A_<99哲`0yXmX72|
sTk/ք%;	gwnGicд4!󭣷䧕Qvdjowxf2j5=&{`"=n݁)%5j%2 /.t;7<˟F3G"'n<Ǭ|=B!ݗ|vwuUqgo2*)ai^&v@#0(OLAi7Woȓ+kOml[گ۵iopP{S}߸߱Lկ=W7FxNYs+olɏFC7݋LR߀6?r7(%6J ]Ef^h(R%A:-NM&A 8TM`tN^T5&ݿt:&عEX_7~v`OnVc˾l&dAT\fc|!$Z4f@6Fޠ`厃:GMOi4̡źS;<X"p'8C$-IųϷ=:JT#.+
$ʢ׿6w#h/Mv!y
{SFn@0>ϐAd^ek7Ib;Hp^7\quSlh>Ce} FegIm SH1	BR >+ZM{̮/X &(A^ԫbd7z{{bVDo.~ST&-8'g["L;"1Qjt!BqތИT	3#<BXL0Sb=xy]>E ^8YToE@{xwpBl=a'( ͢ͅ?low_=s	/r退)c?<ܖEYy% $Vfl|)4@͙;c ֽ`oY@1Mh# 9NZ0NP59y6qO7~ @"G,Og DD	љ;|3b^;=FV%3#}	JjF>ܵک7#g:CLZK
1nk2 aq;47[E|P&WdW 2WeQw)JX/Y>Djrz}AU[NGG0L+fiOWaY6?{"SxOta*	4Of3"!P|xdvGp߈B:8b}xxG(_hi`+7SȕE\#?{-L	R6'^-y	a;՟?їI8Eኘ͵Q7!Xa>B rd>Ym`o^x{
꧗OOK6'>j^Wo:oBD3-a-Ta(S<,KHS?D,dy٢pd:t6Ѹԕq#o8=\%ưU$dk
n>iZ]:?G*S\?Fi{gFWbě%^&;F9c"kA~3\
Yd5 ȮKMt{_|g}ϾدZu5Ɠw%#eDM(*hd 섞KF5..:tסjrA=l?ܵۜ}O+$Jċ
 %l0ߏӷ|dN۠~^gͧb^M.`VnyÖagP"a=u"K%&7d7%va@^YꜷS؇!;3Xk
Ohk{͛F-#PQM MH<FȚbk-YsG4HaX4p	BC b>$aJڸ2~؏ 4vҳٳ|ScX+M'Ɖ(zn<y$ceSqa$efqYzm*~r٬ur/ ()80ߒE
b|kZ6F:'dRa%<}Fq0D8\c1'eJݥ$7\oa\"
`'^[|iZ8k$_c:qWt>+l 	j(kc`a]"ߍU4Ҵf7_fHcj+BZʱu+(K%h`"jzLݗ
s>BYͅuZPcq-xAݯ1SwP.3v4TtV2s@MU0K_a
vΤB1&,^^*Fi9E#4,KqM(aq3.^?Og]LPGY#IqBoˢǂtމяX܏\-3դsuҒ:9@%nXk/gi=4Z[ld23zX:!4`kJLl3l.4l>lH6z`#V)nJLΧ/l`יӺ#ޮEK#qt Us'eπjj qXDЗm[~yFtuuc"Z>57EW`%g8iD]vW+jkbmn)Z~)5/'ӳ4foDu:_9ԿA)6j}qr")juݸ2;M.W
W9֐6f2,K^ĵ8o'xh;oE27o<5TmDaac&e_Y;
]&d#G#vvZܢD(^3 d)[ex]I|]'>~5!YE0'l^scyѻp8HNQU4D!2PS1ld-w+H'u^mT
ʢ#,׬N[AXƖ+B8Ӝ4
0aɖeӖ$iTn	I{NG-o8~7rTS3^0܀S2'tϭ?>aڄ1
zĸ3=qYB߬Vaړ`Rk+O٪ȠOۍ$I p$1()+ev	;3'>'Թ?zб8a~Έ"?!5lcl7=ITr;1ci5fz9N'9Gρ΂|}y#ėi#ܴļ"F{X4ƧnQ\k~U"؏[:~f3/9Lx}M"o>2;h$f*.CBXzw*QC4Lv|x>t`d)&eG1 rS&\FZ`W~)˲3Ɣ0LP,ې-jySxBk![p/h[ZΒM)x =V;;.q/s{ f浅@HD$ec {$rx7|r#,S>dKr`1<v^d2ARa`D?[e[Ql9x(6<bEQw'&iѺOxM(7"ScsbEqY)<NRkZq?7&^팖mTˉ1K%*
rqJ@%-VALC39D2$3_5ub>fXj)5aݧ'*&f z#kE30bg2/BB1y8-H=g?'cMa3e|>4n8߸y,书 r)jrwm%[( 	F}GCd!Fo÷ʱJ@&锵^6b5C_ܐn;'77>3yzUYV&UJ6245GLq/pY%8Z6tf32{0M	
N3G/%8^rC؇;143N_; 4g]&FXfhpFf8tӍtKL fHx̏PpqX,Bu[1?ʃ)~|cvе	S@Ș	$Er&q0HF#ZV.{Uy.Mj%.%w"fwRZ+\gihi69Df%B×<	EiW"0s$ӛbJJHS
2c-帓LR?igL 1 &?Ř3HCPV eӓ0 k* 'Ӕ6+=%gQ4fJ9y478XAW-GсC+RP!	^*e7pfZDxyӈ^J)f)v^qٯ1"%M
<<`XG`vN"蔴JHzZN)* N/R,*D@jc6WY<P?Td e(pq((EKb1Sb%F<<ҋ09_lԮcN~Uhv n 7iTCۖ??6hG
gj]ߥ]n6`ёYbÇ?l&_РV|m
"45+"j7~gW|vg[|ħ@@8F@\Vt}/m%4G~3x-k:dYA_|7$|C"ߐ7$|C"ߐ77K"+u*dD\Z蛝|#L([/Muo[3O$I 8E $]dixYV+zoq2pGd&#W[51^)Č[H-CaZM !Z&6g%QRRAkpAAj.[yvʝyvk5ĝG>?WH2c4(xD+=jꞸ"ih%ҽ4+L2;i~]FO#}8&by,"]{q$ə)8jc4,=T"HK`bX1:rXA$|ظ_%q6D,@W*z2}OiSD}2b=mCES>j`>EDO"MDCrZ%1)G鳃Gܮ7BU8KezDԈ,(jX,$fA|jҐv`P`w|<I&\Qw3
2r#ƕIV ~C&blmI!KP{G֕tOrJѓ&,LN/_bm{1!c##[gn4e.j-c	|XBcyH	{hkFu1ƞ侀Sne.Zls1>Eđa+0GzM蜾,H"ol˱
'{ۍNf2t=Փ[|
/%һnZʍ1w=ņ+`V2\]!F,,1	>yli`uG׭ok,xDAqcsUƯ\zk1բkqWA^?"Kqy]}h-炷dnӓp( *;/A9'wK$1hL\~
,Ø9"tф1@;f`G8~$?o^:Xٲa"n+2YL]-&?~{$d[8^ި^mTiAa{}`ҷ :i+ܢݐ^/7epYNjZô7jC7*cjej8<ݙb-H7K'fEc䨣[J,*77Y/h>^Z!CX:X rι$r227:#.4+ZQƦiaePI/1*Z]^2Gݗ뵼̯JB/5W\qCޞ5
H5r@Ēy1*{ax/G̖[{Qer7k<P_XV%VcӜ僧|&C̯󓅢92&afoYjhܯg1ZTty[%YѤx6qXq 
PzydriuЖR1{W43\LTH+lq=Z8+j-4	\&A_{)YBs-nR_0qPnBTeyH>Br\WX-WysY@yH	gq[""EyVlϣB"
![*b7.ÛߚedLQ 0]<ΧR'g)Pn֊;Vz}6?s{GwAOXݯ_L[\RJ b@d~5bsU+vnvyI^lLV<(S(K/zj2Мz;W5|f_#&WOT'os9^Tj
7Jl>K(CUcR,ϗd),Z2wV/YV+#:|lX-()~Tn%yBQF喌i;:a5NQXiOov{UQ)q+37΃p+r{^=6D5Odsĺ0?sQi&>|ʗG/4:0i@iYydȻ>yET?ՎC)L\tNOJ/vɗJ<\ 'ޯTjٓy]-C?`r 
v~L[7itH]XGG)-{~n`b8Ы_)xQLl3)ù}<^0So<A^WmdF.>!p*E9?7|<^᡿Э|yd7,Yմ4hR36jZ7,>CBO(jҊ=5om `E<e|#o6.
֥zLWy	),/F.B׳	5[
^iB^4
/`uTt!aFu:r +P0-Imna"&*k^r\=,8ɠ;<]鞑1We1tWm	zLkzE['VWk򭓋ke's!I&BQ48~4De[/OyI6sU<5hS_Wg5
OSnJ>!LMY^
(S[6ut{<&pϷ۝M<ykGf.5ofl)7KV(E59$$$qKL
).]Uz(Ecϛ1]ND%ԥ~v";cl'ݑE^.̿W`&	 E1aSLu/*Owh&le;NY[xF&>"6L
]cAh6}vUk#O6X}B=sLg+ޔT6NWZ$q}PlUHrcK^07!.qw&e0Ymn~-/IRS8Ij\-@}L%.5CҞ7sVm9L:BUND&jSҔ&Y\jhZe̓YxۺLVw.^IeGumrKA)O|UEࡢ3ڴe"I%݃Yujǂj{WcyѶUCbXyPZI!O>8gV=oxM^C鑯KeFBG%	Ɔ3p3%ePd[o8GG&Cߔf^r:]iOdM8lCf9xEx:G ׆Mt;	Ij֕W!NY/JUJr1\S&h)Ufug4)<*SG mpk޲fc;[1.I" 7A;0HK38B ܘ=7uW0[Y8~>ydB~= ;"4ą`$X.(:u
ҢK	dJœ}ڧq3׍/b	><Yʕ+!^RN*z=ZΣL=X/B(gP[j>yzA-{ضr%X&Ftg蒩:n8DO/s>q(Pz
#(AG?&[öuZZ6{شINa
dEe⊰tGg}1SQ[
!BpO$C*Qqя~\!RexbBbv|W'8+ӎ$ {!؎/Uw̯򶤥`ZmV\zһp=Kv/"L@k4]H$BbE.kGaV/l2\OehXc'ce~tlTd@pT/2=]NWkjpG#=>G>G B+%@x^6A_k˪E1(InysE7-7A@IK{+HRJ3˸dD6@!gv; :OY.̈2WTi*}4U}Vp	>Ո[N.^{Q.rx8yJx*U"z	t]/y/5]$+F֛`b>M:Um\^˳P3eVOpzUHYq
gax5BR܍ʴ?o%RҠJL.*#KQɸbz;I<9e5>VA1l&:9"3`KpGqy5dpWycO#

qZYBx35kM,ԢȑHaT HQ/S!r+u
`Z[jr{s"Z$4	-!~6xǫa̰3Ʒj~4
~oRoUs[?|4Eࡻ~/LwK;unw5*ge6k1MbzU-ƥi[U%ga[+rs~bs̞GxKkY.{i;@tCanA6y0*bE.".<gDʽA7Sj*=|ss֍kպؠnwsJaVƭKQ:%;(RI-THC2ǵ;d<Cj AmaOZbPpgADvEՔ"J
L+ƭgrQJT17->w`JU+⍕//ʲ=lLJj c
WxVȵçp9aw
>\P@Mс( Վqo*cp7khxN{W%Jd[d|PY-'/7qGwJ+p25qy!Mf:#t9ݑ8c:+<;'3V'R;c>UdqEmaZ"4-'k3Л6o>b9^suuc"iS,4*Q=(rxX?`̩q%r♿:[j<mh!|K_U-$$6UG:<Կ]=!!ʦt<]<%lbz9q{-<g*&Q˰|+Vӗa/ޗ@<;N`{:P,xX !j
)uFDjjR}tf~{:y8Zp˘QY/^ÓW/_0(	k("*uV4jjfYfe eҐ҆$LBRUCE{S	!>@JFJ!DWgx"ʋ)tCZJ˧@S.n<PC<'CjCXOF'ul4^|o56(f)ՍA]@4dz͡9
48C~sTr.=tԝ[M(  l
^H?c-b(-b	B{vG񓣡#戎K 	_kS/</z(]~x,K:yV|x/lt2G]N}6;ez҆%.:Yo7Z੯k-(凪ztTP[hoatԣf:hj.ܣIu`u/G`@ @2bzuE$_v=y}P7$GVUJU]~^62+͋rg
,^NpѷsϋPT_%kX30[OBM9wMGc2PvL$xrchpCn!Y0k5&6B4ˊ	1/R.&FWẐ@r_8Iqs'2z].l"j+ݺ_b Sy?4fH)^iWXᎼVN%GEQ)ZCf>{Ov ʺX\$Se7fe@g v+I/r4?戩5/wK72>IY^BTai(JDc.9-[$)D 4(jŷr$dC[R\+zՊWWe"PMr)hGQE{iLS5٠t+26UE׍pUH^}
(W81kCVAz? 2)Wl%%GlVŊ%ns˲,Y:84">\XΓfYiMմRb2o31H*@	ǝVxTY=KZY:MYрdWH_3%2#D'mA~=Ҳ^`Nq} =0#q8
#H=;0ԫCtPzNݔ0vO,Y{)+Byҏ4G605McdؗTXH|q}S3K+Úk[؆۵ɰ8W9:ar_ZqI`	O>GCH܌,%ȕ|tDמDxM2q{e-bnw*
Yb)Q){}`1*n;MG~Pg.|Խx% ID-3KJm\}sa8(m4ojs7-Bi٣ַhuUB×:Z۹SҼJh}B9*
$⒏tD^&RF-XJ/i^rw^|^V_S^A7S;'ʐ:6ThpQ+#SO<lxFG\Q&|~7Fokf#}j/i -x7`~rmFt*3>P
J  	/GqYd> Ǒk*^ּj#WQrO|^1k^'jH\37'L6][lE8t"'[D(TAg{[ps\rtUE@5 fZ\9@0^\)[&0@]oC9Եwe:s!ѩDc,5|ѥ7ҝ_F_g}JFndƵAP(QNAnl+ϣV /*1p)bima(v(-8w(nܪ+<BܶGk(zYyDeC'gn.yrӷw'aZQ+7bs)UWdGލZ95ZTGg`$V9fm_%j$%o|+Za>;	QImU0XeI}1ZcAz<8]E(O]92sW- F$x'ޮ8cj6Ǫ$2
u|ŧ&I/ހL{_<jBn6Tq䃥5ߣD42j@tV9ѱ2]P[E2+EKsSyikhw )M4y=5%3l!ޘϧS޾L'ЛBe.*q)P{oI|0?ϣ'Ow&>}{\py3@x>%k+8_qY}?ג{ЗxwQA<;S ԭE.Nלokni>=Nv m8S·xsinrWv.P&ɽ=ЅFar\S=BHwer(\ϫ'ӌIX,/us1FoW8>D-.VLC
1H(D^\	rl/
e}鞿eO?f`FE{ָkB@'HXA6@$	 +[XrBs5HM-s/Z椋R፝-[34cUm )?Pluvn{M!b50oዌvMkJïB-|ÿ_kqBEWAQa-"Z`Ӣ	`S@ k U4ZlKNEePKuիld :k9uڝllЂfJ((G*z3s	4BGemŏWy] :w.HWvɻv蘑{fHc	#seȲm&?l[C0s%JzY3t6,e6s2B,ݟloЅA>YPCeAPcE+Ā;ߖBx>*yY5դUy1hunW|P7Y y C6%Iʜ\H+y;]JJsa_V|fA1,vH Sh*[+ck[<Lh_[?+'K̭ _8*ԅ)&uS-0-u;qy=7y[^#{U\m,meHHH$)Il/F[Ů)ipɍ!"ikZs!Љ_l1GryG}`̄.QCCQI~Ԩn;v	\ B@y\AAV텔Rg#wsHKV*(7Uͥ$t4a6x\	q#NN`/jy牽89Qf,ϙO+)EbEn#2{c-Axg|F~PEyZ8VlΏ},'%w|?H&SdP/k\)qSJbWMrWf>MAӥ>2_0e`0yB&~׆4A/"c<iZ}HۘOl΢:.BF!='Ol9<$[FBvOIvx/k63-UQun-ny6opg=m%'-u٠rPT4ZD;9)ǳyӱκAIyB뒆d@EZ#CSǧ<f2F'l?bW]/d0_܋V}v:ZWVTyMl<쐫D@DC[dh11pMsLXWkNC|ɱ iɰдjH՟>CM6ۯhtmFpZS<n[mǱ-5Vk>*gsE@4d;>.y/ڑ|NXNl]پ_q:N@NUvfr:b۩;6m1iaF[ܛmAܽ(c4-ΆVz|+q%3EV=uE;[`Z_@y1@m^/	ǤUڍ" I^S<0 o$'otj	XYsgj
_'RHMLqQz4L<ҁ
~%e
#2xq^P+yMVPhMf2v OSNNWV9fA俫Gy/ss#eHK6xd|UVb0sE/ٵpCEi ܢ,. ouE,L!I#o(r
 Fјf5e#m3^7wlR'⁛ق?b?cYvrG9@gϲy}tlQ1Ͽ}[5۲W50'|H%_Ap#]ޛf{E-~wDJ=2Y*>ճ<y4/^4;㺀B0? 76S>rceXtW>88NkVB<x:|)iO~5=]R˘Oeص1
u;ub8+ 5k*5*hjjSCY{[Ƿ˫ .6TG|ݾ:&t:Fn;puPش&sl?~~{:[3f_\w/	TtW(cyřz5?{<| FL<}$qǽ'w~8I|ɿxd ԟ{?@I??ȾOyJ05{U>Og~yËW=勽l%{S?5y iI^~nXi7=y?h[t|y'cg|m'"m4i5;;<i%-LaLύh/X{]~A%%VS<ߤҔۭxW̲E1Da%u|͕k*nE̻
VU>Cm] i9_VQEe/lv۪ytw hW2B5nW{O]&?^Q0؎lD|ꇢѫ㖣9,y%d^Qm@݇xmC\#FGuDƄtKݩBNJ(s{
5fP\#e{'/k{0RY|wrpTc/{i뫱%Y3Ӽ9y}ivo`Z\x7;VuT*,,Ĺ؁톲g;8[;c<'?XrptBK6Hmnȡ4J},lUJ9tL(ͷA_oiY(t5Ztok7xWl/m_(ۂlQR;q=¿vwI,{tǓ_nw)W>R: !+VbִSȉ1fU,+Y\
bEb'ri=&tg qi}V=:rXj:vat[w?ƓGcoa"iP:py.3Q쉫P̳P?j059ZOSH
Xbm I&k4=*1eCsQRiPc~WW.\J۬|7mm{<?{bO/0GkɠM+๣G4NؕC~Pw^Ex=JoyX)JA ʙXÃʹ?O#mcڏ}w\@x4aM
	|&z)81 ٝǧA }<lO.{0߱`Q|!Q0P> vN CA>O
3 3{w8O`6p08aMQ:1lLIj`:LGA1v7_c(8&_kB;VFũ矜Ʀ7fHQMLxBsJGg'MhW_`<[uvy
#3o0ow[hl|| fTԱ?6p!6.kA5XdYC \u%A G(QʬNa=qfw#xRm 0 7Ge(0@)M,DeNzoL[БnZD),?l5=~k^[t{chh\MRw4=[MBCU2En#+!lnSd0JTqS1fS0'CV$/g!9qՄ3wwm1^,I+Qʒ*Tw>s[o:R߈^6i,j42%IAa*aL`&n~k"rZ; Mc/C]e8jh8F6DTW%ZO9 #$`?917?f[3N.|x&x`.g6	~k;@	/θdx3{"0FĻ,4qN
ޅFQL,tOLFf˓ḏ2:.kKh`\O/=ߌ#yI!,k9b9.f49X>{a.u
#npi`2Ny%5Pf ezL~_|,6`:{!fPBHB_oؖ-ˑwz6p_yM1mN00N(,v7!tH-@h9}`8iT3))n n7l5zF{-Ǟ-ǲ;V'7.ټoVv	ԶmkNSfҒ{mjvm`vgO=[۰mwmGXN>bd]vZmC6 m5}mvNgn5,wl$ӿgӶVʱ;VVGOP=:]t nj6ד;mIdmw,N&׷Fr NՅ>|{'5lWnX^@0hNVG{RO07.Ec;|$@pE>nw#҅DAjw؎oX}@ОPo4VC+"08햖@k{@.hZ0ڭ6:V@CWøC$ccj@&Td:\.Z"xf-&w0"
:$aٵlqNɇLت߶_(;p#EV%;NׂDo@b.JVG؝ kQ B, w:k mlNvq:@d	Ҁ;DHݲaX@jzpD'mwm@vcs$H6	Y̺6L6TjCce8M`3vAژ
	z|Ct[0
chZD{= 	18 @lA.nQ 4Մn@0z--n FNAj 9  A*n߷i(MT~Cl7	}u 2B> Ah5BtdLAAj# Ie`(DV=50mTJ-LtNu1Ӵѽ>& ho&C=hyс$X1'ièfQՆ$˦P7Zxn8D vѤQ&CPyt@A;AVQ-3A۠@9m+&pk{!:kAA~Lnt}q@wPq);jj$\-7NRm!k v2" 6G) ëAv@ݴu*A -AvBh%I+kmԄ"	0	K`l0`d2T>Х(C37mҠ}TDTHs9=Tw:=U t}*d]@dtD8$p5VIԂaivQ8I
lmF;h¡ezșA+'}N_ˌ0n pRau`abO.5;UOn>$6;7DUT0vivh۵[hO[@j}&HcT6TJ]:áZtNdᖱt$4EaL;hp@wl4rJ %`t?`,}m.MAb%iP(U:/4W';dmfzD,]QS)@̒Pɠ@"@Ӄl7mr:0~AvC۫AHiYȌ>7@&y6 e
&. AvpV4"0,8t]gklq~iRuJ^ b`pYtwp^'DtDF`tv7vl=,ߧArf7Eh*r  *EhyKZ=kqih#!f~"&;8l!;=Tнг؝@X`Bti4aVCQtr SI L`HX0fL	u2Y|>-8(4P QuhnkYJ؈}'3h+^S|1 ~6:ɩQk4jbhC7
&XnS`)H*	 a>0F`>a+K93,0CØ$=-3V|E^k)Pxʦ>w`[tTSSчt`KE)1@Ų"hܴZNSчZ4;U9hOMFoV*`
TUy	{P^} l!p`@=5]ڀ	))юH2LKZ;&pR&{G~XhfsCAնڪHSyEHmGþpT?5QyF
8j"D!`7]T!Bd<)QifG: h\8WRH6oWp* PyD<g]M4-J;8|F{В0[ YF*dz ;,øIGmjlć|c/d5/ pJ^u4};!8-aoqß|u<p{/qlU:s:اk{ݛ9/7	<|wx(=|ZI@Jg c,\yơ񥃅Y6(X=M/f`cBpTtU9ďt(=p!-@'&{iCl!/{$lxg46Tn#p;=;&YN;z6o|%d	V`6N-U_jԏ=ޮJ9[I',%tw Tį#@vXZ	9rPױVMڱYOIi9GI	e(S
L=K?]ܘU*
-j)-z׾[Nϫg`h,iJIm`jp,m\m-vxB
M63(9;Oww ٔx`qm)RUQU~R)60wmXb˩n<
=+Ps?@}QV|Ue^:(U˳KCWdɣxZyMa;O[}9R| yߖML/ iԁPYe":+܍Syǧ#<\(L	n>A0ߡ7TA0^jw셡BN<|OpjtUR*_r*Rw^AMLGPUREjpұ]U$7٠B"係J=wVY;|(+@5c[Zv[kN뜁0HBl{P ֱZoom\Ib?HDHj?<[}6Lpamzk";\lڦ60pfL3F_UGrSxMCh,[dMnXv-&w^z<m\6c/b9sO09F)@Aٶn54լ^s?_)?iG`8Ge`nNs؅/Ux熛*/`<`JyH,?Ktѧ>ӱCYLT5:cKl&M:~ȟb8UGy7[.t68(QzQC[ҰTɾ@Ŭo`h-b=6Bl`{zzQ͕=Gp"azr8)O9	6*Ge4vsxxX2v	gy:a?c:zYdC\	qWXl4u$BdZJ2
蜳u֨%IeJv;1Bl&ba4h}(k4:$h\`so/Go'o+?{ .9_3#;? eAx2D8?{EujNB z޼bϏ̟7o*ɻ/!Ѻ_ޥݐK9,716e3|%7	-X܆s׏MGY}
V!s}bLD?C,ǡ?י+N=||?g֛7_]U?J͙d]<&Q:."l47YqPRYP(t@I]vQE
r|O qn]Ώ뎖Jծ)'eU#pSɚPU9&(<LE`2d9'̙8s]dtMZh͡+EU}8Hp/L)QWǋ,+t;]Fo8i/@97CvW0_^d{1ő /{6l=~PyS}mx'i¥VV;B2DExXA Y:*UEsyp8#Fyu(RaV./ܳb֛JUe
AASIa<b\0*H o"-HʼqW؋KTXK1z3H7g1@oirY C@s0- U|wżݧq5So*elMf@pdrD\D?+I2hA#r;oڨ1hZ"MzU.|$`甙5dd
D1qU%mTҬ⊤"5GSGBDo`ƞG_:UMEZO?f5Ȟ1h q\0)dLBT2#!
дAJ$f
=VU
1$Mqs :̠{>":nUFGfwF)NVc4SU$	).D!xEod엱.oGCWWJe>U$&uYkHODP7R2ʯ|*~1}gEF	oo+Upx]f%6Gw>S
X~y,\E)?=tн`\('tgFἙ<P!F |EЋ5R8Qb~!ECމ+mvB1}sL`LC^3\*pcC,j0VIY&]-=?#7<j0 yCJ%g;A̢ %9
1h[(`3}sy;V8i1whOΠ`"B_sdG[r"'`=B#CQW!3Z
%RN)KD*$[TI7&YvI,߆NF^ܴVg?vWڅ9Ѥ`ΛESZMPPe"b~ \y<{
!>5mG1_"twՓF:v1w9`Q0X@+D=֖AToisX+7·ӮJlF)]SB(]^fUB.t5)P	`$xa_<%|p4 -U	9s_dR0 5cj1cN`3[/w%Eٻ?7
)W9)	M"+r)G"r
\L!Q3gsVMc~<foRiGlulQdYtGrFnϕRn2qR~ȋJ2m\ANV]z<Ee54bS)D8I2 `}!Gr`6+ny8L`l=-Pƽt؃|c~#s<t'NP`Z'(6NcW^ /|N'擅],Ob_<V:Fٶ(r*/̍=YwrC;L!HU;(Iq$W>V!~%6=0ߟz&dUeQ8~#\/r}0-54[pC6$4b'|\[-[W9gwF#/u}FEĚv#3ֈpT[4?+_"?v_w	nZ˚5.˵|r)toetn@naBm/xym/ǓёY>c|ᷩmiL$[jJN&#[ٛ#Ϲrm5_!W c7`ʨ?OE25Ki䁺)^쩷 `X PѨF4k!=YMS{O/]O]/ %x$,<?uH5ܥ:eG{M|!͛dsF(z/]_!<3\Ae(CgᓬCgeG,yX7{r]d+vRd.A6a(#ldà:Eic	CKv%[q@ai?2|TaFk)ŴQIs[48٭Q^qΘw_%yԵ5kWw4IZhä8m*bV& ϼ6`kOHWҕS;"!@VJIԍcM?ff^ۛT}>fgfgwgw84pboOeQ >]r}uhjo,8BρH3}a;fltx#O`j3gx8ǘBUT.AX?t
`Cmʫ%ah0r҇_+bNmuA23*faВ,cW
[$bت<<<Tvھ-Uj獤шE\!A/'O:gMZx(O 1X}acI`_r'ur5ш?@UʢWH2tPM1~)oA({I#Ol'܅&$X4Gv6S?eS@fb(&\
TD=gWKoՄݡqUھ'ؼYݟ=s
~yT"(i"E9pxd d ƚc!d\^@ϯ#60ŭ>Q3CWR'ը3JM]K3#YJ9FI#c#Q`<J JAopnxzD(d$2,

	M}fwZzǨt [If\.׊uFk\~x
_d,*,)^4KM/GOGZ_؂^_`.X?~8̾/?fW3pF~ݲ\Ҭŝl`Nf_a%_~'MNfw^)LlxT}ox\YN6r|䳵ۨ6t'%goqvlWW\	Ĵke2~i|Rn@+:/@k,^(bwtt\ڎL銔(yul:iHfU^ڴaدw*npI[n撔EHHVƔ(U;>yCr&%c #rT{a/l4hI5̅<NO+"Ҕ{GdH8[:PE=?cTFgTd&p	V#ʭzDaV$<6unfx,nJ(zXZ %7@5Q+cʓX`ɲre3kw~99?TvLYj;;]BۀǬgE+HH@\8z95Il,~//4LXE ?[K/SRqSԱ_^ӢZ/HЬz\otn}Y?w7z^<fop4!*}BZGvZ	z\imr$܁%-,tcAiA+K|ſ"kƙkcocW[s|W'c,;0f\^\Uh/!dXUd[DwoׄIOE@eimuj_aSl4lqrY8	Zu +߷,,0A1TL"j0 !ˁiXn>@{luR.ǘ5A4N!;F-Xt=mw|O
Y>
=Рa4t;l44(==qRpvЃ2Ahq}Nj"CwjvrO!2>|YhGll
j>×a1m= % |̣uv2^Ԏ%v6 .ۡR,:4bٝS%aFVj 3-J#	ʙuK1Egq;Ow=
laDC}<<h wEr}A[s'HЦ'slX[D匂ڦNu@ N"^$6 yb4ޠ"x7ǧ-t%8gm*7b,VX7c
p62- r4kw!R,ezśL9 HM /sUiO1@ycixİ-Goøv?9`  a`Ln`wqqjb̵{ټؑh1utU2#)2V{."0ę~U$qEa	> ZP%oS΃eLxxFva'mw`=Vb٩RӪpM{.tun	)d<$ci$iw^!|+]^C4ڼ,RZʴ^W)_^\'ęc_jG,PAUlmͷ6/1x f 