#!/bin/bash

declare -r m2c_version="0.2.27"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]
        then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$(m2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(m2c_msg "$message $(m2c_info_bold "$opts")") " res
        m2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_msg "OS compatibility check.................................................  "
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_msg "Docker installation check..............................................  "
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_msg "Docker-compose installation check......................................  "
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_msg "Ports 80, 443 and 53 availability check................................  "
    m2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service.\n" >"$m2c_log"
    fi

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    m2c_msg "Password required to trust the CA certificate and create symlinks......  "
    m2c_loading
    m2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    m2c_erase_prev_lines 1
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_msg "Locating archive.......................................................  "
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_msg "Extracting data........................................................  "
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$m2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c

        if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    m2c_result ${test}

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_msg "Generating private key for CA certificate..............................  "
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Signing CA certificate.................................................  "
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Trusting root CA certificate...........................................  "
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$m2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$m2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi

    case ${m2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                m2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                m2c_msg "Creating the resolver file.............................................  "
                m2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                m2c_result $?
            fi

            if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$m2c_global_dir"/mutagen/
                chmod 0755 "$m2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log
touch "$m2c_log"

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c
    m2c_sign "m2c.test"
    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"
    m2c_msg "Mage2click toolset is successfully installed! \n\nRun \`m2c --help\` command for usage information. \nVisit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log
    m2c_load_project_env

    case "$1" in
        global)
            shift
            m2c_log="$m2c_global_dir"/log
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 >] ]w㶲(x+ٶMIV'vgms$*$eYއy;gZwZ0k><̬5f* $@do3iKBP*Bujqzi}gmO0j9F4XqZ?GƋYx77d;>^#<U8}LXfݨ]Qw.a8xGfSٺxo`o(]ٹxx: f߬7<翁pv&6.Q8>7?MM_G7Z{'fh zyn_x(ey}?4wXE,{L߁o4;Mf_|Vd^SW}6o5;s{.{	6`I"j3bF̛\09q0?I	~tG1;1KN`'p3}vCxO LA؇1umڼ5x3
gF^䳉7%5w_9X0<
}.UOOhVXp{8=@S"rFxy!3 _¯O}Щƛ	LD0N1;Թ	e9n7_Ⳛ-ֱhZ?f$.^oNdj=d[oYk83k[ Ő [zb>8_Ai(͕d
uuGIp<toefLIK11Щ9(8p[Onm7'i:N~gwŧkk1f? ##otx EMCvp2gAx|pƯQǃ(vK@CnGv(K~CѐM,W\.>#1Q aq6!bg^4	CTȶMUu-f5UG^V]BvCEA]ߺh_ JE [E 9-ZK`\ ;:
/ja A A bw	mߖ50?9F_6+H&̢$5[aZ`^ZWrUrf?sk-YۼVR0D0WVǵVF#>5p9ϛq]5\K,u{g~Jg I`'.)3ES>-KwPSX^pȱKvSݝÝ?`syEF7	)XlMҟj<J3O(aO^γݧ/^}可z]ʹOxG̈́z>|b{B{O+dN	6ao0qK y0郵Uhx_56k8	~_L;ҿx$f/M0{I! U_ysXxueU$xVԣX@]z YE s捂!|C'Q'+7ɖOSzu{mCa۹R2U>VtQ1Ofф	&Ƒ#!`rEwk6*c+>Ƴ< *I|td5@ zgLoePHE	Ӵr`gur|i^rjm
'Jo+T_`ibܲF,w|D͢BpA*϶_?a\q6S w5D5`©BL!QxRhI0s֔9Xskw^cRUu8|Wz_P
{e%Tk)ĩ,zqks7d/_FDrF0"Y6o0р5Er-HbOq^quE!ͻlx6Ef
>TI Пj,xf|);W*X^$ed{
X2RIo"UM
&Iw>a$zs	3a|l[99Ka#3uF"xlNY9닮Ϸ`\g\K@~?/W%͢Ͻ(|[ڄ'.' ;5J@y{<UeF	(Mn.l9e~coїRh0
RmYpY$Hs.,	/*5cSKM1=c!킼[ YMOC1'^_kb>"1pG(a0s` l4329=atNM(.X4L0 J"?#vczJ)So$fgSorVnF4<RbtVbF>ܶ}ꏀ*șB;'Hhc\N-3͍!"VԀ1AB,澌"l;eIї<KoK9> [vt,a*ӹ홵̟{Sgj{^=AyzD!10˙>7E;(Q%(@o&,F wS)[0}$cN.~t|N~_KȤ~FIx+luØUF 2
d6=P7<~}=~ӫg%Yw/ao7/5OCJfiK3^tTmi$/2˒D-oRjit~q`ĬS8i:h<%rb0|\u&UDb*V7ܴB.H#]JHnSX;WQ&0#u:~g7$}*ułhNGؿZ܋BV.쪲zƔYWWֆGMt+_|W/_
Փ_112[f jBQD5EKa'DxhuTA U=k)&`CHeZK%Y6G蜮Z
8y7	'̋Nfo~D̏GOR`vYÖag:P"e=#K;Px7%@^YjS(!7 3T?"
Tі7[7ZhGԡA_;vә"$L5&յt )҆wb%
Yy1*Qjy'jx |ۯڵkJeETMhŚk65Nh8Y'}+/(3
&JK9ŧ(3kS4fXiG/=:td %|÷t1BraTYˁo.'ey㫼REF9(8	ŹA}̾
|rT4̨Ny4?_F!;"lӓ|?|^l"-:T*~mkk,C'򊎾2ЬWt$!\XaMb,KqF֬+aռVX IcLmBSHY9np׳tR%LILEMQoJ_a"`ΧT7n!RK~"}/8Hq.S
eۮΪinNZJzK8UaΙt}S(U<QݭbʴNP+=Q6@Sb`scl iqǿ>㢍>+upՋuT1opʷ<|;HA~BPik*RzFcsscӞ%KK2 .F/~vCO!vNN&B3^V̤7JVWћl}t_9l̬rZWWr6	~gN=ev-\ _U&_FoN`76P);F"e-03/H#0->|>b!Ah(C^)^B+媥燇Wq\"ZBljo)[:~%N;4foĵ5tP;ߨq%ekz:_xq2.0s!m̾eX>ӱW568X-ڶ㥚m:iܼmHR͒[oEQV p Q02!!p]8iTϴӚ%BrQ'gHيm/2 Gw/W[3WÖyY0<\X+EYECb(0vH_桜zn-׉!-\}y ,g!IAH_ˉ0
IgiOxϊ.B"&<S6j$N}|ؔ&L53&Dy$HNgG36!I9A1h	_U<)(~뤘!b]f*26*I9\vp:JY5sO~'jܟ_|X;	m<2vMs\%{g0TQ5{氵\-k(q;AC͟^mQz`pp4 Ąg񕄆.{dBa=,IS/)bG5DojWُm=~fS?=$VLMbo66AṴ#bf*}0yXz'x"VX#4Lv||>t`d)iܐ]<5>\,>Rg흼Ri*&73[o)5̼QAAd<5߫-4-tII4bXeJy/^2!$dOa@ʌDPI.p)Ӳ!JX#zVK6jEZ/FԓCEBvFw9<
c]?EE lsjXkgPzNg%qô\;皛UAi%QhBQԒKb-bc#1{#\zkjг#bZ#sSrhjl]bT#L.!270SC_q-hG&Ɨ+Vퟗ<h2^*YlqNc}2 0Ybf̠TI "jQAR'E8`2,?ew8NM_3 i֚Qp5Z~) *b1
oMM^31N A!pJ|l׃i~BG	C3EK<P'-h-lA$qǣeβ,L!UdZHCfPvEti2}Iq%WUqb\e1#<\.dbgq*3Ìc؃	(8hKPYF";0\ipgo<+aqPH,14;NG3ٜ8&d)^byáY>6y@d
$}^#tpQ2?uD0IQd9a`e8*/i8KIHLD#Cdpqr#u=ίaYqv"y#MΞQ&-4UVbD<%
WJ靰d.
Q𫯔!	lD`@ׇl,F% E"Qd"\|J1睎sl)Ƭд<$3ޗ6'VatC9c?3+9π)(Ibe!ϑ :f(*K '
?켯rFSBӗ͆TL(`0[
J(V%%epe 2vG8F4)ot#\a&b`OkD4Cdi@!Ţ!xN`JE'ʗi^Ok{M$r$kHPd`G?әʻfi-,((@!es!pHǮ|EQ
^ށN5{Qސ	i8U/6h&h8N=*@1t]ѡ3:x-]-/:(#:8^(L"FONŵ H!EjC}4}DF~vgG|gK|6ŧID@F@jVt}i/-)4W~q3x-k:dYA
_|%u|]"_%u|]"_EV"Ud)|Smr~oN0)fnco['N5o[
?RsSxn7p,NYzne[II3Jéyc-/$l1n)[H-;ӔKٶPZmMlUK"eN%2gH+c>1_D;)"h|L9.9OO5.8KަA2jھ<F}!gil
ӂܮ_ʔa6̉nKok6d^!el$u*a	)ÒB7m$  2$o̯F 4\ VP)6.p1qE.=ignSF}rĔ=-ne>P>oV>eDO"~D#r˥W2.g+-p"Y~ӞOeYDQZi!1K!cP3k7n
SS~ǽgļ,,܈qs϶|R}!SUoȼ2Zܳ->9maqOʺ2`R.*{W܄%ZMu2f+
'W`~	Ԛ擸,\S<,OKȋ
l=Z7a=u}-92B_UX)i7aGr-(92sHͱu#
&atN__UJOF'̓FJ'qYL)>GQYT@AՖQW-F{ўrÕ_Rk0\m+j`tҐv#QENh0׺N}uwĚ|W<	"_y19ȳUƯ\vr1.AЖnEz{g~Ύ4Payh(w)teC^Yܧ|ʙD["f3~e$U&T$ر5[Va @Cw7IGxؙb?MiRts툝~YbmD]M^{X(d&d;6$~^\mThAz>pj"R5Ik^=h`p˹0;x/;\eh0-͠ȋ125͆>{m{K)R:lÉ^Qj8N(9nL^雛M4\b|P!,tN9\@tdP@ϛ,t+ZYM1c,>O_GcUB/kEmY\/בV!^jh>=kj+5k倲%;T^-΢n7xaa1ZV#B+`9L_'eseLke~fqżkS33Ûvo1&UƛѵÊ1W'+Ln>_A;+Ϲ'P=fj"H\a}9_V{_l=Oyju.%4-is>%/PM\nYX3_(PK*/x.K(opԕ)W9a|KDLB<]o&PBj$sQxY,'2,Q (?EQP6I8&GJ%#UE\
*T-)wh'/BIx> @
foa߭Zm:;cՉT%P_L[\)-Q]B
N`H_
ըpV^&^T=2*E*)q|L<3(K.zlio`^C5XNi|o2/%ؑ;?ӳ7TG8~B0M
0ax:&/iҢsFn*[
u%jeԠPY`w%Y%A&3%jtJ~b\D+xt:2dTUSᑍaeAGepv{>~ӫRxEԏOJKL8>aԫz\-:$0f,<QgNsX
P) l^y<Ȼ>yETf2#f$\tMNfJg/wWJ\ 	DzyQ0+tlq '[8I|H]Xv(-ĵ}n`Ov=08Ы;B`_܈uxw; c zo 6F,N(\z=.rh^zSߣ`pοb(8Y$(39%\"gCh)e`ӊ8R(TCӰ*:oQx!O)zf ؉(K{p:(*Zl]Z+^EgJPd\;]>8	J^Σu*ROV90sQ<ZbDt~$r
ib{8y#&T\72exӕ7k/CiU[ '^epaENlPX]˷NwX]K[]KO2;Ko(m	,eZA>	fq
0}yΖEs~U1)տ$iʭc(LMY^J)qX%}W"aUhU NÓ0m166e'xwT~2VПs[; Ն%w]T}]50|ʜ|"*1?c#7f.n\x]K%\'(fsטVYQa95`+qrڵVrqɩdZ;HM̩/Xy*t+])wkA*roFʧZ6tfG5<4r*$|cKجx7[Ai6q&]Ɲne0K=`NǆxOԐ)ndSWz7tiC琴g2>3e`_PE`F%Ѹڔ6%w6ES-DZe̓[x;LV7.^?gGum
P)>n4CEנ_d󫊋$WmVbr~]Zı,典NQmF`eD_VyhЎ<ι.Uii/s^S59WCz9}#M[cVm8ߔ2(5gGs8WG>2CU܏gs@t~ɚp0rB%.tY0qP>ƾ64\eMH殼
vz	/YW2ǸiO՚dkWשs'&8o̱םtϐ_"ÃK̯+ҽ#WYT=Ni,풶)pC	X14\ąq-+KbO c+ن߳ϣFEŔ~&O,_L&Ykf.ICڧsdG/>=Y3ϠN*z=Tǹzث^rޠzX/$N&_QZ\/9hrᡰ'<>NzF| +GV=jWSt}5l[Gj)||eܰGj'3!2V!\H10⬢ϖm*jK!Drf`b4N4{D_%6*.u"<1CLBH,B(XU`ڑBa6۱ԱNU^,;@+=ӊ6&}ӇOŵaF(I3Z8Ne-B 1K(
I Uf RK>YXK}lpUv؏N.1yP6۳Ljړ#4wgx"م"ƛ3PMRim%rJM{MPJIQb*ʯ[q_Y{n˃Mr_b
ęm\X"D3z?f'e"IB(w;^cWTb)fzoWKb1l̽,lKo,+T쵹cnD^>]Rg]:2#$~9vEW;Z&C./`^9PskV2Zp`UQygaTȤD*$AV9ÿ}Gd{G >c-B&ʳ2pIo譅GͅOi	^(>|^ (V,rrLHY*)PT QL|­)2=]{@A";eQMY4+SsVho4-U"\x>V>l1Wzvּnoz@XAuC͡j.}|f,bZ:Lhw3ETv̵ehT0hʪ3i[q"`Э܂ף$OZSi	}-fz/qLQh-olY>-Ȧ=FE>BeHHy;fr^-Sݾ1^ownú1rmݴZ֭nA@7*޸v)J=fYMZLlBD:=;<l8k ԵoO!
߽BɩQ}%|*VV`4%̑5npm{tV¶+_^{:sm.s#e^3vPOup%6(	o.(`i[` #}<oU⫊ƙ# hU*V\l* ~*V#F;('@rr.lZLW3ȝ5(9d{BgNo=s2NI+ߒd_>5,ƾ=Oaj#(x0b%jJ:N*"mhx2Ӷur68ZVTя;1s+X(9W|sxZv<d%7D@(?|.#1rhHh7߇'WWkLč>R`N0`ײ"W95D]<Y6D4NDRaT޵^qe~<f#=rPmAIySlC;|-<cZUAoD޻ĵ߄tg<쥯V5p'o|@'YdprVq3cJ.jst;=Cl0\p㜢ox-dnelqc&6bn9]Mx
FZ1TdZ	z`>+(de>2P80@)!$@n78*ێ|
}?	(ס-sjޒi6,ɳůmys5&mj|󌫌7_\ɬTBȬ2qz?9wj"#UM#>$Fk$sIJkey׷X@f"z9D^Q yOAO||	o`rJ7;'dԛG\SNgGa9<8~L0JںY	s+^zDBlvG	sCr	_kS/<	*'~x,K:GVQ4^gm웒eW>WpA7VcPdL[2J浖TTcU=<*-Z:;VR3EAh5n٧o|&nx	mH3o @cmtK+7wMdW3yl:M8>X]V]mzMڔ\)gکO͎lN-
yj@^4"k~[8a޴bU}HZTl.-J2ɹ>s"r<$=oIYHOy7fD|K lZWQx5Nfx>%x/t-]h<>+Q\-^"uQ6eq Oe9;]s9EH#0n=Hꏂ^P3_IkvpujzY,~|sQx
OU>5C>{OvS\l (EֿFx8]шO_JSrkg`NRFs8k[_InLD鍊w,SI0W΂X	hYŖ/a\+RXTV\߯jFxS&q_9t/ݾY&nEfpf!PKo]X\ʗs1<29X
{,d)Ȯ ap6*3XqN,B4KZZg_ć/9owGjZq-u5Z	"y77`/H.xD~v+_CugҀw)BfadFΉxbKр5N60 ק
=&
_}|,<zхQ^'3?A	#*+_Aڏ4G<1E,4Mc񒠑TGXX|q}[z++Ú+q؆۵eΰ<b:a275wˇk+LÂ[&>Š^?)2\iǧsӁӁT 񯬟?t`ERŽ@!ePݥ`q{V;G$'TfJcCSj~2͒IaO%e6Ynƨsxq>qэ'bӢy͹Ce#WhCXߦs!1/:.LX+ͫ .RDIB+.Fe:/h`/EN?(7|kscnE;K ~3hBkX?R?1UFQ7`nch> r9߂w'nħb:SϡKH 8 rq@V  z?}Հnͫ6ru_߫o^ʷOX|B$%z6nfQGS&JWӕf[RFgBJ<ɰO.T7w9H!G_/NIWEE1TLa^(hfҫS]\nc9xm(g\*hK9BrNħ7-*'[EŗKov{^*9XђAG-_V:T>s[yo{	
d|W無ءߡZWzzm-[Wub{D#7)n+oLbQE/N]R+׾BU)@z`/wy7j2JWjQ>[-[KHJ)WƵlzy9'ٷeNWb%} ks<L.)9w~'}v#6īo^Cj	IUߩ\PWIv44t/^ZB8
RJFqg[P]Y2G@tV9ѱjQ=>='RCS8 ́(E+T^};v挞ƚݒ
6G }&U#N`z?st7	S=«f(34ϼ`D=]ip,>!|b>S=L޷- Q8$gc>:Շy-/h~w<YC5IΎ|D@= h^~<gGsjF5)S-{Í3ǰɮ-'Lq&_=!1K/܎Cʀޤgqy(L0Yrʶ~_RXM=	9sw2D s#jI>%#X&r~SɽF!J츟/3) QvM vgrIɰLO^Wܐ֞xٵ{xTAeׯ;}Po3	R5	Qf<Cd~:αPZ0iAjlj	|2]	o|J)wUvLC\ir50oˌvMkJïOB-bÿЃ3WBEWAQaX)EeyS 'R@ U֛lKϧłePKTE-"l@{?g6QG-hoBrLq٨\!
Ƴ0{Q0xW{cumG$%@%yǧ u^16#eO5;	[N)E̺n+9"=fζqfg: Pbbb0@HNPS7(&+q|..6hCk͚뱡=asj,
yf[0|\hTO]%Z4j/&-Օ{~]닏i(orC1;hӞ1Ke;oGx9/]+p8A
o_}`z	h]aF-nrWhږx4ǲ.ZWWlϹ[7;$n\K[G? ܘ 8q殸:拽ǭ
#6do2$A6D롩]u$j[	4GkZs!OчO^n1
GvycC`Dn
SCKQ´ afVsnZ.P`"hnU{!mř冤)s@8,%+z&Jh,ao򽈆|s<D2q)w^5HvIC"(+cG~rb'⮻Ezo06|BBX	o}+dnߨİ_|oThO VE>j-xQbFn6D׾Wf7|;H&StP/k\)a[hIU
熝6
ߢMA!}2_]=hA8rN\ kx6ڀvQz=8E{n	5\cf?g5>D$~Rd8<܍GA8du6!vj"-έō9V@;ى%.S?zʶyD&[ζAH,~; *B;)oq):	.ܹ1/*.1Y=(9!jb(
<|'-P+ׯgJ U6^?j8v"p̠*ӽJ)y	D4?DPLaFܳ.˄%[F{1X;ml:U'ǂ'BӪV)~M[ozi}gmO0jv㺬4?R|f8T^lsދvGԹ:l4ZNm./_Fa687O@p\L5vn6~ky-Lh`)>s{Arc7os;u,N]<Ƥ'u0qbyh{v2LSʳAŊ!0$3#9EV=8Dp)phzmj\#?|~U͉Mr͆$" i^SD\o:Ϳ>
gNM
`Y5,9W!՟=TD/`N_Fp6Hx #5ȣ-~J;'`:ʽV;򚬠:u^eK >&8 csL8xoG?w/oz#eH_Ӫ[ ]׼wgՖ&sB*qWHvQ>A|涢0⍢"@%&`G,iEQd8}|ń/c<[9Z@[5ČÛ;D]A6-|?lEӤ_s?g]t/DS	\LY6oK[M{BvV/yvNs";DiQ_3ʸg1<RG_x00r^xstq5[4vN*)j6[ZɁƿۨ;yWZ%AY.hݝ{;?ljW3cf֗ș#
VRD"F|jv) g["hۍzi_B/P@5cs޳>]HKnwo542{WOg@09{WwYs_m˽'}<+rp踍4˳;Ϟ	Iw~{bO׻ϟO"M~Ռ3_X׈nɫS뽗/_d}W?ד^'\ݽ?n?3WӊYIhI~xT]oNu'V;2ؚϒv?Dc,a4m'B89߹w̵_-i
?K2̙`Q?{Ly(L3L]Y(ݲܿ /%J+S׫\Ŕu\`W7<x[@?w,+%cŷܖ߃]l0(~]&^Q0`8Q8W{/
?-ceI,Im%?ݍ
>}pvk^@K4Ң\#GuDƔQA]Nm8!S")8DiG~ݧ%RquTMGʚ(8epojAE,`^_[6L5W7W6^GZS[@l?x#S??q.&vyN5_9ВRs$r(gA̻[Q#9~[k<(>/le?;-ժxSl.m]mj\q=vFwI,wt$_nN^3W˾_"J-QKOXq-QM ':TVjwet8Oʹ}OzUJrfu:6w;w/Ci'X$/Lufu]<|mE?bw\g!#LGi%vWS V
/Xd- I¿kWNnj|p6&e/EHJeAZGYߨfN;y}^=eQO,LcW~!߷~|ݵī$HFG5DҷM.Iy0LNCO~<1$7c7~߱~<Ta E<e=B}'a8v {4OA]w9?ُQ8d8(^(c f{`t$'~iO/=ں	@ˏpF[EcDik?ưr%[lm0<:VP9L]O<
$}vzũ&7'$
g-hiL	$o`߭
yF'5F*f`ȕ߆uhp^@L	`4o|6@` ^Ú-PpYkSZ	 3v {ۄ2kvYי_YFR!l*;.jf9K yGeh7Xiwtdou9rpJzW8f 4\1Dt"n<DIw> *lpr$ 2ͪLu:ȲyINiI(93ALiȟ^B6Ҝ\l{oaC//b.2;uX<F#V8'UNpCm- jo4l#Fxh5 +I
jBV`)fE`\zyi!`izh0Nq~H@ql֮R"j 0=_/Tr@FGI`|bn~NXgz]+s$8>
ّ7f@	],θdx3}b0Ļ,4IMޥFQL,dL|&rgQI2XBR5{%[hm1CMoƑITZ3#3hՄg:ap#JVpi`{2N#o}ne&#Jq4,[14)jvZ7JHihrǺ^Wl+f봪pL^m

bBC5 p]HM@h=`jfRR3 81ӪWNY>tjm:]iUkZzr*@NS:.:9S8sCNn6nZo6:C0ngn춚ݎS8C:njihɎ[ {NlKs{m=s^u^F2{jvuBNj֓;T-z n$ Ӯ6=ФtUv.۫vzfRz=xWO6;Я`!.`jM U{]5T
	r Fz8}сhvulݦthاMirX=v6q{j=P	T-nNvTQSwVBk@hTal-Huf] ؏j6: {}jt@ǻ0sh",_T-Ѐ~qh6a -(;NA6|4z-Q;]%qnhtZjVdծw(@A	lRNC6;8=$s*@mq6̵AD ݁6[a'8~h
m [Gi@Ln6n:0, =B"PS6 Nv8Fu$C,b f&ZH`*`G5uǥ1	2C_]knUB:
z|C鶁0
chZD] 	1t9 Z@6Ь@NQ 4ـj@0MM#FvEj  6 ("SsJS5xP2C5Z3pBuuL5q'@Mhg"Sh KR ʮ49U"e[t2h CdLl7n vK.@JՁU]p`vE,YUjKeӁLMq<A"Ma;h(VK	 䠝 {(z-o&-ZZa:pk:p۝n8;`J8D{5	vnRm"k v2" 6G) ëAv6A4{u*A -ABV%uH+kԄ"	0	K`l0`.d2&TХ(C37;-Ҡ=TDTHs9]Pw* 谇(U:hG.pHkP	ühC/pp0e]%vфCˎu3A{VROzݞ%MFmEajBr4Ğ]m@}H-(8lwmh* a!-:`hжk5ў6bCCv 20R:@1t.bC4!5.7@2pX9-c9ͩHđ<iMrhB@J@@'XaP[]F7NOKFsC
R:Pu_h,38#Tau	tGMO=0KBծ&f vdƎ]
Ljpȑ¬mV#>-d.F 32:·ܐ5ۀ=d+ GY	gЈ`4mwͮ1NJ
s?AA)yQJfq=z!Z0v';0\PӋ4Zu09ȝ&8頡 Pqj  9/]h\Rc1Jz%J^@լzz!{&rE=	ԁ. ~vhìTKq64Z,#7@*pp`RL9d4o|'qQh^v5>izkD-KAѲ*
"S"O>3fт	3W!f4b mqK3hN*5ІoLz4YDRU
 6L}` |QdrBgXfa$ه19IZfCRuEC}8 SSѧ&g&֗>Rb.eEѸi6]ghv3sѺlL&0Gng>%3@ }Bzli5RR5P1C?I?d
4=MᤶE&>̠\〪mT"uڮ}9n?k05	*:Vp&TEiɩC0n:C,xR ̶&u@$p0&l Z-=BL ݡ@y.: i@x.vp'0:=YuJi)I }*-Џ8[h~ܦFN}(#aC}6|G߅KݩPۦInp|=籛~<>]Co!TBIc?En`FPm2/g IfqxoGM
P:*s//,"eдb7GEXeIV!N$
D\|lKbm(p8P!⺍HETJۃ/d H.d_@x>%G]I8wT~]ishI	+k/NX6K5@<H a
$j7pc$r+堎Muͧ$ㄲEc)qnyT5=yk_[:nǫg`h	,iJIm`s,-\m-vxBM63(ݝg;,A6޸7x'?e\GF31paT͇R;)v7ҶIZ&Xkr9Ǐh6T>܏j e__lUzbaZM L"֒%56w `0JixR9;pd)ZL9_)|!Y8Vϓ 9QXaċNp!	Qߚ/bxձE~9qp(R٪U*o	9oMKy.-Ԅ.T,>,TI `ұ,7MM oڷh_Ri ֱ*>Gbz7a]m-wZvn&kx0H`A3 {i$ͦ[gWOwzH}&w\а6uk";\ڢ1mpf\3F؟]UCr3? 1u957̢laƣn5<^Euo"6]GJf3ge3R!c	~Jρ1zM/
w/]ζ6kyMOkWm&$]W+UV<+ps⟳'|T[F?^Y@-  LXD%ˏjbyt<=q~Oo?MׅI~5wP'`&3#/>][8">?z7Y!cvɼwl4)*hs^ڨʞ#ot8"NCDɊF)LxIY'V<*ä<BC._yϘj6DMjC\j)qg:7o:e!IrJ~s2
蜳u֨%v%!d:K 8!410P(k<):$h\is/Go'oT
KCyH|+NGiago0vӘya\m@I$Z_X[*68X	@O|Ju|	YK{uCVX/iB{?:J"ov;yx	?M*d?d$%ȑ(Isu  /xٛ-:)WU>"_9ӌ S8ƑEWwM`r)()r9r:`N]NYE
r|O ]'>H뮖Jծ)'cU#pSPjD_&sAj32LsA.h:զKK>xR8
!SYW(,w%̋AQ~ro
*W8]^{1& /'{6l=o6yk6V4Rz+/z#"ch"<k  i
ϬcVhaQtbP8GrĈ7Z"3']^*/sAXo}GK9g?29FEGxЫ# )V]67
㩰2%cYF1_ojoμQ02Ze@<<g`Z@FyOdokڭo2C6Sa4ʿ~+rD\D?+I1h~=r{Z1hZ"Mz5_t<V3fdY~+`((fU!T69R}lJ+Kk_iMQKu"ٛ>{LfrT7x>pkc46@,4`R!L"T:#!JдAJ$fVQ
1~$Mqs :̠&>{>">lUFGF)NVc4SQ$	).DxEo(tc]61J $Ve>*T$&uYkHHEP7R9bg-E8HE{B_t(Y紟Ζ\c`J%/9RoeaΊfS`rEwr@36iϜy3eJE,J̢	g8pT'2".-3Ubf,S=T5gT%Q0
XØhMZLCzA6^tL.)y4` zzv.!w8S.ع8	Ϧ= )Q`GАA/j飔H_@̏ALxPkD[}ŧMU#D7$ ;:9ctd܋Ǹ
ZP(b8NZLIu]|&R&J1RHKeiGu2^uY _m>μ`2KG3@8`rϘ8>-ZԷt2jZ~	[jED<E~ɜ~Fٯ;ug`vRE,yN+JCjms׮N1uf1!	A)NŢ|M_Pɫ-bv21{s\U7e3Ӻ|&44Hd&f!.5ñBږ"(YCZ%7¿Ӯ8Yu?cNJu+Zx;U l3V" _1hl
K΁8<U'-ܲ*wisTZZ$laR9Ӌ-%:lt>K ]ZT(tx>shկf96נx{怚Sa
1`hܕ@L~:e7NSDY&Co=&<3pB$ޟek* %'ơ*=[
mЖ\FeϪ5HyLxwLchlWQ"DBg dwRR@֥:UN+K|b71O"B=G<%vS:\3l*Nu}rm"ꢇhp?<x ā=?v[mht+zt71^Q$P(bajN&E޸+#$
i,k{5Sh4.`rV.Hώ¬~M"$͇|4x\c?,a]	˯""'Fv_/ee$&L?E8#?˴Fڟ3(3<o8 }vm=y՞G]_N=j kK	7в+=`Um,[%M(;`X EU4	=gay|A>l.;O=W{;x!]hb:Z&0%;޶qӯ`l|i.E69")\Ւmmm#73$%Jc;MӽXgJ!_ntvwX?:1Pc)j0(C3_w?/}]*7NФPjRJ~n ,];@6e8-`.9\ќ Kt$uT(Π2ɦZjYz:'N%?=*};[%<z{2dG,%	azၼW7R:M4kaWޘ-  䒩TՄzmek$')НæzHZcęxd-H$ӯhзV -ܭ·08E*?]9azRVѿ"3"DrWtC1L%7	s -lbAZJd֭РRB/Z2+NާG(edAxxya(oQR)vG6Uv~+ ]pì=vW5B{Z'Tw`)l^_WgO{k 7q(DS%v~`,42$DEa=Ǧ6TA@G?7䛖ZSPnK,si0r;7H?GtM6^qD7-FT_CVI輮:IyE]#oooDcMMid&MŐ;H{x^wQ>q=792*fax<A@7Vrݱ1<G/3gntlGB6oB%b XA
IvqZd76|TQ'<ܯE;Ll9d+ ~:,{{Zs0i epN -Qy'RM9(鵦xz4[EG/'U5J)SW0Xܦ9̷
dm W_W
iʎM_pjҎ2AelԑL\q~ el;AO@7vI	U	gԝ|qEK~؟i{Q:F_,D	ڕoH ?%plz
P&qyB֖'MzǢaiG&7$HT7Z\>ʀ /4t2iG`I*6yGZ__z=jfSf篮?fW3n)PJZg d
#Hf{6>^wK?f~U$Ah%V}PiV=@]O"vt;=>`R[\қ݃>hX<#rOa+"w۴sɺGÕTy)kpFova>6~}$w mÚa |-ʵ֊AdSAlQ˳ۍt/.J&7psH='C>%:w(W~g'LW0ek~z]ttxD/;#	H
(Orks}vVYbR	a!xt$XDqwRLPDiF.F Nlw7$a&=&GчC;rDlkmt%V TD;)7m܇y^o\G2>٦>ljXXLMt^+%D%4<&|nJO3x1)rPSn9g%}cߺNKuntեW^w:US"dɍB6dV辰`+a.r	-hG)F{hWB3ȘmEt
ҳK:y?>Z_Cþ(VOVcXh$55)DbFsotzq|EF_bgָFRsnGTZD-7Mo,d=eK 1@t nO7`=8h$1X#Ji>d~6CؖV.p1f,}+?FQ>>tAz3 [s^]߸)&ܯd)iV8w;f%bi-98mA6sDi(p?Odq4y	W%ЉoDOB,uG1b޴kSJ*"ԛ(N?Zx:B`OWPB HNj1hʍdwNŧљ>ogLi)Qj	+RР\Ar	SvBmtwL295T_?E~vy.Д(5~2K̊pbdNy>G,eR%*gӥphQ82?`'F쎏},k+$^6@D^NY6ިnS7x7v3'( &BNlH 4k+f>ȥ.5o	t`>6 iZ	)~  7n_X8C灐Ca]0ַB@b	M0:Q0 !g8e∜clޭ}v$ZtݕHێR@iq L+xEa> ZP%a2&*$.ěj̷ht(d"*enk:*OԹ-d~>_K-Ig	ɏ&Oja+`gZ//H:sLp\j,Xq*T
UBP*T
UBP*T/.  