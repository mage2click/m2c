#!/bin/bash

declare -r m2c_version="0.2.18"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]
        then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$(m2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(m2c_msg "$message $(m2c_info_bold "$opts")") " res
        m2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_msg "OS compatibility check.................................................  "
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_msg "Docker installation check..............................................  "
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_msg "Docker-compose installation check......................................  "
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_msg "Ports 80 and 443 availability check....................................  "
    m2c_loading

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 80 is already used by some other service." >"$m2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 443 is already used by some other service." >"$m2c_log"
            test=1
        fi
    fi
    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_msg "Locating archive.......................................................  "
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_msg "Extracting data........................................................  "
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$m2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
      ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c
      if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]
      then
          mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
      else
          rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
      fi
    fi
    m2c_result ${test}

    case ${m2c_os} in
        darwin)
            if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$m2c_global_dir"/mutagen/
                chmod 0755 "$m2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_msg "Generating private key for CA certificate..............................  "
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Signing CA certificate.................................................  "
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Password is required to trust CA certificate...........................  "
        m2c_loading
        m2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
        do
            exit 1
        done
        tput civis
        m2c_erase_prev_lines 1

        m2c_msg "Trusting root CA certificate ..........................................  "
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-certificates
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust && sudo update-ca-trust enable
                    test=$?
                else
                    echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log
touch "$m2c_log"

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c
    m2c_sign "m2c.test"
    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"
    m2c_msg "Mage2click toolset is successfully installed! \n\nRun \`m2c --help\` command for usage information. \nVisit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log
    m2c_load_project_env

    case "$1" in
        global)
            shift
            m2c_log="$m2c_global_dir"/log
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up)
                    m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|down|info|remove|restart|start|status|stop|update)
                    m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 F] v䶒(
8-o)]LyWU-ʶ붥vLJddJ%<0su50|MD  H*h2@ " ;ݧ}lZ>vS<it-f;Nq>1^ċ  aS4v݆]<pޏ>,;[nٺxo`st#?	I)`o6[Nm@770lۭ6ywP	-Uhbx6|2鿂orNn͂h7ӡ=~nO"?*` ]<3^gz4GYyM]Y0./1glN6vM&؀%!|o~2G~Έ5X1orԏ־dN$	&',Hbљ8
,9bÂI ّ?
ϫ? 0	cIh*(y&ؗgߩOsax2R|wkЬ5p${2;?D$"8>~&l5C5f@ߜS7*fa X-c1}CsQ[ uVwog-	ǣ[co:9;y7%&It:&0xm4I>ʻ~cD9յ+bXa^c1^	~l`F]coJZ2y6$8w23&~$AaQR9(8pW>ww~~sǿۆ14}?Z;ӵ~eOF7:z`<!;8ʁhu5 
vpߐŧl4d070K/=#$Y;ֆ1D̋&A|zٶYi
4kN폼8	ELօ2Zo6oסvѾd@d@rT[H%0.qLݑwt$_&7¬A5d@6d@6*
ۦ"d׈pG6۬T#Dl0"_Yߜ5zZ/u*JκO*Z
uJR0D0W^'VF#>5p9ϛq]5\K,u{g~Jg I`'.)3ES>-KPYSV$Qc?a$l_^;;p򊦍BoxMR:zJA?k9lx6fQ°}^7XĲRfopϦ2X-[	VF?`#xKaD}ZI/&Z_<^t3̟P^E_1 =^y3XjwuU]2)54o;X s捂!y|ƘC'&d+79
g
66e󛭷϶{]\)Ԫp.^ݨY9Y4a66iH+oɿFC/\S߀ip7oQ%H#mݕ;'ѻP6Pt[tD0M' qV'gfp%֦ppp1A ڡ?&-kbIG,*[x|{-#P!Ʌ [$xN5~f0FIU''@bbݭS
zyJ8ޣCt1dT|×/]}A%	PmNeыߘd&p|2OpH{>Gj	#e~)rlF@D~s~wA`NH.u^zmɂ[JV$qJJ60 X^/@g&bp >iArTls=`Se_AULP$_ń5^0?$&\L[Y(qNΒDyhFݫхy3FPz*/8닮/x+a1ΈQ%% ^xfQ^xO+mA\bE ]% rwE@2&76/Xֲ}s7K)4,Zv8*$H3%,	/ٜ(5cSKM1e:5c![ YMObN6 }] Z3|,5EbΛP7`E8*k8>AA"/4hkgdr]P]h6`? *%PJz 1cvG>zXfD#/6A~YVg۲NPe[9bZZ@qG	}ݩe根1DW*0F"h^3ܗQ- |]^u'45sItv)dˎQEغtxôjƟg{fM鯷SoSIl<	QSB3}#
oʩQ8|KQY聮LT#WpY L8`J,k}+)a;5?їI4Aኘ-Q7!ڼJ>>;(Hpd@޼|:ϯϟ×f?6g|>oBD3-a/Ta(S񣑼,KHS2bKYEul\WƹT,qbVnJ+xNjuG9TBr[Mpm83Ep _vo~z1H@ާRG,ftYPMqX+d®&ѬnuE~kxT[Dw {~WP;Ujه9#OcTM(*ht DH/7.:tסjr@=El?̂}O+$>@VK@a&'yɌMyۃ?l"5hf5趚0lv%R[-jTZkcMnhw3([b嚥y+]1y0CmM@my+coyީvDj9		|7I©/TYiR[K\b/m|.<\1IpŁ6w?b z7٪]-{/~j4o"*Jɨq"^Ɖb}^<;e>&XyATx6hTZ:a,>EY^^
榟\6+%
9zױס&G8+b5|K+[.r	ixwSn(%'8'7UTpǀO ʗƗuBSAs)/2r!(dz5m1v/Młj6گm|et1Z^W&6p_n$ė\7Iu|7nWHӚޔ~%
 i,h
i5+ѭzNdI"Ia)2u_+L
VRf5-DjIOѱOS%uV>MeC!pPYu6	Sk 5U\/	)L9o
Š8zy%;eZbO0.unp-\-g\g~bv1U@a&ŁoE iGybI\Zf]i]k꒥%u~c{ﺟhm]k0ﺓ[a,T)}.3̀5tWĦgtFi~6frVtl"΢vz080J[Q~M42NxߎY+;-}U3(CÊ$l#~ᗗ`iWW	&5(ky/+q=W-><1|Is%ⶻ:[V[Sk[Ok|8ݞ%5{#׾%AFU/8NO0]W7J!*2[e#?{5cۢ	^9ڎm&O.,/v[$QXio,. UFJL;iynQ"urV:)OOi}"q~5![E0'l^cyѻp8HPU4D)2HS1lteʩ[VN>r1hw+(\p
2U©;Qȗt$N
YEHėpfw?Qm-|3ĩ]	+~;h&$?IP3O'qS҂fm*ǜ Ӟ+DklVE~n$I1op0 V8Hع9>9ok%;#X]ְ{*&ucKܹU}e?n'HsQ6-8*~ufc@# Otc>A(<?{3 ir%pP))0|KOOp`&!^_nMkNxhwTRrLf!G! Y|,=F;˨Qt|>r:0yGf	 pS.FV`W~)3ܷN^4
uę76fԨ ny2Қo喖$|$T1Ύ=A3y
B 4A*I6dQYDOa
gѣOf׌ԆiAR%QhD?[oYQl9x,6<aoEQw'iӺO%̍

rv}1)Ђ"T܈,pK[L)}5-E[ЎxXbqDvF6Rbu8	e`Uْ͌^̠T塙 "jtvJҙE̺12,󔚰Sw\rM_3 iN4[J!RQ,̛Hd?'#O A6|hp~q<?zÃՂdɭQK ՏP@82xRߪ2-HZd!ƏY|S?"4ȃ[UgY`{;WY=kh i.k2^T1jCaF1n4%(X'#G8;0~5L$^|Acӣ f82Ġ8}<9M<S2o4^2C0x8šm젃^bb(6C3%Ԡd~# rfފ1UL9p¬ODL#cpqm#u=akYUQ)F4M׸R	/A¯Jjpex1gD_P$E&%REPa=D)q71ŘdFZ*p'
'jϙ)_AbL1f#fb<X!@<&'Q2TN&mWvR9KxĔesSmin4q[2VBTho$&71S#"#+$Sts3_Ic
)DJVY	Y,zy°T)i9W 7U 5_b20Le׳lCRp(!	νkPb#
5;F*8UBhnwy0HzSs0R?|G4G6}oWOΪ }VСX[MZPtAG~6 .p](L"F¦K lqA6RjW4j=~vgG|gK|6ŧ@@WF@bVt}i/-)4W~q3x-k:dYA
_|y["oKm-%Dޖfm]Jd
Y />ԠajMgI&̍t,^~f~sKYJPpSxn
M 2 N)bYls./KJtDoN8QrN㈴,x6o!A4YJ,K(-Z&%Q2[hA,FD;"tӵ|L#OOY-Kަ12jھ3<}`'wilG
Ӂ~_J<a+K߅A>K/Vpirn܈UrXT? _gJTɔaIL@aTт7WZ.+GKN~<и앉ܮ3)>12XM_~7zP2'e'LLqs"aimHDdt
cn]{7* o2="vļ,(jX/$fI4|jҐv`P`ⰐW|<íTawʾO_ W%14vٖʶ/Qwʺ2W\~_qs{'"w/=F!nIYWƻ]](eOƒ29~]=3SxLT
Z|k%)c	y?P->X#U&졹.s9=cS{rקj
L!	K<kEy1ƟRGj5`7as$ZRg|F6W`o7R:UbTOaug)>jnjj)7snNo_Xp7z{,z$v"]֥:w3[ؽ#糸Ix3YAϯl5~`yPC^[6yq#-t՗i~!KN= 	2<?QrD&ĥ2#"_׀.P5[bǂl!t>B3՘F2&Kg>d6]6XDyͽ#ve]&|^u5ykSYDou/d;6>R8<܏6F7vo,uϭn[n nуn]jsaw2^`cyw'u5-aZA5&cjej0}'b-6KfE#[YT0yon6-_p}B7 Bu:As-I
den@uF<o"zZjem76ŌM.xb`2}Y	V	R
];\eqE\GV={YG@oyW@ԬyʦOP{9:*Ys(`)9hU
Hm[.B8`3g~S,y11fUz>ENE7oڽ50+T/&+\J|l~~h0M|N\*o@qRЛ#q-N\W|eZ~/<}o7M×I7^*d\T)x4[ֹ@5rgbq|@9[,,QWs_8Q@-"0w{@b1yCeȰ<DĻ5FͻBE`'6I*ITBr)jP{sLܡ+GKD*4 5*Lqk<]NUOgGt6?Е?!ߚz+iK><^[S,ׯB5*\qj/ʮWlJJG\=_159K3[;+-)PBDS#ߛ̦p;av`wzfhg}E(-f4KX^I9<L`Q!B݂+ɲZG5=)(iC*AKz+s:x62od`QSᑅã8G+c?>?|fgWe0~OJKL8>a|\:~$0bcGA'f{oF3Fݢ>Z-|?W,G^1.@e^xD03ypR%h}秽g/w~6Hk8Q}_,hgEy$>̮.)^d&7 :ToY],bzu'8,˻p>dD/#Mƈũ?KUWgw #xܭPg8e> dF<@:1ҬjZ4ә.A5j?k30~s1נ}J7 !ZG!^J2+44ԙoOGVAպt_SҊj8/}3#EƠc僓Pz>aqP`fAIݫ:>אj|~:*0I;	ˣmoiq(FDڦ0-ɉA0wlZy6/C9KnXoiudtɼ1Ǘe3הWmzpxuKlX:M`v-:`v-ena4 _9dS>
J/A杼2KT%Y
ؠ⤛m3èPi><Ǣmjk~|UŤpT)ZOzM,/UXH_G	(S[Rwt<'Eᐍ}oYhGn.5ofl)?W(0592Nd~	Twý>w%w˽OTD]]50|ʜ|"*7Cs7-w^j\x5I5\'(sטrӆUQaE4`+qr˶ڵ{GrAdZ<;HNM̩Xyf*a) k)ro	Z6tfGuaFgݷ UVoli2|C<S&0\ߤˆIL0f	X/I2NU㺘@o
"Sb(ql]:pK+`Rjh$wPҦdhgGlyrkqoG6W3v쨮-2Sa)8ŐE#[<TtseM:jHA_xvyIqVbr~]Zı(̅NQmF`eDVyhо<ι.Uii/뻄s^S58EWz9K₲}#MScVm82(5g_q8PG>6CUgs!t~ɚp0rB%vktY0qP>ƾ13\ՍMH7Į
vz	/U
2_ۋq뜪5ɶ׮iS?MOp.oTc^w\t|g~*ˣ]6Z5/bC)wBHe1llM1ǠL)Xo!^F%?~
`q+0X6MD~,( n|bb꘷݅t]W4v8]Xr.-|0>қ$;}[@%MRn~FdvVԋD zq>Ճ^Z/ٵ8ԂpǭP_rЊ4aA7OZy/%ύ.2GI 	y4{ܮudkضR ZPˇaNgңneXB*YaB&1&aYE-e{TԖBЧ*S(:.ifJlT\'Ex\9,8`X.])ʵ#H?$mcK՝n7󫼴i)Xuqv+emI->8˥Ek^ÌQt'xm.$Z@R!1cTQ { <&|HZ1<\y7=yP6ջLj7#4w?vٵ+PR,m+nJ;MPjIQb*/[q^Y{j˃MrX[
i\X"Cڐ3aNDDuW,pfD;r*9B\,0T]^mUrU>W3^)\}}}67`Uy䫒x?A@KgãKKUZ\f俔/G֮pGkba{1GjncjUF
5)4,UT;Iq䟕iNnz#o*	qC)I\1\zkdsZk(,wF0ʾ_J+"=KF[/^f
V#K`TZf~,j:Zeq6O"Wyo~eG&=2F!J0Raa65Һ|<q2Lﭹ:9LrG-u9UqpNYԉNɗ/K!lao3ʇ0JϻߚW\"aҟj벎M}WYͥogO4"+{a[:_tNyWa=unӴ,q:@Yt\eI|r*+*f>3
6c,dӞ"Q]@!]q6Kt3uZn7;7anZzznVkQozs[^~-Ûhٲ4t/wp2F	&B (->R<3+VJH-(l[ TIbŸmOnI\pyHryKagZ@<]Pʗeq@:lӭFi=wqr7F1zo#F]6܃aJ4
)iudwk等=5Ѹ`vկ+KȦ*ZyhZNЅ_V	pVplfCD%1(nґ}O茛3s8'q6uV5xv7Of4{s2GGHv-JhB W/+G*UDE[Nf7md	mCᗗxAQ|ߧuWWX~#=UzV#Q^0SJӛuRզH{E-"Wf#qEm%!k_yʃAk6C0$DٌX/[hD&&[s:j\Ŕx!ނyXk[A\MH^]nqYc)Y)z	'L0{Ǐոwk* ABRgNA1*-y\NgfCCLgunx%de,qjρM<e!Kil?H_L"[grC,G\xҏX*(%$WM_(23?|(0(,EΟ eDTߎֶf;-e8Nv867dY!ԠW$1HgSFk6W	4&~rF56(̣.@EX"Ts$VyaA*<	<3Ipgh	UISor?G"@zM9apB&oQ(F*i*L[hg1g	<_x!SNY,CKS[mp.h0)f웒 &E#^/MjA"[5@rd r٪[R/ZZ/?WTR?OUڧGjTI	\%^g0%0͍/ ;yč.x3u|Jφ]Jԏ6\2gUOMtY038"}=t \)o{͎,N˷IY\lwqC޼U5fqB4Yc}SR'QOV
Ns)ҍ
,(ʥ+ݍ'/WDPI:gyk{_5i듲'9;"5!3͈9,۶&A=w]q`a/3Lq{1Y8k=]\^R4ʊ	(S]\FWẐHr8N'D2ߘH.~"j4vkB
y$W GD^tT(AȤ׵D;V3*;|sQt
@&C7>{&6ЃA2Q&ڋ+;?0n#>}qEI-À9I!-}	!%+f"5݁θ f*xMRpƢ(m(T6
*|Sd<_"ˡ/ڢG(~uU_~3߸2ʡ/UT~BYFR5٠t+2W6UEqS^}
r0(WZ?Cc#gʯn,~ d2\Vf\a[+Ή]H_fɊġ)*h<iKΛ]}-p~K]M Hf}^z.)~e。b)^g-v0QWVPPh@KߤЯ{s"^XFzD4e{#D#4pD_0cGp>0ݛCPzF0Nj̯AY.XQMYL##MQB4/	h
Ku}59O	we1zQ֚b?Wm]h,]j)/sSs|q]+ܜxY421F)҂Se$ҞO鵧1#A\_Y?b]{Bˠ|K^8كVW}7wH;O!~+|d% ID-3Kl 7N3
|[?lKETsdzJ˞׆MFCXcމvuH/4|]<ͱWW)-1\(G\V\1yt<^шK_%+~Pn.(ef/ޑ7S !ksY*4(#S<lxF@\Q&|~?FokJ~n/icP-x7`~rmF|*3%>T
J  	/G
qYd> Qh*^ּj#Wq|^1k^gjH\if0eM~=7]lM]tR)E,kTA򉋥psV\rKvqJ*x	/K eZB9@0^jq[&0@]oC9?GUAc]ʹSXF@d1`!>ҟav.c/>[Y%K#|]7Zr (JҠ0gqn|+=O~!AQ4O:0;8WVV̠^!n[K
?}H|0fߡ?3Av|E<CQb6Al}8
IV x`J|]yA9wy7j2ZSjQ=[-[KHJ)WƵlzy9'ٷeNWb%}І5t9|3Q:EseZ@<H<0fYx2Fm5[-f8LB]#h!'2kQ%d*Nn񋱊 ,dqa%%}T|@g[jc{,u<4@!YxR506y =9&t$rx? k%F{`O\%]me8svO{
͇3/|`~O<>1~zS)~H&ﻋ&`(ǳ	Y]1sC^P^{,wx z$HNgGx^ 4/8ϳ95#ݚZr~)ƙcdW
O ogE|?͐楗)nǁWe@o۳8<h&-,9ec?
/)|;"y5d3<)9zn.7g;j7JQb|I|HlChW|&W?k~yn˧L]{*y\*?j,6; U`[ٌB 4"/HZHrɍ
-4 s6 h.~τ7vNlДHGAxyCZqx.lqJXӚkx|7eF5uW]ڇ'sb?`OFykkWŢM5"Z޲)`@E -拪qfw9i`0_d&^ϙjmAAڛ+aSAs6*a.&W/R(#$|+vI/z)Hݩ}Ԧ{<f6!C	b]Ĭn)kX0!01WKv]+5;۵s8L306UZBzG!Y0Y-q!@Z,\l\	SCeMȤ7$݂Bx>,+yZ5U{1hun_|PCy y(^G6EYʜ-y?]͹}r_)rgGǰXX~#dLԛ F[
3l~B׶^ǣY>u2ʶ8eν\vΝM&usXj,_r:2-Ƽ0wŽ/G	7_=iUq%#!I#"P\M>&mUR!%7_G.UYӚ	 N/߼zjQ>
'϶ˋc&pwWbXbVqSv%p~
qE{wn/-7$Վ<n~ϝO!ca.Y=k&ߌhW5ΓHt-pzE^sd'$Q8):$:I+yK1v'/z*n[GVc^>o>G 1 
q|^ӷB=J{f@6`U2/jfCt~[<*e9, IE*6A[ozYH2'FYvw[pun	a/3-4[<'Cw&@m#Z<~_Љ };E~,q!탫hɡ7߃]qPE8sɇτxH2鷌 N	~Cְ3-Uun-ny6mN\g-u[%hSC2Yb%DB
gtt.zB뒆@?FVꧾ7JNyj_L8EAǔ_ZYi鏭,ĝ^YROo8fPsfB%j"
(V@ne=څ߀6:UgǂgBӪ2SVj~mwZ-FmiM)4ZVǶ۶li7:ZJPy鿟y/ڑ~NsXnh9Ѻx?Af4OoGٜ'-0[;0h`JI>s^{Arc7w7'_Y:vrt<*Ƥ'"N0byh{Ld,8%Fgx+z20|CfpF{*J`+I40bz_IP'G~f^6PCeMC@{Cc&:ЮtCΦ#fZ0=YsS5Ưc?'u&fu^ܴ>l3<j*GI[Ք	`wȏrk^Ǖ{Aw5YAu6!vعN3 |<Mp8A:% ^{瘆q;jToF`?v.bFUY[nVG8;S$Z( >i[QjLʂ_ pZ[b4G"Ǩ n~lg){iyx+ȦE{o'-hvυg؅/R	\X6o.-
% {++ݗe95se9r|HG(
BRe܊35rQ<\.9Ben'3͒Vpu,N'7݆};_MhE2fSóovwmek]MLPSk/%3G8,
癉EfxS0 nE$mvA?%(ښ̱diynΥJ}xr=ܫgP_Lmߞ`+ջl@Ȭ>98tF;?={sig}??jF?9]~JkDUޫWoy־_I_\.	WOޛ?+MiԬ$}4Ӥ?wjRfoww}Ǯeݴ~U3bY[YwyǾZ㋟7{?̞4X('g;Y%-\ag\931co)S dI+ŷ[W9$E1DiszbR+w08f'B 0s_Y$WK9xkOǊo̹-,Hͣ IM`Q8gm?~wS{F?B.Q_g;(X&R喗%5/$̫Dt7*LpÝW/x	-,Hzp	SGu;h>eNLt/._|F#[t1H'ǵRY4)kYkxLcī1Y'-x}YvoY0!֤^:DrN^xkMm9J 9hϭO,؁_swJl$Ci<#b]تb{p\Y(Gdi9v?n.kKv[d[;*WjǼF`of=E;?Ӹw̕WR˺A"+V!bj{ȉ1fUw8瓅rn(oӡ^iGn^lN.ܟO2$zRoE!DmS7ۮs/k+2W2=0<	}e#h )FRg[]NE)LcMZ@¿k.~4cu>t;cKsRYk~Me>XͣY߰[n3'[n~ם<xjϯ1'kIO*{'4ēC_V"^%A2d70= 
~,䪐=	[rGӢaLIw*E@C?Dȩ0`Oy0"J!0A;YrF
Ч .K(zt\s/i1 q0bpSo?*扃_vnppF[&@^Dik?s%[lm0<:P9򏡌'IɿZEf9nhm8Dl2ta6+dSB=>;ya<zUc2:v®vިI݅7rwm Wg b.N@EQ+1  ZlkȲ^K x@֖1ݣ&Ye˺G@W7eSqQ7i\, ΃8mw>,Dvź6oL3#[|ˉSZ~дRqx/8M 4\1Dt"n<DIw> *lpr$ 2R-,t켄ȲyINiI(93ALiȟ^B6Ҝ\g`	aC//b.2;uX<F#V8'UNpCmu jo4l#Fx)h- +I
jBV`)fE`[\vyi!(izh0Nq~HZ@ql֮R"j 0=_/Tr@FGIȞ`|bn~NXg].|x́	M\4w5hGVqn9z$3.L?L!.<My"wQT 2K0:\YcyPFgT e'wZ6f(ң	8:Jkc&#a\#U㺰1Z1`Dw.lO?Wd&cJq4,[04)vZ6JHirǺ^Wl)fj-mm&bn:`ۀ¨jШ5{Ȣ6\R!k)nmj`j7 Np{Zi4CnznNӭ9^ғPql<tZZq	qZi5܆uzv%w[58hNǞwfjv;Z]3q\`mu&$В2 8$Z(ؖ.`z]s^vd#pVmv:\]kj=t [Nivqzzr4i7{=vKjݴA. նHwǻzol@tBqjvq ٫NkLk6z8}сhvulݦthاMirX=v6q{v(ӄ*Z7{vSkhwի=%. 5[fRZm@AWøC$c=WЏnw܇HFt-y3&BȒ6mAC	m`GAitj8Clk9@t/iYV6!PXv'ȇZmvp5z(HY5 mk mNvq@d	Fi@Ln6n:0, =B"PS6 Nv8F6EB1s -0Ҙlhn.ժuL E>átM`TP|j14[.C	WtMZP]- L	h=@--haCdi6`4n@GqmdVHM]F@$u^ϡ1k4US?'z.%3t^h`?'PQ7ʔ^ y	tAn!(:lDoG8FF ]6(TV=70mmTJ-Lvnu1ݨA=L N-M
)I"tFWbNVuIÁQہdU9/IM2:xA"Ma;h(VK	 䠝 {(z-ovL Pun
	\v[-^Hmvm((ܚi9vc!tL	5h6AuAޢn6(&pk!9(2	`s@ ؝0zdgM@[7;l+kT#!evP$H'/iC\0V(R{@VhHJ.PS.Xn ͡pvFCMiwkTic "#b ; AE4{H&vH2HdT`uh4E-;EXIE>nv{Zf466¸Մ=6Hi=h#W>;	l[Pp8?UVISABZ:6`hжk5ў6bCCv 20R:@1t.bC4!5.7md喱l$r4EaLhp@wl94rJ %`t?`,}aFӒ\mдT*h+Nl2@}663`"AQT$Tj2h6`@f(Х[._jЩ;0yڢAl2#|9PCIHCp4Hp&NƸ}:0CyT$y \`m	3Q.@n8فh7pAFL/Zhw0h`1d	`r;M0q.AC@Ti Q,Csȃ_
6N~Oc,uK4ܕNiz]v{|\vQq@Bcwu}߀m40+Rqܡ(:9MV)Dȍ
&\0$,~A3p S:[,> &	lhׁ]M{OZ4QRwnw
ylԾ`ȓ̓f`}tuutH.Mf?GjluL5S51J!Gn&+@JJAai=O8Ò @N,$"0&'IWˌC_}hZ>ThD"}j"L 2GJE>7ͦLrF}.Z-W}0#ۢ>$fz=Up,קdF/:[?#8]P-Ma0_#!%_33CiIӤNj[dhzN~5fKi*(Iav0;,? ͆&@'ح*LӒSat3X @DmMaI:r`\AM!@Zz^ TCM8];t4AҀf763]|Natzf`7`_$+HRXS]=wUғ[q>~ܦFN}(#aA}6|G߅Kݱ[(AzmS
$@xxQ8u`r]XMb?_.!7t!礿΢O7@l#hyW3?x8wYd?h&i(epwp慗Dvf~̗Ws@`v4-1Q)VYD?Uk8 /K҆B_w6og$7Tn#p79eé7&YWn{z6o|%t	Q`6=U_,W{~$o-ZRڋqBF{.7#@X;F	F{aj~9:.p-vf))-(8leJa\ri?Gp駃3;j^%UEME@^Ekxv=%-])ML6R)&"j'dd38q9y%f\w4㧌HҨjT6f7P'%bF6
%ֺ':FΣcںd<: De[+Xex^r0 ȒGɤ6w `0JixR;pd)ZL9_)|!Y8'Ar:;£4&C~eSpV~}GV+!+n"<}Ԅ.T*|UP%Ufn![ѵXMp+/BKH4]؇qm։hcN^y7`]kY-wZVj&kx0H[`A3 {i$kͦ[gWl;Z;\.chXך]ρBa.\bmQ]^ZlLuEn!Yg;L?'jՑ\dn<H@fzx]}!h"[`ϱkvMw^u۬ql;l_* sl5sO909F)@Aւw-	V؆`r@xEʻ~Z0Pe#7'9{jhE*?y2($/X~\͓}cYk|z@<i7]&:tCL0ħc~7ZN C۽?uϗ_Py̊ܭXknVCP13:jyiS:U]ڨʞ#ot8"NCDɊF)LxIY'V<*ä<BC._y؟1aa}^d5*R-Yn4::e!IrJ~s2
蜳u֨%v%!d:K 8!410P/(k<):$h\isnF_Oߨ/Xu|=_3#;? eAx2D8?F>{ujN" z޽bìϏÈ, *黡/!zPeݐK971N݄,nC=^po>
Dt	r?py( ?>Ǘ㫯~vNn{U*+˯՜iFU)cgH"Q<s4JrSSVfQe1H;@aIRkX:\fs1Te4Ĺ%/ѹ Xx	s9Ġ\z4݅j֥y}s%JjUr<R)Ȑ)QWǋ,+t;s](ic?A97CNW8]^{1& /'{6l=_ys}mx'i¥V^F7D2ExXA Y:*UEsp8
#Fyu(Ra}V./g	"w}GK9g?29Fe'xЫ# )V]7
㩰2%cYF1_ojoμQ02Ze@<<g`Z@FyOdok+VO(ދG?g't~PW7(cЬ};rZ1hZ"Mz5_t<V3fdY~+`((fU!T69R}lJ+8iMQKu"ٛ>{BbOrT7iQ?{} {hl
e;Xh.pYC8D*tXFBbi]I!p"Hcd>WI uA%L|=}U|0ِ=TCM#S"h2bIvS]vzQj؟Ǻmb1
@^]I*Ya,Pj!d!1}BHad<_eI}U-rD:,zSϊ%ٲ+Upx]%6Gw6S
X~,lYYlJL(.Xhft^28S`8o,TDbdQH,_c0Y4av;JuY/ hy2;QO(&owN{2̻I:yHUӫ}K^ Ek>URb-AWixC/Ћ΃%#@f/eпֳs	Ùrt}Ix6Hu;}'
{Mpp>Jh+l$NшŻyMߧ^|xh_P0TXE1o8Bď|C#9N`	\0FHFν(y9z)ʔT%g"P|m-A,t[vĬkl0FުCt4y`cYbghBJ5^^D˯\C=Cb/Q)_2קQ8<f-odVR34	A̼SlBg! ᬶ]}H#Zv5f1	ӥ^48(^tLwyIT"bUs
|
դB&Kٻz>yi`?ZU	9s_P0 5cjべN`3>X(w%EïSfEѫ~U#[ضM~4"=ٚeE.<~HZKTEoUK885<r6R0hlܴ?/vVr#x9COr<KpMR~(J:5\A@V%2FjCC'^
p" b|1) abYQ 0eִfWy^=9h+SEȇ|~#s<vP#\;bVc:CFLvVX(>|Yzg6 eB t`//Zxhg)%û"/\&YA*ӋyO`6{:RMnMaSu(|L ?R=D!$7*To&Q gcnPo,MZ:XU%nI7z.-eICpǠ&O=лYݲscLrgGa~K4k[fŵ|Dx\cG,c]
ͯba4D[jp{^'wqerUn/X<|njNDxRͽP*d9xs{$cyzY:@tkv!>lA&z 7Z4⢂q>Cj4>{VE^tQbpT8X(#0aG}nF-[7&Ž(;6BBz0MDK2)QX9fYxa}Xc:[4
 o3VڝE>6ۮV\5l^QF<YAiNQ{^-JvFoMW`JUY!xC<`> &v%LdۢJ+ț2)?IAkI8*;$6ǡ RtDpޱ?*BȃG)mUTTzPN &^:6>7;iٙٝ4 Ũˆ5+{@f5{Z^f f4܆ +tz}x,(dfk[7ghZܾ+DUl$vFQMԽpsC(K6:֑'SwOئܛ%k4\MCy=#̺F@{r,AHOlYXЉMdґs:ijmoԮӰ#hZ@F$n6ֶnZF̀U<'p:@gv|koI \C7O\,$݋|ܰ:B=% lM</t< h+$:E£ѥa<&>F(6FנP##Ui%L\Oֱ3&H@Mt3F4Z^,у-r
hk«@K*	[m-t7(RFzg/A唂,oTfi"hڙPk^`#,vs8i	jJ_2L0t\Uqd4҄Á^Gm@Sp7in3媌Oԕ kL:lae8\ex(%f~ A]*֋filӋ.J20KkrǨr8!abM ,K\g x+7u#ZcQ9^fIY{j}9z<M.FY%
Հg+y6I(mfi{CI5C(ᯠ+W_vP̞߿{	mKߛ;[{1`x)zyJ.s䳷Ӭ7wu'wuӸ_hSێʘ4O[,6;X=^"Z:G\Vwޔ.A$Al T8о87huwP}wWtɅFEC}mmhm.^7	G^fOS}a<s9B˾	&@'c
K+`IQUBU`fUow5$aMD{HU3
Bx;n1Gd
x-T T7:zC z]~nɴgYl-Hq0F'1۝fr	Qz|/_f]Um9RXySJ\sǍ&~Ovjo4OF>4M[f?4vp`! ]zc
#?z9~@3)@+w6^5	qҀ뮑<:ι9ӥs	cs#=>Ïs(hX0.:Dv?|=R=S3TA\rH'ϧ$	
h0!ø'N_SCO<#.ש8Bꁒ%T9n+_2~-Vk:ZX *I'151`XeSøjB7YvV6!Chu !q9X>NaK1?Cccv rt0F"}q=1sB5C=b=c\Nz5K8JѦCwjwB	$=r #̜թ;d.:>[דJ*,gQ[)<ZF+ExO)l 4*š 9D6ӨHXs]ИICL:.D3at^:Y{ڧ<@V\_+yN,9ܠE8`rgU	=lb8U4զ$/z%O}D"7G`gtʄ%<aMj~0ow<I_`|b<j"x;6=!6Cnת/Mn"4B.vpL&)MC sO
UqO| l9~gk5k#+Q'#BäF1@x21~G| _w~ ;-Jf}ʢCx%% _I<GrZx-(`]H.,0=Xoq07@ Fv$i׸ӹ@:G:Q2O?ci$iSW u,i#nmǀi®J\Ľj'ؙyC)@5@Ag}g,X`,X`,X`H  