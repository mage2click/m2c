#!/bin/bash

declare -r m2c_version="0.2.27"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]
        then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$(m2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(m2c_msg "$message $(m2c_info_bold "$opts")") " res
        m2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_msg "OS compatibility check.................................................  "
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_msg "Docker installation check..............................................  "
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_msg "Docker-compose installation check......................................  "
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_msg "Ports 80, 443 and 53 availability check................................  "
    m2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service.\n" >"$m2c_log"
    fi

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    m2c_msg "Password required to trust the CA certificate and create symlinks......  "
    m2c_loading
    m2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    m2c_erase_prev_lines 1
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_msg "Locating archive.......................................................  "
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_msg "Extracting data........................................................  "
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$m2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c

        if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    m2c_result ${test}

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_msg "Generating private key for CA certificate..............................  "
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Signing CA certificate.................................................  "
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Trusting root CA certificate...........................................  "
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$m2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$m2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi

    case ${m2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                m2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                m2c_msg "Creating the resolver file.............................................  "
                m2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                m2c_result $?
            fi

            if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$m2c_global_dir"/mutagen/
                chmod 0755 "$m2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log
touch "$m2c_log"

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c
    m2c_sign "m2c.test"
    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"
    m2c_msg "Mage2click toolset is successfully installed! \n\nRun \`m2c --help\` command for usage information. \nVisit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log
    m2c_load_project_env

    case "$1" in
        global)
            shift
            m2c_log="$m2c_global_dir"/log
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 R] ]w㶲(x+ٶMIV'vgms$*$eYއy;gZwZ0k><̬5f* $@do3iKBP*Bujqzi}gmO0j՛NvZ?GƋYxr2F#o6KA9pD;S~4.a8xGV:Q0^C~~[N#Z אf?MINN^?} zyPʞo?5ϧ|h'>pt]<|?^on_|Vd^SW}vvypƆd#a$aX'ZX&,LNhsvO`r$fQ̎p̒ <,	܌}^ Sp<z_]6r^l}	*>OFBon&$cPfD/ބbpWSt$	LD0N1;Թ	e9n7_Ⳛ-ֱhZo]<C؛$x}:Mgl][{g9ޮ1b.LϬn݂Cj$o}L|f3ԘcoJj2y:$823&~$Ae`TQbBi8
O݅'__#?iv0[v~gsŧkk1f? ##otx EMCvp2gAx|pƯQǃ(vK@CnGv(K~CѐM,W\.>#1Q aq6!bg^4	CTȶMUu-f5UG^V]BvCEA]ߺh_ JE [E 9-ZK`\ ;:
/ja A A bw	mߖ50?9F_6+H&̢$5[aZ`^ZWr?9wmKeaR"`+YV?Mfs8͸.Ja.Lĺd3?3$Og|Jə)% ;()bU,?	g`Tk/8O%;)wnǹirӄ,ަRPj{jG5~a'/wtp_>vfy?~JˣfBJ{Ow^~CV!pr2ʰm%j<ڪ|U4دPZI/Z_<`^t3ĦP^Eo}yϪ/<h,W~*fp+eQ,.=J"9FC>̡ƨPBߛBdK'BzgmK_Z\)*_T+pV^٨E'hK\yȑot09Ȼ5|^	}Y[$>҆]	c} d7o	(RآKÄi?9o:9>K4FS/9]6Dd÷	*D/41vnY#׍;>fQ__ gwwnUr8)Y;\	EBߎy!ۃp(<qj$9kJZQ5껃[C1U)u*:O^>}qbӫC/D=TAFo/^Xji"g9R#H,7Th"w$y1M8oo:	N؋\Y<m3BYp`beArhdO?|R<3ӝ +HoҲnn=`N}ZT7A&~$cx0LL0>-P✜%o0ьWrff<6zEG߃aRXL03b}U% ^|xëfQ^xO-moA\bE ̝% bwE@2&76Tֲo}Os7K)4,Zv8,9lvZ)֦|d]O̞1o
vAޭUߦS@1~Mh#0z9NZ0OP t6j?0@&xG,M&g DD1z=ѩ7x3f~79U+7#}	sR1#	n>G@oLgxtIki!M$4l1w^}juy!J`s_F_eyYԝ@ʲ$K%ڥ^v-;GuwZOuOzv=ͩ3xO/X<~S]J"go|kpB^\rʢyx(Kh`^zsXE\V|#?{-L	mo'S?EZ:>~a't%dR?NPH#$`ԕ:a*G_#g	t2 (؛WbmÞAgSu3,F\{Oް_ϛ_RȚ!e34/L:e64eI"a7Fl)4:8Y0b)4M49j?E>:sSت"fڿMnZVNlᑃJ%$)o+(m: 
[xV>`hbA4W#_d-ȂoKZ!+vUYfpcʬ++kã&؃/~ϿدTɯwDO-LR5%ҁ^"EBa
* ]Ղ@5y!q$2
E?[#^tNW Y-e~E'3y7?Wl"G#')0;B,a˰p(UZ(krJcAH /,5[YYL`Gk
Oh-{ÛV-#PQM MgLHN}FOZvh{i;ui ļI(qߍeIW5gg"N&b5'Xex,w
̓SuBLgFSe鵩`neRR{܏`2 t[[o!o0*7_Ӳ<UaO"w\g@TSՠ>f_>9|R*_
_

_
^f]
MAuxʅ/vOI>>/6*Jdh5Q5ѡhyEG_XhV+I~	_.rݰ&1%ݸ]e#MkVxSj^+,1B)լGr8Y:	&$QQ7}%߯0^0Sh*[Iۛ\Z%u?>NBZ8u2mWOCEg47'LT%st%0aL)*`(Vl[eZ(Ş(a)d1
0׹1Ŋraڴ_qFH݂:xd:*78[ V?	(@_4εfgiIG\﹋f捱i^ks쒥%u~xca	\xu?K;`u'? +\S\f%eMľgt_F/g6fV9u+i93]2ym߯*~/ǁi#cf}aseπJfeXòDЗm$>Tw\]1 D4}!qmF/rZ+8iD]WJn!65D-['Wy^R7Z_:OoTU꒲5=/8P
9֐6f2X^ثp,mR6n4dn6y$rfɭ"(LN+s8|e[(toR4UgiMs|9rlŶIׅ}z#	-Za˼,[ˋޅYUFrpŬ!J1Q
aXO/PN=vtZіD[AYw}r<VN $/D3[I'Y<gE!?_)Hv[}>
G>lvOb~~&{ss"z$Lt$AZ˜~Ɖ/tBժ`s?LuRLF	[j$	^|;8Cd,՚xŹ'H͉OI5uOE>t6vgJQ
b`tA&93=CsZ~5fyL ͡L/GĶ[=08Y8q~ |b3hJBCnҽTZ2Xʞ{|πɩa#7CUl϶?+LB&\d17Vs\nvRrL><GZ|,=Z<+Qt|>r:0yGf	nȁ pS.HV`WV)3N^4j
uę7fԨ ny2ҚV$|$v12%@b2N] ei"bq(HOUqiYwr`,WS=a%gJQc#ɡ"SHyHa!;PC#˻kWή\Y,`3(='ót>rӦaZfsͪ(4jb!DjȥjU1
EA.55[?ϑ1-fΑq\gX945.{*Z[&UN~Û)šEQ#KHpfy/Zs,Y1ξ@Br?b,jfP*Ф^ 5CꨠD"0pdڟLMXm2I;Mhk'&ވp[Xk(
}x\A7&&{/IvWSe8%>6n߈4?ţV%dAr ՏPB82gYxRߪqj2-HZd!V|];"N4ȃΒSӫ*θsUv \d.`^TjCaF1n%(,EvauK.A48^7Eȃ08G?$OTǙlN	hLn/W1ͼP,aNqf|<p@
>/:(:X(]0wAc{L΃4%$&"R!2R8i89Hma:HW䏰a;C}׼&g(*Um+O1"HyiN؎Ld2l~(Wل?6I"0C6FN#z"(2umj.BJLk>N9cVRhZVRzOq0y!Dg$N1ʲ|\THa VOIA WvW9M#)fC*	0h-a%+NX22CelG
IRsTh#ޔ7R:0L1'5W"JP!R´Ob˃u<'h0NI4SN5ɽ&hP5_Tb20R#LWLV@ iEx]s2׆ڐx8}cWarL٨]qS@(@s{oQJ4^GG4?Q튃Y
:tyF.cᑆ_Ç?Q/&ߧRTZbm"n!h>]"x#Q?#>%>S$"D\#t 5+:嗖Ҕ_+8|OJd
Y />MD.KD.KfzU"+u*dDN\697'F371_{n~kߚF-f)AM)<7mp 8i,K=R7g$KG ߊ%ԋ1LۖAWbBG-$ƝiJl[(y_&6%2NZسhmlbFvz4@i>qώlIHZ%o exXm_ݿY#>Ŵ\kiAnׯv}	eJ_0zG`hdx2irn/ܐ2]mTz[E?u:ɔaI!KL@T7W# Z.+	KN~и"޴3)o>[b2XM7+Q2'eM?L^rs"aio+	G鳃WBU8Lp,i',a%1KCڵƂA|ByF7S))n?y޳[b^a\Rnĸعg[z>)ۊD]`)*7d^mnr}-vԊ'e]M{)={nRu-vЦ̀O3JVP+0fjMI\Rr{%EYW`z枺k^Oc
l*´D#yYH[Oc9uXC:̑]w0:/Kү*%{al{_~x#[Ÿ,&]OVGyR#,* AkjǨr#=hO/56WymGxyiH(ˢLOi'4k
u>;bM~>+?_ޘzVW?	9j hq7"t=B3?]gueN_4Rn:x۲o,SnlL-KJ3qipd*E`KXК-0~Spx$#@g̦ˆ4)ovNSd1{K&/w߽|MTxD]2@AYs?\W6* =a{}`{nusv5p4t0a8M~FX^.24I]MyfPIZnfCYn~%f)D(rtu7
&M֦OWhVD(V's.E:\(ΈMWowzACƦiqoP/1*Z]^rG뵢,H+
d/5W^qCў5
H5r@Ԓ	*{ax/Gܖ[gQer7k<0ǿ-V}|&C̯92&5޲j}3и_[bǵѩ򆙙Mfe*a+@	7/頝K(z3rLu$>jᜯL=/oid5KEkqÖ49rkR.7,BZ,n/(u|ur<%78ʔpG0
%"&[D.}Z(Ct!59(,_(xޢƨyW[Z$W#I%Т[.Y}g;tet	$<HeKi3n0V61OwOD|{Xo.e®U!X0$گ_jTcbT/j͢BQZbksPc=f6ƴwVZ0RVpэ,4G7MWȇٝßaaQ?LeVQZͦim]rDuy4Ki9x7-MqWe2ojP{RP,H;ВJ~ 
փtW5o:X`JV1VcI<:[2)fư	 ãb8;W=iOlv{UY)P{%^ѰP?{b.|ws[X3(Nr3v_S9сg,~E}?[(6Xb]Tʼ"*M33ccai.:&'3Vĳ;Jj%Ώ{{O_d.cp鿼|QRΎ(H|k:8x-UD$>.Cs;j?ڏY7uXf՝WJ/n:f<˻Ý{x1P`7#h.V_94ZQ08|_pF1C,r.GSC
3!z^bNWӲPiEt)`PiXA(<Hpڧz=hD=p}YRt^laāYK@6."ܳ[%(b2J.B	%jѺwy'pxOG҅M(Y|KM@1":?94	1L=@fT.yYr|KHJs|旡jb^_o 2ްn['6(֮[';ޮ%W-.'cHa%B|Wfʶ
ؠtm3øPi><gˢ͏9_p
4V뱊~[zM,/UXH_G	8+˰*zIP*|I6{vX]}f;su*`jRUs?o+Ϲ@jےTh*.]Uz?aG?eNk>\PqquWZl7F_eMG.RukL@i(0ۜb8Y\gmZ}+pjT2-$Iq&\T<Yg.?ڀ;յ s7#zSFS-P:@JduT9[%olx 4s}.N7F2	L%0c'Mj7[T+r:OąsHڳulbÙ2qIYG"
h_DmJ];AHɭ
]&x
]h/۟L\E(oH}Ue7Pࡢks/{2UE

˫6+^19S\XPm~[B\P(ڶu#j2"J+<D4hk\ު紴9!Xs=xAپȭQi6ozEpMV֫#irq[!*3OA¹^q:]YOdM8lCf9{sF
,8(c_&UksW^H;e«wcܴjM9Ïw[Ug/~CEn_,*u̞p'P^^vvIYIZ¸%l{1W Vg1]OÁlDQb	q?'/qyҵNx~UJ3ips$
sŹ{WxtY,\HFgPkiJDu\=XB oP[x'Z/U?.ƗbPX͓VLt =AsvL|ĕ?ȣ`Bq^+r):>#>x2AnأF]VJVXP.
{DdqVgK6"i
w3J0K'=:nY!m&!$Kan,vu*rHcGIXXRu *Z
ziy{I>~bGZ0#@ä
h-^!THե}$ *3 )%,FVL,>6~*;QG꘼(Ygk3VBp&)4ɶtw|&C&(K~[(f1W-=
&H/U1roIL6.Y,tșmG2$ąVz]r`FRҫx*ksPAw}3{=JV%1V6^lzIr7*PY1J"Q]Q/y]..EW]jpRyZ"iS!KF
/y5V-8Y*<`0Xadjcw ?+sӜs#GuT2FK=#1SZbrY7rᣇ'PX/`}>/Vz+EzvAX9as$w,ٔi(M_e`_B[V
fZ[jr
ʽqa ,9+47hffw+6+=h|k^77=ml K͠:!]P5AH>EGTxjr[Zͻ
"m*ZLӲ`Ef4eՙҴ-sMb|Y8F0VTnQTEہ'Eͩ
3f[ϖi6,_dӞ"Q}VA!2Hq~Kt3uZn7;7anZzznVkQozs[p_&-&Zlp!"65qYIŷGɂ节䨾ܒJ
I+ƍPr+LFL7p`BU+aۍ//=tbRn[LvzL2
nue\;
l7hk}S4-q0JFޑ?>h*vUEjv_+[D6Vyx+oG k9B6~Y-&SZy㆙	Ǐbhm2KG=3n9ֈK
U$ZoI2/Mpfc_Şo`	FwWsuu1vh%Kd'OH6F4C<iۂ:MJ+ǝع,+¹Nn<-;pFY X_>}ۑUQKI9ym$Ç+_^5BWW	&A}v]]m0c]'0ɊkYDZ+ɜW".VEC"q'o)0e
*Zj/	VC?j]9(f )
P6!AӱW-* Q7"Zs
ZoB3iv+Kq}EK8Q`ԓth7>|]g8^cf9D1Nw5VUZ9Qql:ݞ!6.qN7<	7\21meρye1h.A&<o#*2m=0WDZ2^LusIqtsa|elJmG>Ο eF95o4fmexNvx6漹_ٶd5yUFidp*LdVܸV҉;Vͦ}L`eneʹ$겼[j,S 3sMV~"Y(<D'x>>	7qL9`sMNxZK)0LL\X?&X]@%mݬ/K=zq!r;#lsLgC5f?K<%pSpi
#s(/6MIpe2+r\}hj Cz+M1([h&u`e_-%EvZKgJgzT[Z-+ |KS7@Dvw7M6Rc|1y6Qե~{r~6&Zq́h.|Ů6LN~&\zmJ3'fa
RIC]\lwqT5hq/Q5j}SRQboZ*>$-*hDrd|}QHjg\nɹT9v}Y^Ğt7DMy,u$'䎼wM̛~3"j%IF]-Xܫ[('3S<c}R4ʊ	(SFẐ(r8 OA'D2ۉ.9"j$z{R
y$W GD^/ct(Aʊ֤׵E;V:5,	w^}|(d<Q[뿧*=yr~q@Zbi.6`L"Ng#<̮hħ/)I30')9C]a&w;	`hW$U+gAp,҆@KAb˗	|?0BX.eI){,R+.zBWWev#P)ḯTE:ٗen,UJ"38_|`VQtW%ڷ ,RxKa,W~m=`d0Bfs]yuɆoZ8'y!}Yv\%-3CS/Uxy̗7˻#w58^[vX\R0}kb|P$Q[`RC?l:ˏ3hii@H_302#Dr%h@^UGCGSh/`V@BrĨCBퟠwRe~ʊp GĊjb#e"uxIHS`b#y,a-O\=aMZLDlZ D2g؂Wt1eNVK|_յ͉aJ-bP/BfdIEӿ@|z@wh*CWk:"vW^2(Rׇ8l=T_#Ua_z*q3%1ߡ)5?fI$0G'Q̒2p7
ncԌ981Ri<\n!QҲ+!oӹV{B_hel&OsUJEKk Q)W$|L^f#2b4bڗ"'|9wY1k|࢝%Z 
Ua4YcP	Fo`)ן*u~a0{rr71z[c4 S{9NCeok{7S1)qХRPz$ } Ix9R8 q >BVj@mP:Ո7g~J`jY'j,>WCT=O7)ljJ-^fo)3ej!^DwGdاZ?O\;$ꐣ\RtxԯaY0/3թ.U1le6Mm3o.[4֥e!9
'bSOa-ТK٥7˿L/le,uhɍkPʣ/+JV*Ź ^<7=zG2r>?sPPZpP\h+NBܶG٭+uYJ="[L
WӋE7&w('Qbk*zNz=A0֗}ͻ鎼|_sz+oNVHୖsL{_%j$%o|+Za6=2apʒ>Dc5t9&Ҝ\?ʓuNUlzշSV[Vˡ?$cW$;?I/ހ\{_l!Sqr_U`)%wí(Ѯ,LZX:+ߊ|P5(ۓe) K^ia*/mm>@JSa;M{^sFOcMnI# >Kf	*'0JÛӋq)PU}U3g^0"48y>1~zS)~H&ۋd(ǳ	Y]1sC^μ^
4;,wxZ$HNgGx`V 4/95#ݚZr~)ƙcdW
Ϗ oƸR|?ΐInǁW{e@o۳8<h&,9ec?
/)݄;"y5$FX_bxo{^y%vϗć(;HQU3Y䤊dX'/_nskO_<aڋ=<fqQ޲WE^A ΄(d3DS_!2?XLrɍ
-4 s6 h.~τ7vNlДHGAxy;\qx.xJXӚkx|7eF5uWYڇ'sb`OH_z+{WŢMU"Zd)`@E m拪qrb2a"L3Ԩj#oa7W@!D98lT\Mr_U{˽(#oNGV쒼_SS/^O	ydz'OC"f]rr
3zdgP]^(1D1lPn1Um$'(\|Br>fО9X5Tl<z3H-qn._*®gXTQ=Z.G47򡘆q4[iODe岝7p#<`orߜUؗ_8 ~vrQ}k巯>R0@D~bs0ʖo7+xmu<c\-lSv+\筍_Qh_V?pw%wuϭ#^nkm
sWKrdxVW`[7bi"mTc:oZN뭄JjQr_x_5 '/Hxh1!Hp0f"7w!(faZ}039n7]Q(@`0lWwy7ȪQrCRwwҹ 撕=%407^DCtDnFѸ;L/B$;$QL!iN_yR#?9}Wq"_=ʌ7B}bEuy >b!HێфDVx72oTbX/>7*' "A(}S#7k_QVқuyPTbԩNV5-sBK*sN~a	oѦʆvt>ү
Ik}h }@'~ۃpJ.bc<di\m@Ot1EL"ĎCIe)vDxD F:C;5qIQʜg	_+u\)B]ʊf=e<"-DNqg[Q pLg	NDVoɁhϬN}oxB1dQS׳|%K*s/[YWi;@ZROo8fPs^B%j"
(V@e-R#ӽ߀6*cAaiUL??ˇڭ_G^Z>6xhzvXi5?R|f8TNfhL$d;>G#<JKέq/0]< Aqu0Gٜ'a0;7÷0-zQx	h́zva}Dgn[>cʢԱ`;m]<Ƥ'u0qbyh{v2LSʳAŊ!0$3#9EV=8Dp)phzmj\#?|~U͉Mr͆$" i^SD\o:Ϳ>
gNM
`Y5,9W!՟=TD/`N_Fp6Hx #5ȣ-~J;'`:ʽV;򚬠:u^eK >&8 csL8xoG?w/oz#eH{pvo1QmYkk:-ѪPqՌdWćin+
!(JY+]jrvA̒?Q@֍WL2]C̈<CdӢ=ͷp\4k;/.evۚM%p1eټ.mlQ,4q	Y-۩:+̉@姽ChF:GW:|u|(VŨH}%ayqul-s;3<=liE|_8KP''7sv~3wk}Њ.)erA˧ȇ϶_?anW67=8GP(Bg&o1E`SsOQ 8:F3g9m޾wR_3|kk2ǽg}<k*i%ez$sB2as28W=!޿{OxVqig/w= &Ow?/Ex'gt)rݒW){/_.ZOx'zO"r$\=ϻ{~f 4=SdLO^ߩJ'z5립Ovj=-ve5%m5>xoYhi|A#Nqs{7\?Ռܒ0Z.Üfӱ7ϔ)Bx4C$ؕE-[XZ9uzULYw)̻
VU~Γg] ֽNEeğၷtv۲<:{Դk_svxDx߫U5
L=tj?>A!2r,,y%d^GQaB݇O|}~haFZԃKwhNwȘ?
<Kݩ@-'DwbJ|q!(OݢDj89՗ʢHY3GX- ^!Ȓ<l˲|xˆ	&
ᗼ&;Xu_kjQȁGot}jt|g'΅\4w?]yn5_9ВRs$r(gA̻[Q#9~[k<(>/l=)6a춮ɶP5uwTԎyP;OͤG{;:
/7Pv
nٹw̕WR˺A"+V!bnT{ȉ1fUw8瓅rn(oӡ^iGnҧfޟ'J=\"(mߟgA<s,$y4_P0M1>t
Jk֛$i]׀MV*CXM`ƤI,h8]TWWᨖ~tQ6?[jޏ;y}^=eQO,LcW~!߷~|ݵī$HFG5DҷM.Iy0LNCO~<1$7c7~߱~<Ta E<e=B}'a8v {4OA]w9?ُQ8d8(^(c f{`t$'~iO/=ں	@ˏpF[EcDik?ưr%[lm0<:VP9L]O<
$}vzũ&7'$
g-hiL	$o`߭
yF'5F*f`ȕ߆uhp^@L	c/`C|L kuX
b zm*_+yf ݎ[]pt2vPf^.:]]7+htV*?M~El3r	R ~c8H4@2ڽvۼ1~lu.'BNiA^*;Ӭܻ{>?h\MRu 4᜺]BCYqɢNY6/I)p1	%g&)SK(ZޚmӜ{m!`[̅W&phd
B5n{ȼ-\mo54r%IAAê`L9L}k2rV#o:- ?L 7\)nqUh8CTDmfؒSȈ(<	cOOkLp[/s`q~e.Ga4#;v8 oY֐xE&	Sл(*I%od],<IK(S*pಆϻd:f(ң	8:Jkc&#a\#UZ1`DWɊ.lOiϭ~C)e=f2etz^nh6]7JHihrǺ^Wl+f봪pL^m

bBC5 p]HM@h=`jfRR3 81ӪWNY>tjm:]iUkZzr*@NS:.:9S8sCNn6nZo6:C0ngn춚ݎS8C:njihɎ[ {NlKs{m=s^u^F2{jvuBNj֓;T-z nu:-iWvhnz:Y[*};U;zrvف|{'WNX^@0Nr&i*mk@ z=ц@_4;:nGtaw:PӦ4m^9,]Ht;Vz(ӄ*Z7{vCu
w;*;nWmu{NSKv] kA40ZvƁЃqH  {u^~tP>Dr5:`k]94BF֯È`*dh@?840LvF `s>dVW۝.7_4:-5+Pj׻MH  k6pa)	pq
`Vnh 68vq "@u5CPh%:Jbv5 uӁamY" 8 զqZÑ 6#Z$d3080B S;;.IΆ6@^p[jT]3JMA UͧfPCӺ ] hN0a|uN٤ ´fvpv-lX !V"mhh8w0j;.RA  Gp=IzИ5Pn凒:j4z먛]@eJ| <j 7@uDoG8FF ]uPvɩzfa(ڨ[ ?G $cbQFw{ [v=WRD`Ĝꒆ/eɪrT^,dBu\oFxiAF]l@M@!YCkA_?D~7-o U綀К`UnDfcUw8$@zc!tL	5h6AuAޢnmPMdCsPd@r;=4`x 3&fnv@e!%vW(uie-U$F:}	LLD
<zehFfE Prh8@u@p!}ri=#0jN[E Jۭ@dtzD8$p5fIԄanQ88m(e]%vфCˎu3A{VROzݞ%MFmEajBr4Ğ]m@}H-(8lHVCKTY%MciF]j0p0h/w;8}@Gs;:	@ti\Jvkq]nˡhNF"\!LSdNt'hʖC#PB- L:Rۇ"4(vzZ2V
ՁR`BcpIibPME3HCԀ>jb|"%YYv54H[ 3vR`zPC\f}/nh{]`<m ktq6Ap>!$![8$J@8FцncܾkvqRV<NɋRD<.06(h 8فXo.^aЪǐ%{4A4ƹH5 RS.P DHq ~B+8:m=Q#0.pW:fm$ĬqSO6.*^Y`tNt-F#fZ*;E'
0e R怄/hΔ`Q'y=B:[(SOZ4QRwnw
ylԾ`ȓ̃f`}tuutH.Mf?CjluL5S51J!G.MV0Q$k ðd#{0pه%APYI|EaLNg"Ѐ/ĵ}tAq>w`[tLS3чt`D)1@Ų"h4.N3чZ4;UhO\MFoV&`
TTy	{P^} l!ptA=4]IHI@vD&)`Zl4釓;@3SrRE+CRahzf`? ͆&@'[TSS%ø`g "I2L3ۚ!WtCxk
3v" #q8vh͆6tg/8!iZn݀}UH#HI2h`=sDwOumTAKOo~aB#65_62OvC>F.;>.\NWM6p?NtG[\&'߆y<.c1R?~JrN,tx6ny9HN7|;E,NOhR9X6wWa{Iggh|`Ui,.%S1&8*:*kHG
qB|'Q e^[KnF̟
mD.R|&'t8ArA$m|G3.8LƱJ|OŴEKJXX{t²Y^"_vP|BEARw{'^P Uho0 _/u\e6nҠ%ծl>%%'-L)K0G.tpcfGͫ*)K\"hq=^=D{O`IKWJjScnjoS2hA<c	;):RDť4#`j>IɧشüMb5ZėSGy=~D[W/Q~T8 (bbuE˼ojX`,yLǯ۴F0 y%QjOÓ   SK	'm'5 bj2MƱrx
$^taLw$xK(#ȉGVUyKymZRwn&tqbdJt-finxӾE"俀J}wVi>sesjnӲ;vc4Y,nǃI6XCCM&]m6m(:۸.Txӫ@;02u_^+A 戏<p@.m;3l 4@>9	׌Aˡ9aMd3u9*]Cx?W6k9.1
1M\SzLk9Pп|r]k]mleG09 r"]?-xfX=K
l4Jj`|2($/X~TO}c'춖<8[wN>ǝ<FŧkkCG3;ǇrU#+>9v.wm|F`҃5W	GFPdya!pJV7
=ND_[)'fEX؞
s~a?cڼ5?
sk!Tq7qK3hqj4H$	Gd.,9g
ӭQKckJv;1BtAp&B(ba<&P(k<):N$h\is/Go'oT
KCyH|+NGiago0vӘya\m@I$Z_X[*68X	@O|Ju|	YK{uCVX>/iB{?:J"Ov;톼{qm&`02LH$
9:P ~I|_z+*/՜iFU)cgH";^&y09i9$es9::>.̢Lc6'_w؁®$uWKjûxMac3Ĺ%?\Zƌ<9b g=BiR9hg9B?dHAAEJs:9rp.wp봱Ǡ뛂áJǪhNF^I%@IrA|e[o~MM$MʋHf8+x3XUZX4c?Q1ͳ֡bܳbo[2Rᙅ⏌G0~xQ10*H o*-H|qMEex*u%EVQLvכڛ3oaz_oiY C@30- U|wżݧq5S7Ve!)0_?{~ÏY	)@"A.T$4ku	9?`-T4H-&[b~/|`+H3k,b03K*e>6Y%5ů4㏦ݥ:M|=&Eghu\9KZO_<a5^1h q\0)b&
*V}xXhZWR \js3(nU89 ofPg	=bdn|L6d*#P?#'XݔwF"m٢nZ:.oGCWW+K2LE*SM:,5$?O)aWE"gOâ=/LZ:sOpgvTLY10tL)`uҷmgE)i09Ȼ`9\{ഏgNἙ|"B%GcyKOfф38Qb~ECމ)m~B1ysL`LC^3%Q0
XØhMZLCzA6^tL.)u4` zzv.!w8S.ع8	Ϧ<X(#@hȠ~RlSQJ/  G[`&qF<(5k->SCI*a}"~ȎDN8%p{8"?>;b1B赖#J4V+SRf T2BI:nLnYu!fCl6Wۂ3/y)3f0w/NcmuݪL5_ՇCobwI)_2gQ8<fΫn/zjʂ-ZܵSLY3v%rHB99?}P
b!a(_e"6,~|jLWM@0洮!/bI.Yd36CMztp쳐%JV(V4~9NVϘ>qiގf`;LO$@k|1mM|901'CDX%[V%|_t6~XJSҰV9-L7guz%%:lt>K ]ZT(tx>shկf96נx{‚jSa
1`hܕ@L~:e7NSDY&Co=&</p@$ޟek* #'ơ=[
mЖ\FeϪ5HyLxwHc(lWQ"DBg dwRR@֥:UN+K|b71O"B=G<%vS:\3l*Nu}rm"ꢇhp?<x ā=?v[mht+zt71^Q$P(bajN&E޸+#$
i,k{5Sh4.`rV.Hώ¬~M"$͇|4x\c?,a]	˯""'Fnv_/ee$&L?E8#?˔Fڟ3(3<o8 }vm=y՞G]_N=j kK	7в+=`Um*[%M(;`X EU4	=gay|A>l.;O=W{;x!]hb:X&0%
 owVڽw7,/i*c5l*|Alà/Di\ץbRptG5Z !ߪTsp7ŵ's\_tcL֜7UX9w]ѝ Kl$Usu5|eS+U#ϩ 'mLwgl3jx(CƳ$RN%#eTev\Ts;޶q}=
nP`7[v$-i.EnnjѶ=>DIػCbÙp8$E8dsCZ2ժ]PP3LYlU7H(	7i]պQ9?D7bw*qeĚeb ջ5E>&kJe꧹+'ZQ8@[kU;).N-wUGA=tZ~yE;BT,		ֶ59WIZE{sft;}_G:i'(@ȂY <b1H<lW]Hҥ8@otA{U)偹hu"Aufu{vs}יqwD&eH6OQau{VAQ:ȓqۣ6PyXDlZ2h@ˮ,(8ZߠWKm_^q;5[	}oBXlk!_n`Or!DxcC@lѐa<kiZWMfR-qH@$k,b|C7fXF9ɆCtc6ݹ
.|2э]FELsؼV}^
IvqZdA8f>z5
QhFNŋSТxJ11D/LC.L=TNIձ:*S3z4PӒ/|5xr25xlY//9%Y?{Y	M|K@vڤ
b;{z5ÊlWLSwlX[Su,ԗsTFq`:MLX T9}6o%9U`ԭ|qEc1Y3c3Q,Υ*]9|@-1rT[/F!gZ5*[ZFP"
7g;fvL(v$e?@0FG+OxA:`U%xU~<?#'t]
?̋t̾^| ͮ>g`:S}[@-iEJXYW1W_Ɍd.ʠ>(?l/4V]<+k>U}~xy1>N= Vi=ŅO$">lFcc=)p.'s7\1ǯ)/~B#+xî_J<bܳmd: G]3$}=}>e6~{(w|oÚz
a8b-*wނʌAf3AsK gEMo!!j0pKЉ!OS_OJlS	
h^uh+GRF8H@֔8VPE!6}*]U[_	F-Pcu׳E$-Iz[G:I:HqIXuvR'\/Q)@2݈QN<d.#>Kٺ>lf3i9=u_"&6qt[?_)%d%b1cwke7'9RR~IBX}ЗA;Ts:ҍX㻎!A>_8ց)H|WJ/]O g`R9Z\w!cqN@W:}o>Xk_'z?N2Y WCФZAĊ3iGGSotzPqbާN3>@ke#)UeVcxKltBk ,/{U OLdIL >kzV&_>#8hm[<Wc<Ѹ1Zx=⍐ Mz8!&G/d)iV8_JG48#}z'c4ӊ<Een@N^@dIRtГ07Kʈ=!F:leX|̪ \]fASo9λ8h]b,beCO][A 2&.Tɠ7uڮ4΍(Zh0 ]JY)F;	m2ݝP@es.WMEA* RbQDKAw@$tm3˔JT(aߖ"B6Y}P3?`'FO",${]r@D^N3_<oqzS<a*	qJ4ũ	 9JsVtᩉRj
X6$xls%x]\i5@g@O@ o,ݾ0CCWa\{?50"p a`LCawyy9bQhut[2#)sW.1 z."0$~[$RICh}@JG΃uLM<<"I\Xi8O=oMP  dfnCh:Q5*OԹd|5I|U˷7hcZmlM5qUubII;*K:n{~ ~ n 