#!/bin/bash

declare -r m2c_version="0.2.21"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]
        then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$(m2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(m2c_msg "$message $(m2c_info_bold "$opts")") " res
        m2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_msg "OS compatibility check.................................................  "
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_msg "Docker installation check..............................................  "
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_msg "Docker-compose installation check......................................  "
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_msg "Ports 80 and 443 availability check....................................  "
    m2c_loading

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 80 is already used by some other service." >"$m2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 443 is already used by some other service." >"$m2c_log"
            test=1
        fi
    fi
    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_msg "Locating archive.......................................................  "
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_msg "Extracting data........................................................  "
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$m2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
      ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c
      if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]
      then
          mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
      else
          rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
      fi
    fi
    m2c_result ${test}

    case ${m2c_os} in
        darwin)
            if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$m2c_global_dir"/mutagen/
                chmod 0755 "$m2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_msg "Generating private key for CA certificate..............................  "
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Signing CA certificate.................................................  "
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Password is required to trust CA certificate...........................  "
        m2c_loading
        m2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
        do
            exit 1
        done
        tput civis
        m2c_erase_prev_lines 1

        m2c_msg "Trusting root CA certificate ..........................................  "
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-certificates
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust && sudo update-ca-trust enable
                    test=$?
                else
                    echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log
touch "$m2c_log"

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c
    m2c_sign "m2c.test"
    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"
    m2c_msg "Mage2click toolset is successfully installed! \n\nRun \`m2c --help\` command for usage information. \nVisit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log
    m2c_load_project_env

    case "$1" in
        global)
            shift
            m2c_log="$m2c_global_dir"/log
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up)
                    m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|down|info|remove|restart|start|status|stop|update)
                    m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] ]w䶒 pZREf-W-d[uve*x+3&R%͙}9gvه=a5K6"  	懤RٷE  wVg&sfiUw>2^ċ  ɜ䱱x1y`wvvFyx}4Xv:z4[q0EnAC?ӑ$|l7-6w0NٮڤCC?
G WF>}<'IU;,?^@v9ݼcR1xx>C?<$x,U?7|p${񯟸FӤo>ŧ='HaΧ?sw.]x	6`I"jsbF̛\09I0S?I)~tG1;1K΂`'p3}v#xO LA؇16	-^#/;6!OGBoM	MC Y08#"y,'a47a{71r6~}3N5L`2$qt`vc4R1^ 5VsoŧֱhZ<CěI]
	>{S9Kiϸvm퍟xƘ\(AU
2ڑ?"k,34̈kvb\il'Woͯ%I0`н1{^P'	B\,ĸCDIE|_2NQVx_]xruun?M }<F^|`ol0(<FG0ZR4dg!|V97o5xSn	h;n8eop6I?%˃g>#$Y;	ֆ1D܋&A|vٶYinUSs#/NA{@+ӶPmwoo6K[C1>llHj@V%0.);򎏃d5A5llƲA]BCUYqMfUj$fQ+ӋaF"ANXe]YSw4'̭e{YaYpa5Jl=d61ɟcaM|ތi2\]dAkN;S:It>8 ̯tI)iYB0b̚"Lo-_'j	b?e9$W4mz;nT
J\-/ipT}ų4O4?<}ݗ?u5^+-	)j>zb{+wWɜl+޲`@jeL֖hxoP[e8	~_L;ҿz4f/M0{IC =_E;sXW~T$xVԣX@]z YE s!G|C'Q'k79]zm{CmCQ۹V2U9_tQ5Ofф	&Ƒ#!`rEwk6c+>NƳ|n[T.Hzw-j@"3o}K4M@y"]&L!}sYY4:z٪) *!#jLPJtm Oc5b1|ݸ#j[@R>>xsV}˹ldAckkr)$	}+S/m¡߯3BzѪ`)sh1G֨<Vq?:Hp2*>}|{ыGz_P*{e%T[!SSY7n'._ƿ~SFn@(&rf#5ɲyC)rlnAD~s(
lޛ\`넽ų)&0#' HMl`  ό/t'@|J%0hY77zbN}ZT7A&~$cx
$zs	K3a|l[99Ka#3uF"xl@</^>r>ۗbq3 /`p/⇽_7
?{]i~Ⱦ?OwjUeF	(Mn.l9e}coїRh0
RmYpUH\X^UjjƦ̗ZbM	t=1kƼ)CyJ f6=V9 ZXk9o;B	cހ]4`@8Ogf!iKtjByw|ɢd@TJ9PJzw 1cvG>yShWr3[?Tf3mYg0i-- ĸp>2s"ҫoAN_4/ҙ^	l(Py ,/HYV}$:VeG"l]r675:??;`w_sL9^m(V7O_o}\Il<Q~cQK|SNY3e=Ktp˲ˊoT=Lɲط˩"-߂:2)&(sޅv0Jk{࣯@鳌:M Gf+1϶_aϠ_j~0|מ~bw{e/~ye(xRZ6L3_,=¤SjcL#yY$]cĖRK#f©LD.Y397žZm kBW`um+҉?<ru6EeǛ
8J7p<fĵ$ B#,䵕|@.	ڡXY{Vʅ-ѬnLuE~emxlo[}?~(ا)]c쾟12;V1AHՄ"jHN{r)@wAVz !SM}7,+9Jnmx9]din^Lh#/bD̏ǌOR`vYÖag:P"e=#K;Px/%@^YjS(!7 3k
Oh-{ÛV-#PQM Mg{LHN}FO{-]G4HaX4p	BC b^$aJڸGީ2~4%vҳuٳ|UcyZMjZ*Nd;I):!³	nqFic)T07Y))VK]G0 ?:A_[[_AraTU\O0tM7H'y=>nrQr<OqNs{Q%NW}	I|%h|%(|%{Qw)4o;V0T.|S|MOyPV"C8F+:B^NK-6ra551.*iZүUZa$1
M!f8AIL0I$R4b05EA+~9BS!J~ޮҺH-8qb ǩLu(dz*:Φ9aj*/T	;gMT GYwV}L] e#4,[:78ƖXсQ.Bq3.A[Pg_GPGC?g|"'!Пƹ֬ 5/t#w1̼16m]$zЯR},,>/gi[i4n4d[aЌW)}.3̀6z+b_~q~/#ݗCyYki93]2ym߯~/ǁi#VN`76P);F"e-03/Hc0->|^_30D4!q-F/a%媥GGq\"{VStJl,_=NwizEވk5tX;ߨ'q%l:@)d\`XCۘ}˰bysc66$X-ڶ㥚m:iܾmHR͒[EQV p Q02!!p]8iTϴӚ%BrQ'gHيm/2 G/W[3WÖyY0<\X+EYECb(0vH_桜zΛ-׉!-\}wy ,g!IAH_ˉ0
IgiO(U]D8L|yΧlvՖmI|+)m<@/kͱgLnω4Hf36!I9A1h	_U<)(~뤘X!bmG	[j$	^|;8Cd,vMܓ	$aħ:pE>tvgJQ
b`tI&s=CsZ~5fyL ͡L/GĶ[=08y8q~ }bshJBCnҽTZ2XfϽw>g@K
0رxś*Z6)2|/l꧇
0	Wi#YLͦvnK;.,S7Q6:_KO
k&iݭp,4}!Yr+&甋X'BʲLW*ZşFqfM>75*(H;{F.	ߴq8f]L	;/AիVL	`S>248Dҧ\ʴ;eR0+p)UꊳZQ˱P`{$d尐]+ngauI.\,Z0cYɣz{kp*($
X9*Z2riCZeUlLy,B=aoDQKaMzALK▰sdn|*#VM-KJy֖Ive!S@_r fJq+ntQTãcj6-t^K>m;nis P\揘8Kllʴ<4@@͐:*(CQ!\;Y'SVۣ|Gډtk 7"V Z30
nF/DE*>,<Eylz;L̫)GP2oDQ`{hjmD-H#6~<Z,O[5N^@P^T8dV
Yoj^Dש%7yߜYryjzUw.u3@+6*vWR[:c;9=CٍEe(μsq%ݑǫ_qƳ2y(J}8͉3a Mb*7*!)lN(@@%=B%SGCAv].hsEt?DPj!82DF
'M!-?<VS7lg(O97eBC@\m)FS>pu1	1AJ"f!It}1iD_P$E&%REHiͧs8bJ
MSJ2S}Y`s2nF7O=33FY@)
c69B24@p*i81%4}lH<F[%b	_RRWfH1-#PH!	Ajw4\p
mDx^J<f)vJDIc1J;DJVY	Y,zy°Ttҩ|9)fɃ&y$M"J;J.'#?T}5dOh`PE@Aq<
i(mG:v&+ʔU:tً4<OTMñ>??\:}oWϪ ŨVСk3:tmF/tF5t|Ba1}*uO.)F
A-qGCaCogW|vg[|gS|Dtyk$`EЗҒ_KC~qG~1ײYCV!kŧ	z]"_%u|]"_%u|݌|] _e-YB +HO5@97¤Kuo[;L5on)4K	
n
Mi[I8eYi9Ko%Y:7'V(^qDZ x6o!A4lNSr,eYBheM:4=W-9tE#ica|&)OgaGhcwyzBoqdEѸ_6XW{}q88KLeVv{hPChM\M.r[zKK)@#&P%cY%Q&hHT\S 2,)T	qJ"Cpj?Cb%tbJ~	#OpW2ѓۓ6[>qm'w;LcV/ %SFt,ɫYnO$>0?--w\z:(}v8y9][
[
'7d^E5$>5seHX0(aOqXȻ>HYzF0{eρ{vG+̒BʭW;lK'e[{e]ea̫MroĸZN郎+.2'emXB^inT)cJ
_rF/Ni>BZ y
]uSW7b1)c~Y-ՄB^vy$
)7b1)ck:ބ9+nFUIX01~qamao<KotrWŤS}ݔE$(y#]iypRny)7\U߾*H/ibeYI):D`O s۠g^{Ggqœg<[ϟ_ujg7 ZmY0]Ghw츼LrAMO@[4`m7顜E%8Ii&.M?W]An]4j"Ď"
C|1:	g1L?}ll({mG0˺Loǽ$jr˧Jf+]c(X#KQxGF7vo/[,uϭn[n nуn f8
;C+e]F8i91xS-Sl賿M|7coI7EYJm8+\/@2͢+}siS
>	"hN"W ,s
3y۝^rP+k)flZ#tLJVWz-+:G{+/ZƸϡhϚwJ͚g9lj0hn˭25-h_XVV}!|&Co92&5޲j}3и_[bǵѩ򆙙Mfe*a+@	/렝KU(y3rKu$>zᜯL=/oiD5KEkqÖ49rgR.7,BZ,n/(M|ur<%78ʔpG0
%"%[D.}Y(CT!59(,_(xޢƨyW[Z$ۃDHUhQ-̆jߙ$]Y4]=/&R! (Raڌ[+wVΎx=]?!jߚzw+iK>x<[S,7B5*\qj؉٧UflJJG\-_15\9+0c[;+-)PFS#ߛ̦+vam00hE(-f4KXI9<raQȖB݂+ɲZG5=)(i#$XhI~Vo%}I_Ɍm뫒Ht5o:`J1$
-Mzxla~YqY1+Ş|gGO_o}{]V
(`wԋ0J>8ǗO%¡ONskII|k*?8:oqg%wg+y@E/24u036&#or:nUJ<{M6Tbgs$EI@;+/ a^WXM0Fqy!8QZ47k?v"0@
Uyxp#1!^<<ܻǃlZSi8GpIxʡyM=`~;;4g&pa9<zT̓btM+tˠP;-:oQx!O)zf ؉(zp{:(*Z}l]Z+^EgIPd\;]>8H^Σuoy8Qхm(Yz|KI@1":?92	1L}@fT.țyYr|KHJ s|旡jb^l 2ްn['6(֮[';ޮ%W->'HwB|Wfʶɲ
ؠtm3xPi><gˢ͏5Eq8I~qrT~;zM,/UXHD	+˰*zIP*|iƻ{vX]}f3su*`jRTs?o)Ϲ@jے;Td*.]Uz?aG?eNk>X\OqquWXl7F_exMK5\'(fsטVYQQ95`+qruVrȩdZ;LMSe_dU6RhT׮T5:SߌMOlB̎kt(yi}PlUHƖY_qo=˷ljM;u$ 3a0k?4!SlɦZ5	o >%!ie[9|g&e*&Jq)mJv3lj[_"'
(vtn)\u3lΎ2-p 3u U<id+?9\痍$WlVbr~ݤZı,䅸NQmF`uDWVyhЎ<ι.Sii/s^S59WCz9}#M[cVm8ߔ2(5gGs8W>2#U܏gs@tyɚp0rB%.ty0qP>ƾ14\aMH宼
vz	/U
2aqӞ5ɶ׮S?MMp.oc;t/_ÃK¯ūҽ#WYT=Ni,흀풶)pC	X14\ąq-+KbO c+ن߳ϣFEŔ~&O,_L&iuN'x~UJ3ios%'
sЕŹVxtY,Ι\HFgPkiJDwlI,Wz\7n7D=n'V,
yT.'xnt.	2OZyL=kA}퓭a:RK჈k-C-=n؝\ϤʰZT2r!Uc$È>[v-OUQu\81}ب^nqrXp<ah3	!\
u`SWkG=FHlR;=`Wy]R <HN+.Wv˙[|p?L>v?"&MP@k8]HBbǨ.(|'7VHyL.g1Bbby,Uى:`?:m7|T@pTo2=]gO]巊doC=4I1I o;+%6	^6A_{۪%E1(Joy{eW-7A~ɮ{+HRfgqblxw]C<;/OB\D_IY.̈rTԫy*U<յXJaU5|+s/g6"Jk
{mn[%WϮWYW%_<]ִ%X#c<ƚ`,XjvyTfi0YU02i5ѩw ?+sӜs#GuT2FK=#1SZbrY7rᣇ'PX/`}>/VzEzvATrLHY*)PT QL|)2=w]{@A";eQMY4+SsVho5-U"\x>V>l1Wzvּnox@XAuC͡j.}|f,bZ:Lhw3ETv̵ehT0hʪ3i[q"`ЭPGQ1sIn5Z+̘^n.7>[ަٜ||;M>DQY} .
vjZJ}cb^ܪucƺi.6;݂һnXUFqR]	z.Ͳ~-Ûhٲ4tz*wxp@e	&k(B{#S'B+
6ۓsK.*)F'U7Bɭ02iK#7k	Um7V(Э	tJ]F42m1+˼+5"7gsf+
N6KlP\QMN8`Y'(AFyy^[Ejv_+[D6VyzJ#F;Q O
]e Aif&?;k?Qr,θ9=3l;#2//)d>Th-W,ӿ#,|45ky8}{FFQD'1^QKS?D+Y"8y@1L/lhUZQU?l@U/`\\uri񐕈ހ3Z#܎*U#G{FB>|^_3>L07KzY:IH9:վf̩q-r![jsH=ND-eLA݊+Bb#_xaOk6ҳ Eٌ9`8;oʽMxHrGot\d!FyXk;A\MHw&^qYc)Y(0z	'L0zƇt%k?
@CSt9?pWc_X7Φsb}S,!p5/cV6Ȝ<_s۰!mS6Ҫ"JW3HKVˀn.<<.B.Mx3ȧ2~l͒<{W%ޞ7WK`2˒7ϸ(1q̺[N%*[תW:0z*>R4Ob	ḼֻLR9WV]w~}Kq
df.ɪϚCDk<
$)	OB<<CM,SNf>;yS=6C(<8'2y#֏	#8P1UQσ^p\6Azn}(Y. Py<`!A$/eI'\\j"ʂƋy }Sa>cU5bazjYG-4E0/z"}3U%UXUK}z|-ΎLQ>Zͥ[[l _	[&^yR[1Pǘpݪʍ]StG9UL?Nh-8#`VDUfzg^agt~.6%Wpʙvb}s0KSF$b䡶A>]:;o=U(ZKFdoZgԃ9	s؛ª>$-*hDrd|}QHjg\nɹT9vsY^Ğt7DMy,u$'䎼M̛~;"j%IF]-Xܫ[('3S<c}R4Ɋ	(SFẐ(r8 OA'D2ۉ.9"j$zkR
yJꏃ^P3?^IkvpujzYjE'yY 梐$Fm.|kćn3<zvSЃA2Q&ڋ+;p?08$p֖7wM73$Y
^ATa3añ(J
.-_&)~aW&ﱰV\߯kFxS&q_9t/ݾY&nEfpZUuC\hߺ4J/OȘck+ KAv kd9WٕXloĊsbҗeǥYuqhJE|
/q>OfyW|䮦SWӮ YW|C
_9$6 /84u;n+bb}V4 ]
ows"^bXFzF4e/FT`DK/1ýG>1CPzF'(a̷_頬
~D,8⑏Q6)Rgi4&<ƚ'۲Г(|^iM^XD6ܭ@(s-xAS.d	͗[>x_(ޜXa42р)"o!$NaFTJ{>>g7x2qe-bnw*
Y.R.{spf_gvMU"i#vןCS)?<Mw6KR'A9>ZfdQpf''E7ٖ:L6φe(-B6[ay'!Vva4^i^Tpr%JZqU6"x%F#k})r,A_|sg.YP]F5, hrR'6z'.(w>w5F`?,1]&0?w#>әG~]*G #
 (4ovg^S^xsjVbz5$IE.q3:2VZ4e2:SޠOtWuN} sĥZÏA"8%EzqJ*x/ eZB9@0^Zu#[&0@]oC9?GUAc]Yp"&>ּh!P9b-,g`]yػ*VV_׍ܸ6
<jҩ4(mY
e|HnvT C,3S
<'guU}=ީWVR0u\?}H|?V?3Av|EbQb6I]8
iVʵP`J|YyNz=A0/yj2JWjQ>[-[KHJ)WƵlzy9'ٷeNWb%} ks<L.)9w~'}v#Yīon[Vˡ?$Zcר$;?I/ހ\{_,!Sqr_U`)%wí(Ѯ,LZX:+ߊ|`vnO qd}s%JjU06y =o8&t$rx? k%Fv	Lo0x@&"ax9'Tvۚ|>7t/GӛO;_Ez0Ax] s>80~tF<MF
OW|dVrRP?bAãjAr6;m  yEͩq"N74>'RԶx~x35ƕ[H|;C*b^$^핇>Iso$Q7`m(Ыޛztrvd GnՈ|	JGbM./{卒#q?_fQ "AD` '6a68ܐv_<eڋ}<VTAeկ;}Po3	R5	Qf<Cd~:αPZ0iAjlj	+<eN~&seUgWF:
3Ů>8x>Xg0ssURʝ\3@/35+><	{JFB1;_ٻ
-5\5hRE5HRnhAO L@/ƭ7Oˠ$[D0.,PnZ\	(Q	s	4Bge>^F]O׵y{ u:ʷb=ԝzqzJ،=SO&8$;o{8yz1k[5,琍X+%;Ǖm{ FxLc`UַqnQ!LVbl\lІ57CkcPY>2 C`'~.J`sEi^NZ+w"h=PGb Mk2vt5}sW-`_W~p
E1,_zH 9֥*[+-hfsS'Nمs؞s6owF=I~]-޹K\=~zC1q2}q/ˑAtOZUG\o,meHH=DS)Ml5F[n*ipHɍQִB/bBɳG <<iAԬݴv	\ E\A BFsCI)wPx,%tMXXycER0Q섓$
G1ED@gQ8	~wI5Ǝ^O\mw(3alv֋'""w;[=1+V v³ϿQa1#W|OЦ Z8Vlί}K'?|uGY:O!@~RMP:[^ָ:R̉ђ/Qcn;!}&EfKځ'yC<dH.Dz&Am<6Ńp
m¡߯/,AN%;}pm>={p6?1j~r|0y[H&>qyߏpEKClDrǥ{$E[+sF[|YKp]v	~(+eL9ŭmEY2%z :VZ=hC;)oq):	.ܺ1/*.1Z=(91nb(
<|'-J_K .=l̽Hlfq$n_ ʊT*O|z1mt-
=Rh~r+Z-&&i\	KKL?hcv~ڸbW֟MVʤNaXG~hVn~uN?n9VSeuYov3)977d;9^#<JKΝױd7fr:n:<y
? c{0Gٜ'-a07oׇoav?FK-҄|$n~/}|Ǡcwn'M0E5&9_K.B»"?GNtFY,f7!A>	(!2OрF3o5_R#~fVuQDeyKC@{Cc&ȸtCΦ$f1;<ƩW՟=TD/`j_Fp6Hx@#5ȣ~J;'a:ʽV;򆬠:u^eKg >&8 csL8xoEŽ?w	0vz+eH_Ӫ[ ]|4VemM^뼅>Z\*j|>#mEa#ěE)~E0K܉e?O9Fuxķ1,t3>o~uٴ(~O-N|;8^evۚM%pMeټplQL4q	[Y?-˱εD 6S4#	+ȇG?q+d<bG_|p0^xsten'wggv%OǿvBtrm<sǿX,||}}zo`w{-mw511CmLo'zn})q9¡`Qh%>Lm./b4PͧfǇ瞟p~u,&nݨ7qA b	[[9>??^S/Q.ӻ{>t#^qރ}!޿>8ǗOxdqig/w	Iw~}sin_/~~FL~}+-ybj~bǗzҫ$!KՓgJ3Z15+Ivz4ՏUm?w[v=-6e5%o5>xYhi|I#Nqr kg}[fZe3,~:`;Pϙf(HQ|e	A"=_KKV8WϷ).ŹyW
y7,w`i=Y$WK9xkLǊo̹-,HͣIM`Q8g_o~G{ M^U`$qæ;8W/~wz\FʱҲeyuF	u==yj / 1%~xPSC[NŔH''4B
QߟEjprb՗ʢXY3ǼXS. ^!Ȓ<l˲|x˂	&
ᗽ&;Xu_kjQȁGot}j|g'\4w4odWj(d&JcVen?VB?
&˩7[N>Kv[e[;*WjǼFbݧf҇=[E;?x̕WR˺A"+V!bj`	Dj3*vZ펻aUB97շPo4ӣVwZS_lNnp>eD-qC@Nl΃0hA<t,$y4_@P0M1>tJQk֛$i]׀MV:JXM`ƤI,v8e٫뇨TK?(yuzm<gO_.^?+	7|BO<9^ou+U$#IvOQ
 WM
ٓ`+09}4<-tȊA}R4AЅ
|.);	 ٛ%ga }:2|~¡'Kɥl,>Rf 0-6'a<<qXN{^NX Z~0bd)*w#J[[	F+IblC):ˑezq$Ḑd_/,1pQ8-1]E
YPOz?=_|UCag_40:0R1C.|ߨ3E0{] 1GNѨpo uI{k@5zXdYMk% <q%AG8a	euY31uFgCxTw\6sZ- u;0 7 8N۝D4 n:knV'+r"4Rqx/8:@hc.Ey*!^ @:| ΩUر( I 8d[Z:.3Y"%78.&0#{	_Ksr9;۳Mrc%pzCpaLZBfT9}M{EYÂ\0ᝲƢv J#W<
ğS+3oqRFN"C~p`J6^ج]5HEԶa&z-\Z>倌Ӑ=a$nF21&7I+quFC?"o̀8n7p Yqf`jwY$hț=KY(1LFϢ˓d,2:;.k8KڨcBO/=ߌ#yI!<o9fb9Gf59X>	{q.u
Ftd:
;~Jfr?ơGAʲC32:^Fo7Xou~CثO͠4FplGXC$r0obK1\enm30{v(,V5 p]HM@h=`8nP3)n ihֻzM˞9Mvڽf'7x:vq	qnC:FԒ-lt`4Vc:]춚ݎSmuWXw[nbt{	rtZ@ c7Z=mvngnmuꎞl$?۲fuvV[OP=غt Nn{ӓ-Idmmv.۳;zrvف|{'WNX^@0]o9n4{vJ?vZn3ިCG/:`t ]Ýp0:vxA KNf;nn@{0:@EPKfn^p⎚zvsZY;aj5[f] ؏=~tP>Br5:`k]94BF֯È`*dh@?840LvFv0dƹ2`^Bv|$NK
ln= u;(qXiaw|n#CA
=׵v "n#ca"q\
;E!CPh%:Jbv5 uӁamY" 8 զqZÑ 6#Z$d3080B S;;.IΆ6@^p[-]`*.nàj*S3i].vi 4`'J0:nl҂j`hja@L@	R;8Z;6DMF,XАfNA@6i4q4@^g
5	TH @Nsh(MT^Ch5	=u. 2D> Ah5]BtdLAFj# .Ie`:(TV=30mmTJ-Lvnu1ݰ& ho&C]hyՁ$:X1'FYՆ$˦Pכx8D vФQ&C6PylAA;AVPZ׏M3A[@չ-+&pm{!:٭t@At~L˩;=.q@wPq:);jj$\-7vnRm"k v2" 6G) ëAv6A4{u*A -ABV%uH+kԄ"	0	K`l0`.d2&TХ(C37;-Ҡ=TDTHs9]Pw]U t#*m`@dtzD8$p5fIԄanQ88I
l.mFh¡eǺșA+'=nOˌ0n5 pRau`abO.6UOn>$66DUT0Ni{h۵hO[@j}!HcTTJ:átNud喱l$r4EaLhp@wl94rJ %`t?`,}-.KAb%iP(U:/4WԑF*v t0\:Y:D&'RRu%jWAD 2cG.5j8ua솶W݅N݁VFg##nȁMm@L\A3hD`X0qm6f'%`
ݠꔼ(%AoG-Orr.(En:zYGNntP(U85 pAT .{ӆ%KA=w%/jFBzn=dF@ `B;i4aVCQtr SI L`HX80fLu2Y|>M8(4PihYJ؈}w'3h+n]|1 ~6긥əQk4jbhC7
&XN]`)I*	 a>0F`>(K93,0CØ$]-3f|E^k)P:xʢ>w`[tLS3чt`D)1@Ų"h4.N3чZ4;UhO\MFoV&`
TTy	{P^} l!ptA=4]Z	))юȤ2LK&pR"{G~XhfsCq@6[HSyEH:mWþRwU?5Qyz
8j"T!`7L!Bd<)Qif[: j\8WPH6oWp& PyD<gM4ML;8|Fn:W%Ɋ4R$v փ>G~GTWFd`G-O`?bnSy#d>`{߰p[¥ԁ[(AzmS
$@xxQ8u`r]XMb?_.!7t!礿q΢O7@lȏg#/x3?x8wYd?h&i(epwp湗D{vf~̗g;H`v4-1Q)VYD?US+8w /K҆B_w6o$7Tn#p79eé7K&Yn{z6o|%t	Q`6U_,W{q$/1-ZRڋqBF{.7#@X;F	F{aj~9:.p-vf))-(8leJa\ri?Gp駃3;j^%UEME /qk~Uǭxv=%-])MLuRMEN5OȠfprloJ͸7x	Oב"*-.Ql +oUNK>Ŧ捴mVK5O|9sԍѓǴur*x5/ʊ/*VWt=̋˰V&` &[%Ik6m<3L%@^`ڳsv>Z)IsLSCDxq*9<OlvGUkci/:MG0&;G$xKN(#ȉR-UWW+BWfEy.+	]TJHR"B:k&&7Wh_WRi ։*>SbDYo`nY-wZVj&kx0H[`A3 {i$fӂM+IpIu;=R.14fs.yPdcW#>@[TVt:"@άk&jH.~VX27tgr$ ^3=)Y4-xmmTX&rm6k;.1
1[M\SzLk9Pп|r]k]6an2#m9^x23TYEVĿ`O=R[F?^YB-  LYD%ˏkbyt<=q~?MׅI~5P'j:$َp>??⳵##[R]u*!bvżwl4)*hs^ިʞcot4"BDɊF)LxiY'V<*ä<GGGB#î!_y/j6DMjC\j)qgrXo48_7u$BZd..9
ӭQKڵvb,a\,8xLS?8r9֊͍_C?_?~J>W`Ϳ/]rO٘w(#!*Y0ٛ74f^nخ;t׫-f}~F,` |o}{]Iu|	Y׃.놬}_		NքuD&w`q{'^U'0-H&K#q(C%'>>_|7[tRt/+_L3L)8GJ_7ỹI8H *+Q9u9eeUf*>v 鯻Z*UȟUeL=k
CU+LsLQy_r8U˘0gCuG]6m]7^V,#Q)(HuuҿAiNgY3G.e^r6S}Sp8TTZeik	kq\_Ghsfك7?&o&ߊw&\JoEo{C$3pLMQg`<MuRZTi:x$G@9běWY"g+J}9{@z[L!wchxf##c4_0|T ;țJ28iEe{z}0>
+c|]bx>F_oC/-cU7sȃpo,8Ifm̐Mhw_8xBN7{m0x2ZݯgBXA6RK;_n9s̚l2B2oAE̸*Ēʆ6GYMiVqERGSGRDo`&Ϟؓ?:UMEZԻ/d/͂MCA иl.1kHHR,4+)DSC	+VU
1A$Mqs :̠&>{>">lUFGN)NVc_i2bIvS]fzQj؟Ǻmb1
@^]K*Ya,Pj!d!!}BHad<_eI}U-rD:,zSϊ%ٲkUpx]%6Gw6S
X~,lYYlJL(.Yhft^28S`8o,_B`X"`'h(f1΂aKD6?9`&T0o'!UM/.xIpW}p,ZD^]+
F^5:;KΔKv3t5Nų)n@Js1 4dK?+I6)a(%cop8F#5y}AsSa0?	ȎDN8%p{8"F8>b	B赖#J4V+SRf T2BI:nMݒnYu%f:iν`:KGsI7>%vV(od2vz-rTnE7D~\6FY;zV_}gh6ҩy#4.%ñBZhϑAYm9D.F8wq+i!|k0zc"%Khp1PC]DH7gr	I2L@&9:>󁯘5AkeZT5!g\vN5	ܰ=1;6WDh{`ҿmʬP*_HV&?PlͲ"yZ?_$*,󷪥邇prG{v9k|)щCZJQInE;rmlsI9%&)?QEz%o. V íG	_Nl
6@BVL5-o&b0~(<~O
F?0sG</mo8R͵}h(f8;جq8ddajS^Qw(C{3~YԒC;LFU-1}rw|7)
ZV^{<u#?KD6^~9M auѣA4z4/	LIxpA&n x&=fy~P 	Vj[`=ĈUUQ& 8yƪ(R޷=G4z1k[X'_YDM}tkL\q숥{,WBnP"htWnZd_8Lܲ
>gÐMmI},ުTsh5t2Բʽ,-$}* }eF^/j@ACN&]|*CPmctf1?$`Ef%m+FvFvA4]$HL-{73|W{Cbp8C9Mċp'J5B_==	¿/LvރF7j1-뒣.к_mI0DX04pAU7.]@L#<hJ5pBP0;c+:swƕXo7۶уY>6soW[ܜZSdxa.NqP8e-
-Eulkv,7Jx!8bP$^~Թ[VE;u~{e=R,ZIR˲d㻼=jjnݤ>(F-FX64boeEiy9\b|zeq@}|A0k`{)M:whZܾh$DUkl$v~Y`	Qltx#O`m3MyBkSUKh%<P}I}aY*y!TeҨXЉMdҒstn95&߆iަ#hZ4@I$n6ֶmZF̀U<'p5Ggv|koy0Ѝ<8c6pG>_&l]TUdgT}r-z$CHx4 5tC3mcBMo3i{
Tqd8)͟a:60ТyaI=nƈF˫1%zE.W-^]t նaRAKxc"unĠwTN)ūaIunI86)FZAIS5NPSaq,$QUőScKbuz	I M1Ý}6g.do32>Qj4oe2P;n8lelF (řp*Y??PJ<zTٽ#ؠ;]$4e`sS2YpBRGoEC ,K\gx+7u#ݟ#<ƢrnC͒쵡Y{j}3zy%z\~|e)
]Iū UWb
l:+P8+D-d<KjP_AEV ZCHR0{~;8w瀕।?)2a;НWܣ/CO~MKNlFZ*cx<B2cy*aպ	=\z,3}ptM$\7">2g]n׾87pu
PhWߋݤ[G.Dm^v/kwwFk+GR8H@Ƙ8,"6]>sCL--{d@oh
\I[`IQUBU`fw;$aZ=%Ǚч^OR2JE**t^+D.vd{,Y${gOap51qpoIh%eFyJܕvi=%,E7Ut?}h[4;~~9<ȇSձF^owPsU>K+AL+Ũoney>ϤtA۠4GҀid7
O-ʜu	cu#=Pܓձf(tvp:wRGcS3T~\H'$ˍHSo4a\N$VS6FO<#.1CS˱5%KsZWοdZ:?,vK@Tcj0c!KQøjB7YʎV6!Chu#Y|8Ƭ(ָcE[Ο1vgj;wNE"}>
q=1sB5C=s=e\Nz5IؿIѦCw? j%^@9$2 F"eS˦ϟKxlGO* \^"f~Ko1BaѺP;m.j}RvLe 	ጵNDvT|]wn@gZL'RY!9#"ӇL־k/-b폳s<@n\_-yN,9L"crV	=b8Utզn>
Ē>BۀiC:|xӋK:eB({3ŻV؄׏&,+^&a"o3xrdr!veސM>OYlj9}ρ?,4WUꞟ62捥3=dl9>M|u^hsM
`A$
 }<{tS[\a}DےqqyoGG+v	g	!>E49lDqeAXug$	jy܆z{- ZNE:&t!BW(<Q62<tj6_K#Igo"ʽ'cOYZ{H*ؚ+Kܫzbw4+Tdp7jjjjjjo	W  