#!/bin/bash

declare -r m2c_version="0.6.4"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Magento Docker
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_loading_install() {
    tput civis
    m2c_start_progress & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done

    printf "\033[0m"
}

m2c_start_progress() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏') iteration=0 length=0 log

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        if [[ "$iteration" == "0" ]]
        then
            log="$(<${m2c_log})"

            if [[ "$log" == *"Progress:"* ]]
            then
                log=" $(echo "$log" | grep "Progress: " | tail -1 | tr -d "[Proges: ]")  "
                length=${#log}
                printf %${length}s | tr " " "\b"
                echo -en "$log"
            fi
        fi

        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            (( iteration++ ))
            sleep 0.1
        done

        [[ "$iteration" == "10" ]] && iteration=0
    done

    printf %${length}s | tr " " "."
    printf "\033[0m"
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid} && \
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    local text="$1"
    local chars=$((${#text}))
    local cols=$(tput cols)

    if [[ $chars -gt $cols ]]
    then
        text="$(echo "$text" | fold -s -w"$cols")"
    fi

    echo -en "\033[0;32m$text\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_dots() {
    local text="$1"
    local chars=$((${#text} + 3))
    local cols=$(tput cols)
    local last

    cols=$(( cols > 80 ? 80 : cols ))

    if [[ $chars -gt $cols ]]
    then
        text="$(echo "$text" | fold -s -w"$cols")"
        last="${text##*$'\n'}"
        chars=$((${#last} + 3))
    fi

    m2c_msg "$text$(printf %$((cols - chars))s | tr " " ".")  "
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "${m2c_log}" ]]
        then
            error="$(<"${m2c_log}")"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$1 \
          only_y=$2 \
          opts \
          res \
          text \
          lines

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        text="$(m2c_msg "$message $(m2c_info_bold "$opts")") "
        lines=$(echo "$text" | wc -l)
        read -n 1 -srp "$text" res
        echo
        m2c_erase_prev_lines ${lines}
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_dots "OS compatibility check"
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"${m2c_log}"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_dots "Docker installation check"
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"${m2c_log}"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_dots "Docker-compose installation check"
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"${m2c_log}"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_dots "Ports 80, 443, 33060 and 53 availability check"
    m2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"${m2c_log}"
    fi

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    m2c_dots "Password required to trust the CA certificate and create symlinks"
    m2c_loading
    m2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    m2c_erase_prev_lines 1
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_dots "Locating archive"
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_dots "Extracting data"
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"${m2c_log}" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "${m2c_global_dir}/bin/m2c" /usr/local/bin/m2c

        if [[ ! -f "${m2c_global_dir}/ssl/config/v3_ext.conf" ]]
        then
            mv "${m2c_global_dir}/ssl/config/v3_ext.blank.conf" "${m2c_global_dir}/ssl/config/v3_ext.conf"
        else
            rm -f "${m2c_global_dir}/ssl/config/v3_ext.blank.conf"
        fi
    fi
    m2c_result ${test}

    if [[ ! -f "${m2c_global_dir}/ssl/certs/rootCA.crt" ]] || [[ ! -f "${m2c_global_dir}/ssl/private/rootCA.key" ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_dots "Generating private key for CA certificate"
        m2c_loading
        mkdir -p "${m2c_global_dir}/ssl"/{certs,crl,new,private,serial} >"${m2c_log}" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "${m2c_global_dir}/ssl/private/rootCA.key" 4096 >"${m2c_log}" 2>&1
        test=$?
        m2c_result ${test}

        m2c_dots "Signing CA certificate"
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "${m2c_global_dir}/ssl/config/rootca.conf" \
            -key "${m2c_global_dir}/ssl/private/rootCA.key" \
            -out "${m2c_global_dir}/ssl/certs/rootCA.crt" >"${m2c_log}" 2>&1
        test=$?
        m2c_result ${test}

        m2c_dots "Trusting root CA certificate"
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "${m2c_global_dir}/ssl/certs/rootCA.crt" >"${m2c_log}" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]]
                then
                    yes | sudo cp -rf "${m2c_global_dir}/ssl/certs/rootCA.crt" \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"${m2c_log}" 2>&1 && \
                    sudo update-ca-certificates >"${m2c_log}" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]]
                then
                    yes | sudo cp -rf "${m2c_global_dir}/ssl/certs/rootCA.crt" \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"${m2c_log}" 2>&1 && \
                    sudo update-ca-trust >"${m2c_log}" 2>&1 && \
                    sudo update-ca-trust enable >"${m2c_log}" 2>&1
                    test=$?
                else
                    echo "Currently, we are not supporting yet trusting of the root CA certificate on your OS." >"${m2c_log}"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi

    case ${m2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(</etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                m2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                m2c_dots "Creating the resolver file"
                m2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                m2c_result $?
            fi

            if [[ ! -f "${m2c_global_dir}/mutagen/mutagen" || \
                "$("${m2c_global_dir}/mutagen/mutagen" version)" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "${m2c_global_dir}/mutagen" >"${m2c_log}" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "${m2c_global_dir}/mutagen/"
                chmod 0755 "${m2c_global_dir}/mutagen/mutagen"
            fi
        ;;
    esac
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="${m2c_global_dir}/log"
mkdir -p "${m2c_global_dir}"
touch "${m2c_log}"

if ! docker info > /dev/null 2>&1
then
    m2c_error "Docker is not running or Docker service is not reachable.\n"
    exit 1
fi

if ! docker info > /dev/null 2>&1
then
    m2c_error "Docker is not running or Docker service is not reachable.\n"
    exit 1
fi

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "${m2c_global_dir}/build" ]]
    then
        message="Install Mage2click Magento Docker environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "${m2c_global_dir}"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "${m2c_global_dir}/functions/m2c"

    m2c_global_load_env

    m2c_sign "m2c.test"

    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"

    m2c_msg "Mage2click toolset is successfully installed!\n"
    m2c_msg "Run \`m2c --help\` command for usage information.\n"
    m2c_msg "Visit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "${m2c_global_dir}/functions/m2c"
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="${m2c_project_dir}/.m2c/log"

    m2c_load_env

    case "$1" in
        global)
            shift
            m2c_log="${m2c_global_dir}/log"
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    ! m2c_in_array "--help" $@ && m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    ! m2c_in_array "--help" $@ && m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    ! m2c_in_array "--help" $@ && m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ~] r#G(8˯Ȃ.BU&Q$$NW$5(	$2YTc>cv^`vkK KfHE qppo?oj뫫}vw}tW;+ݕtV3\qF +]a>vzZC~NR?G翳^w۝D?Pאָupڏ~*w8hG÷8hO  a-/v!S46`<VVk.)M!xL3O";0 	?D6p<ceuuݘH"Sw:Jv$ v$s>ۅ7^㨿aXCmvX26#oG yKXg?6XYYƌp<NQ(f[6[^e0nis2'QVx_ӝIF_&Y~\>yBڟ7>_XOam8_QxZoXɹ%;8Ԏo:_.wG~ăȟ$*/zC'	ωi4_n0tp::A7&у=f+{'Ng_XzyN#r7
E1mo֜J{,8FZs*N*]˼FjoלcK URT*U ^*WgKt.UӥjPMߑ{r'_./Sg	el\*er*d:]2`ϼ?¿ -՝"4^^mqir99['Nԩ-~P޴Tv.j5I׵f0E|z`:9ݯVX/XmǺs0-LkQ0,r/@L>7.N3|C$Efq)P+wPiL;-pǞ^H|ꏽĹv"o<ݭ?:_gr#5NrRk'V@pfR53&~z'a8{[9oyu?}n^<:pqg먿yZ'k:TZx+:ifC06wcw3yp&BS=F=`(,_y0k=Gm]%+/.{7:hGo"nҫ}æi0zw%wd,.+s?
O	fXApG80~` ;b	/aonni{\뺱!^OCX(qVWҿ,}mv㋷K{px[~ֹQ2տ9n֟,֭֟8y4
T6GnWXz}	}cYο-nbp@lO4Gj"S۷48vhZXR9 8E췘JmMQ&糶 Cqm]Ý35;tO+N~Wfwe1byyxuyF{s XÂ3`O@h :5A8zFߍA8zm$sw`-/8`O5ءVES~<'H6MrA~E0NwIGr{͗;7}}>DShhl\.~cL7:oqjY뇓D]ƀc:T$;
f;ۈx3'ߴް%BEv"s=w9#E㠖"$)l)OCTP	Y`{s'5-Ғ;ϜNYE2vuI_ k*@J&nx]*X(Μ40EhЬ۷6.4;ce5oYY%C>"r`zl՝֗_>W?KY?7e_nۅ*9~SaYfZ*yjǲJvTSF=KEwSA5^9z
FAy~NIZ8[*Iz\<,>l^Q&U@@{9r'J[\C$Hc7~.m<Kn|\=o	tԻ<9(զ2kef'SL&}ͨ^w:\k`j@{U?03EySPb3`SPlߓhgC!A]w=sNhgJ"?#tc<x $wع"7ls1< VہW'Mp>8=<Yomw,jBՌe$PX5+HuBNLז^UY~Yj[JG_TVSc.*jxR㲐</ޘ%?^_hƉcqlom~ycw3on2fLyQW9GlOI8"}K#AÅ{{B(5cNJ9߱
;jj4k$WO[~q~'_K6Lb:@tšĊkPyK/Lg pBW?0G?ﰯ/^d<[;9xgo?;?ͭY#|hQMJum/>7FAwG.|p? V,d]z'L#m1Hͭ6ZEj,]IyMN77RnKrk[n!Hς`>*7"cO"dx͇T9E"9!@$O4Gɶ
Y1jf4q9v=4P'<?~zht󾀬y;fArӸ)<sA]01^Wh!C3x,dvϨB!QZp)tc]^Mǰ@*Ys02<q 	(1QOza4$qY,%[fXkyֲ /#-Br(Y~y,bp=9` S\P~p*ռuްnUm6rD1'6,5px
Kh<IxQpi5N-ppBl㈡턀d0^G96XCW1:?֦wAݶ]vҮTXS*V$DFC>}J.V*r$ӸW汕0`+<9rK$e鵭!2VxFEg0:Q18ߤ!Hw`TVRI>RzZ6f%'_5rU]J\Z8	'Y2AMv=&CW k>|^[	L>zK3imX[GYꖚR+Bp?|"9dLgf#hyDPh+sjƂ!9K3ݥ%Jܯu+堪הԤ!v>msObU܎2\g囘4GX{m($e/[$ٽ#rWm|+oö|+m[Q=`,r҇zjc%ǀY@)e<\dc7twˌZ\soQMD14)ԥ(WX(5]!ʋ?Z-2YzFx5K\XWd;7!HG0duM*
B->C̶_շ[Y~W,-Y=S/g3Vw=ӂknw=}̱Ph<2T.(.2W[̎@I&kI
zT^="n&%|k77uK:a'.)Ƭ_GKK+ʱ bǟ6 e5gOZwShFK{`G>=Ç͍_^'En87F%g-n66Jj};647.Z8Օf9ys}n-iczM~qui]m?7!өVOk}A_^mbv?MkN}Ѭ+uGlo4`7qR}|{$@(팂tVY3aG ?^=iNZ9R$|i:^:^֠.ws|}?<<8ѥ{gqP04(yXK4"w	at GUl+xkbtTgOQ.~L?a@NO9lCq8i2;"x*B ţǬ^9Riw^)Vσܣ*qb=h`Qd<I癤򞸦gfKTka29]1QVAʅP8@wrvKW,UsZy{Ǫ:9hrȼ<T9 sE\ l^yR9_YI%n>a+yZԘa[ŭ=fJ'Nn[ аpm]^6`/Hң?|Kkݸc676K;	I#D4pfhgA'Lfbx`5љg")SHNNPŹ%М3.WQn2_
|G+@-y31^RMOFwǌ|xscD̸O2틺8#ƛ66޹P6;`æ09W9q!{q;&]1c㟝'/y?YxT?qt'hV[.٭!/wcv7[n!­ݶF[t5Lcsϋi)	T LjJ(0FR5ǤYzsY"e͢Euв9DG_0ޣ<[~cjŭl q*@Þ8 S=$)@G=
AnZX#çz~m 3	qԦ٭7ޒQ&%}!&ЀCLH*$aѩe<3"iqGZv@'xU<2k2-aJкrE%$aIJŹz+n,b2gHLtyKf^"м	TxY0m	GTv>tgewx^Lt_sJ"7,wې[ZUKBGիN%.PW`cl9w-GJgVX"5(#ZC	I!rn1r -Zl60Ҙy^	W2H^x\ft=(T xb]`2=u ?u ]&jݹQCXMZ}((^9?g#nw
[Ҷ=8E%bopdԋQǣjأkMB>2i\MZ G<V3˩\V$7ZnRǍR{1]p?+sfc"
gbo!IF|;t᜻s.fflFlwIy{CoŤ񌺹,|mܦT@a#_W;*(9N8%]>=6#466$dk75Mȴ7гHg[㯲 s}!(?-t~xm0k*SY4srd~Ƥ&5X6??b6]i;6&Yt(bd-Җh$+N]=*sK,0<Ql]8MY4d[pXCLuM:O,v;òsbXba,e@* CX&r"3j'eba  P `O
'e3/g'_f~1!:bl%b(U`5).ݑVC1RXAZ5έ<wƄwцPGRmܕfp_|O*4δJlzb;;F^xbJ=ɌMff2ɦfe%1Z29|u'a%D$JgXU`TX!zq(*
rR_f#G	P!?`h+UdQv`9#7`E
K OOxQ&1p'^
27
2't1Py'G#PeK9l!Px(*IX u
B޼" =jzdYGE(L"8C#IpAvc9;4e}1.~kA>b=m<l.LWArfFT[{=2,D@t:10f1Xe+c}t":j)v:n\؍"[EaxAѦe&BlSP6Jm6HCM.`<ܤ%%l~S"a)X02%]Zke/k˪",/]#ثFD	тh@?mm|[ m|[ 9hE4"MD~V;Ls}oI62ȿ~!}.okۊ,usYr@CWVͫ#te=,}ɲg}ot?q#w+TV5'@tߜh!|bTɾVF{pI)hD䠋i41ϒt&n6^sx?%lfEK0iwӓ0oL^[</kԋ)iSR;Th)Y+_ˬI_1rQhۖ{ȍ^c6b㓍g&1=TƇLYV[D\Cd[󫞴-=帝$Ƶ+pOgռj43OIaknnRMF0μd5Yϫz~jt$QXĖFG#sje:Ub =9ѕy3^BqOƹ{bwXlD-Kqɲ\[j-X6e),D`[i6GJP~	Ŝ%י'wB\<-|.P'%WM߷B\CyD[LQCJvK	wA	E8~
4Q0!͠XڻmkN:ۚxD	Ly(!	g=πi⻠6~
5#b`C :H!J%uɭ"|DLygH5Pm#~*s
Urߏ)a 6cӦcb\gnɜ<݇l@|$om~?I2ړ;c1DK+qfb\I1'זgwBXI0ev,G>Uϭg(h^D^~g)NgnE㲽/BiuW.Laqήz֜e3n  xo-yˬ(3	5Qr B'<\W9<{߼awճ4aC `I>3ڈ$nEz&ײas%Smq	f=:rs/9O?c'	G--7Ot\\z4Ñuaso-OZ&N~ZZWVZ+:?k=ReTMSTe`4zΟ2f-nH-4x3M
%j5m&^t\gV f!;gQ#JEN#\a^6ŵ$Շ]
E76n;rVg2NYٓ]GxX~}cW}[YM|9]mDNYc* OQ	ehotnu,HH^&.ʚ(EӺT	#hֳVgo*`򄣌>##,*#p <~vR3;~c2t!q=M@}KJj)uD*8dg)CEwҤ)CR4UɞdbT﫞+YEnF2jRfrxS(N3Ɯhv[XGP*~	Qo]W0߬}>5(gYj倊O\%,a[i 8-5+5;_~aMnLgie ;0/&qCzh&"=5w~Ud]3GZjȐ<y!b&ro\7z5~Y2A!AiN_,h(M y02[TQnF&uLGL'>p2aD
oz0%+Nߩ˧(X)XznŁg9IoZdBig^	Μa>syh4@EIOB)(\@^veTA]	T,xLB.'`]y1#Sx%&{C804B/ׅ2D!^-?oom~ycgЙRÝ27/h-yxO{9eKj g{ڲgN(N2I݃#ˣ߳ew ͡!uigKG`8;iNM2/6_NWj;~)c08}{ZqlDe'ȋ S<_*sx1>xB><j37^k`Ia^=+`ast`,"C'>Bd[!<MlhM]<b((A Ut$aFλbzlȿ@r2Hc!6y#DM0DxVqdCgAۣ蕸fM&%eFAߋz}OhXpobq8̉i[Co2
6"1X[I_Q:ncpNZ4T	0
&vZ]g+.T&:i-VPCqF\)yU\}	PlcGwp.#V3ܼv*W gq{)uHF

R@ V<0I 6in#-.Z^=Hiج<h9;BhH
W˂J[8$̊snPJ1ݩL7պr, 
͊xK5+%*#A#p=C#ςV6k8.+{/ շ&>Q9(rj
{^A Qa{>̇r߬XV2Ƀ	ՊbrGr͠btty:qw)93+r1疀xݩ7og+um1Lm2p49BXgM5);bWx{K<jjxξWYo	#%?P(Xv1vy0Y$`^yj+!0UطZo3:0,ᄏ$kN,-3Sw>uVq%:Mk2ocqZ(Nna̦p$PS'-
doR4V!g'7ͺť3i5.g3M7œnz,U*rʭTHm(g VrQ͖hD|0Q<;1%d|e!\g|4CijR$Wx<-U)d;	\C|Y[q¢`*xAXV6͊cfMCp-3`o:eG69yh쓱	1sU:βnmUo_j7 |d{a9gm?
/aPE\ylhbl%>kI;fov9x\PS]I }We5e6P1a<,XX&U*tA6f?0K̫t̳kjVKEuc&v^|	w DZ;?A!sr
chi=J
5`ux?>a"-rE˟t"3 Iq1.deP~c
*Գ	|[Ŕ*;!0xv˕ɒz0[87i,vj}Iom~%0l~ gb;aJ0L<g8t(j<,aU4W寍vz!Jb!~R/9)sZmδb+,5V\9"ĻU\!`C0$竵_Kp􋋢7ΦT%xp<LW<Wucf<f*`@+BPER39J t`XEzvN&~I΀aqRe%(TTKg|Gږw*BXUK	`K0b9e*F7PP2;Ӈݓ䚻(We-ӉD^I$^e$
߉
(Z
=SO&Z15n.y17F^
&#nSh֨pEɺSIO1t,jk/
W.c/:Y;mICT-`]4cLkvzUYTBtVJK9r ;胨WRf~[OPfҧ#U0ıQDCBQtrM5xƐ0eraΛ0_~4I\|ͩ赶1\ZY);L,B{Õ늎0z(Uf-P^n[{7ˬ;-Ur)蔲S+TE%02DTGIFn(5=a;?a2i4LjtiԤ;CS@"B$'	_Z1&˦UC<(rHu4JwYʎ]+mx l]QHs$wZ~CUoq6v1GdB9	\,Q|"Zy'ԢS}$
C&R%-YQ3<#N1fK,b$NvP$豐/~rgAȕV$XI2>/"c`V VC@,GT	|	Ƕ { eɟy|k7o!QNTl.qD
:(i.z_ͥE)L	,ÐqɹEeUԼ]E71s	y:<yn9#6cMfT޻<BUϼe^&KrIrtZ֜'=sѓϬ{EZ'ttE]h5;dal{OHKu
4]ۊ2K;<wx݅%*S*D?vJs[!JWeUIe=F/(|l~2Gy}t}U1V%SN$#2P8_t>3LinF:0eOt^;ڔ)~sw3Kw?]*L'"V=e	5[V;K.<04||:U"MkʯZgp#k9K:)Ri(VES~u.]%5fecm8*F6OF.b75jr)CEt7>m%?spͽo>E^{Y>p)<mgrH%	-HT)Il5(7{zxmcM޿E(w+GBX!UkfZ9 iɐU9%>8:w:VեO*0G@Wy0zj:<rF
0b -R_9g6#h
B={~ <`pnM?bQSm(NRY#!j4-<w"0 +p(94}⎱D<qH 姍yثNXa>:q&tÇ͍_^$ssCƿ-Nu̻
辷iDVKѸwO51Ǟ{NM{ť%*=& ƭg-uB^Vq-,)Fq%NpNn3+ךesrִs\k]X .Z̅9mw`"_~zO?| nN-4_z hpMiB-\]C~yԱґVc:+2=78Y>gT{wU4f3kxf!@XMamN^-SU'WNNM9K(79#4/qboDŤ+4
#uhQЮʅ"H?OTCy|zvl4(a**Zi5^%:CyGAFfܪh%aNm?fS* "">e۝T؜i=1Zi޲gh?I\cH|Wxڄ't$D7\ؓUYʓ`ts8 t<-=ߤX(bD<x4}4+i匣qVS#yghlTGkĺ,=(RUC<`F^[tJ:%Ԟ[&Ca<n,kِq Cv.-%Ŏr}k%J&v)0["7G^[I^=C?+CrM:YuVJ-X\;9yqV0r½|<=N&^DbӁakNK&/+;!
"2i.ԝͿלjfnW{	KϯFF,K+74iQczh
\%a@nL5wDMzeeϚ"gظ 81!餁m.EfU>0,GqD-lG[<y%eLPjTR-C4WchcYrz['~!xķmb4r;I99	{")1np`~x%LǤ0`Ҍ^{GolԳ:
S*L9ClTU
^O#`"}`z 2#J{TmevoOv!o(CG;e,4lĮ0)[k^󃻦a6%lBl)$~sSbʫTuPiA~ҧښVfϖZueIx]=؄좬7H<'~Blg 0>vA(y:aXXf)fA@#B+H<*s[Ϯq6^pSh`ca}Dņs,*C_3b)Vf4q>kZ%)3Ɛ#ݗ"˰~рNQ3+9J}F|v(:'WFtMFY))+BGZOcgy"dyzjWRk5Fɋu´uyyXP-0_*^[Klj)')-dH.4.].Xmqiuu"AjSͿtHy.9KoϥÐ.+<:}0>*ʸ\t3でdˊR8:gfKܹK_/bwNK9!FQ"!Tb*Бt6fjB,&ŽE>XUW7}(eE%E1\WUvV)bg|*[HV&pЙk x-5_	_Ҽ<`J-J^uT v#*ܻ#EW1ͅQU|TZe+Vg(ݐqQRۢ4#)|lycw -h$@F">"H^{"@wK@M\3!k@!K@%<͢榉P;9^4硉GDp(>&B)gRޖ2QTS@Vjcӥ9 iqck!yvËo蜢Ó^;+&L)[ی|uN
 WqpG+R6ȻFMAw3߯BJA|*(z'CU44]ؽڴ:Mji/̋-C)}^iI2k\i|\9zxv)`3Π[!\Yw>7 xsR>oz-׸#;?#)0*CgMA0 *z+bWlt`Jww(|W5 o7GK
Co{z'8K+zdx/E?z#F(5cnU!YE 1yRâ%uCUUL/MqQ3gDۋH\^DݯI(Y)~i4Мi7鿍i%舮NwS%]7]hRG/z*p¡ȉ_M$R/70,(PB唋535ZP^)|ť"u,vpM4.i+RGۓn)/"%x7 vIA Kla`M!<,KÚm7bb
<~?	c}#`?3Ҧݕ7V^)rV!JØOpN8qS&igtܹa ܄6saVOΧ'xC(?Ͳ#2#_)ha#4R6P^~cw7v8̕q6cm{s'ǱSNsgsE^U4n0
*MR֎dkW5#7wv[ZnrGI<2A'/-+&JZ&MUkn:l~T\y툫ZUn{Mv[K7W }aǺO[~E#jYuw(-n~n%|iYGE-i	
n?j
R0vI{<k5Zfz ʚeuM=7mGc"pp@]	X֜2@,Us1
ȍEju\7U܂+?x
zy];A@*[	Պ{_ܲrՀn{"7Wb>y ]}pPޥӀݿf/Q6XL%q)0#a8c̢Nã`޵^vZ["Xŧ9oG2qq)n	LuXy-p1W_xs=İXwW7`1B.aib&c6sOh6(1tksxAlm2/Z1y4p`#(+[	ZcDgHڭ1845p;B[MR-ީ_7ej^EU0q]5,Aa jsIZ4ԘuD)3&{s8Qtmɱ_͓/}_$/Sӫj
(Ul
2j
TbUt45=,cd5U	5Wn%-h]ѣ11̔?&}%-WaUn#k.sRuICa/_6ҫW'yZ*CbԦEHӇY$D:!{۝Ѵhʄ!xdMϏ³u@~rᐷ3r#K9"&sD.x+e*/Cپ a:ergv^-<}pՙHjqaa6v?dMdK_;&{NNL0I8E,!W9з<
$
G1`EQgb[sN'.%^٩Ґ78Oyg&:~b\ -󞙖cڧoJv{f)Rk{9VtDw־Ey\aC7WF)]di?)Q
H[Ձ5zeelNI&*0'5Cdy~#n?g52 vi04#xN8ypf)ޭD+>Yѵd}w'pv/1!/0Bn6'2|G,rѰߋp,oga
7As--yU:,^Fg였	t.i+E^t1)zf߲i2&Q;]FmkB(TƝ؄1^v=n{(9g}Sۄ|g25
0>''gnv4xTNyhfq_Ow8v&*IIuv2S#.L@ZԠ96bW`` ;e2	c;A4#¡x|jAxDD56Ck]a<9յ6rJ{Aɦ)
 +]a>vzZC~N2B06*rweyy]^}HSp{h׻+]48ڀX[Y)14AP-;M>%ND\tc[zN27ޓeWFu׍m"Ƃ#4;6QgI.ƥ{ !;]OJς06t17R7&4ga"{佤JwI }DV;NgT/|j<PYqn@wXY٥KrN&p:II5Nz"F)T}WԟB9T^snښDp:HLώGIvgʓ ˝xwqYPayKTP&u :Υ
z
p9szyw"1	c}#r/lg#'3fPF^[߅|+!?Gpjպ):`tm }|N60b@ʂ_BX9kKGi飡7:Fux,nCd'k0+Ep$C`eQ.ejG@ "U]ix-v[HJ@ռ>7qz7ү~}FYi ;sEv9:C7Jȯ@t^DP- dN(z3%3̛(xޏ{?P9:T2^$8-eŸ/]⳷QwH[Y]rqThE+҃l;])a֏nLF+};m(|?OYmV"G`iccz&~mBkGBz6K,3/rs%<}}GQ/fӻ3^@[/z2a}{6vop瀪YwK@#bokNpΫzãݗ;j=Ŵ^y? mʁ4^#9${{G<io_iQOw`>"\^w^oT{xBAEז}$,|~oUnn봛4lVnn֭=z˟7z{}To(˝w֖B?٘\E(iP AʯOn+c
x+ٷNo:lEanɶR+w00}Lz*s(.Ux^}~̄:/dveh { dd{S\+B5ܵͬ[	U;[H~#XEAscTf%#P
q[$4o~
M]6Gm	$l4PyAfq#(x?P}OSґ̆`a6"#Qf'w"Ό=ºK`U+BZPGɀX^#fw7OY}$/8L*vHmϡtJx B-U:b=2<[R?uW_dh *&wRvcJde3CaP]廏~۩GɉPf=m?D*bgԂRU!jv+~Xn?vȉ$NowVֻUcfZo9){w0WRRJwwV׻U˿(?H	b(<iGq?vsR3_sJk>%!$L4:AEdq's9sR/
ǹD8?c~gUTYᣰ!,cYSOfM=.⠔Iڤ$MAAf$Ib/ߟx.[>LOrɝ3/|֢?~Q2#>W$
"/ghC@x[zԁI/WDoڒ<7ko䣌OUMYLrp4 "rbC	F"'i1#!}z|iHuC8}<gxq팼,9/ٽt"ڔ[*[VqDkkχn#\[lÑ"ޗ.:r9S{+rꎓ~Gx'z5O?71dKnQI	<\J/-SWAx6;}Y+YG$CjGCZj~M-T0J"l:v>>a~ɛxo?ݘ??L)32@ԁLq|fx4J{68wC%h 3d[|8Qŗ֙mU?qbtB
5*+x)~SasW^)η"1\^fDgrɨ)}qv>o;~sA@8oqTLj_1W1y/	bD6X-N4PCdgc-*S6Ͷ,N19Bt[jOٴ*uA 8bjϓbhIdϴF8qu8lEq=+7~}Gf`@"1g,FW+sB>~#jF~}"eBЫ̢xV07UaYĚa
GD]eHiR^"!0`iMdȋeM{/{}jƄ>od-B5z8kUy4#֣^@SYgRqI;B\ p&v3'lF8)6D)򬲺pf.r!A{e{ $s¿ %qgiP*l0`z:~h͗~.N!,!.j"hX1FY^	f&{S9ESBުF&[&V H#2bvX<ٖԝJ+|ϪՍKKDRm~nKyK7f?֍4TMM;L>q^8^#FJ eUk6p#9=n&b!>b i&]E
"5dPsrxT1MzD̫J.*D<|i7ۧ#t>őj3FtA!Agb{`Uo#DP$4}sVL<z/ئ/?kz-FF$!J|"pS߁~y#Vn4Ң0R>Xѕ3FJ.,ZH]bF1,RyjP7xH-)2#::Jq"wRBD7[Eռ=!iwA&n#c,`4z)N(P08BXHK6mB	tidnʹ<f
ĉ<~ΉlW^4boAqUGCbocU~>wsJ^''\'PŶGو0O݁\1) 03Fߑh~#O6kmFAhȚ=*U n#;;++ϝZVGn59"zFqJ'6«1=:5SmcF_^rIB8Ai=[m)|SDZ78K[(e^`>g`=e8J[K1jcc7d} }z{F#	JcOB"}d3g Ȁa(f%+b\9q8GɥAH-{>5MWW w]$.kzaݭMG@O[h2=~x*/s lV7ޑӘNg.K~bv:)wl-E#J"w6E >%$HG/DFR~tvM1+v3;- 3p9̠?poxt_'NcWd&`BQm>L83
`׍0:3S~`U9ro],Id/t2rwMS>|XJX-[sk9'X% }/+3HM+&1b_!&l;"O.XفΒ8_
c6h<.Î代P@=ΙD4\/AQ҃r'3LJ<J@SP"lG?XP<jah.z^p]58!?0#թzckuo
9&"j%Zq.FF3LQ`
Kzswi}f:ַD[GʴA?D0S9WOs{}p RhBֈ7u3l$rH됂уLTބaRt\,1LufLɋI_<4LD$j2)h`U\]0ceQMt
7	12&t¤h 0%sdr
ؽϒE-@/t0?@FB0p`DBn'6Iq,~X7/Met\(|#a	D 육P6/yO.{̇鮓Nrc5_HvѲIukeay٩b"JN ^}p|N::1aq{t鶳/Y{sF]$!2p
D_PyLVOΧ'7PS,Ƹ5/D"VdVeDٯ([GNxC&*;@q8H{U3U=0nCcLIzPGti\8Gqt)-k~= ,溿6ڽ1$%MXEAy^$;q8;=Wz (W[H\3\X=hK 	JXqNΠi@"/FSf\HamJQqCj񛀀f&*yӠkmt'S4Qpۨ5-8[m6ԽNMiC0C S=Z ?qM{|Nwz)/T~LΏaWO©s6ΑKP ̐2x|t΁ddC]@44V\!o:id&C;MayDbGZm\-c!<0En8bA+_k} \g; b\9[O>|NXnhwӶJdݴRyܭsw, JX0%vv,ohjPтt0I:N^	oDPY`8?u&?˓|d$d435ُaRIE VF!PA@'IHn';Ļt"$-M?`}Ӭe[0qᛃ-n|S^>rU2ܴ3ctڦhb夡~[A ˩WZ*hEګQ=eSW+(ktOm+l4\#CU[azG 5觰)$N6_'"5RktZM5rlϱsk EX;ݽ7xt=9Z`2 ?P9&5
_܁4g>z]q
3H8BNG(694
eoEBjaVnuKma'穈m@C?;^M?y㟁n-)WyCFdh0iTq>R-Ke+mc7!y{wvQ]W1[R#Te}uWֺem}\
Ϋ T9ku~}NJ<aFn+Lυ~h́~ܡ]ɶEhO=ɔQ6<:zd8ڌtDw+Aʗ d_z WO]Of^{!mf&ދfG,LCKʛL>69w6_(ɳ#霒6	a!fψս`/%-_Q`ivͮ}g?/Mai\e%#E}`aN'R6ʕRUJZKZދyѺ.`Qse5l23o>V5WY/)dce|e`0f;d:66 uIo"tO$vzN$90_A(ߏY]/}2Aj<ϾX49l١{{1=.l_G{ \(Yk˸k+U77]f_z\~@"\LZDt^*FzK<Oe<&*x}J.,(Vڦb>d"O^`#*g 	ςiD.?|}*tp1<m[$bl&!+
f-v\DW}` vw^~0attpߡA;w:4(< 6Cr^Ax	i=M?U?˓>L2`49r_A8Acw_I-ˡK]g%	zu5(P{1zg{zfÄ#G<筣	 u[Aa8T=wnZPcOy@/2\^8Fi'ٚgM]W8j?>ÔCbtoeZ!Kw$hy)ȧ`9>0hiy7S6@yZh@VeAŶÝ KpMCF?w\l9d	܋<5	v趇,<KX7as?^ds %}x^kw@/3`ɩzAu}^xV% 48H@}<N|d-GGQ7Rh@`j0 #J=pY(|E`v$z8< J\X.Z+=ߢ6h !{ɥq:!BoyU2=ēb7Ҋ">9}/)e\̡2Ow}/?{T+3ʠzrF	[D9+W~1=czL1=~7_@G X 