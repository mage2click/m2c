#!/bin/bash

declare -r m2c_version="0.7.0"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Magento Docker
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_loading_install() {
    tput civis
    m2c_start_progress & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done

    printf "\033[0m"
}

m2c_start_progress() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏') iteration=0 length=0 log

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        if [[ "$iteration" == "0" ]]
        then
            log="$(<${m2c_log})"

            if [[ "$log" == *"Progress:"* ]]
            then
                log=" $(echo "$log" | grep "Progress: " | tail -1 | tr -d "[Proges: ]")  "
                length=${#log}
                printf %${length}s | tr " " "\b"
                echo -en "$log"
            fi
        fi

        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            (( iteration++ ))
            sleep 0.1
        done

        [[ "$iteration" == "10" ]] && iteration=0
    done

    printf %${length}s | tr " " "."
    printf "\033[0m"
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid} && \
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    local text="$1"
    local chars=$((${#text}))
    local cols=$(tput cols)

    if [[ $chars -gt $cols ]]
    then
        text="$(echo "$text" | fold -s -w"$cols")"
    fi

    echo -en "\033[0;32m$text\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_dots() {
    local text="$1"
    local chars=$((${#text} + 3))
    local cols=$(tput cols)
    local last

    cols=$(( cols > 80 ? 80 : cols ))

    if [[ $chars -gt $cols ]]
    then
        text="$(echo "$text" | fold -s -w"$cols")"
        last="${text##*$'\n'}"
        chars=$((${#last} + 3))
    fi

    m2c_msg "$text$(printf %$((cols - chars))s | tr " " ".")  "
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "${m2c_log}" ]]
        then
            error="$(<"${m2c_log}")"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$1 \
          only_y=$2 \
          opts \
          res \
          text \
          lines

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        text="$(m2c_msg "$message $(m2c_info_bold "$opts")") "
        lines=$(echo "$text" | wc -l)
        read -n 1 -srp "$text" res
        echo
        m2c_erase_prev_lines ${lines}
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_dots "OS compatibility check"
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"${m2c_log}"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_dots "Docker installation check"
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"${m2c_log}"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_dots "Docker-compose installation check"
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"${m2c_log}"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_dots "Ports 80, 443, 33060 and 53 availability check"
    m2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"${m2c_log}"
    fi

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    m2c_dots "Password required to trust the CA certificate and create symlinks"
    m2c_loading
    m2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    m2c_erase_prev_lines 1
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_dots "Locating archive"
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_dots "Extracting data"
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"${m2c_log}" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "${m2c_global_dir}/bin/m2c" /usr/local/bin/m2c

        if [[ ! -f "${m2c_global_dir}/ssl/config/v3_ext.conf" ]]
        then
            mv "${m2c_global_dir}/ssl/config/v3_ext.blank.conf" "${m2c_global_dir}/ssl/config/v3_ext.conf"
        else
            rm -f "${m2c_global_dir}/ssl/config/v3_ext.blank.conf"
        fi
    fi
    m2c_result ${test}

    if [[ ! -f "${m2c_global_dir}/ssl/certs/rootCA.crt" ]] || [[ ! -f "${m2c_global_dir}/ssl/private/rootCA.key" ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_dots "Generating private key for CA certificate"
        m2c_loading
        mkdir -p "${m2c_global_dir}/ssl"/{certs,crl,new,private,serial} >"${m2c_log}" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "${m2c_global_dir}/ssl/private/rootCA.key" 4096 >"${m2c_log}" 2>&1
        test=$?
        m2c_result ${test}

        m2c_dots "Signing CA certificate"
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "${m2c_global_dir}/ssl/config/rootca.conf" \
            -key "${m2c_global_dir}/ssl/private/rootCA.key" \
            -out "${m2c_global_dir}/ssl/certs/rootCA.crt" >"${m2c_log}" 2>&1
        test=$?
        m2c_result ${test}

        m2c_dots "Trusting root CA certificate"
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "${m2c_global_dir}/ssl/certs/rootCA.crt" >"${m2c_log}" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]]
                then
                    yes | sudo cp -rf "${m2c_global_dir}/ssl/certs/rootCA.crt" \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"${m2c_log}" 2>&1 && \
                    sudo update-ca-certificates >"${m2c_log}" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]]
                then
                    yes | sudo cp -rf "${m2c_global_dir}/ssl/certs/rootCA.crt" \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"${m2c_log}" 2>&1 && \
                    sudo update-ca-trust >"${m2c_log}" 2>&1 && \
                    sudo update-ca-trust enable >"${m2c_log}" 2>&1
                    test=$?
                else
                    echo "Currently, we are not supporting yet trusting of the root CA certificate on your OS." >"${m2c_log}"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi

    case ${m2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(</etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                m2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                m2c_dots "Creating the resolver file"
                m2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                m2c_result $?
            fi

            if [[ ! -f "${m2c_global_dir}/mutagen/mutagen" || \
                "$("${m2c_global_dir}/mutagen/mutagen" version)" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "${m2c_global_dir}/mutagen" >"${m2c_log}" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "${m2c_global_dir}/mutagen/"
                chmod 0755 "${m2c_global_dir}/mutagen/mutagen"
            fi
        ;;
    esac
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="${m2c_global_dir}/log"
mkdir -p "${m2c_global_dir}"
touch "${m2c_log}"

if ! docker info > /dev/null 2>&1
then
    m2c_error "Docker is not running or Docker service is not reachable.\n"
    exit 1
fi

if ! docker info > /dev/null 2>&1
then
    m2c_error "Docker is not running or Docker service is not reachable.\n"
    exit 1
fi

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "${m2c_global_dir}/build" ]]
    then
        message="Install Mage2click Magento Docker environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "${m2c_global_dir}"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "${m2c_global_dir}/functions/m2c"

    m2c_global_load_env

    m2c_sign "m2c.test"

    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"

    m2c_msg "Mage2click toolset is successfully installed!\n"
    m2c_msg "Run \`m2c --help\` command for usage information.\n"
    m2c_msg "Visit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "${m2c_global_dir}/functions/m2c"
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="${m2c_project_dir}/.m2c/log"

    m2c_load_env

    case "$1" in
        global)
            shift
            m2c_log="${m2c_global_dir}/log"
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    ! m2c_in_array "--help" $@ && m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    ! m2c_in_array "--help" $@ && m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    ! m2c_in_array "--help" $@ && m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 b] r#G(8˯&*\y($$NW$gt5PHd2dQEه}س1ۇ>%#"#o%u3"̸xDxx{xׇ^75͵F^"R{5[?{8I@y忛Lx/>'$āZ^Z]jaK?DGw~|o(P~////5qV!q?e#D?z= %ye-D2{i@\j/IAڀ}-^ּ?w>_~jӧLOw̲6[HA|4i|s#O r/
4ar3FI?v1wsCߏk٬Gzo}\'vKGى7H|wI=$Ax~]q=/23>!fO&X:^VDwe.(Ρ:
+zsݷ1q/55_n-CϞKX+=DޠzH/Yj>5޴^jς%8V>K#v$=}EAQo~o+NO搯(CI07{/Y-fعAr=ѶXY+\oU^/I^{q(ZʬUBڛv$a+T
UBUrWʕ٪lS5mMմ6Tw%AD-QKTUDU.@Xw293?/lUZ$5TGje_!}j'2Qzݨyz]aO:_'4<5ՏXx0`ha+r^[.0@K1Juzy.amw9=ӂ/D%w_ѦV̊께6UAnVa[};gFޙן)b?b{Eqʶv7|{r{ag3m=bS7CQC$Jp>1"C$WW;?]S,H6i~TO{/zjvGg!pUbpg`{ciTժhw_iZBQ)E%ט⚒MO݃NeY?nov_mFT}7)'	D|#\.lә{ꊴxEߵ( djYwRf|3^5f|hy>
"i-BBYm\r89olfF=j' w:uZQdA!(\ŧ	pa2v&x襝ǏgX^D?M4\.m]#uRHqI2[<	νA!ۏ^ZHok~qҦ-3/ȕ[#aeʌzokt{Rfea_]~ݨfxpT{[|ں2U=W"Յs~:C&7-0a׋cHx?{o0-A΂,OÜ;98Ni؞lUdwoiVdp6n|j- pB	o9OǃKfmOC Շğ۪;էkJw?N(l8frQлx*_xғG6QstTG?Z`Q(k8ZGY`<hwhG!+kmG1k0:uU%	P|Agh!}rݲ5ǆq2/7~&w{|~}F#RgE[f-ﯡ{1+b\gluy T4...gp`We?9NAČ r^"_7GiU?GD*ZeE')Z9`- Ot tjM㫯__?u\21+:Eb{su=g- ujI/ {N0 a6`>h7byH6m
A ]HIdS!FL&rxgRun4Jp8VëLtaNg<I!vɛk.eqw*;!ld<Bv1Yp(dA :Pu$jFDOf*0>JҊuq-)kUlE&VAH yS_J%ﺩ!ee4cp͙)B9Ǳ3A2v*/^&kpVw6X_U+jUq?O`什fZ^x[vagci )b{k`ZkwB=mjTePϩ"埊z&-ёT7lCTGUBǧTUD
ΡUZLT<EQT(w^_T\?iO:+x|*rpF2w>il֟!sᏓ;<0cEY2	*FքE
	Y3AM̂>h<)lav`nXŗhU0|G@ETJ9 yw&};S_Ws'F
/YZu?KpTAݙjBդқ9KC6慘RuZI|Q\"Ҵa}Aꃎ)iBZζ
%qae^q<?Eq6smVo678خGT<_.h?\#?W|TOq4#U|C#{,5c,FTwW)=PXZmZz95{vk0ZQ).O8FWr5)	5/0CznS~l0?m/^]H[?~?o勷_}р
k6HXFFo |7j ȜN̡(Ɍ9^
!ދcvҮk)ZqM*
FcAGfRdac4B"7ʦ,w`*C$ CuFdR*J]d bdA4B|l`8&yˣq}~3??T DWMdzFgWktM#oƾJ*,oL"6ƛJ[G@})6{aq{[wO:p-$ZsɄڄ#N^"d^|:xDwG8R&Յ(9A3%c<kKV9G_drIP6BIh_^6_ Gz09VQ[w^hS#j	$?a)D#?oSXBQZSix&Y;M]k
C	a1(?Ss| J/ uAbL6M9L@I*EyX2W^ӪTeLQQ/W%'բZ0 eW1`PXZp!-.K]-wy	b`,:o0z{+3{zrw+3gdRkS!+B+XK(/;USɭ[d2Qc|%FJU6C8*.03}qun͐)Y!N]j.8oجJ2f1F^1.9\aǐ8ȜInӒXSnݯft+L@LfZ&īe]x̶u{.bDfBUsQ<7sydOYE_mUTlEEľ**vbwޜts\NPmͫp7+('Ң<tҬ$*IUja=Q!ٱnLԥ(hP,;L~mk5vh +變`sf.Zpȅ\/׾?J?QW`܄nXb,	ѵ0*z~qy%3-YFnF:~LlK5#Ceќ62y/޻"MfP;oP{&q{X-0)[650x/n
y Xf8~-߯/(+'	q^Vep ?^lJ5q,Mv;[.$>J!r)ppk^NJJҰCs-)gTS]ejӹTt'le=B{LIE\5z{M~:]\dgjrЫ;;pai^;p+S%m]GwôhHNg0|f#Hr\ H]lw3!E(>N"lwuHAG*
x獛`{;ݍxpcSeK]SDaxEԢİ
( Ybe`@n6
:,,6=3ĚϞ\h^C|\ن$>pDBz'QtPE&;@Rw'dHei}]jJ/
A|ΡB"cEAʊ'gR{aW,53ݺ
#˔`pt*,V!ijRMgLnJ{'@6oPW' -Twh u%vB}' 
6Ew;Ҝo$7("-kj̲VQg>M'~-){hXWK^0i[{SxS$h }$V_MM`ǍNARz<٬v<Vה03t-e7+Rz&B_}Zps:!4a@sп \U8sXt~TZX;^<j)9rizr;nh0j$bƹoOօ	ޞQ7dRJ~^zÀg^Fcv}< vRI&]qc_Wb<K,<8ܽc4NdٖKvk˝ѐM.aߚ[qkwխa&ұ1I4`* cBdxf(0YFRقuStJ,'7%S.P4Q-cݓVrF9{gMYoLw{Պ A4h6x0½xiߣt)NFLp12|JJow 1Goz-Y`rr-8$dyB2[!}6<liXxDP|Bƃ7|V'*3#8l@i9wUA9,=Tsq^F>L6 h^5Kd7Q
iVYLߐ<:Q3YE8	gW̍%a5O5V*Ak5D# r0p#'Sg.W-h.Ps|J"i:E}V"Df	-6KAkC⼨D(
JEAC"T/2@]WP <L~#4m86AL@@
b  UkFqN_ӳki{g#\cJ?qneFXHn[Vp	Rׄ/uxH0HzA+dQfKf]!fK2jV?5}|S	\^|v""7JDw87tfk7kQC<(='nщ;}vt-b,O{lMHs}Edwi,]o6i Vʟk(',Lޝv6yZxnڕː]ڍ `V B>sTaBs~PD	-Ox&y,WGX¼\eYܛz:82kl~~vc@4bAk4Nit7Ŭh, qҦ%W#y=%.r@BX%We-s[6אK檳P}kDD)Sr<#vZy0ʡ
	
"x2$N1z\
J vS Ź7d,rLTˍFݠ6$P-Av z54!sOE}q,<Y36$|18B.03=45˚xR1-wTbcăfwѐYy3+SIAf\o*3۾H6+/@D֝PgL&!3*Ar*y4@ą 8(ʼhh>LaMHCU1V~]eȡ
F,!@*QX8Qզ1pא^J2U2'tl9w=c1Դ%w\>˽Q2BqA,P<O" =zzdYGE(C#I= p/^~c9;8c}nڇ#qr!jA>kB-zyds\a܎v&{dYv#wc#衩[FU?hWQYEuլQ57F05E㶋1BB؀I?Z+LDޤ@MI;m zv}I^DlGm]!emv[ޖUmQv˫SA_VeY~Y_KK~qWx-[6dـ_|joJ)oJ)oo
uيlD!-T13v27R|%Q|J}R}[SVշemI}k֯VU}mՇ]TAKeiei,Mw/yYVeM RTwW&"+8#uKO%1C`BZM}qOԬMܷ%2.(ǽ@x~-T7FV[h5`
)$%}xQl}Ig$Q٣e6י2Uf,fq-Lދ񐻋BCn;5Ba̜[v$jhIHvX3O%*bȴeIN\8!JA^3sXHLl\/	EZT&42{lԓع(9ˋH}싎]&"Vo&c*~2èbdvn'M8HOpprK<K)T|'+	w~LQ_,pɱ\9h-86e),d[
i6^?(nl}⎐W%W'B\<-Ob.$%-אM7B\KyD[LF+B|*ԕvK8Z찠A	M82~Q0!k͡xmkN*ۚxD	LE(!=πY۠~5,#b`*BX9H!1%,Uɍ"|DLEgHPCM#}p*
U
ߏa91&cVզcb\lɝ<Gul@b$om|?ݑ>Fg\'<bW.j1ĸC^^9
EcG$Wɟ FRT>zGOFqMgҕw;SNAOn4~y,-q,XwB{p6,u~΅\՝Oe"b5J-2qD;[:qt/ay K8HI4FkD1t#kHdhR]Mi-f<}JE/2=(ͻx>`F*Nq>Onq<oϐ29&
kHm'$88Ґ_m	~MN`d/tחǽS1U8%{Y|%Ph\ϰYq"(D
Ex RKCgBi_FW,ix*v(`9=`ɡ+k'}Yse$J3,!Qɍ.
)7!3t(xAi{*yf2Jܟad[Y<)=XꢾOZʵB ٧U:˞]:(R̢PnocoNPbtϚM.h[*K9<.0MpNj3j.OEsxw{ت^_(/'.8%$|d~eB{]~39S؉%̖ܔok2Gi&tE$M^/hPKP6?KyIfzJMv^1 E oynF1jYld@9nRN5S0CVDr;#@x#b~`縄9oc~NyZ3Oڑ{ưύ8IaL=+5c._~2MYmlxi[E(Zp%MЦ~n!CTh뽃_|&bhMcN¹+vJ5Hy5@7TkV=ԋ맿V[4I~s:s./4]b 	a(7i#Qim#wN:	I7v ~p]rR]Jk=wwo4"1:dT091|}JRj kbJOBPxyQq/$u&<w8P	 ?	Q]3l0ǯ9/E).]IkQ#Mq|YkAATj_|ݭÍ7'Pʗ{}_\f%E6iw,rI5`+wOvI'].xpH5L @}ZG "6]#΋Oq`~$4H^x:,˼xQ,?O]6_oH_hp}U
c-/ A^t՘X|Z:zOc/L4㍠?AްkwLsfH87gig[nXˇ=	BNOH#9t DNH !/ЈnYȤmf2IE.Pq|4I ^Dqp9(d8*TCYA*~6ɇt	"G%q3zEuKʚ	}x6,3~AMrAthMd9O8	H.`	pӠ+vƼLYW q\45pT&Ѕl%ׅD'䐼|R`m+c蓢:2Q-ЮtxGe(g֘G;SA]ˁKm~Q;`K/u*}2cMH'Ӊ%S1w[Fu;Hu;;%!{t@ACrGy-5Q˺vR~kq WpwK7"$ÚAE	5h/I*hJ^nSBnNirUv9>&3zqCTTOYFQ}(ς~Nq k]?N+w?p7&>99Qw ΄ DRSxhAs,<aK<;m$ ThR2~iFGy%8^kgm;Xw.G|sG(O"j;]j3taO#_d4twYsj޳ޡk%o̷٤(ff}v1\UaZm#UnFHy}ee
u]uV[tJx(=J+싋lq>`OY>g+Jw hoĮ. iX%mghlVAչwӆݴS{La4qo/B+1{qj=Zj-'.آPHYhʂXD7[Bjx^-Tbp3t$aE+2;#[{h&;h>obcEv*vD
fu|Mȥ )WeX9bY32u-lnĶ"۴M]:1gEi;1ѡSI\UpjjK^ogťI@nJIbo5YlnL0E}?b l<4	蚋5w.̢uۚm>н[3>:/l9.0Qꁳt|¤GA?74Fwcmd<T8qcFAu]+3|
nAw}vXbxNHc¢"刣haS	n)9\^ecԫt2	jF@e] |Q$c=:EޕŔ윸@osvEѢ聤$#PM+s<'@Ҁ/C:+UT%WA]AU),W"?YPNmMj%0ĸBļɪ1	1}ՋLFqx\h-]K)(20}nJc%+吔}I֩y:+7kV;Xl=Zk%i4߱oV)Qr+JB{fET{"(l	*逋}ZǼ.){6LJۭfxb,׬QedE Y7')ue:h "me5	ξ"&nZ9RP6V0R	}#G>Vk*CKI
`kVre-*'"3o>d_Iȵpk+.誫I[ha%HqHzLJgrb<D]Xˬg& !Ε
i|FZmţ9xn''3)x^^kvx,u؍EYNSG<,Lc
b_X:[4Ub2U7/R,x2")Yǳ' zU=L8i"i<"JX]aɞ0o9LMp
+W<U+AE*WNObR*Иɜ*@׊~fnݬ=@S⦵gnR)}rKΟ[铪i#ҭsHLꂿ
=֒aLQyLO0ny,&&s'LMNOL2t'KoZg&L
Ԋ196JMI&iq]g-f#tJ,p+{El@#ilfc(CRJL7UoI>T;3r& x)SOdU߈/ϵwR-?7\?\k"/5;$(}N]y#cw"YHla8f\)IkPv;[*Be)qT=|S/k`ׅ
:vwmAO\blwƜlq߿Aw]G)}XL~ƙmBĸ\0%.&#z.`X<a24|wxd0TpSݜ΂YnuC6_ȪmL1f0#R_?.w/ԁ2F46Y_Ky3V_Dk'mN(>뤲)~({4G/SW$4/jRA=/*dOpL\jEGKS'(kh2wgN]WW	1SBs$kK^fy*0%҅ʄ	91STݧ%]erZVg9i[3%f%b݌B0w)jZ>cW1nbHE5LY3j2{)NXш+b׶.Y1[E"rrLVgHvsqiS٭fLIw&ro0a55SOY4_r a7t	ygG®YC+bFΚʹhOM%mdGqF6⮦νl4dߏ\{ian/r;@KW0e; ]ؒWvum?xz;KWu6fVc:*0G hA@%" .l;@p9Lt ^.E肬[/<3:/pnZ-8دډ>絾?JfLb7A8c85_AFޏ?۵]ZtO[-n/k~U`EYJ8Y3ٮ
\9W2:}- Ch5cB^<5!Ab#j' w:5Ky*0doU^8缙n6Bn!vj4յsKV0IԊO#y-#Pé5ku4&nV	b+G^cV}^x\*UDYémIMHRc}gI\_wLn\_/l{{tr\IY4"n5|4EtS+Uű[K@<(#WBҨ>G?YPɀ6m2`wem&!9zBP
")2	F71	zge0girI20oZZɕsbW`KDx'kE~êf#r`hݶEk{ Ѽq$>E^ɵ(M_s{NbYe&l9~xLDBW5Z,ǧܺUO/ުxtOflMcXՌɷ+9ǐ6ɑړm4\=n{RŲh&94T+'yɲŀ䴎1gb
!EHWK'D/Ki~lƉh6*'GpI\GdXE)Z{R>^HLgu٢TH7Pru%@U24TdTB`D#5`A]L=Oh2oay#ܽv踦t^pEzo{
%"ɪ'fez3`#^(d$ ̵ZLqQERLoݖUEb􃤨9r+s?ʛ

K:2Bx))(᪅Bw-|dg@ƣ/9|Z?p/UaUfq=$e='N~=g-	zDת~6gg]<]K|~.WcMqùv?C:A>=oh4eb@nϿT8DCa"YQ`C!<3Gx*pMRp?6Щg KSwBGM|L6G5]gJԧ4ːRU`\댫4FGkg@@ןuM"\:7 j#	|k$gB W¯	>~FAp~Unِ0ѓZ(ׇnooqtH*q+-Ԅ2	F.MPUvm#ScQ .,bɽ&XPH(d
OcӣFQŁ5hu$v
["__OZ2CZ8^IG:SϏt3Sds󧋍|D.Okg^[|O0
Pj Asf,  &8U&ezWbLajK̂$nd9i^O^.CŜoxv-<m'G^+v:;
!1(?Y+Yl/ЧɅ٧,G62>>X{tPgȢ&"@|K*|`K_`ι4d%/F=x J#s+G_g~p17݄WtUPQKqB>b`/\</pLm[j=_1j@QY=3Ü~w6؇eOúBFqR@	ٌBkکi'84`^gNWI?uȆTR3\zҵegƧeQ9wTOLg	z]èO?zCg3-^G#a;Eqcysr!K*/h,X.
ZTNݲ2'rnm1Xe/jK4{9J&]՗|	vfV_yho=l5Wn@$?Up\z+:D/DN?(7|T'l	Ηݗ1MȠ:S-=9z4;
!^8&~2D/o8Zx;~\"Ҵj5YC-/@ "9JhR9@Tb@MBj,@e#Wb@%<͢Lmwr"jwb'V[(>B%f,2
	R$|+K'ti:j*iq)`Y,jǱXDdK<uᕹ;ͼ@:{0Hk6&e\9 !Id?A54 M;T`îsY.tM9m_2PV$hqr叁QWwѕm_*J7k};VwҊ*ָ8ֹVqY̐Tl3,hB);04r3+"Wfՠ ERu~Ԫ	?B3F4ۉf7P
c`TA|tθ#mRx]44U+z[7MoH~>(˹I=rJ>SeD=tpGʊUd`x׬QG|L$H*~8ti#NjN;Pʹ@"'M^DY=RS=?b:Ң?= wq4wH{RD\xx{C88IIlHpaXQr:OZk*Ly"Z%ԪыTrYyM{>&uCAb/mR~kbmb^RU=,Kǚ:P7eƹ0|	z~'G<ȮH|߉?B_y[}N+*E+DQ ԓqH4G :ᢧME A~>pbyLqifsC;PѤBƳ#3b&~G>z " ݁p,_mqo$P}ѣ7*8Ic: glcA^E4N
Jy#M-^'dC벪W+pYji<:v2a%}+&ZKuUU4^ԿX7_m1yK>ݼ*l{ּoHk౩4UhZ!Ag偧\K3"'w)~;sݝO{YYGP]ȩV<V݋oy.[4ܴsIGpp|BLZ?+3
b`{9.tk裆"TmpzUrs(QIh?SfN!l j%0UVB.yYM_uᖈF.#
=/X8ʪ;G~j2@*K\	E#`cManڽA{}9llxRr6N>b,~|?_#/I:Gil]4Zr?4BQ溏Yl	b\}LonL'ln{qޅ$]ȳH%R?P[e{|ItAc	vc# p;RB]MZ Inbmt;עZ+Y˰wb1Vm*K19kR5$ip㊊͓Sf!xv83
N</;}qa0WYdr6{`R, @-V
,ZNcMrLWZmLNSpM@_(|V24z4&y*pJ!짶/S۹硰z˛d*T@[`\QfH
e7?HU[mW12vMVMڳ_.sF	0Bg[<1Qؿπ;{h|8X-TAhTʥ
yn hhAÀD6Vw>8֏=cU ְo~~(_QE(]}{PĔ<hGM60ABG4XY<ر^e7v q+`x-*:?@C"|˽[.e5Q~>#ߊ1@6EJw#x{/'Òfw(}](*uJ "MOܣx^3ŷV"LbN ;9bڹyAuo/K9_˻R$TƹgUj%H+a
,-E###oi./v]kXFTlO7Ѹc(Ĥ57I{  ]XmɉT}2HNc8ly3+TJY(zRh)Z]/a7X?d<OW+v ir[/fUqL5Aй7Lq4Nk;1suu\C#ɗ[qS`!G3gܓp}t6?8];PX+T+֜OYX}MjwBI>qfdѨ<r^Ƞ:ٕI}vr^P#)L@fV%.vF&S0f|☄O 	0vJ15ȡ?<D½	qm4͵F^"Jٳfkrp nb>vr2$m(9k+kk08?E6JZs܆_Z[^{H"Y0e
 z-7އ7D>ǦZ0Q/. G{keA1{rݴ1eVW7C$<YcR%\9Yz.Z'2ƃǯig>gFh>OdQI"*ﶤGx<o{o0:YQg<hP~
5pfјpDeiZǊΪ.^\o4GQMrUVc{XO=4_B1ϣz1ڙ$)'! s;oL̓7cv؅β

qusz w21C-.o΍NoL_Z^[if-?H@gU+9AxUtPQRěYC0حQ#(b׆ÎG}j
 &ɀ[C~.j2v7 s>	nJw*Upv4ou  _]Zz\ʮ,:lJYLټav	ײү~yVv]!fz҅n?V_pTe2cHG󜘽#'2x{sGBs	:gt7wܒZ@˘)i#F5lo/5I׿1hIz/F>>l88<iZ c܍SWf)r`wQR`mT|jt|LUw46j{?Dr0R!GsKgNz	O_Po;T?FgKn+W֋_Lߝ``%=ާ*dV?ouR5~xCF=|j-p}^|@rqx^P7@Z܂W
R|/ic>ݷV.Y;7^8=8x\?JA^=iVokew6ﴚlv:+fV06SGoτO>u4U}c%4jYku?Hgs?+[۟=mX&H07)Bx4ESVDDa{Ҕ+w00}JzJ
`
_j.˕*k+Ī<şၷP ˶^.Q@_#
Vv݁jY$n`)lzo7zTD/YJeǘ)9ZGwnhwgkꇝ;<T+Z4mJ@xOyQzxЖn@RzŜaXj/>!ۑSQmN(<1iX;%ǼlA0fC*R?Ex{Yvxk ZH@1Ur dį9}Eǡ7]zgzLJmikuټnVI'sLݵ;P]9NI@S{=9~i*~ZKB/%Z~xT;e;oz|uvfVwdN=M9gIcknAvU>
m?t[4ߵl!D/~F-(UVgٰ뵥:C/Ht\qkeu]1Va{>YRJ=|ϬO8")bi9r{,Y"}f=ހb܃pYi͊:cXKi+&y8߬^/TseYXs샖u E/M|;.HnwrV?
%kncRd-4VaiDD7:2uHP2SX[LȬI7Aosso*A<zd\O0&ß'5>mYUwEM4d6,MFŅ/I/^LoGʑ?a?3J7QFZ':	<y]%̳H|zAFh:o(fe#Y|6Ya]S̌nhgR_74O32
Ragyo2rՊB֋q/*{bֳ0Ӆ6Idu1|lZ-f>*chb?~^|#x+qUG@z;Bu>ejW\3jJN׈{)((_EBa8ZG^"qeǪ9C3՝cCimo1_?>g<yוk;"g_9UF:I1LN-0RCEzg^`hH@~|]գ2`w|U=8<eSU|Ѧ\	FvQ2X8K!GێR|*B(ʵ0MF=eKSF5{w<M{ξlo:P  DB7p.hI+f*Rh%I,	Z5j1f,EeM KgM4fo^VtSj6Nݜ#ACc:[ {,妇T=U;$N6<"f6B},a\y;[4Ö + =cQ8^3aw̵x0B?&,Ė޽Nύc۷&޺Ϳ5:1?gkju#=VdD{}a$|,4z/_ϻ	}^[Xj`+SzzrL|mF;.fB?p$+)Qo	sa7!ϐ&JgՅ3[nu	 veZޙ_q>Ǩc Ku{8L-TGGx΂6Tt0/f9O[זFHD?k;iW`ѳfE&tSG46\A*&!魾iBjro4b #U,qmQߩ$"Xݸ vD5v>wGoa}|}?TTMEۯG.WԫD<6ZC@jcזݦ6VL,#g<dH@pQ4{Т0:P\]6.a豅7ۅQz>Q]K*3NLA!Igr{Uo#DPL$,}}Rr+3Ǳ4yWJW_}E_~VZ66[ֵNICx-"pch~Vղ0JU-X%Lv%TQ#11#n橼߈8cğ Ӽ<R{+*tI$|t0<^ۣPIRf68f"ewz@BVrWdVu!5hZ`Q+<)wgxF)K#<~[3å֭XEPh(sQSk
G<Kp3("3S" ˠ0D$ؒa)f م rsC0gZaDmq^ջ(U]Ja!v&3--5Wtļs/x%_I}]R\4J\Q`y/uk&(aQX|S$:apsbp
VǪal57usHh,]Ey|/Tpa+?{oM~MN뭽u 4t*UT<?E 4A3&]=aK43C6!وF(u\2{{|ɒhLbR=^WqxߏzTp]$.kzah۩/K'-4BYz?<HZ]^ZHyB~@Ee|Z0ȉu6m6sТ%;}"({MHDH?ooQG%S?eEAFy]̊lNv@C\4GhA6ٿ"pZ܌jaA[:~̾aE+)CLw{|HkN\M/|'+t1%;5 pe~`nn{qZkJ1@s&;=יIզ8fqo &Mvd&.[T?	3Β8n_1
뤀5Ggx,/x1Q1E#?zةƉjWVA(u&vj%)Ш$l4G 8X0ye7aCW5.PK<u߻ᨽbqB4AhF2>4v;ccug簱
9:"%:e(<A5
f)/;Cd4H4u`]M5&:7QE_ `j
w}^_#ShBV97t3|YEp{eeq@XqLTфat\1Lu6[lɋuI_.}4dHr-i"SPêj`ƦG=kvKL@$`R0d.@	@BF O.K&۹,9?+P	_)'$iE!ehLZ'ű ܢ4}NӧB	KDįA'-yA{v>XFޟZR
ǉ΄OAT"ee&XM(c5Sd"$U}7fS\C;7<w|N>&5aqΆ{t馳/y{FØ\$!rN%
 :(X4%iQ?'kXI]Xs>D2GȮ7.w:_QHw_OXxC'LT~zgèO g~%1QE݆&03'۸p|' SR3O- Xh.aE啤zވi]asuE7 &\e.ƽ3snzD5.$ &`,K9!?!TFM#-Go&"̀uA@G!l*h{nEPJ;}BAMǼs1bOOiugIMsxV{ +gB@;hj~LOQ{OјyMs@3:^	:Pq U1W|5,h2&HG(f*m*9^+rss8J#3<!L>:|v2{-gX3rM;NUŖ/nň-NCĉJ ?EOm;*: z0I'Ki!HJCv_[g`t:GFbLJpK=Wß&$-^8	`atO7aJ
uo:)F*Mw A+%gxb}DۼbڧYRQ˷a>· [
T\0Feng%Ƙ(*M-C.)C+6x;@lvL
\ieBm.;(NM]>u!xtq^ma:WTҖZ8YT~}WH!G>|]+7'W^U|}Q޼z%]4]NUKݫ!}GWJWU
GëY+]u%^[N\VϯgG0'Tӡ!ttBn3Fa܍ڢLhu^|4mJ`I-D<%7qhqr]y_;?yw%!H{(4,M&k.NCчB[E~i
l-/k?yD^~{ktwe|L_xem%-///_]nC2nR*v\u:>|'%]EpvFBK?@|?^ߏݮ&sɷeDhXL=ɔB1m E6}dV}Mq(وj(~u]ك:?6=T/A4ɿ? A% x)*/ͼ2:wyE$z/?i473Y-)oz0aT:]T`weV~'ώJZG'뮇1{F{,!4UuVY=z]o~#,z~ldd1YTI'reTң.D<+76"ۄMFQLVƸ?eqDI#Z{nJnx<d_Boe1L} csϞaqK&w4I?͵GAқvNq&/F1ȁ)
#~؇zAܘP3t1qڕsdC7Bov!cv؞|m}v? Γ5;kc_Y]Y^][n$yy67
bxE9<<\/R0!O[YC:7c14L_t*x87Y7z˺ <{s:?ë'x?6H<FIL yj]naK+cxtRQmG͍" z%Z&/_q `O1x/΃ۯ_DCAwuviTQ(@l:[=܃L{qp<F~'{%qz%侄,I o%	@?pv's`7/F?l)U=(x1Bzgz枭c&F  5eeTv)jO5%K,惾vh$>bVMۤ2[΄z}1LYA16nO&~/"Y2$9C3x23
|XvX"
X;^oja>lЀ ˂Imscs@"_)p~p oy3Ⱥљy,o wA_m9zkY+ægAfJh6Ur_x2~S=o9!08z6;Y,r 0}Fo 8x]^0qMGGQVh@jr #K=*%Y8pI`~$:8< J\XZk=xߢ/׀!{!s:'BoyΕ2=%(q?oϥe̓=qs^[˹ 6kkoum1ۃR\̸#W3r&V@ry 9XO=|1=M?@ X 