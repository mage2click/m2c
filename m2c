#!/bin/bash

declare -r m2c_version="0.6.5"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Magento Docker
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_loading_install() {
    tput civis
    m2c_start_progress & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done

    printf "\033[0m"
}

m2c_start_progress() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏') iteration=0 length=0 log

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        if [[ "$iteration" == "0" ]]
        then
            log="$(<${m2c_log})"

            if [[ "$log" == *"Progress:"* ]]
            then
                log=" $(echo "$log" | grep "Progress: " | tail -1 | tr -d "[Proges: ]")  "
                length=${#log}
                printf %${length}s | tr " " "\b"
                echo -en "$log"
            fi
        fi

        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            (( iteration++ ))
            sleep 0.1
        done

        [[ "$iteration" == "10" ]] && iteration=0
    done

    printf %${length}s | tr " " "."
    printf "\033[0m"
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid} && \
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    local text="$1"
    local chars=$((${#text}))
    local cols=$(tput cols)

    if [[ $chars -gt $cols ]]
    then
        text="$(echo "$text" | fold -s -w"$cols")"
    fi

    echo -en "\033[0;32m$text\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_dots() {
    local text="$1"
    local chars=$((${#text} + 3))
    local cols=$(tput cols)
    local last

    cols=$(( cols > 80 ? 80 : cols ))

    if [[ $chars -gt $cols ]]
    then
        text="$(echo "$text" | fold -s -w"$cols")"
        last="${text##*$'\n'}"
        chars=$((${#last} + 3))
    fi

    m2c_msg "$text$(printf %$((cols - chars))s | tr " " ".")  "
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "${m2c_log}" ]]
        then
            error="$(<"${m2c_log}")"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$1 \
          only_y=$2 \
          opts \
          res \
          text \
          lines

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        text="$(m2c_msg "$message $(m2c_info_bold "$opts")") "
        lines=$(echo "$text" | wc -l)
        read -n 1 -srp "$text" res
        echo
        m2c_erase_prev_lines ${lines}
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_dots "OS compatibility check"
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"${m2c_log}"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_dots "Docker installation check"
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"${m2c_log}"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_dots "Docker-compose installation check"
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"${m2c_log}"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_dots "Ports 80, 443, 33060 and 53 availability check"
    m2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"${m2c_log}"
    fi

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    m2c_dots "Password required to trust the CA certificate and create symlinks"
    m2c_loading
    m2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    m2c_erase_prev_lines 1
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_dots "Locating archive"
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_dots "Extracting data"
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"${m2c_log}" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "${m2c_global_dir}/bin/m2c" /usr/local/bin/m2c

        if [[ ! -f "${m2c_global_dir}/ssl/config/v3_ext.conf" ]]
        then
            mv "${m2c_global_dir}/ssl/config/v3_ext.blank.conf" "${m2c_global_dir}/ssl/config/v3_ext.conf"
        else
            rm -f "${m2c_global_dir}/ssl/config/v3_ext.blank.conf"
        fi
    fi
    m2c_result ${test}

    if [[ ! -f "${m2c_global_dir}/ssl/certs/rootCA.crt" ]] || [[ ! -f "${m2c_global_dir}/ssl/private/rootCA.key" ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_dots "Generating private key for CA certificate"
        m2c_loading
        mkdir -p "${m2c_global_dir}/ssl"/{certs,crl,new,private,serial} >"${m2c_log}" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "${m2c_global_dir}/ssl/private/rootCA.key" 4096 >"${m2c_log}" 2>&1
        test=$?
        m2c_result ${test}

        m2c_dots "Signing CA certificate"
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "${m2c_global_dir}/ssl/config/rootca.conf" \
            -key "${m2c_global_dir}/ssl/private/rootCA.key" \
            -out "${m2c_global_dir}/ssl/certs/rootCA.crt" >"${m2c_log}" 2>&1
        test=$?
        m2c_result ${test}

        m2c_dots "Trusting root CA certificate"
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "${m2c_global_dir}/ssl/certs/rootCA.crt" >"${m2c_log}" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]]
                then
                    yes | sudo cp -rf "${m2c_global_dir}/ssl/certs/rootCA.crt" \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"${m2c_log}" 2>&1 && \
                    sudo update-ca-certificates >"${m2c_log}" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]]
                then
                    yes | sudo cp -rf "${m2c_global_dir}/ssl/certs/rootCA.crt" \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"${m2c_log}" 2>&1 && \
                    sudo update-ca-trust >"${m2c_log}" 2>&1 && \
                    sudo update-ca-trust enable >"${m2c_log}" 2>&1
                    test=$?
                else
                    echo "Currently, we are not supporting yet trusting of the root CA certificate on your OS." >"${m2c_log}"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi

    case ${m2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(</etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                m2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                m2c_dots "Creating the resolver file"
                m2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                m2c_result $?
            fi

            if [[ ! -f "${m2c_global_dir}/mutagen/mutagen" || \
                "$("${m2c_global_dir}/mutagen/mutagen" version)" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "${m2c_global_dir}/mutagen" >"${m2c_log}" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "${m2c_global_dir}/mutagen/"
                chmod 0755 "${m2c_global_dir}/mutagen/mutagen"
            fi
        ;;
    esac
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="${m2c_global_dir}/log"
mkdir -p "${m2c_global_dir}"
touch "${m2c_log}"

if ! docker info > /dev/null 2>&1
then
    m2c_error "Docker is not running or Docker service is not reachable.\n"
    exit 1
fi

if ! docker info > /dev/null 2>&1
then
    m2c_error "Docker is not running or Docker service is not reachable.\n"
    exit 1
fi

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "${m2c_global_dir}/build" ]]
    then
        message="Install Mage2click Magento Docker environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "${m2c_global_dir}"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "${m2c_global_dir}/functions/m2c"

    m2c_global_load_env

    m2c_sign "m2c.test"

    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"

    m2c_msg "Mage2click toolset is successfully installed!\n"
    m2c_msg "Run \`m2c --help\` command for usage information.\n"
    m2c_msg "Visit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "${m2c_global_dir}/functions/m2c"
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="${m2c_project_dir}/.m2c/log"

    m2c_load_env

    case "$1" in
        global)
            shift
            m2c_log="${m2c_global_dir}/log"
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    ! m2c_in_array "--help" $@ && m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    ! m2c_in_array "--help" $@ && m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    ! m2c_in_array "--help" $@ && m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 T] r#G(8˯Ȃ&"IPER&Y=)@I IfLE9v>Þ=fg>alfd=.H KFHE qpp۽?<lj6}nf{}V7jt?8q{WTC@on670fk>ha=
]F{s9H4~X7WqkD?{ %m}?F?ap`~u1HAڀX[+בk>Hi;8O";=0l9DV16ۘD7ksA$AIt7$UV+oxic.|c/xbXy-O_c1֞l`mm3?;sgo4'5o=/J3&^VdƇ?lx	SøKދ
λdE%TGY}SOw&?}VW1gOHs{>OAV!d{SIsuMāU}$s9q8zN|}'|}z^1z0~B6lEyi-}7p#ϩEvF_t/(F,WSY|e'~/ܨܨIe6]kw׈Y͊saT:UNU2שlS5mMմ6Tw䞞U*AJRT*UJU@ؤw2	3/鎢lU#Hj)7"SY\]zu0S;s*U]
?`~#kyqu~(ÀBQ8}-lx;3вd/ݲAn"G[Y|N^I^zss?0:DRi̐>-2|%w9$.WK<Fҿhtw~<VGj֝Oz/ʟjƧ,#M>(qv_qﰻ|qxޫǝfSʹOZ59ld"c}7{?^Nm\r89>c?lQдZ$2pOA:WG2:ZQdE~pJ+4FxMM:}T?8^rF$XیEŅ``ǥPYa)aU9HgC@bK[,%-֍9mc+b]5h=>T/-[oگ۵n־z'Տ͕֭IćdTx%(p%P)?Q^cUfVC|%ey
;wYw|T=L.IMhaix6H bJ5ݑ\L۞@?'ݷUwO9֔80]o8J8Kq{Ω|*@b|A?`Γco,9gΛ@pߏ2٫0NثxqUu%h'K+f	fےeXd9Nlոq?)ߥ%cw8YJse_߮Tn[&m3?
^Il=mX6ш@V룋QC 30s4||=7z2v_}bż[oWWWd802D^r\#8mGiE%:x'9ZK`- K,t mi||_::GٍoLI|xhop秭VvX@6Y[$^8:okuNM\  9fvvv(Doӄ+.H^ōy<*d58KʴuQ"ƀc:.,(gRU&	4DXގ:~|{ˤ(
Ne? Y$y's]L:	*iABTȁAXGDQE!ds*!,ooOe]^v}Ӫ:;(z4jUT 5xU| unxru`ǑéU5Μ40EhЬ"6.4;cTa*0޲|E2`ui%/a}ȩ/2rÛI_~ۅ'Ur8ýIT×G?MdO9Uisb|񧼞m?Tn/]#Po'
RפkA88Y4RBNVOR'(2M ̜m^4w:>/Ωa'nGg>V@gAOFjS=a>'SL&Cͨ^w:\n
B:F`&苀GYQJL^|[l~j{4;9;8k<kg Q)^n t;W^978us.r2p_UU;\x·P1OhA}K&d] jP5c%*l0ԁ!r}SV
9RŞS7;ka*",rW-i/*~)e)Wu?pYH9(^W%?џw_jGp#3?:F}{돇"adKC<DbZ
eD*縜Y=}or$ vxoOUEfɾ7[)g{V|RMzz)`shkrɆIT^Hxڙ84Xq%S@^8 (ZOn|叝9L{k/8o7/NhK5k䛯-U` >j=MI&(>R׊94YWi#zCD:[Ƣb5*M<&(%Dm7@I$gT0G3P·"cO"dxGT9C"9!@$O#4̶
Y1f4q9v5Q'<?}jty{bArӸ)<sAy01^Wh! bv@ߏ޻B=Ifoj-		G	9UxY/ߝRwP@>A851n6d4yA&Z1eP(C.4/eqv`JݯNVޗ7֭jކZ5&ĆcOa	GI}AAb=#Mi`]Xm14Pk=W;ǆ kc:R.(ˬ4*+Z*ZZJwhogYORJE¾@dWj<l CAniZ|D7,4DTFޕh ~!*A<tMGVpgn@*,OWJgA,ǅkSJ"BXK'(+[UQ#ɮd
D|ߛttKɇigy_`j8-K|!KR!RjY/Nϲ]#j-La^cv-/[
spE[|neH,dҌ lim|WJӺwrPk&Ԥ!v>msO-bU܍2.}Le>#kp1?xAx$?>;$r#Du<73y@y_mVoyEwm+w|lߜT%s`]NPM}p7('2<TR,3*qũUdGN$C{#C`7XP+&RB10]{1 4{_gB@K8YET&p+0Q~=fkys^8!}ouPU`܄GXboB	m0g*z9qy>d%3-XFnN:~Ll5#Ce2"~޻¯cP[/fK:q{X-0)[5/r X8~-/~o/(*q^ep ?m
J)q,M:K	's>~:%p!I[ߏH醃[s3mTrV,Kh|;64>6J8Օf9Ysn-.czC^/qTUτwtb4vC_)d=fPCۘ]nځ3|_4R,[g#M\*-a_;	&vFAr:,o#a\:QܫfW#vuiA3CDڃ4AM$Tswۯq8#&=7ܤ8E`^@4\\!<`\Bkƣ:{ryc	rvvCæ KL#)	Mz&惤zHݣRH*<ȿ='9v!.IH+ctI+kz|i:^ɰ@Nv[v+.S+&j#(0Z
H7ҕ9 KLm졪Ng2o U%v\=y{ +Aװ` ai7szꂏaxJf55fVq٦҉[?$=4a[WsƧxu$h S8\^5XM`ǍNBRz4iAxF(5ٷaw1h4F|nCMt~kՒĹq3vq9x	4+UysԽEjW0J1P@Np̡'Tӓ1-\Pa$3.L}.<Έ񦍼MCeJ:uذ1hru8vN])`N*;InXgɋhBl1O])U`:Kvk˝Ea[pk0=~"}Dqs01Snp#ALcRJ,edyu=ٹ,2fQ:ghٌuOZqˁ/lLQ-pa1NqIw@
)а'1p
Pѧ*{BХt:2q5)(r LBjv͇d gTI`	4-Bff/u`tdό[HcGܹ$9^{̚L!GrGCq؀(bQ	sz\7|R;Samz3AvR^H54o ^v#yx&;g;p&b:GO9%Kjm-%UekGRU0V16OGJV2+]ZV]fDJIdn1q -Zl60Ҙy^	W2H^x\f(u=( xb]`4=u ?u á&jݹQC5XMZ}((_:?n#w
[Ҷ=$E%rqd[ԋQrأkMB>2oߩ%\ۥlKߞ[N "ͧbַVj/ƻkgo2pEpN߬|LDLS3֓ -$"P\N9sN=T̲8a5ވ펹;q!|O-4Q77ƹ۴
(c^#t}	GdSs8}R\c&Æv톁i C^ 9(lAǞA}%SIX¬LeiɑziԄb4#ڀ"Owp8!]?ೢti0PJ;6@%2d !nbSͮedLC5Tg,2W扔űTfXvY!]Y*6
ɢ^	
ry2$Nj"/1ca
yRv! x?pY1rv2@I*eFQ5'Ɩ^ fr[V/zj54#uE},<Yʊ3$|伋68j.03=45R1%wTbcĕ{1kVPINf\o23پH6U6+@,ъ+;&Y"qU<êbt +
CG!TP#zP0c88J<e
]D[Xu"+
T0@^|zjH#5rGIWLwDHbz)$ã)$Xs̸C@MZ+Y@Q$b)yn|E4jsq"Y$c>4} :e1sS& ';yj!
j!VϜ[`s	eǾ
30ʦ4l,?0l?GmxPC-Pc}UҊT٤xƛxobdlbEG}G3SI<Rs5@"*0̖C:",B;μvmU˧l/˚*ŗb+Z"m&DY?7M|S 7M|S ߴ7шhC4!Z'bgZ005o%$̫#)mok۪έ_f-kڲmYA;ҔY,_-'&%e3ҩȍ!LPyZ<FZU떞 ~sJ=cR'Z^i4K$.
@+<KЙxu˛Joc-Ц՟OkRH2M;9oK.6Q/NOSGKSebXq:Ɋo5!wikx1SA|lF:^r|ђo?1gJT)˒*aC@kzk~Փٸ_:Ny鬚Wf)1lTm@P&yu}>}EOMy.D#2#bC2hdcwn&NHONWɼ/MFNM'=1m,2iD-K4e<Zl`e),D[i6GJT}%7'B\і'E[>\kGE]ȫ&7;!!"{h/PuR%3}PBNo_wBMԝ#<dTPS T{mMIdq[34s"p-L zhPPxSb O@
T>(ah$o2O=10!Ɵ"@>wA4\}êy~'TQSA3h]M8Ÿ>֓9݇l@|$m?H2ړ{c|ƕƸfS1z˳{r,:GLY`~Q}s{w|1+?ߙr
<gѸlojPaڱe}`meXކ5[@#@0:@;^[{2+ʌEBhPfb	וwO^*7/awEcl51y;h(4F0 x,O(6"!d	(yloTY\F*&⟙CܫwGrz$ fvJ[N{Y6Wrϡe"`(˩upnm,#UF4E%]&Z>Y*3o+IH-_13:ޤ@]Vcn.k
c2*DȎB
S(sP%"v~T&\a^6ŵ$Շnlmvlu@IO1er/'d%2җg|/jKrR('b%s܈I	T{,<EaP'V%Vs];.`DBY?OvQDQ'-&0Vk=kSmVXYpgdie.@C4xY8\jTuxcS.u n0=(m_x	ZJ
ηYPJlQ;VjҔ|̇)`˪d}4@1*~?
eVQ[4Q:ri2]T)]kN3Ɯhv[XGP2~	Qo]0߬}>5(U-hKi>7z8	^p6ixԬԌ|uh]և5Ugܻ1I
NW$@+UO>r=>KFϫ;g<B$'난9oWTC)7QkJhSOܨ~kźLK4΂<tY95#S۹C.md.^7txd	w!=֌M6^KSr|܈ubVzFM:z̙0^?;Oߑ{ZdaPL詝Z<˾!2ceu ٙ Ih8~o qE@QA3:Xbs[i=!tr](kNAՂ/~>G{xX)e˽>;/3r*rGGp7,rI5`,{Oәŉ]&ixtL5U?{y4N,l= yaAstC=MۈG_;;iN2_l?;^S$ޯaqb_kƱyWx /ڢdjLFN[i[H"74SA{߰kxwLsjHb8;`]9c[vXǅ]Ka`!~g:"+$`!hT>`Ks=o0]ߗIs/R8PEHfk'fK)G.8Vn7BTaHgMV>D{:=^߫G(s\ XlwtXYj@!(FzњH"uر4_36z~čEAӮ :̯lיh
k![ЅYBib8t	A(bą-We*N9vt{2mu0k{	rO$W9i1(a1Q\a"1Pa;qO3%`CY1¨GD~1:7$}x2vRlkgwYM	&B+@A	pRhi) ׊Yg-UbLޖ;ZW.wWsi{)D5f{Dڙyb i*,`[gY{e/J.'*GXSaT)T$*/q8ԇHɒoTAcͲn>I>b*zA1gtzw1Ǔkrͼ1G얰٨qєm1綪KLmf5qK40;kY}Á*)[b[;<@ljϾWigU%.?R(;vYY$e^v%l*e7$gݬxTRĠ'IRd_^v}Ӫ:;N5wF
7[0(Nn4b̦pwQSǧ
4(Ϥ^!mmsx=Be> -.LH۳w	8qzNk?0|*ó7ٖ.!rRs(.+j%,lيFTCIQBG_s5+Kdi@3NI9-FOrUݏϳkQUW6p!@f*/ܶ',(	ojA2DlūYҬ8̙ЬiΖ7Pum]xy~`>0S:Sh,܆VTNaT_ƌ(Fs#۱E-L|`=4/TmbgڈmrbLߤŝ;o8Jg`FulKNqܽiOelTn(XtL1,o-&*uQ `VvgIYJU:Y{:J!UŃ u".`_Pـ>@>FjZT`[̶%H8<Dg>ap,rCt#F2 	q1UdeP~C
*Գ<ogŔ*;%0xvɐz[`;7i,F-jIW~#0/>S3jk0%Nid3Z:`ujԠ/C3,vӁ^p5X
j.ԜogؑVpЊR*=ROxL=	q6fcu|QGV)zl@7[t|Z4fF^p̃jdq0)DUt+5SA+OihG*uXm*Qaom&P08,|S
!,jj	4udoP!;(uSTf_ERu-,yEG>[eq8+}f
Hel{\s(v`"Ő{:V"ЋqF;Q^t`}gE+Ƶrؽ6#t쯔s[j1[ʍ=i2<%f)Ӗ ۢ6[V~ 3\h:sKT4HT&߁T
:daqXL,Ag˴'$LRzuJewdqgyq9}: (_UYaSN5YN2D*5G7$p{X	Sv&"4ٹYk)Lė MaAo7p*zm7)tzr茋- -،YMI7ddF-vnmARw=e֝ÖJ}ÔYZt:٪LTEbe ^UjzqT'a)g:0;5ehdz2aRKsϦ&Uj.$?L\clZ<D+"XGc33Uro@˃·i46ӱyR/3U@yj~?#&M('AҔ(_)Z}oDDVj:,8Ҋ"g_W65&9ѫ1q)2FN1=OT"X#qK;Ǖd d7/*ݕ]Xș*9ؖ:XLo@S\5ȅE9K,Lw7\9HYäI7qؤ8ؔsF/&]QNYvuC6dwDՏ6٫C:PSpH6yiϢ,ZPFF<sYNZb\Fƚ<7kwyyL'L_xٓ_&>'N~jZ[Ӽ=/Ǉꍅ|QY=jQ_STpO7jLGńIS:,O77	R\çkW1^Qfq$Re9RU=%\iqZVgayÄz>CMs|o@H8kW*JQ4]bվKfd"P]#c=~E>-Ndi':ymjf)gsw3˄?]0#OEt]Ν=M
f1)iLnea,ᣋ^k*B	&|igdrs^xIDaoW^qM'	⌘5Qn29
S=ʠsYF>μl4DߏP{*/2@CQW0e\uun?xr;pKhWufKb*ҤI@m+8y?~GziVcgКՓ}| Ӷ~*jCH)2Qljg 7{:x+u޿I(w#	Dt;4xV+9 ihbr]|pt\TcN(Fkha,6j:9#lYy1FvurbΌ3`сp0!F=qN Dޗ0<k涛N1ś]z	H'NH)]Dj|tMUu'uvx |8eBqXSeDZ"=L <a`RUK~I`q9K	]:{{(ޞ$AGtSvɩyPWF"Hh|c6<>j&Fأ 	n9B9X/I65K;B^Vqo.,)NO>q^pn=+WMZi@igݻ :A/t3\sDP C%riu>~$NqNjKw+4!XD2G"LXrrN-1%tLgkrqVǦa"բ^:}Ux9٬AH)Vv[XvWF')i+'%	ۜ3"yj`c(}Oh׈Iz%EGC١Q{6h==J~jx;P ]ܑ QӈPnUo40z=P)xJ^l*lNўm4ʬh[I#ecP|7xmt#$DWmؓx;ԡΓ`u8 t-#{(DNx%Oqr8v>4T<ZVTg3x46xTLNo`Cb]MޔCǏ!#Xzז	jϭsŲK̹MlPe8z77bgJ>emٵnW-k%_H4i_!bf`cyKLVAνeTcy-!|T.KFu;gCx`<y2nq] )/+;F+"2i쵸]sgNKP+NU53bPd< (mǄ^PLoA&}BWL#'%݇P݇qzh
?!w\%a@w?~IjݬYsƌˍ#&c:!y؜N±"Z&З2XȎ*L{D8&NM'ͼw2&f]P-C4[m^=GhcirnO|A|6(PN)׍/@x1W/kx&%B T-71/ˆT1)D4=>!1>:c1t6Tc-s.@ uDdF9t}$99<U03B~s P;"&E²H(Z¤l%#\ttmDjOVo۔X	apYS^>w'
*H>ҌL=>ִ2{8?ܨ*fO2i&NfeGS69%"dT>3]	KՁ%/L,0CM9ηo a1"ڑ!dѼ=aJl2hTF^?)
R	=v\<8b9	!ѯj3QG;@|c &E!<ԝcgz%*015/6daN:f8Y.J鬛S6SV|z[94*0"%EtM 6o3ɺNa:к<<,)ߏ}-{
hN-vXn$Jg6Z2Mf$u_O^RZnqjuuAjSͿtHy.9K/ΥÐ.+<:}4>,ʸ\~fǊOɆߧawO?8wWh!Ŀ^<~z}߅Н~sB&dEC)/(U&'F<>tD
ͲXo7`I_a"[,*)D*ͬM<4WbUAw6Y4wܰy.oR /xN?(7|;gYj1e7\Lh7B&T{}3\ &0J˿5l1R%-J3ƧL\9t{@
߂Fd;k$.%L7I-TxO5Ʋz	2Tϣ]/4hmfӏ5oJQy.ibMj"Đ\|/um)K<b06]1C"L8k.`iP;ֻFZ>m7~ˀ)?4b>( ?4r E~^k r5w[]xޠV)nrU\)/\EEb*Xb7شw|7ݘVIV-Ey1ַ`(q+-Bf+cc+5N3vYZ;RfxLn4TaTU ڃͥRu~T	?\F4KՀWPc`TNᅃUVĮv
Hぷ:GFݗQZQk@޺oTgNqg_+_ dx=t%pGȉ UJ3Pk@ݩBFǣ{Yr^ )ӝM([fͬ4FW9rKľxmFTɛ	3+0f"T9:ޢ?= ީnq$fMz<º`EN<A񋵉SؙdwP ZE%JsѴf֘^}VהULK ;FzϢVླྀZŖ7M
hhZW2z_;8`)֝~UQ2Ge	;s2bXSw>Ե}n}"L,_[_/+O;v_9vz';_;|"eg(
G 8 #1ѓD[vʇ rj_wpb+ΥL1ƹ\Oo#C;PQQ~~eGfF:3Ig[kC6JAQyz	aX(3W؎}qGodqD.t
Ǯx|g{E~^U4~
JژNe^dk3W#7~Y^jrI\w2A%--,&J&uUlv_տX^:CGVyV뉛+>0c]]PFzG~gº;Lp6nv~%|ixiGE1n	g"~044:`ylvA5VN)n:$eeE8:z<,1|5:ge(Y,]h̍H+$棂"TMp"Ur7(<ebwMh?U4Ml:T+.Z莖ssa; {t[TMk_F#
ӷ~elcTG30,OT:x޻ƫםƎ(imaguqAjS?/45~V\W(\1ؗu95X8jX#z/ʺ.^І<;̭Vl!5!D?J6A-݁1$Vߚ8!ݯ&qXrWXdћs|v5"
v:._U*`L!0 5wL~%`*\bٔ1R}9` ͓0}`h/S)ӻj }
(2jT
bl06],eZdU	5Wn%-h]ѣ11̔?6~Zͯ*FZ?\Lnbǣ^m嗇֫']*mD!1jӬ$-DpT||oqSݎEhZ4e2z8Y:Os?;~j!gWrDD.|+e*/VCپ a5Z/erxv^-<}pՙHjqia78bMdߜ;!N\WLռ0I8E,!dxIb:z.0e1Ķzɕq{P\jYӼI
HCpl?UEr	"s'3{fk逾e2p\c7*fd12,Heo$q]b塯s!v%O\\xWd6)vA}}.oxJ)"OT&"frZ{e1B!)Lwl>E&o~6Pnzޥ=°Ь^8:¾i+c
gxdVey5۞l1c(57/y|dr;.6>$瑋^}gy7SdW(zkz[*a7:gd)OW+ta_[/U1J5Nе5u8avj\Fym6DȨB1t&,xqṃF'Kt	!Ζe^!k`|NNoBOy8a:Qz~?Ё먀&%fzNȻrShT7SCV<b5]ⲗ#$|7 OUAS'9pˍٷl67`io7]h֚kpgJ6QRP^z
AwQrWkM|#OaloaW76)3i㱱V0-ci3 []w0<৐JӂzpI7t_6eneWNfƄhoZ{c#Yւ#T;OhIڕ{];\Jσ0ttًR'#sa"འJw D=V;][NQ7S/|hx|QYq@XY٥WW7?FxG|p՜\e֯}ߩ?>L1G)Ҕ'@e@5{Գ6&򎨠ԣM66Yu+7]r8DcZ^=FPfy`zscc$~TV땅uUUtp0GBZCݧmEa#Xbs׆0G}o+t
 ^3<ӓܚbNV`VЋfAL~+ʢ]書	N6[R Tv5³N*ger{z_KKq_jzk٭ݐ+*a xCAY@(nwg3o΢#u:?AgT~p[}wL~E8	!俵Mlo6tt@+Zd邖O{Ϸww~ڪmԿwcrx?rUY+i;Gy"ho<8K3Sc@ٶ1)5:hc$Qp	8ϼtE6xtL5cxaDMvCxm=:PݣCBd5lӫoWevu w^hW><ϯ^uK3t^|#9k7畄իl/tqGt|D0D?~n蹂-4-I<|Yxৃf9ji:?כi܀;[ǇO?nt>i"ƒ`_m:
tcr%9 gӧ#C)S?E<N>)6Rdn8m5 mŇ%r,h6FKQ`i)#i"\m#_7[94OMSnXp~ M
Q7ŵ >T}Ns~#NXqoOyK!qTvYìdzkJuF{ݝW/AO}^Gm	$lPyAfq(x[
?z_}OSҁLa:"%#Qf'w"ΌRºK`U+BZPGɀX^fwyz4WN[kv>%/8TJvHmϡtJ BߞثtX{4e;ㇵjq7Wkmn(,&RGGvcݬJgdeSCaP]O~i"S?0w3{?F*bԂRe!jv+~U[?tȉ$N76ecZ8)J|7SRRZ{l	_>('4.}7@(V$f)_-Y@$ěbzT͔M6atJa;ѳ=wQ'Y9'u⬐wB?K4 fvNvE%>
[h`8/}ik"te␤1O&dw9(Ȭ5	A;O墂sܹA<zsz%ס3[tڍa3=CPxyeTQ&71ȋ)`37u_K-yԵϔ?g{n,9'_G?_Fw@>HLE: ϧˣqҰغ]!ӈJL	5DY<JC֓E_NCZXhd-
s=9sc;Mg~	|hE	@,7CjE  |X>t[ieMHu9ЁSkȩ|\Ru[|>?C3peY4[_t2HJD5ӌPzy9EOj_o5Cb'k>@ʄu2/ @u0%2LeΙΩ١$wi/@3oيGnzʭs/Ԝ2#CD$!IWg71! ?z;KEp:sU|iަX-vU"R48׫!6GR|g+Bqʵ0P]FyN޹Z4Z/3˦-b>HyN%2}Ŭj_Tr\¾$2AZcT: BG^1e̤idԌ-gb[{JͦW0$hMg|4s?O2J%@~q]xh|-4 Ĝ0\w1 Zh=/Ӈ?ct"hڶ^AF2[B2VoOW=Sgk*u!W=6Hys8Àq4"/Yh6n]v5 T~oדMx@3$2n=)t1zu&-5_OyO uX<E֚(EUVluVY\>~v״7"vgqod.Y ĞSe9Uۂ0R-C}ej66D7B2%%AZ5֡MӾ>ƈ)ҽ4,=¤|vo7h*Bh^[uzd* i`AZF2X'b"۲S	vYqA~m	U|b)z<ys`ajl*o*B{|d!m4-P-˭Z۵E[`u341bi Nk0/R0!*󍘨cQ4顎{в
0*P\]:.a9KoK#t>ő
*3FtA!Agb{`Uo#DP$}}Rr+b3G$4yWW_}K_(VZ766[[֭JICx"pc~yVҢ0R?Xѵ3DJ.,Z]bF1,RyP7x-)f8a![)WJ"""ǋjޞRSyuFn/`46N(08BXHKЪ6MBidnڹ<f
ĉ#<~Ω!n^R7rArUGCrcU~pɦJ^D''\'PŮG1ۈ0ܞ\1 w?3Fߑh~%O6k]FAhȚf=*e n#t ;_6WguѤUǽt[bEaEg4~v`S;w0.X-/^:$W!JXU4}svZ-un 	-2/H+B9'FO~RRLЍOXHĴ=QKXEPHb6D"2`o)qɆ72@ڡଧN='Gr9btRqG|v[]	-+0lwgQki`{~ca=c |\. ۪Tw~<&u?4SY˒_]dĺV]6lCvGh>}b7k$	"$	ҍvv(裔:yޯAFy[j̊LNv@C\3hdŏ[&tבSq)%d	|TӾ"Cju++jC('jdjN]CR_tj:;^_)D,	iY,BÅt]EI	 }/k3HM+&1b_ &l;"O.YفΒ8_
c6G^4X	
H;-щ)y{AN4 =%|2Į5ȣ4
5(F}d (	jX7avZ|R5Guc0_JU'5~lz?nDάNjlNX8=SD)&(]0%=;FF>T3HztQe[W`#zeZx"gIRak:y}Mjv͢xFntwݻpiQtP7z0ʛ0LE5la6)yQ6ӵf4\:	Bd
jXUW$&u<Byy	țL]:aRqn H[	rdr
ؽϒE-@/tJJKq Ie!N80ΫBn'6Iq,~X7/M:PF+jЉ 9Cl^];'$OJ)āj' *:eTbXM/c5ScD"$};fS\C;7<|N::1aq{t鮳/X{sF]$!2pDPEFO.ƧPS,ƸD%"Vd7ֺeD([GïgNxC&*;@aاH{e3U=0nCcLIzPGti\8Gqt),6+~= ,溿&ڽ1$%MXEFy^$;r8{?W: (WYHqB3\X=hK 	JXqNΠq@"/FSf\HaKQqCj񛀀f&*yӠkm%tcQpۨ
5-8[m6ԽNmiwC0C S=Z ?q9<ym=FcGav75A?&F0'عpQ
{(fH<>:uzot2l. Idؐם4O60A<E#61"7ӈj H4>vr묰r6z-~,ruuBXnhwݶJdݴRyܭsw< JX0PG/X^Ը qt^*8pN~akN~'H\	Aagjäŋ#;',S?}XB]雁N0ؑJGO|w
rw3DI[L9}D۬`bڧY˷a>7[
D}\U0Fdmpg%
(ʵM-M 5.IC+E#w&;DXA̗S2UЊW!7zʦ` WP
Wi<A870@*OaiKSb-I,km2:NEr7@K>.jo*af?ʛ7@@o9jw{3ofp>7hx3"r{C:nÛqtϩÓK}n,(7fDSrq*>vPmF3hfި)VC* NDS۾.w@/7:?~w' 7z[R2@a2O4}/>X7&jj0c$ϻG{;nF{ۇwp^ǟyzG~aiR5jmm1Z=_
Ϋ T9ku~}NJ<aF[v#鍸υ~h́~ܾ]ɶEhO=ɔ1i y6uDV}SqȵjW~U]:;6h=/A4ɾ> A˯ )ʟ/[ͼfmmuKۼ"M$Xř釖7=0*}l/*lr0;:-lPgG`9%-B̞kū^,K;	eFFZOnnȷ7=qUOٯͻ,sb?QԗTZz^pr@x~JIl2j|ⴾ
7	̔#~eMjq|b9pT2Ƈ12~	E*`0p3s[2aU& oVۛ777'S?n}0@LW>fV}tGA~0']~=M6;t|c/vdL;/ၤ^ïO=dł}fmLX뫸kuwQқ.Kjg+ͿI@.?LDZ 
~.S&O-":/h%APO>$?xOURX>/p2ȓW.؈/>jiz`ģnhdG0a@!˞+ek+guc=CxOV;(Q~/]7YK] $KF,)*:K?y0:wW:8 z{};xYUr
>Vr/X 4&I䟎ѪIXr}a}	!K1[;x/\3\kU`y}n3=QBV#F (z5eeDt9kW.4x<RKZH}.f^8Fi'u]ݗ8j?z}ȇ)-ȇ|cD=˴C I.L)8RgۑOe3r|XaX"
X;%^ora>lЀ ˂Img{G{@"_)>J?w\lp=tEx݄?z}xtCjZqr%,m[iŏAIm ]s  AXr2!w}#ün5jcc&
a0t_wtw`^autZ4#*TmW@F`آvXCСİ> Kip̎DGGD	Gt[T05 d#tVWu/'\	*^<*Fxs.(-29:77忌1I4oJqSz\Tޠ^+('j䌯 sA4srziiiiiiiiiiiiiiiiiiiii5 nm  