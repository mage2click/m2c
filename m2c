#!/bin/bash

declare -r m2c_version="0.2.16"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]
        then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$(m2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(m2c_msg "$message $(m2c_info_bold "$opts")") " res
        m2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_msg "OS compatibility check.................................................  "
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_msg "Docker installation check..............................................  "
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_msg "Docker-compose installation check......................................  "
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_msg "Ports 80 and 443 availability check....................................  "
    m2c_loading

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 80 is already used by some other service." >"$m2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 443 is already used by some other service." >"$m2c_log"
            test=1
        fi
    fi
    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_msg "Locating archive.......................................................  "
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_msg "Extracting data........................................................  "
    m2c_loading 2
    tail -n+${archive} "${0}" | tar xpJ -C ~ && >"$m2c_log" 2>&1
    test=$?
    ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c
    ln -sf "$m2c_global_dir"/completions/bash/m2c /usr/local/etc/bash_completion.d/m2c
    if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]
    then
        mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
    else
        rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
    fi
    m2c_result ${test}

    case ${m2c_os} in
        darwin)
            if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$m2c_global_dir"/mutagen/
                chmod 0755 "$m2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        m2c_msg "Generating private key for CA certificate..............................  "
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:m2c -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Signing CA certificate.................................................  "
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:m2c -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Password is required to trust CA certificate...........................  "
        m2c_loading
        m2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
        do
            exit 1
        done
        tput civis
        m2c_erase_prev_lines 1

        m2c_msg "Trusting root CA certificate ..........................................  "
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-certificates
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust && sudo update-ca-trust enable
                    test=$?
                else
                    echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c
    m2c_sign "m2c.test"
    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"
    m2c_msg "Mage2click toolset is successfully installed! \n\nRun \`m2c --help\` command for usage information. \nVisit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log
    m2c_load_project_env

    case "$1" in
        global)
            shift
            m2c_log="$m2c_global_dir"/log
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up)
                    m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|down|info|remove|restart|start|status|stop|update)
                    m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
] m2c.tar ]w㶲(+ٶMIV'vgms$*$eYއy;gZwZ0k><̬5f* $@dfҖBPU( qFm}vgiO0n;]x`n?GƋy!{WH>'O?4i6yGc鴱}COצwNa0ejM	j4o`7FhwH;Nq0t?]<IE>^@NUNf2k|<O)qzeiߴ[νč~oh-ߝ<Z05ugOvx>g"Q0݈ٹ;`,{zQ0>#`AS/\c!;؟0?Xg^0ԏ(Q 7#cG88>$L<֦ū\;`>nO_F?q۠WVG# ?<%"y,A8;e;rx5(c{jPtD4;j(J{Gښ 8Styn5/>kq0b;v4/^gTyKs]cL]\(Uz
2Bo0~KXge+h}"GҨ#^!50̌ߡ:Ib)&Fu:aWDwE., eOݹ'__Gw:fZv}?3Z;rӵ5~eO;>z`<!;<A|cմ'QGПvAy#nGv9(K~#Mx<W\/>#	Q{?fڱ6!bgn8CTȶJTXU+lnoF?<7je:ԺCEס6mT؁@	A	d@	$GM ۫tC`GG~<Emr$̚Y@6	d@6	dsY̠Хۮ,Bv8̋ga}d*@5IĆ0IoZY`^YǬ䬫;jG̭e^VX*	%2XGZ=t>3mcaM=ތ뢄if2\^dA+N=:It? ̯tI	IYB0b̚!Lo-_jy1d'7c98W4m[nD
J\-7Yf{4O,c{>|<\{OW6jY0݊!2va1 \
"&j@mJz1YJB׽wÓ	`4z*pƃʇ>σ>AFwT}ͭJaTeϥy63w;3
<qnk5%\!d)/OQ`=U_oq_iXKK8V?4v+%SZ%׫U#+^<M[oC"lx?@T7 GDtgy ziT	Hzw%j@"3EoyK4M@) &L }sYy8>骵) *&#jLP} 6vMfsn5s>t{o燭Ɩ}LȂ'	 BH-V4f@#o`0sIU'@bbݩS
zY
8ޣCt1T|ϟ^}A%1PmNeы_d&pr2O`K{>Cj	#~)rtF@DAs0ݝ\`넽E&0 H Ml` 0%OM&&@|I%۫ hY770ʾ`m6VHyUS	k1a콏YLLi0>$P✜o0ehFݫхy3BPz'*9닮ϷKa1NW)0x^
ÛE>	{O]dQOv3wEދyʌP\,?SQ˶v?"w1Rh8mYpUHgJX^9QbjƦ̗XbL	t1kCGyW> ~*Ŝl ~-@fXkĜ7GoqTԂIt|D?h g ϼ4+"<_};`|:|? *%MW	(%;;BO7U23ё[?TfSmY錎1i-) ĸp>2s"ҫoAN_4/Ē^lP2 _E	,*Mbd\]iٲktTn90'?=;q^YlzEoTh4~gDBP|xdvGp߈B:8b}xxG(hi`+SȕE\#?{-L	eMg3/AZ:,~a't%d?NQ"$ts`MV0VG!g9q2*؛=m~ÞAgSu3FTOް_ϛ_BȚhe3BÙ*Le6~4eI"a7Fl)4:6Yb(4YM4.ue{GCx))vYl	YڿOoZVNloϑ
%$*;כQƞ0#Q>:lg#}*u~ĂhfؿZBV.jFYWdױFGMt_|W/_
_1/- $jBQD5EK$a'XxaguTAU=wk)t`.HeZ$YV"^tNW Y-a~S's6y7?|*5hf5趚G0lv%[-jTRkcMnhNvS([b嚥y+]1}!0CmM#@my#eoxުvDj9		l7I'TYY\[K\b/i|.<\1Ip6{?# z7٪]lC,_ةl"*Jɨq"^F#}^<;e>&XqATx>x\X:a,>CY\^
f\6+%
9zױס˽&ǧ8+b5|K+[r	i*hǧݐR;/3Y~Nn )"P@>	///}/S. ]\`e<~CBQ ;j'b$H*m1_(ЉcL,4/m \aI/VCnXnܮ5+)
X5@S[YjV[9,DX(A(Qd꾒WH/)4⭠j.[Ԃcn!~-|TBvᶫ|& j^2Ss&]A0aJTaշʴN[Ş(a)d1\/unp-\-g\c~bv1W@ea&šgiEybI\Zf]I]k꒥%us~qK܀KP=^w{i5wdf=tBh*
֔>Mf@I+b|q|i~#4C^3J1u+WWgr>gQ\֥v%-\ _U&_<oǬ̝>nRtaEK[`fA_G`?|P}ru4ĵܜ]s_1|Is%ⶻ:[fV[ksp[O+x8ٞ%5{#׾%AFU?NN0%]WfɅ;J!*2?[e#?5cۢ	^9ڎm&O.,/v[$QXiW9A	i{H]zִ<(:+GVl{^I|]'>{IϬϢekᱼ]8Zn$(
*Cr$DRr▻:\*CZneQkVe' ,cQ!iNH_ˈ0|IǸiK4U]$=yhv#ՖR7Cz|9)M܅@/mngL	ډΏ0mByh=tbŞ8%-oVy	RP0I0ĺΧlUdF$sFtv	;3'>'Թ?zбVXع3+yȏdmzJw`jR7\άk(q;FC͟^ӉmQs``<xyĄg񕄆~7'󩴈BQ=wy,IS7΁è\G.5B?nO؏[:~f3/9Lx}M"o>ev:ᡱ#RIRUN]pDdk}T,h2F:|RLIcu]<5>Lx>RegoRI (&73[om5̼Q~Nd<5ߐ-4--gIq8ש"=f=A3y
B 4A*I6dQYDOne
ѣtIkFjLr6DTqům*/[nF[M.Q~݉g48GD"n	&sB\djl]b_L#H27".!10WC_qMK#5<憃y$kѲ64j91yDXs]1ξ@BrX?b$jS3(iyh&'9!RdfnCK<&$W%\@ZoD0~wMW2EBTT?7et@-=toÇ77<Zy)AܺmA-dR$OhX{?/sH'N tZE|1g`xg37[N,药OL^U~	vqs޳FB&h)%3UԆ3rFaPt)A:9٩{a%gx+x ?0sǑ!fkك7&LhHnz5ϔSq
N  ˘E.}p{+Ty0܏OyN
>1ZYIR)araD:<BoeWEҤ6y^BPBz',x.)h|w)euvf!HhV"D=|	CP{H5A&cVRBZVRkIf+ǝd*i0H=c8|!g0q)ƘA@\:` (XP?_K|,1<1SsaTL`0

(fp2oI?ZǗ
IR)3D"ΛFRO0L1|~%G()Yen&Pxa :SsGTB
^THWt|R󡒋H6fs^!JE6 R֋¡R
){%ĈGzQ&kvڕsݫ;Pf9
r`F
 fc~6h&p?ѧ=q>9ZAbw)o&qta֠6h
pѯhqA6Rj4ŵ+j7~gW|vg[|ħ@@8F@\Vt}/m%4G~3x-k:dYA_|7$|C"ߐ7$|C"ߐ77򍚬EV"Ud	|Skq>ov0gn& o[7IoS?RsxN',vQFae[AN1ʬÙ%#W[bF-$F!Mɰe	6DL$JJ*9h5Z90t+LS|N[+Gt<r^"HkѠm({⊃PߧEpZKҬ0uN>k>ƮB9]޳zt]đ$gⰬc4,=T"HK`bX1:rXA$|ظ_%q6D,@W*z2}OiSD}2b=mCE>P>r`>EDO"MDCr`%1)G鳃Gܮ7nBU8KezDԈ,(jX,$fA|jҐv`P`|<MTawʾO얘W%14vٖOʶ/QwʺW\f~_q3{'"k/9@!IXWF=]-(EO29~]=3SxLT
oZ|k%)b	y3P->X#O&졹.3=cS{rj
L!o	Kd<kEy1ƟGj57_7as ZRg|F-6+W`mo7R:U|TOnug)>RJjj)7sVNo_Xpwy{$,z$v"]u:w3[ؽ#Y\$<|, O˫.Z_cTEז,~xE2	ђ[oܦ'7<mQ@7Tw&_7^rOHb$4;X1sDE }KXК-U0Q`4Bycgˆ(nvRd1zoK&/w|*(}#쒹
`{zzQr-EtJv5p4tC:{ů;C+e]F8i91ݨ喩x>؟vg늱",6Eo)q`JdmZ{ko@a`u9Z$ ܀ꌸl"zpZjEm/bƦY<B1$,J ku){.u_2_#+Qힾ,# \q7}y{ּ+ Vj,eKvŨE3[nEݬo0GCa1ZR[-[Osr03O<ʘ(ke~fqżkS33ÛvofE*a+@Ϗ	7/-bh	gtݹy:Wd{qpW՞7[~iLR%Zܰ:M9`څ9L=|ʅ帎n4Z粀G]|FDD"tc܅:`eޣFBx"o)[5
aKypjp$$Q2RZȥ0Aш2v(.S(7mƭt-V>{OQOX=kHo.e#HNJrN`H_
ըpGS0^2*)qlL<*3(K.z,n4g^C5VFi=w:WȃٝCJ#iab7"止0ϒ
)aYx]:&ω I¢%x7	?,Mq9We2ojP{RP/UށgVg*uldnɐ@#FGEq<POzvdOJa\Qt\Wr$tH:`X7ǎ03v_SF3FݢY͕|
?++!myg2/`YLGq"XꙋR)4Bɾ;?5_>//_ B<cfWp,yНFԅuyyqҲgAhz7.،ZP]MIیxywx8ex8Y C&`31bq8hߕww+3(G熏p$5<5!|4<M*tnPZ͂p	!Hp'z=i 5ou$`M@e|#o6.
֥zVlWy	).0.B׳	5[
^iT(QхMFXg{K@1"Zevô&'°E iM"]ڼ,bYyACwxE'ec/g^JK)/`x%,n&Zouz\2 d2)fן^MN^%*X,IoP~C\c@4L|屨A*._`4V^-t_Ԕſ
(rH*<%ɻs7Hǃ|R)|Is{vdXnf{Spu*`jRRs?cJbK9-x_H"rU% 	[4DTbm72734lҽ}6Rjx]0NP-1XthVmwd#xSɤ ^vvlsg]e_6dU؇)/]t.t% ӛ26j܆ҙnIGuT9[ؒwe<byL\^I'ۓn`&cfݵ^3$5e.Tu1mD'PV5$ٺr|1d8^ä#|!XTI46%MI#Tm#OGly2kqo[6V3ڋv쨮-2Sn)8`E#[<TtseMK_5\ p<8^19S\XPmvs\tN;/ڶu#j2CkJ+<D4iiLު細]\㫁P3=uɒHvST$psUηF"J+.~gCcd_b wHS+N8-	sqyq,'YbpddM1anlBRvUSx{Ҽ^|[TIvA:gqnvy;y>Fw*g~*ȣ]6Z5McCG	wBHe1llMyǠLɝXro!nƞ>^`Q
+е0X6OE~,0 7n|bb7)݂tW\W$v8]Hr.-|0>ϛ$=}7[@%MR|FdvV+D zQ<ԃ^J/	5jz!q>P/bڵ\m|A+	҄,i!dN+<7`'O\<
&TPCQ{a:RK჈gk-B-j=jֺIa
dEeGtHg}1SQ[
!BpO$њ#*QqϞ\!sexBbv|W'8+ӎ$"	{!؎,Uw̯򺦥`ZuV\~ˑp=Kv/"LN2@k6]H$BbE.0x'7FHyL.ߧ:bby,#N6`?:6joz
h8Vn'Ghf=k=W $X$1!w</	s`/iՂT_e<
껢Ӗ e"Ƚ$)i\X"Cڐ3~OTDu',pfD;r*9BZ)R*o6yU*F-gd_}-xS_qp|*|U:zrttIu)R˔9_mhM_]m\5xBlYhYiUW8eaTPr#VJq')27ĀK&ơ1Zx>G[
NiMɕge0[ ZCas4Q}<GPZY5z7S ph^:62C^:-j>+_yeF&BneI#Аl%eհ0i]<
8&TJZV#ںE*߸ƜV8Id,'AKؗhCK0caeCms%]oͫ>p.L0d鏵uY_ަ+ʬҷ'hg[]0-/fEԼyV线v\iZ8Ogj:.MۢPJ$ƗEn>9eZ3TdJǙ]B_r9K{܉ڧ1ζviσQ+pq.?%Ru\WToouWn\[7ukSz7ʨ7n]ҹ-A/BFYMZLlـTD:9n8#cd!tɟ+MFgWlL],Tbܶ'7nK	.]Z$9˼03b-S .QJcˋl8 @48[+>tnZ)]F\!܍nk[{2QwT`Bío
vEemyykbiM4n`<=X]p%ʂŭV21ڟwD,Җ+tab8ܿ;k8pPdl8QA&td:`vIoAݓief1sq*qs
QJU-FܖMFL?|>bBtuuc"xi{\]1HOH9<׿b̩q%r:[j	=Z"b+q긢؈/<fAG5!rlJo,L痭_U	"ek9bJe}oA֚V~eK˭ .k,9U/D1P)a5B՞xX !Z]S);p;fX0;~tpd-Ol⼌%.\[YMxgq4da;	C)|kPiQd끹T lՂE"`+'Eq`R@Hrѕ"8bwxʇRli PK(mmobIN-.]C;o3o+oΑq#XN%BrQN1?QlfS@cAKPi㏏b<LtU/B5IbxFS<#x
w8\TMJ}v09u's(-$ߔaxxM/dF-bd/bƏ^QD5\ީ6~rv{$y& @y\`A94eI'\jkvAI0c(X&6ũ"{i
W2Tnݪ"_$VނzA߼z^~GG>9VK
jH T.Q=(.A67>u|\=/<7r)=vz)9g3/D#s?jê_S=S7)K@er7XRT|5v7䕭ҨA5;ݟ=fUXUݠtʝPN1n~%S`D1}W.]n>9xٿ!*NOҒEfCԔiOBd9!wElkBٛQsXmM${撻)_f8cγ`ztvh<>Q\s<uGq{Oe1=Eh0n=AڏǩP3_őigvpgrmgE'ϕ#w(械(EmM|kćn;|t˽Ml	*[Y7KrdLYFw69Yoh^F|⨋Ys2C:[B2tV=Dkq'"U

sşa/EQPlp	Ul"O1g.Fʄy,6(A {C^jEP8mꪾf
I1e"C_@Ҍ훦jAVd/l֫bxD`Qx?Cc#gʯn,~ dRJs+3.0-_KqҗeǥYuqhBE|
/'|y?rW2ֵoiUҴϫ^!3ϼSVx<0>KL*5!`
 <BHv5c"3rNċ\H.Ucqzh	t>UQ{pGbF{p@JiQIy5W:(+E+i2(va3VkMy7&<!(Fo>"6
WZW55^jqk-Қa7Wqs:Y-tB271wk+a
-c|`+-X8YJR+on:^{:=5ǚ,U(dJʷ!N?xjuWqCpdÿtILwhJ݋Y:	2̑I2&{4c 9&.C̶a7O9׿Nyxmtn4:NCzK^i^TprJZqe:"/x)F#,)r4A_/Q
f/)HZEFe\
M 5J~c|\bo5݄mlXO8sB{O݈NtǑCJA 7q $H .〬@~48r[ūݚWCmꔿW#)oë!fث!^IRK<mLc&L֯kx-N*%xbрj1L>qnBيCrAѠ>hRLa+hfҫS]\-na\le6Mm3o<h-[4֡KN]5o$ZTF3.9f2r/2Ur4u%3B)Zt"rc[|eƷxwHLCCCiA؀Cq%`eU_M<^Ckjp#-7L<wtp}yَaK_5퟾ƾ8	wՊZ^< L/+	^1M1¨ey7ّw/kN5!3	riMKDϐre`\+g';*>ɾ-r,C46l,X3H6\7k\S:']fȂc[k迭Vmӟz,`w 'IW=-D\8>?=]$x21JL-~1Vq䃥5?D42j@tV9ѱfۑA=9'R) Ѝ̭񹩼5{;v挞ƚݒ
6G}ϧS5N`á7st&S]kf(xs4\L=J?y>1~3)~G.Hۋ&`γ0)Y]1sC^P\{̏wx zďOGx^ T_ќnM-r9pJxpL1q+Amǩ3c"ěWOHELs#߭rч27Iy.4
`Cz?3nNoܝ@z^?fOJbM&/yC [fR,"AD:Ϛ` 5%#l<y_rC[{	g^yJ-qz䝁N	-Wls!HKB$-$TFO?Dk9Z{_I?;'[Zefh]Um !-?Pgluc<8sZ%Ai5<>h"]kÓP91=d|e#bQU&APTXVm-^oQ0)dbBE8Vo9ki`0_d&^ΙjiwAAڛ)aQafs6*`.&W/R9q#$AG%w4xeo78kvڍ{,kHy+Cm3qdg6C8WE1CGl\X6yet%(g|#.XخXɒȚ*LnB^!)Xޱ/Qaa&ʋFkeŮW;_t⣇ڼ P(Դ)!gMRlr_VVrib[oPOaRG
ğ7 F[
3l~B׶^y6u2J~E^Zr6o~tJ=Iv]+5ҙ\E[ZG
?ژ 8q䮸 6拽*6`s2$@v$$]u$b[48x¥&kZs!ЉO^n1GryC`̄.SCCQz?`jT^R.@O`\<hnU{!mř冤ڑ	w@x%tXXYea0QkP8EgD@a07_I5Ǝ^K\mo(3alv'""w7[=߱+ v³ǿQQ>#W|GТ<VENb-xQbDf6DǾW,'%f|?H&SdP/k\)qSJbnMrIg>MAӥ>2_[r6ia0rL4wO\D x>1}=8En	u\"Q^O"ĖCIe)n7Dx.nB?f:;3[%QEQʜg	wVr:k	F[PiOYdɋ9)ǳycӱκH%mɀ(?{FF꧞;OyhO8=~Ŕd_ZYa鏭<
ŝ_Heħ;0NdCGr|^ QnUDXñ/72a_B{mo@W*cAaiJ??Xh4vg6Vְ[v}9l޻|hG;y.[co:fmwfQ.u4]<O/8:VvM`[à;7룷0pqpA]̆zvaO<ܒ3`N׸>cԱ`ӹwh}4lu^X3ɘ2BoKLΆVdp2 ~珽YADVEpa٩jN  V^<PDe
9E@{Cc&< l}}g#f?\Y3d5Ư#??w&Qvn>|g3<j*GI攔)`wtk^Ǖ{Aw5YAu6!vعOS |<Mq8A:%G ^;
;T{F`VA;u/-Viڕ5yhs9EpCi /Ȥ,. ou9L!I#o(r
 Fј
|Q`Z.}0!fDo~u٤(~O-7:v+9mw'ϲ?m/R	\X6[KAVZ/y˲kvs-Q_+ʸ'j<@	&{st;o-[g4vN*)(v%OVXnf;Ms'O~59]R˘傖OOmÖթ411GmL!o&Nc)qᐳ(B&o1E`SsO^ 8:f?i6{P]_nmM~2l@kgҿM!8;DL^S/P6
oN&?gG dWr N3o
`ĝi$ӁRb5Kv{?!V5[*z<ik/_W/IC&'yw`|jZIҫ^5G)ہݨݴ]k>o}O?o>-?=M.h_	Pv;{ߝ<i%-LaLf[fʃC!<`"E%UlQL,,QXaI]osS]s_߬oY(oaF+۶{"_^xxu<(0, 5$5WdF}<h"Zժ5J~CROH9Y^ZԼ̒V2Np^#ݨ0'Ow^nE@#-;btZ';@dL.ԥTЖ;1%	l|	Cv|dnP"5FKett#^fgaTdIH
i>eXz9;Kx:yee{į5(©;{>n>nb.Nv϶;;yNXr}BK6Hmnȡ4J1,lUJ=ne,c:F_ƽ?&;fʕQֈC0Lz|gݣ#?rho7״{O}DZfY+[VĝBNt6bxY0N*dJktQ[ei,wn5ۦN>ǝ<ITI:8Nqk+22=`<	}oeW<LS<>z"R&ZkI5_տJodWL3VXC34!)EZ>ҏ.SJfh;o;{<>{rO2kɠM+๣4MؕC~PwV"^~<0= 
A䪐=	۠rCӢaL7+y@#/>˩J1`OxH"J C;y|
'?/0t_s.i1 ݉?b`D3w}lwfm]8}ʕ֑wA?dJR;ayt
SrCxq0%je/S?9Mo0I̧#KLxBV0%ԣ'_4w+hs(jZy!W~l4آFcS 1'xqo ui.kA5XdYC \ujKQ
ʬNa=qfw#xRm 0 7Gel#2LAtZ6۬t =NVS귻6 MwA?=h\MRw4pN&G!H!*qʢni67)p1	%g*)z3ύ)Z!^m-!`eM~[́W&p6&xl
BԵn}-zFpN7bW|PF0aU^If07SڥНrȏuMc/C)u2DzN"vEֈ"Qۆ臙y|a%2?Ns`Ś9>4G	L0nElWXW(G^hȟq^'w~8=³Hġ;{*zE90	ӱ?#'ɘc	etv\ִyl^z4aGBX'Qa.0YrLr]̐ir*}T:]<B>F(Ive:
;AJjr?¡AʲC32~No7Xlu~CثO͠4j߰k.Gqe4}Ŗb8vn8MD7:.60j`)m44j~MǁTb
:mj&%5ܞFe7[CѮ۽cS;V'7.|hm۵n:M=7TkVKKkVk崻>{Z^j0 ^?D^ ѩ<lې!oך>@ ;35wl$ӿӮ5{^O'cwj6[=CТ6`tIлZѷiM:~_'kSþd{Zh5A i܇`d3ؠ
"mƮ5ڶ0~߳`XC`Z;-@o6ǁ#:]VZv0i9Hn8}:qV"GЃNߨeC{Z0:z@EPKVn:ZNA]5uik^nid"fVՆTi:80	د5ЏNwHft-y3BH;LۆMgVӆlqNɇLت߶ZPwFffJvڝF@>z]`&8,e;A>ԚN#GA
=׫ DA.\Dhc;vC6"KĄv j@R;г+$E@88q nCm#l@2I"f6`ֵavTSwM-3Ui%v۵t07zg8ZN8	 O͠>@;{ף! Ѐ`(a:nI 1F$P[Kh65 bACZM;&D ע1 yq2+`t&:H @>n߷i(MT~Cl7	}u 2B> Ah5BtdLAAj# Ie`(DV=30mTJ-LtNu1ӬA{}L n)L
{)H"tFGbNVuIӆQۅ͢dU9/HM2:nP#< q4IXM.m5 逐v귡"5ZgAsWhM0*nB"th׀1htS{= :$)&wSvH[o:FJet6h}P. v >du3֭.,i
ZT#&eQ$H'/i:C0V[(R@vhIJ.PMSm..Xn ͡p FSMjT84vn g#Z5H2HdT`lh4A-;CXIE>nvZf4qm
ï{tQA}
vt!ٶqߵ%`1MGۮB{
R;58X;6@z>IRйЂT`sz4n %@5`8P4#G.)
`VA4eۦUy`( k cChvi`}-NM+H@ֱ~hxँ4QCئہaL$%j@0>
l,	U$-;
t)0=v&G>d7ڝtD@i5{8 8rCnnR`dg% A#Â@1nߵz8)+Px&UE)	"fA|?hyLKG4;hl4qAFL/hw0h7c} wZ`v\@)X8sH(ih+yv6b.'[Nt/,0:v'P IR-ڈdhHJX `s@7@B3pS:[,> 	lhׁ]M{Oڨ:4QKSwn
ylԾb{ȓ̃f`}tuttH)Lf?CjlwT5S51J!G)LV0Q$k ðd#{0ه%APYI|EaLNg"Ѐ/ĵ}tm<eTE;-D*TEɩ:bY}4nZ-'C-*n'ێ&`FM+}0I*<EY(OɌ>@_t~8G{ۚ.m|~MThG%f_~8mI?439E!ؠj[mU?$Egafi8CjjLq¨?nE?5UZr"0.*`!2(4?lv4IG.+?$v[ϫP8jw(<iK`&HfoA>|I7nSOrl쫂dE@
A; A#`
_z2|#6'1z?lXE_8vAwR- hv(Cq[<8(:?=6xyp{/qlU:s:У 61T79@y<dQ<z@4@ƲY;
܍C=;ss/K٠H`4-y	QWYD?U+(w /K҆B_w6oxg46Tn#p;=;&YN;z6o|%d	V`6NU_,G{~Ǟ-ZRڋMqBF;WI] `vCVmnlD~5ulYI|@W;6sdPi20.9#ō]5 ^آҢ /qE|Ѫ4z\f;R)&"j'd38q9yȦ\w4v'kKҨjD67r(Oicmdk_Nmu#Qm]y܆GuQp 苲⋭]W,2lUc9	CVdɣxZyMa;OSW}9R{ yߖML/ iԁPYe":+܍Syǧ#<Z(L	n>A0ߡ7TA0^ju셡BN<|OpjtUR*_r*Rw^AMLGPUREjpұ]U$7٠B"俀J=wVi> Cص{munX<lTdCZLXjYPſuq% !!t_߷areZP_V(1̅+@YmA+aSl۱	g4hqZu$|@?+,:%1הAˡ9aeSuڍ]Cx	?Wjk6.1
1Y-\S6Lk9PпC|p]m=knaG09 r"]?-x稲j!XS=qK|<sjj`|R($/X~TO}cYﱇktz@<h9Lteߟȟb8UGy7[Nۥ}ם<FFkk#G1+rbQÝ} TZd;afxtި^mTseO;>!~d|Ehkk<$جxa`CS%ayVp%;%ꐇ묎?e%>Jk#Tq$7q[A|clN֑(IQjŏ>+\0+\s[4&+Iǳy̆Yp$Ǉ̟FYq&Ak2_C?_?~J>W`/ ]rg_G?7_Fw@>HXe
q~=a7$@j}KFi!?ٛo^Uw#5_BփuK!-,CᗤsYocl5e2|%7	X܆{q}է`2SLsgH8':sQ ~I|_z˫U6"_9 S$JǑEWMgMszi9DEls9
PR]TfQe1H@aiRkIY:\fs1Tey4Ĺ%?\ZƔ<9b g=\I9tchg9B?HAAEJs:rp.sw`鴉E뛂áJR+//HK_J=B6?>}k6V4Rz++zC!cp"<m  i
Ϭc*ТBM9ƍC|8#޼:TarY7m2Rᩅ⍍G0~xQ1.Azw$7$e>_qҊ""RFa|<V|"k'R;-͙;GnCZlVLHt1o/mT{eJu!{0 _?{~ÏYl	9@"A.T$J4m
97dmT4H-&[b~*r>Ps̚l2B2oAE̸*Ēʆ6GYMiVqERWGSGBDo`ƞ?:UMEZO_<a5^1h q\0)d&
*VxXhZWR \%js3*nU89 ofPg	S=bdn|L7d*#P;#'XݔwJ"m٢nZ2XM!Fȫ+C%M2LE*SM:,5$?$O)a,E8JEB_1Yѡ~?[}
p`լ`J/o-+-NI/č4>3
͔+X(lWxNY#Ł,旹R4,}piᝨRf'7;d
4<$>å7?ĢU*	\1䠫4<秃`WM  k$/Jgr3{] f|v4k8`3}sy;V8i1whOо`"B_sdG[r"'`=B#CQW!3Z
%RN)KD*$[TI7&YvI,߆NF^ܴVg?vWڅ9Ѥ`ΛES;C+w T2"Z~ \o<{
!>5mG1^w^m<BH^N#ј`s:G,
&h_]"263vm pnkFB>`Uc"%Kpx1PC]DH7gr	I2L@&=<w	.Q}HA+eڸT5!gL❀Cj`f{Lb<0w	lDhѻ!{?fCɫ}U3t-"yY_$SPbj^Ui(˙9 R?kzyfl#CY:nށp,iu{9#PJ)7Ǹ^)?QD}%6o. V'.t=54bS)E8I2 92Ɂ}2kV~pPzV{A9h؃|c~#s<t'NPح\;_A{1+^IfN'V+,Xžx-u`]ʩ37dwRAl3UȢ$\ZVCXNRKتYDpp?<wW9En -\f^;P(`'[(-4[pC6$4b'|\[-[W9gv_:u>#"bNkD8-U/;/Z˚Z	>tNX2e{:7 o_΃pưpB5,w_h>
64&J5Vɿ@%Cܗڑ͑\j+ t0deTZ4@]y
/[` dtlN"FVhaVXXES`3ȏO>'0RMcfz.)Eђ	JҹyMF>n^΀K+Xr}>|kV~2t>*:tNf|Ēѹ:As*.!1Bb'EŏaU2:?JSޕ`z#dNQbrOz.	t6v"wZLeft!O [\Ld"G^Eō\*CwƔ:ٞ<s,I\ʼ0HjЂ%Gs	`Ph\xڝ{r/YucQ nkOHWҕSyR$D9ڪA9&αS󏿙هESJȾwggfwfgwװ_:jڽ}b|EH45GBm)J[u|B$騯O@n3-<aF f65u k4;ɯJ!SJ2U&C6%WVя-I2FyMӔ%xi"Pkf\McKạiUҹh_U$09j^~ѧ74fy.LB1W{fcih_r˂guf"zJ؛xHסR;bT2tzhѦ{nz@gc]SB5vʝ`AYTܠ8kQ<9\4S0M@bP":-oPyћZ2}-}c[8WhOe~i<`@Cxg;ܖ@SeAHsoJHNTAdgBc Tm0֔d`D#'SsK1;CaJ>V1GV27In2NKuu%x]&Zgޗla#/ʆq&4*p4F3χѠ蔡<sbdY}nqZa@~SH=m+hܨ~x³c*֛-^74K/OgZ¡ɷя@~pX};Jl^M2+
Iӄ;ҿ$_	~L?ÀOZ̞o7vZkO?b .^o_>i֛{l~ⅸCzul*^rb12PӜa~fKUB'rP|iNpL28oD6}df0Bȇ|-ĹA%ECh0(5*= _wS8~m

hi&Q7ȘG
r"BSj<\I^'G
[ÿ)r&.GGE<dTutT[\Va倄%zi>fz>v|J(:Z ou F]~lʴvYyYdG(v{i8nNL.!*QˌJؕy[ܴhtg	>KbQ]U ]py?{ivO{w~)CU1gh}n?w7`!/~2Vc &
#> ̍,';TmWMp&4]Zqe.tcu!c?oY'!B1%N?l _5㬕1ko;"5?w:9qO4 cH;)d">X. YnLG*2,wXiMYhL{T^DZfަfa	ABS5}dzXZT=;,xp:1`Xإ(aZ5V13!DCluGCdF	N`EX{Ο3w'uqt.+'G	oihV+9_.j9rızn˸-Rk$%E1'0L]J@1d=z2feS'<dSE
6E!a臸3Qlx:+ i*({ @ljOpDP57ߴujt(40hOMŬn!1wʾYĻ
lAaN=BS\)/(@SFEȒ -!*֖[jF;`1ĨCEX4F<0d=9>xmd/9woQ8ڳ;`]tb<5j"x;69 6Cnj-'Mn#4v-B]2oSBIC/Uig C߼tvp=Goüv3
͞pE>y48Lj^'wqqf"̳Ouw;#bhF\c;.1t
]Y@@⥞<Cǀ`-A=L
V!q	QuHqz*@ۂ03H];N?nhppl1_K#Jݓʕ1OBG~[hW4WU˗W;wKD 7?|o~J\ f 