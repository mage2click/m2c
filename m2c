#!/bin/bash

declare -r m2c_version="0.2.25"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]
        then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$(m2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(m2c_msg "$message $(m2c_info_bold "$opts")") " res
        m2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_msg "OS compatibility check.................................................  "
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_msg "Docker installation check..............................................  "
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_msg "Docker-compose installation check......................................  "
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_msg "Ports 80 and 443 availability check....................................  "
    m2c_loading

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 80 is already used by some other service." >"$m2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 443 is already used by some other service." >"$m2c_log"
            test=1
        fi
    fi
    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    m2c_msg "Password required to trust the CA certificate and create symlinks......  "
    m2c_loading
    m2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    m2c_erase_prev_lines 1
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_msg "Locating archive.......................................................  "
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_msg "Extracting data........................................................  "
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$m2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c

        if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    m2c_result ${test}

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_msg "Generating private key for CA certificate..............................  "
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Signing CA certificate.................................................  "
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Trusting root CA certificate...........................................  "
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$m2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$m2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi

    case ${m2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                m2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                m2c_msg "Creating the resolver file.............................................  "
                m2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                m2c_result $?
            fi

            if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$m2c_global_dir"/mutagen/
                chmod 0755 "$m2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log
touch "$m2c_log"

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c
    m2c_sign "m2c.test"
    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"
    m2c_msg "Mage2click toolset is successfully installed! \n\nRun \`m2c --help\` command for usage information. \nVisit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log
    m2c_load_project_env

    case "$1" in
        global)
            shift
            m2c_log="$m2c_global_dir"/log
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 H] ]w㶲(x+ٶMIV'vgms$*$eYއy;gZwZ0k><̬5f* $@do3iKBP*Bujqzi}gmO0jvNéXqZuX#E,NPyΊy/ڑ~N*>&,Nn.ۨ;0ˎV^oNuwP'_4VOp>X͖p70k6ywP-Ul2h{'fh zy.L?Jw;doDX*`xgO~!4<Z k"߆9`.1glN6vM&؀%!|oj~2E~Έ5X1orԏ>gN$	&',Hbљ8
,9bÂI ّ?
+? 0	cյIh*(y&ؗgߩ:`d+V?=YmbH2 ev~NHD q|M+k̀~
>Co&T0N8:jc4Rǣ& kޤMjGXǢjurwco6JNUL`4ICFvm퍟xƘ0Q>uR?"k,34̈kvb\i\MF1ޚ_W~AVfPxA$q J,Q83 GY?;vqߑ06+[ px2
!+5ilYFUF`-mQg,QY|FC6	|^qy0 |D9k#y$OQ#7Vյլ:V%yqbߋZvemmuC;}(!l䨶dk5.q	K`\B#(HƿMnPcY0kll,T%:M["d׈pG6۬T#Dl0"ooNχkރEx3f3k]YSw4Tə̭eg}o^Z5,KÔ9\Z׆Ym2&>ouQ4s./e 's)$y:MhWHuN,!A1fOFb!I8Z{!~.IOƿ>wwwp=M&`u6WKVs8l(?=yǧ{;vx}zӗ?u5^?=WZ5R|
_m?n9%4Vm-TkLV竢~UЇڬJl'}1J	`&6z*h%}Ç 4{V}'anEc;ƮՕU1s0eX)SbuQg̙7
`0g_w4Fo2b'[r<Oml[o<m_v-췕mJTZyF8("?E&XXG|ɡEE~o@~48N 47\$6J %3oyK4M@y"]&L!}sYY4:z骵) *&#hLPy 6w菧sn5
-P>t{o燭sLɂ	(BH-v<~_C_g0FIU''YSbbͭQ
zyJ8~CtVdT|ϟ^}A%*1PE2O~]8ǲV#7vN93ȑAdټDo6 ɋi"o?9~S{A`6NH.u^zmʂ[++8DS%% ,@᳴6O^DZ`=x{u$usms*b>ȠJ%	DW5+&Ë&Y`%/`r̄eo,yKf`Խ]k7c4;f=/^>r>ۗbq뫯2 /`p/^7
?{miv|Ȟ?{O/g(?,T%4YDxmƏA6  G_J(H%eѲaf 5Ϲ$g
ԌM/6&zbyS0n=H f6=ZŜl z~-@fXkĜ7G1oЋqTւq||D^0h W34P:5<_;`l2|? *%؍	(N;1;#Nɉ?ZHMЭ[Lp?#g:ãCLZK1h2 aq;47[E|PƨWtW2z/ˢR&F_|..l5<[Nfgz3ӳiNi>ǫzŪoWq8OgDs,g_XߔSãp4DYf@h=Ʋ,"Mؓo9`Jl{};);5/!"qB1']hDycV>>(Hpd@޼l:OϞfQ6ړxo<oBD<)-a/xa)S1,KHS1bKYɂNTIul\ȹT,qՙbVn5<0Xlr
tb#tU*!Max\GigWběސ;F;:a"kA~S\r/
Yj4Sf]_YU7ѭ|]x~
(TO~U#x~oe	EE-)SPQT Bțn Y0xW/ri-dsj)($<0/:F΃׿9f1?1>If1[x@揬Z,֚@Y[PʖGyfqzWLb.w @8b` P]S`x*PE[0oެjQZji<Mg@p72FxTҵ[xDKߩ%O (d= UL,Dq n䝨-GO^mj׮)=[=Q5v7k٤8Z/Kf>S@`2b`*<go4*-0,/KMsX.b~PSxy˅Q1xg- `oN{|J尿x>$J
1*RRRPR2Rh
?o;V0T.|S|MOyPV"C8F+:B^NK-6ra551.*iZүUZa$1
M!f8A\IL0I$R4b05EA+~9BS!J~ެҺH-8qb ǩLu(dnz*:Φ9aj*/T	;gMT GYwbU*:m@A(DM!V-Vt`Ц}6BgPU/#QO)8 IG@:q583HMK:]~]563oM{Zc,-ɬ^ 7CTKKYA=صs8;,п	xX2?()[]Eo%g8w7};䐯>C1ʩk]]N$E:`Ɨq`ەhs~U1|id8N!3;-}U2(CŊ$l#`WW	&(7k{0z	Ξj_1|Is%ξkUr!ڿl:Yzת_jA~~ǭҮVt|ǁRȸ̱/1aO^؀`hێjv[!s#K5Kn}I6FarZ+߂`G˄|{4mwhѮR=NkZ[	D#e+N$.Ӄ`I߽_Mn2\[eX^.rb03+fQRTz"]|r걻:\'p
ʢ#,!,Up*&!i`|/'(L'9J?Q<+qOG-ۂ8V8aSx3^0ܛcϘܞyՓ 9`ڄ'	
ZŠ%3N|q[BVaڮbbu5MتȠ/Pۨ$I p82'+-d+=@vnN|Os
g-c$s?cgWRx561p|PEդr;1ci5fz9&Gl;CWpc<"	2U{x$MN Cy]bE\e?~U8MXf2
6m$ٴҎpe9Fg`Xad0u6Ӂs0=2KpCtԄr@BHYiwJQSܨ#lɧW7_0Fiw˓|^(%6',a)>"hx˄q
6<)3NCAJ$}L˺S +cR[//9ۨUjQOџ
FJGBv^فYX+vv}VmbA990<̮ǩ2sknVDQ1G%RKF.m]P)V(
"p=Bix4i	0Cv̍O:ʡvS)2Wܮ,pK\L)}ō.jxxX_rp@Zm^ֆ0xԚgm:qJˀg-V0R&pRGeH j0k'˰djj{OhB[;7 FCw
ZkFhU
*Y47{~NNGLsļ:x()qC_F	-%}- CMp϶~`A<90VW#iA:ԯ"#0B3~ڙujxF'u\^UqƝrsŌB&p 5UƖ3rFa&Pv-AQf-SD\r	zwW(B!A=
!yĠ8}E>gsL,@}fr{qi
gapC7C
P(yGE'EA"]=c<t$,a'!0!4ZISaAzlaD:"gSο49{~HFWj[yA+\]L+wvLf"{f+FR&YHi]D7Bv×<DIkTsRbZ)Ŝw:αBӲ{z_؜[Sį z<|&qQ#"b<G
cBxMNn,(yl9,GL	M_6R15OіFl	+(Xq(pfT<RH¾Bt9)pDlpdn>a`QҘwU}l^0i8A)t*_NJz=urI5oFȅ"@%ILg*ﾚeu||Os("84	ν6[І#
eF*{z:G{C'RަT>??\:}oWϪ ŨVС3:tyF.tH4T>\z0>:ݧRׂk#qqGC}A
-&]&9XI-䗦Ґ_\ő_{⵬EV"Ud)|i^%u|]"_%u|]"_7#_׫YCV!k'rt L97¤	Kuo[;L5on)4K	
n
Mi[I8eYi9Ko%Y:7'V(^qdڶŸ:o!I4tNSr,eB!he:4	>W-9tE#mcc|픧4ӣJk41爻<=}vd׸LBh/ya,=j9Y-}_+Lr~]K(SZT!c~83'fF-%ǓIs{憔h4*`Y{֩%HK
YbbܴȐ,1rXI@|ظ_sňO\L培͖Oy|S@m˾!X]>)na򊖛3O.^ɠN8JL^NF>V`zgM{G?eEk,	A\Ү5
~XSΣ70R`*LNws
䲐r#ƕ=IV'NYWY!jsk1nns϶V }5<)ʀmK_sP&گk6սg|ʘT*\%L7SkOⲐrMtܳ>e,!/*Ekdk݄=4eX#g|_~V`}Ua݄%rBʵآg|ϩ#5a*9}Y~-V)q3>e_`X`k0O)*e1z:r3jyGeQ	J^KeW[ކ?F5\c9D{W~Ipշ1dʫmo=KCڍXDYg|N;.\V;׭okY\$<|, W]rM<VA[6y!Z:;./pBBܥrߖx|{equc{(gn4^RKo CW.P5\bǂlX!t>3ݘ&bg>d6]6Iyͽ#ve]&^u5yco#y
ȒpzrQ[Ksְ@'y[ib/7epYNjZô7jL"/r`4r3e-6K'zE8[YT0yon6-_p}B7 Bu:As-I
den@uF<o"zZjem76ŌM{xb<}Y	V	R
];\eqE\GZqT {YG@oyW@ԬyʦOP{9:*Ys(`)9hY[.8`3g~],y11fUz>ENE7oڽ50+ToF&+\J|l~~x0M|N\*<@qЛ`#q-N\W|eZ~<}˯M#I^*d\T)x[@5rgbq|@9[,,QWs_8Q@-1	"Pw{՚@yEeȰ<D5FͻBE`':I*ITr)̪P;sܡ+K'D*4 E\*Lqk!|j숎9W'{S}'2@mSo~2m}s)ӧGv
A(8ł!~*lTu[{=xQW˨ht#0}\Ϡ,3d{112Ђzn`99ljbG>|N4Psa
-[l6M(mꘔC #YJŻili+-,~{tPړBv?dA/.UށgVۗV8жDy)SsMȀޒQUM1G6MqٹROzvdOJUR??+-1<RsIp0?tDqk&9})<ci.*cBɧyr< TQl>@Lsё79*%~V&_U\(w~{b's$O勒vvGAü\ӱűla$&!ua-BCqTin~ͺ="0@
Uyxp#1!^<<ǃlZSi8GpIʡyM=`~;;4g&pa8:<zT6уbtM+tKPjOê"G9Gk>YD`'/˚g7b j]:wix5*A1Prt$8OX(yU;ֽKU>{?Z.<0nRG[Zlj)9LaZda-^2PrA8PΒ{[@2hNWhޘd5WWmzpx՗uKlXX:Aav-:av-fnwa4 /=dS@
/	棼2[T%Uh<&h-*@H!9[5Hoh~UŤp.VT)ZUޢk25ey*E:J`>` a]_UHbW;Opƾ1,#7G36۔ݟݙSSTB|[Am |Wޖ/wRDSu9?@	[<)sZԏ"rg##2j7e7*s=ou-?r?`E]c
N[eEه|:kkR[ɅSG%iA 9H{L67z0¾`-:Эtܩ]ku!כ2*j܆ҙR$Ӭ٪-ycNx otw1I f,a9~<iRCْMb\-A}B%.CҞ`7sΔ}L:BUMD"jSڔg0MնͿjD2OnP2YSzF{յeZ*,Bx@*V]s|ٓί*.RW8^^Y)ujǂj۲7:EѶU#Ya|}PZi!q@;^8V=OyM _둯,d7EnJ7gX|S+ˠԜol^O[	Vq?y|
= -&kfsD`2	E|ػ,.>32VUgAڰp=6!B\*D)%d^e4/=Ukm]]~]2~^w~?Cv~.}3f.jHp\7 gQc;!{KڦcP&`JpU̷/a#ߋ"?8z g~&"?USN vDh?P>\|3ưdu:ƫ6ZUICk|$95>Vk.ݻ}6̒&`g)wB2Gx?Z;UOPU&Z>Sub~xxc8Gjq6˅n`:U'	]e'A*FZi#]>NяְmA󵖡r5\ϤʰZT2r!U#$È>[v-OUQu\8}ب^qrXp<ah3	!\
u`SWkG=BHlR;=`WymRԛ <HN+.WvK[|p?L>v?"&MP@k8]HBbǨ.(|'7WHyL.g1Bbby,Uى:`?:m7|T@pTo2=]kOܝ巊doC=4I1I o+%6	^6A_*%E1(Roy|eW-7A~ɮ{+HRfgqblxw]Cl?'!.ru3<z5^SY
M_UrJ.ǰ1|fK/žK1<P*Ui:zrxtIu)Rˌ9_hM_,l\5Rx9CmYhyYȂUfGasPQ
#VAYDK9򮣒1Zz>̏Y0Қ4+ .%a=4>9r'xiy[)ҳkZ3E#klf^FΦLCQm*D2
RP0*XR[ShtUk,eE5eѬLY4PTE0s5UNfX	\E[)nSdYcm77B)>ch^W3ݢjUXlo#Pm0b-R6à(DmYXk2ǉ4AZr^b.<i-jN%,W1뽴2E]n}M9gZ |
A#]"^zLvVx޹Qȵuj]l[ֻwݰZzۥ(\eZ7i1ѲeiTᬁLR. (->:P<(|F%NFWl'G\TRNX1n[a2e0GnָZ	n|yQtύjdcWyWvcD,AV8>me=ؠ$@0_뛂qnQ6QAU*g T}TZp%ʃūX9x;@ Yj1A_37L8~#w0@TmY:	qs8}f$نFd^^R|:%ZXOKY|hj(׀p4*<~ N0cì)S?D+Y"8y@1L/lhUZQE?l@U/`\\uri񐕈ހ3^#܎ĬZOΣ=wl#|>Tw\]1:H07Kj:IV\j$j_1LԸwd*i8-~K)SPqxR[xIHlĵ5vP,6AQ6%'uMW	V𜎽jWYi֚{V~ҝI󰗾[A\XsV+
^bCgU>3 !Z)uDb/R̉g9ps)Mᚗōi+`~dP/mFsv	6)|iPi%l끹L |$Ғ2`O:@ +EfS<'Tl;)5v$(0_>̩yK6h$.ëw§ãɟ7̶%C32JLܴM;p%S	e"$ƵN<ީTm6eS'.s+T&)U_RcGlQzG!2<=I'ghe)gSorr]zO9a`B&o1N*if%ṰxYy!&Hϭec:$|*Lu0C<$?Y,KS[mXDYx1@oJ3,A\Z>F_U-*׋`Xao֏AuTB@3.o(,ZZ/?SUR?ˏU'GjXI\e%^0n%0!ϼe {yэ.x5Kw]]ԏ6\?d`EKtY+vagpE{6AwkSri>/77;U8
nH"F*b[g筧E{҈mUz0=f{ӊ-VQ!iQA'z#廴BW+=TF?O'rO=^otB"ӿ!jso'e#y>!wwkBfQ-6XN4}j^FG`8KLwŖPVLDr-4z֊dGQ۔x
j^>!N4vAhQ#3lNWȻ 
?
&zQCiRV&-ڱթeN@E!)HZ=]V׈fxdw{?MTZ7KsdLYFw:t`vE#>}q(MIʭ9Im}'%nb3ngI CL&\g8cQ6&\
Bg[LSr!.˯LJcQZXq#J\|-sᅂo\@L}x**?ɾ,#wflP놸B-^/Ѿu`qh+_Șck+ L2ۜCK6|b9˲,iiAR~ϓfYiմk%Ăvlߐ[Sӆ>"b٭\eCY~TLAOKߥ@
q9'%.alDZ8=B4:"h\*@(|A=fGb#F{r@Jh%*tPV|i?"VTxS(g4KFSoaMc}CmY|bIl>&kjb"bn Z9)KtZ
脅-zLoN0Vnh@z7@0#H*r=MkObCSƿ~XӁ1JA)^w>q8dY*n"vןCS)?<M76KR'A9>ZfdQpf'E7ٖ:L6wC2\a}΍ZǼ^hRG+c0yc}4R*Zb`_PJ%	c2x־9KW]Q
^V_3,P.yc|
M 5J~ceHTE=ހk	ߏ q.\ۻL#?.# o HˑB\YhqWj5)}F\9Sz5+߆WC?WC`	"yڸEM`S+_MNWm2[xK)KoP'+>G'>b|R-G W咢ã~8%]}<|Ps2ymINuqf.[hj{~s٪.,Q8z
kHl1g_30.e]ezg+`iFKn\R|YTƶR,΍o	y$;*!F	^b҂3~:DkU_Mw<rn]׭ϊUܞj<x`f2V}ގ^,J_F1퟾G8wK-\^U	ės1kMwݨ+]yEutFocl.Q#)ys\
ILdߖ9]U!Q.0QEseZ@<H<0fxzjZ%'V}sB]'q|l~нLzbhf[b( K)}kn@vdhdb"6YA FV䃪yoG؞</K?M gH7^TJSyikh9 R
i3zkBwK"g(8Y2L`Wَ8UD^$O9g
﫚|>7tϳӛO;_Dz0Ax^ s>80~tF<MF
W|hVrRP?dgAãj'Ar:;m  yEͩq"N74'RԶx~x35ƕ[H|tT4/Hr;+}(zޞIA09Nog)Q0WIa7&\ϫ'0b=R7Û\^~5M%%(~$> D!4Eڭ` 'U%2m<y_rC[{	g^y4+R]*jB@'Hv&D!\ R8bBKnThdC%xE˜v~&se+gUF:
3Ů>Xg0ssURʝ\3@/35+ʺ><	{JFB0;_ٻ
-5\5hRE5Hb"kM@&J-n0_T[ov6,=A-SI`] 5٠FV;y
!1Q>?ghr+ώ¬>^F]׵y{ u:ʷb=ԝzqzJ،=SO&8$;o{8yz1k[5l琍X+%;Ǖ B9&lgro#=AC.Ėٸ-.kǇ	Ǫ|h+dқAnwsRY<<l-ҪnVWEкwI/>z</^N"
,eNo+.k~s\Zt9cX,,~2&-sKwUV|]k[,h_e[Oޱ=>omzDZ+s5/{npc^l`e^ڗ#Ǜ/*䏸Xےː$M{(.Styj]o)TR/ƣ
iͅ?E'_>y(bg啩A1y+xO1x,E1;8YqiCzW?!d~ϻAV테RgGvC0X(7#U̥$t4ƥa6x\!	'IbNpȓjɹ89Qf/ϛO+9EbEv'$2{cWA츅gbF~PMX9Gq_?_N~ꎲu^C"NuҭBqum%_V)<vBL(~6͖6Oxɐ~uUL^xmD:C__Xr<)KwHjF}rM# tm~eD'p4)`'<L-#H}p'$p;5تKH:7V<Nbme'UrPV4)!l!r[ۊ"!d:K t&z
힦$pN@oxhv{Ǭƻ	'x(U@\+\zX٘{تHܾJj֊T*O|z1(O7[*Q{%V@1]ZLL5r/,9.F`eW֟MZeR0=>4n5:zbu?ÜF٩w܎벺Ӭ7;ZJTPyΊy/ڑ~NOXnh9Ѻx}oot< Aqu0Gٜ'-a0;7÷0+zQxh́zva}Cgn[>cʚԱ`;m۾wbx/q%}]ؑ3
#Xp2	#K(V+f ~YADVUhax驷Ū*oF  V6'ڢ6%|ƦMzyNq4(M7:5)If`{j
_'TJPMă)}m g⁌T v))ţ֏+Z	kGmB6{s/f xptJAw21yw6|鍔"/Nnw!_^#|[jT[ښy|9T\5#F|8Gۊ,G7R al܁e?O9Fuxķ1lhp3>o~uٴ(~O-7N|;8NevۚM%p-eټllQ,4q	Y-۩:+̉@l姽ChF:GW:|q|(VŨH}%ayqul-s;3<=liE|_8KP'n~;_MhE2fSgwwne]MLPSś[_J#gp(XZI3A{[÷ˋ"0T(a nIn7m\1fBd'!Ï{t!y.ݽTKI^=jed#^q{BfͽO/46,^l?{' &Mqo鋝??I_>//_<6O V3:<iO~oSb^#%RLͯ^|]̓^ru_Ozr/D8rIzw^ vY_izO+f%N&USu2{O;jM{O[z[l`k:>KWk|FSF ^3~5?++ ,0gY2Ft3v
/P0	vevr*Dz(&(pN]osS]s_߬oY(oaF3ӺͳH,s<<>s[6XG6+\pξ~w{FxIG_ǧ;(_P&c2R喗%5/$̫Ht7*LpÝ/ϯ]x-,Hzp	SGu;h>eNLt/._|B#[tH'աRY4)kYkxeī1Y'-x}Yvo0!֤^:DrN^xkMm9J 9hO,ı؁_s;yNXz.BK6Hmnȡ4J-1.lUF=ne,`2zhW~/O	duNٮrvkڡnM}j&>ڳPGQ
XS\s;{\/~E(D.=!b"VF7Smk[Nq1~>Y(Z=5zVY+}˝wx4œ[co0hשm׹w,Aqxtn>2+ j )g]NqX)cz$j_eWH;	,]ژ4!)kj>ҏ.3Jfr9r;yٓ;za?^{`GMN?0i\='|wv xRH:s4,'~[09}4<mtȎA}* 
"SV{cp>ATa͒0R>It`g?FГB6pxH3|}썃0zb8,`=}Lh'` -?QmϏ;#ȕvnWCC?2u=(Lp\HU2_PwCs/~pr`ē(M.̢ѦEV0%ⳓǣ_4v+~j(j\y!W~oآmz}S 1G'Ѩpo uI{k@5zXdYMk% <qKQnʬve]g~#fJ︨ٛmZ.Av` oAp;hAtXbn7ݙБNVD)-?h]~^pup{cG\ЙTB
@&u 0ScQ p7R:.3Y"%78.&0#{	_Ksr9;[Mrc-pzC~paLZ\fT9}M{EXÂ\0]Ƣ F$)?yX색?3osRFyM~	঑1:m9"jǱY"@{HmL<[28S}'!{̂I8b	tetcL0n¯E|WW(~dG0qn'wA8=³H$7{*zE0)Q0#E1'X`	etvJ\pylQ^z4aGBX'Qi0Yrr<̐kr*}T]<B>*Y1t8;܏p(Ѡ3ClLN׫>0kjS3(!m7#ˡz97p_Ӫnm30{v(*XFj׀,jju!6v,II v N^m:fЭVt3Vvju6:Nz8NnC:FԒj8hNǞufjv;ZN
fl:r{#MHt-,O%;dnpH9FP-]zu{'/붪n	:jV[OP=غt Nڨ'[@vjW۹n՛ulH$;]=ٌ76@tBq6LWuP)'n[muq6EفֱLv.v>c=`6u\n:`B"ilի=@9О&.P٫7:vVA`PqGMq[jsZY;Qj խ6t5;D8߫c?uh?ۀ!]KD̡6~FS CYǡل`r 4:UCfhh!  Dt/iYVmB"з n%X#K9-NՆkP Bu@;@ oǱ0t8l(n1asۈ6,
@N]NjSۀ8^H Ց-uh!m$pgC}v w	nfV]`*.nàj*S3i].vi 4`'J0:nl҂j`hja@L@	R;8Z;6DMF,XАfNA@6i4q4@^g
5	TH @Nsh(MT^Ch5	=u. 2D> Ah5]BtdLAFj# .Ie`:(TV=30mmTJ-Lvnu1ݨB=L N-M
)I"tFWbNVuIÁQہdU9/IM2:7Q#<\q4IXM.m6& nv굠"՛g@s[WhM0*jB"th[1耂­.SowzS] :$)&uSv&H.[oVۍzJath=P. v du1,n
ZT#!evP$H'/iC\0V(R{@VhHJ.PS.Xn ͡pvFCMiwTic "#b ; AE4{H&vH2HdT`uh4E-;EXIE>nv{Zf4umq	{m
ï {tQF}
vt!ٶqߵ%`1tMCۮD{
Rۈ58X;@z>wHR йЄT`s4%;@5`.P4f#G.)
`fF4eˡUy`( k cCWovY`;=-vM+H@q\~hxऎ4rPCئӆaL$!j@51>
,	U$-;
t)0=V!G>d7Z.tD@h58 8rCnnR`dg% A#ÂhC1n58)+PxUE)	"fE|?hyLKG4uh7pAFL/Zhw0hc= w`v\@)X8tsmH6(Yh+yV6buu'nt/,0:v'P IR-ڈdhHJX `s@4gJ0娓ѼiƁFyմM,u>vG˪,(PFL6<<iF'HWWh\Atdh31V-MZ9UC@Q0z@ptdHIV)H 0@0M1	G}X	Ua1Wd$jQ|6{h+B\KчJSUۢHdOMUD> X_&H(Gtq>bAΨExjfD0z[42SL3N`\t]߻]Egs걥	?:HHI@vD&)`Zl4釓;@3SrRE+CRahzf`? ͆&@'[TSS%ø`g "I2L3ۚ!WtCxk
3v" #q8vhnmfV3t4d-7n*IV
$9";z6 '˷@?0n}Rs/';!ď]`d}.uB	ҫoR8'#-coNn
w)P9'p|bE~<Aexmx˼$'EޛqM"''Y@4)HCd,0Ͻ$
޳3o4ctnAӒb5N$#[8!
N|\(|qIe/m-%~iOpC6"Q)mxQ:z nu6gWL`u&m؋QEv%A\bZ٢%%LH:a,//ld;("~ ;N/`t(m7Mѯ䗃:27iВja6rQ%{~:1UR[TZ%}o_W'+%	αT
pکf	4Πx\vwٌxF`q)RUQ5JSlaH&iXby˩n<?+Ps?@}QV|Ue^\j5y,0aXK<J&m#yJgJ(I	|	)6j15|iNg
wX9<OtvGUkci/:M0&;G}kSpV~}}{TKUgV%6-)\dP8SP%YRXY[CHZ47iߢ}Z_@JX>;hODur99vei1v}O$D,!Un 졦 ֮66oom\Ib?HDH?<U{ rCúze/s
svhr8 ~ЊNwPT[usd cv]V
KL΃kƠ0&z.!As\ۀnv+n5ΜmKd&t.)=&5ſ(t95QC?]6an2#u9^x<3TY͉ΞxRnn6{f0ibJyH,?Kt>ӱCYL\5>cK7]&:tCL0Ǫc~7ڴ_NN]<FŧkkCG3;rUUe߇b7gt0Ԏ%߱t0zjR({2
0?8E%+v0E[[)'fEXڞ
s~a?cڼ5?
sk!Tq7q[3hqj4H$)G\2+\s[ڕvb,aL,8xLC?8r9֊͍/I/Q!P+j?{ .9_3#;? eAx2_#y`McsI'h}bo00b& C<}++}7YC%d=8Z,]YaN}c	[+0M6M&XkC6aZLD G<'Q0יKN||?go۷_^YW_L3L)8GJ_57ỹq8H! *+Q9u9eeUf*>v 鯻Z*UȟUeL=k
CULsLQy9esO3!pУ.T./QV*pJ(dCO:^d_4,ߙ#2/~MGNqʩ)8t_dtqxpZZg$WjY 䭡[N҄K魼|od)𬱂 )<uXEM9ƋC|8#<kXϬ,vy=K a**S-Y(Hz9'9C҂+NZw^^f(_X"QdDjg9FK z˘~HkJ~  i.>jֿ*O(~Orz&oPƠYLk2ƠAj4"|{G|-XY@vΘYMFHf HhWXRِ(K)*H,1q(~14uD.I fo1):=C+QUXҢ~	Ab,D; v\0I0qTP+BӺB*5DPXE)w}4šx0:K{$t`!{TF8YE=dLEŒ$43lտv8ұ?uy8*b8XYa,Pj!d!!}BHad<*9|"^	}cҡd~?8[s
p`+f`J/m;+MIɡE͌.K}4>s
͔+X(l>[bF~2&Rl,(f>NTnɛSfL`NRrRG(`cV
W̢E49j1a zy0`0鋯c_ٹL9`>CW$LX< :GBC;gӟ2R"}1?9
[0o4AA^m2L:7VQCk#ߐHNXѹ#Qhcos/&J*d^k9BDA8i2%A`v	H%#_dK*$K!.閥[Ɉ{]b֭l0FުCt4y`cbgE!|@*/SM/WPD|KT
ich(*xjg/F:vB3o9`q8YH+92z8-g8cWV>n$-o]q>wK͈x3Tv h_1f/h
+7yg`-MIcJJ;@S&|XJS°R0"8hpbnrj<4(<,@WӅ%
*'!5=`W^`
{ʪẖ=ś$SsxD8X?]	dqSfCJIG 3V7Ebt/g_DR~YVЅ885<L|oRphslΒh,YK>U#R;i.F?%/Z.r79/q~SD:iyq(3F_nfi\` =&AY0(qfF
n_ ğDlϏV*3>J,MUi	3XǠI7-.j
 Z|#5ڭz#_U{H^}]yFhYހ8/K\q숥{,WBv5DAELLDC)5C'ztHs6C,BH@AkGHCjYYpyEؽp-X|ң+yPU+58R5	6TE@>>n8A-ce|Kj!<gSy-칲']
ېDدƚ79[Ts*>aq~M;7g/>SæK壈rf}!J".}c 3?WbX|J1;L?;޶qӯY;)\kIsER%;ڒ+KIӏCDv7Mo73pH3ě'tk׊mkfs tsL\Ԃh<F{G{̅DvSS8J UjjYf:$L%?3*n}5W'<{2d*_Kb_^M^aB?E*A\3](f@[	f<ǋnQwVGq&9sw7vD ̵Y˄5@EA*wfNl"ɟ0l=ʰUt̵:7ĀP<&aQ{E|C T,USHfoӢJ+%-"Ӻ^V&ϲd[e5I5Gd0U|L|A󰝟tA+*H>\-/G|{?! ;0l^_Wv7{k!1m(DU$v^a~`	q
3!ʒ':vlv	FUQᩏ^^X1MC.	̧y|tTRKTz)Zb&R%F%yȨ輮cu.$bVՉ>mCժh*1Oи
9A`r绤_\mQ*aax0n䎫$`8xˉ]B$zr_;Tm?h/C`<K\3L)XPm&</E{wL5!d+a:,UZ4s0@1vP8R%-TQ~/փ]9hxxs\䭦ƣ5E)R0Xܦ:Ldm 3I#(vs4e5/xBBHQY+ud%ājp4Nc@	)փU2E*区S+IA֥%N$919tBLѰy ys}RT['B!&F5
[O1"2"yia#aiGoEM lHb#T
a| v,v2iG͒ⵦ	k};z<mF}e) fN4`}hv<֙4R:l`NfP0!3#2OIu&|6>o^s ;{HjV{گ?dj]ZT(FI4|،nǢǠL*Q]Nzyжgg'mhS#Z*|kpu_{ECBf~s$w\oÒa(|9sfwΊ#A$Al۹Q+ۍ/.J6qsP߅ѧ\"{+?V?iG'm^/Z#zC~$ cLȶc>.yL[eZ&Mdൗ HKv'Eu&bT	urT]|@2nHYM{L䕯4_Z>qwfJ(-PP$$ܶq+1{]pt,f,ȑ%lbm&A)!
Q/fӌ+^+i=rŤțP>-t-:.﷪/\KOo۽~9@uЫ"dяl:k:0 Ts;Fr?,x)FhYWL3HFt7%|C5Gc+`|?{;`㣑> A4פ,Z3$kF
f ;$?'qLݍ(,aoz%Z#Xd4ei{_BZg>xx&H܆JeD}($q9v0MCHF q2JE}8ƬEq	V0j{αG7\>Cc,z~0a4uEz|93|m|#\zS[9O#48qti vڭ$+HяoDOFB,G1bf޴kӓJ*,ԛs)<ZpQ;nB`ϔQ pνbFOQ73|`j8ӂxW@`̤Ar-e"h,=ڹ1}dfY~~X\)(P++d;eĒISm1ʤJTN(gT!
T$\@1?$O7H~9:xe"/H\M~D!`/nx8:q!䶇[N߄xp";|w׼uL12\Wj? 7o,{C+[_:e:h^Q~B N1@:..N8&8wk ;-Jf$]U+ztMis L+xEa> ZP%a2&:$]XI0	oP  NEbnk:I*OԹ-$$m(8Fώ/ފSD/JM>dt)`+`gZ//H:sLpLj/XЉ\F_TPATPATPATPATP-g}Hy  