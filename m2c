#!/bin/bash

declare -r m2c_version="0.6.0"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    local text="$1"
    local chars=$((${#text}))
    local cols=$(tput cols)

    if [[ $chars -gt $cols ]]
    then
        text="$(echo "$text" | fold -s -w"$cols")"
    fi

    echo -en "\033[0;32m$text\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_dots() {
    local text="$1"
    local chars=$((${#text} + 3))
    local cols=$(tput cols)
    local last

    cols=$(( cols > 80 ? 80 : cols ))

    if [[ $chars -gt $cols ]]
    then
        text="$(echo "$text" | fold -s -w"$cols")"
        last="${text##*$'\n'}"
        chars=$((${#last} + 3))
    fi

    m2c_msg "$text$(printf %$((cols - chars))s | tr " " ".")  "
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]
        then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$1 \
          only_y=$2 \
          opts \
          res \
          text \
          lines

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        text="$(m2c_msg "$message $(m2c_info_bold "$opts")") "
        lines=$(echo "$text" | wc -l)
        read -n 1 -srp "$text" res
        echo
        m2c_erase_prev_lines ${lines}
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_dots "OS compatibility check"
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_dots "Docker installation check"
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_dots "Docker-compose installation check"
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_dots "Ports 80, 443, 33060 and 53 availability check"
    m2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$m2c_log"
    fi

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    m2c_dots "Password required to trust the CA certificate and create symlinks"
    m2c_loading
    m2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    m2c_erase_prev_lines 1
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_dots "Locating archive"
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_dots "Extracting data"
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$m2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c

        if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    m2c_result ${test}

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_dots "Generating private key for CA certificate"
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_dots "Signing CA certificate"
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_dots "Trusting root CA certificate"
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$m2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$m2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi

    case ${m2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                m2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                m2c_dots "Creating the resolver file"
                m2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                m2c_result $?
            fi

            if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$m2c_global_dir"/mutagen/
                chmod 0755 "$m2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log
touch "$m2c_log"

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c

    m2c_global_load_env

    m2c_sign "m2c.test"

    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"

    m2c_msg "Mage2click toolset is successfully installed!\n"
    m2c_msg "Run \`m2c --help\` command for usage information.\n"
    m2c_msg "Visit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log

    m2c_load_env

    case "$1" in
        global)
            shift
            m2c_log="$m2c_global_dir"/log
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    ! m2c_in_array "--help" $@ && m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    ! m2c_in_array "--help" $@ && m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    ! m2c_in_array "--help" $@ && m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 @] r#G(8˯.BU&Q$$NW$5(	$2YTc>cv^`vkKHYR7$Ȍ{}5~S\_]e?)k-7WmlV+V.J$b nb>vz::rs^n!?{#i^o.?C$ 5#D?z= S:|[^񇯏t 
J?Dcmee-Zּ?w>kc{i$Y&>H|&C/#Fye}eq"/>(YSfzq	=eWјi.0eX᧽F'HE1+~	;svi MX~8<H($
g' >~$}h¨ƛ\[h~>/_Ve?UyV+Xp= ]sBr=x!g^&סѹp4݄><JR~BUyvP?pDekKc4F_]]8"So<Hw4ڏ&ogRyr]`L]\P΃l|ެGzo}\'v++˘H<;n47oݯ=?NӠ{+3yA&:^VDwU.(.:
+{s1qg8"}'^r`_  :]7-4e{r\^~r5<5>WV;	,K\,9ƃ>8WP!Q e`ah0Hλ#v*vUV-߫v%iK|/%SuFW
]5_^{Ŝ/M VJURT%x\6UӦjTMiC5~IѻL]&Ȗ	er\*i!?']@tQh m>P$8_NeqitٯV=enb),j9f/*@F
{a:ee~0aA[%:/x0`8ݸ-HZ>ȺhD^P|9(BTx,gq͏?>Uzb6®7|
"! /x͉kv#_^[}ʾoC**ayg݂QgCƈQl{o;ݭ;G/w^u֚M=ÝGGF=bj`wG?ktN}/Bw_n	6V\9~rV1cf>lh<Vg
O+6c<_e(gGeaz~G윌ҿx@|,a.L(ziC {V姗Qo;AorRuSiH8[ԳMoAYl$aqEAr2JUCӥYfWuo|ue~s\>biIݱ㐉&"ڛ$bSAػp>UƬArgykⷸCһlO6w)y[BNmCjP- p@O69<S4ݑښF>ч۪A9gf8]8JQMqL.(v?%s֏͍`Ikzg ΠWlVKz$zQ4츽At5,}K4`>s  1۴*w]b֓ar{͗;7]s<D}ͩ1-FrP৿a^%~cT̆r RЍUd6D4͹v#Dގ9y|{ג8``%JC7JViB,@%te,t"b8=N+F֥%gUeUdMV*JH yS_j%ﺩ>eWd<.l8 6pt%LzGHsfp.^6ܰ`*oUY%'~12yrs;C֗_fW?KY?7e_zqmW؅*9ARPaY暠*yjǲJvtQP;KE:*wӄjert$ sS)	޷]$UzKTEmQNv75OgӴ%v]f]&Kқ {i~/ZA.5GZn U2)Q|_#j֝ZM^G}0hSP3\`QP,ߣ`F~؇+

<??b81PEFx  )@G^	cν蟨QK }}RVrF8r#?U@,-cP5W<iB\`V$P(X5/Ĕ"n_-j'UYqY$i;JG_t֑!ky?;6,*y?>90T#;?l
c<npG=wB7F>,4&J0|S9q=}ovjd`JQٿsb
;jՆЯW#_-ui_&jFi*C:q\G%՛ڐxdt6
Vi,_l^pÿnx_=|4il|j{Y~vY{ZX02:tvyQױM
c5OwGdKP(y=qBP#s	3F^?i$~ohSA*laմh,:TL2lp޵I5@;A)d[|qly!Zx L}24<N To0"'Jqe/C*uNQ Ă(78rH7YMJBV΀CRǽjسO/?=ٯ"d;'o*6aMcožJ+m&1M.'>r`Y54޻?!3`6HM0oq("7Ae8p<0K/eb)ժ2ZVTݬa
y9opOlW @рyw}A5©*FTzmCc$'6,eh|
g8J!|Attu!ab$j7"9j7;;Q5o	Tzpu}xmIM@sl@z4BDk'iU2Raa_!K:NE`WY,>B[\^
ZQصOc{N*>|Sfvo 2]|btlM*f0*2]I\\$F@On&K+ uݩ(~YZlNѸX:0[8dleItTqݮk,cNc}"q
;P`sf$cKKb%ݹ_E3VtW֔dqe,sO-S~UNUgn]4{m(zUwTߜKb=*Z/*R,b(*-iWQ=`bì1Q=5JBի`sBm
#q$e`4JRaշ>Ѱ M(X=d1411UMd) SO8!M*yVp 3{O=SdkCs@}Ty
s%q~! 拭ۂ[筬,-lc,[/g)V=4uhdhFX;Y1*v7u5q$yD] y.lWՂpR͍]/⪍ בȌ/գMAoxtOk@ܪP3.e²D=M'>|n0
8Ň(%\Cּa5K~FK8jnD]4m𿕪uRm:JEgxYݺqzM~45qiUo/8UPgΕhxVy͡/61݁}1էa:ܽoTݒ3i
;2' mH]z:-y<[k5h]!rPѿ4yi89aw^hSUK9S~7H(;a]
Q@
4B.`ѩtUVXmznlhƣ>zRy^PF4j(:"x&;
`oMcDe {]J
@ΡB&cm,$/	N̤$5=4dYc mgںEn^)]S]SYBKb+LenJ;U{湀,ڻ=}]y] Pp``m1N9[,<K.4xjF/oY)I^Sk0}:)-Q>h)-j&b~ko 0E^eLR_x}2MM!~$
stM̿>C_\zC`ɺ--љf")CTKvA$"/{2.<ۀ0֚n{f2E
%AW2EZf8^2UONuǭ5E45I)?շ/s/Ϩ2TV8Ѣ@_g/w 9L6tWy}< QI)]ٴqWwkK8DB(dl%57(]M`ߘF0Pqmw͑*0ݿ)t$"qvr0@1!ױZ%Z8L%Td*<6|rY2Mu*9+d _X0ij3i~KZq$P8:Ҁ>T+/e)ӭ<?O9ceUo141DZ!ςBFw:8rs/4ӼcV8+&}_;nLDni	OGTp**dKARj.*_	k5p3CfH*I#.ZojM<+iK*ҞG~f+*G"}5!!XRP$](wVbѧ!1%BOWX+^-GƤf"5#[ÝSS;1^JɅʥD. {(HFI%lOZcFǋJ@ϠtA=,B"ڜ,T´WNlߴظF &Qxg̖A"*RaQd7I[W| v=pCX:
nFXuInT[r{mM$b	bԏQainGU/=6JU\]H>DZߚqōK<~Y0o-TÃ5q]Vwq+H&8kƄICuNڰSCX	P@Nhs|\II.+9%7Xฯ ǐMˢY<K}~?AInڛ^fh!Ho/R%7XqW@^(Z	J{#?L!zί JEhiZ'<<Y+BP`~[*$WTin=k}+)gKzB}j~~$r	şojl4NYDq{B1*Z8(A+ Ez顴%	0jAS{O\x/-O7RY)ϋUir߭p% \uL6NNv;'Ksť`XCcPi$ C:.D3j6)$
 P\ȓ	#'g#F'f0*5P|[zH ¯z5XqP8R:=[bs6$zBB"MGpd&Lј;Fn(1?3ʇF;hȬęDQ#+RUK.W	+@NY|WwRb:d:xU%f.@쏡1PAW]Ckqd@GEZR&1*E6PbjlrXJR|-6%!@ވ$RIGDшI>q73@MQEQH1<ۉH%GQ2|&JSAЈxR ܫ'Oʱ?~h,alG
EvZPPIzۿhX%y9le{gȢc:pzVc?TVHz5:qB'SuH%C?1hRyhh
#1cj6)fS̷F^]_EeIAֿq!EH?RF1$eIGR.cIzyb(˚*/K[~i/e+نlB POWM	|Sߔ7%M	|Sߔ7%M7M|.[6dـ_|"%}bpzo- g^&/ԷշumM}[Qߖշva*KmU_[V}h
ETVQtgoYo--?OuG^qfUDãgU51o	0$3~ȫX$U	o1.˙VR&4"s8k0Oy{8_ƨ>m=ELN[=(ov&i3Q2lRg-K&};E7xMCj[0ef hMT-牞kj4T>;OY2mZg>W%NjT_ȫw`;z. +Ik3+?L|<c=&v[b7z"f%)zQ]O|qSeR$bJe2\ݑħ2#sbs8W,>4ӳ
I6w%oR2:l:,ɱ\;j.8i)?-di4^?(nn}}bN+Ēܓ;vɖG%[1Bkh2%]kM߷"\kHC}uVDU+--iQ#ޅ$V`luS1`)ǔ۲f$sOnYGTD2o,lEykHRx="౜sda*@2]HH^܊,rzGTDVT4oCYdﻐS9}]VR~$LEccϑNuqt'w:H3
W@Ա 	Ljݣ>F\'w<RWBKp5f\I1'P׎gw"XH0v<pG>UϭgI\$tL '7]t?s<{R8v̻IL:Xaé_x?ϊf.N^jy܊2gPA!T8|nn#L&n˧A0;"z>|Fc4KT]z^k<*t=VY73/:hB$ߧ*Aa$};-*KD 3f;y2fi4.xiYyZCɕ;N7ا'67DDZc`(uS;*i4oZ.NK45^2So0L[fSqT5dOfg>st&T%z5.鸹MF; !(ώo,΀Yw6;RsM*)$g(5qqU ~=ÐY^nj?/^#+Iq,>\q7N[L>W&9*@(^a2m5&-R-04eA9XP͍p۞ީn~w#W&/[91nM6S%b*#t*:`&xhce
 |~~ѥgv~7:o-	X7۹K^B2'RyM~)M5h]w>쐔LEUe>6*ewU~ɼ
hj9k`<)mklgsj;jEU#~s8^Q!Y8!P|VX0}@IK:睡!i7NhX-#5a
:4oкac3:e<ێ.C{߃Ў~7nC=T	h뽃_|&l8yGURrNU߾.BϛTEz_+΅l[_J
g\n+35ҥkm\iN\Dݏh|/!y;'ځ4F"v)ˋ{^Q1=1\fvRd"ol/('wIRe¢
<!m9eMz]<BZ?gA
/JޡSԺ8968nixiP(ZĕE)RCw"7b֊O/ۛGmBoGRw
K$~?lKCWd*w
i'M~O(8giz bR1b-kρe^ iY2lx L~ջҲo>8y@_Ph?*hpW8H}ؼCpkq"?0 6>rȃ=oXoZ7
z@P8ˇK-7$CBҞI> !Y'Ƣ^o <N8 
 32v]sA#!.pH9
%.c	pf}CԢ\	t09(V"BA.F C0YHI3c"o7!]$GjeL9F0	Ff),+ƢB0q|mT,ԱK16
Z-N@'ɠx!K }o`*m]镍P	N๋Awbܹ?>v>,<6!,8\y`_
<ɟ)ϒ
>{&vѳЁfH吻w]eCT){r<Fx0<d2M32+W_(T1/pϵJ^5G>iR#Гwr*rDU=*	Y0,TS֍*}rC~<{'.+M0t&J\iL$JGy)<N!2N$dh.Gh	ŶtD̜2׳ɪ*Z.?P(nDB,(<pTl Mb5?n[y*
b8*,-ŀ=c*"5YBf56hlܭ4єty`+A!II9*wIM(HC _vFjyWIZ^\:>~B=NYZ5QԣeT#^ 6։X׫@lACӐ f}a+∕7h֙erI\CͫIE[Zu; 81hZ v҄CWmH-F2q5?*.5mfm#rhd5iꚀ.cqsXF!I@6֐UmV8ʦ٩1ӽLt;5"L8z8r	8;0kǹ	>ˠC7Yq6'>jP][_@{-OqVcu`>┙)b$Ux03",LAAa- 	b|f}Z^e8/%i$m=u)u.mɎ^lG	Q\*ۿe z=ʉ"ő' >a̖
	,;oWhn@Ux)xњ|U$Yu$~HAxez68C_rBe'/&MV%^|_e2 j_IŻj_kuH1ۭٍ6q 4VmYW:_o=U}^_jo|oAkM$̂g&ju56Y{`F67&՞4
"Tqza_?Zcؒa&PSۭfa_-׭QwU",o+
5AIeM:hSDj}E_%4:,e\v!4ʩmC`.M
#؏Чj[}U홪.=`Uq:R99J9	w1=O]n`펠b$/I+QLb'\N蝬@cRy[to0$WfR@~t|騇/rFjRhP^oȎ1^&*k6}]"XQu
CVũib`4v(KsY^6p|ybJ:M<^AiEHYDZLY\'ť zlTCO&Ҏƣk\ӊk6<J]a*4c&˯'_ذk6_K>]9:"mkiUy.g#q}=w#L^+4]e6r6X?vٵ֞.JSyZtت(JwdԽS%c,0, osu63KO)'%:aOz2=@RR"F,'_Z1&ǢU)"	t02Nl:,1sA?Sto@Ž"YƐ 
:wH
gcOr&3}g۪7$G8&ArDqYW.2I(Բh6;!Q8."%;||\Lbd}$q0i?fBS?TN#TӦڏJo 71k_?'kyf*0g5DP[~>se{)u)~6>9Sq97A1MwŖz.ӄQ<Ia2X`OEb**睅:<m8؛rtE^nE&Kʂ]QHX;w!IjgQ2?%!\Mj	99:ԯVؓ\3gqΤUj`;<i]w!(L=z}-V(i5m7}%ѥ)Jj'A涻*=FOENG=qwo`'p>QtuW1RbbZNsar$geq#_vM>A2LڤЂ)|`ڹ{;;1ZE嘙ș;+ӞJc[ cۭmS#<`Ǵ҃oQvuфwBϴ&iȟNqWzTķ+yOYCUX6ڮ@~Uer/Yoa>w߯q/Kfgi&7q]lnf+"<o*Qh8N\Qhj^eS'`^ڎqf4;r[Y;v<#č)-A`הI!,.	r%]XvR$w:x˖筋;bu9qƍ}pz%jѳūV,#ݧ;d-Ri!n;ŕpCES}Cټ,m}Qs4?1GG[{!r{R(Ze:;s˽-CV.(	V;B9ün6t$I"8,m`F舧Vرd6C5T5[!u[kPh95Yd8!6$Ok>c$YQ<:aOS+C}wWG9N!^KSV}VF"am4dcFE;R56{ܢSbKשx45q|h*[EYͭD0%&;9zBV
)?pwA]Q$pb!YdDBʔyyTcu~hP5aAN:^ҷ$BlU3V	y1q)DUO39x@n	W}y5yFߪFL{W\Ac.sgn2#$Uh:IQujTXREM#t'^\.ا;>Q̿}XJ	^EgYjdD?+ϓ̧%#z>$=;9mj|D&N\|RIE<Ͳqsf^F;U螚xoMSyo&6&l&1m44s{5j|tNkp`L[St~BFSk"pfO[^xf:Qrc(EDt^OM}8KA\#@׼eCu>#[_9!$£H{< Rl[g	ǴkMIα)p78AMVܕ|M.0P?Bud7$6m9UiTT,gh_ۘI~!Gvb晼`GSZw:26o򆎫een֢
{?F~Db9khWmV<<dK&Np y6Z\>k<W
&#OUuͳNdC-j̫h²ʺ=:xٿ!jn	ǊeFCؔnBdDnɸȿkDfѻ!ص;l@ŉN͊s&ibPLUWM㔱l!e{!ULwȓT:ye!HٍTwrv\\*B6Fxދ@`'A(oEr)h wvV~yM@Hea<2&ۀ
%QmrA*BI)xS=Vp݃:yCF,\|Ty7x -鈻#K%(etЩTE
f"P ei/,ڮU"磀C(Nkb~qЬz+:]^)<~sӘ&0LwL%ͩΦ?},#eO)uO-5ڲǣMz-j΂lGm<'bBƫXi
#d0 5M<!pLG8۬475U*, Ʉ&>NǓΉ~CI6A,1fGպSF@r8{i@A10E. hFa:6`V1,p&/gŨ>bEn8aprdM/Dv
`C =%O4AOW_!#\	7#p= Q7=xgu9SV|[54'(уEu .KkwR$ ;i㰠O:aR*Tb8v`W$[XR'i5!Q"i7]n]W{`
V/38|JE.5ߜȞ^dO06rN+sɊkƞjɇV޾aggYX%YG#fEHwcCW~ec'cnudBW."N<K{"}Ocgo'E M+ID,+ C+6ysۛ	L;)f-*˛V`^\IwMk5tèDN?(7|i9nOb q*\qI:0i0y~רg݁	?NyM?;VAG9z0߂6V=$bQ7EM;* &P5N@!W@@%8͢rr;9;orHS*AP9-GV9(>AT#O~7n}^i)/
atW
X;J~q'2xh7]tAIPȃQ"	gf=W woOcxVM\&`rG9XktVm
ۦE>rsO#;10Nɵ?_'_G׶lWK|]`Zy\J+ZĚZ_kyngWf5cJQQɅ^UyKrfhVMY2"lj"&^X}f21=mb~U`0<(;</:wՊ^JMQx#0j~{?znR\5XGCN/vyްbPCwB-|<:"ePmʒA`nzYW8\GG^ND7K:gWw\j56b:XY]mџFj@Wy7~?no9*X	ΆMl$ %$In,~@rhp"]:4aQFWe5CumHףԦYK=/ՊVf=\]}6C-4{/Mr{ It0lK\z=ad1ZʏuqҩucǸ2o^xϗUqrs|ħx;}wWLRB\~8@=$l"Sw̞8 Z9)8	^mnh*_QZF)9pLuz8
)0HWQcjgXg
^cCEEިܛ$=>NT|h͡=zWU?z#/ݰLa68:zq5M`ፕWx,-~[^yKn;v0vMD(5.ALKySy!k6^EFy_ZxO`f-
mΛ?˚!kDG\us-ϊ賺S+\plbL9J#%{h̊u2 eUavF_%p>˧uEV/$G	C1DxLu /H? J_:y_5]FS 𰎵rp\WUX1,M5Xʚi7W>Nƅu3-c0ّ"a
@/YV!.U*$sb( &_䯬wםݣƖ'e͈v$?	c#/I:	M6`kU!k6}c0}\y{Ut"f"fH<ڬ4_bbΰ@ܨ!v`QGsQDd2TZ&4@޿jcAOwkZ-ulX8}tWŪM\L@5wNJ0TCNbؙa!gKN&8Orru>٧'Q (`4aCAFM&y(xku:NRnUfXҲ8ersj醓Ua%[0J#ev*
LNkan#_h&Qs1CQ/YH4ҫWy:ӠĪͰwPVNt#CqJl:4adj8wf.<Gho{o2&~@ρ0{h8TX-TA^jZKPЩfVwP0꣐ajcqQ\kuXh%TXֱM6 G:\{c(LhQ
VtGa+<&1v⧗/,9qrN	g}J te;`$^Gdo>}eg7*g/2
H;ndodA`X!:-,c%u@"O^GY֊eGO	>L{DF	vr$؃f*]$]?x~#	R4͕;k҇hKke`X%hw9]E}ӴJ\%xdEY.3bxj$5|=@h
.16,->$g~D}ܼ(
(vLV7{lq?Yզ?۳.fUqWG54w8vhC\Fy6.rȪb^\@Dxƹs]=EAlCʏm(Z @)WPqcgf1Nb#,GZR]G$G5" :*G&% /:-Oi# 6*VC1 /?"V)9"@}xm4UFk^"jefk:PiB nb>vz:$mvamL9:{yq"O)e^_i/?Cgcmee_o	|Ш߂zAt@U:rn}f7dlӽ'.̧Zk[J{q?Dc&?6MK/ڥwUw4 _gab{tK62$#4a'2`࿤Jw =^7{ި3TŉB|hLpg硲쀶aEzGgU.-7o~({cbedX="?F?ԃicGq/3q9S@lʹ'!@524ọ7򖤠c&6QeK{Y|>89=N;EI{6+('7|bPoe}
VC$q**:*Hr!}6(a?ʂ_BkCY٣?4>Ftd6{^MX'[k0'E~k]+Dwk- iEW'lR	<6o% ZVQk[75'a/<']膚	ڼܯDG󬗽#G#x{sG]:/GCn%feB]M4?|6JVV!c|\$MS|7_0ip_[n1nvs*v`wQR癈`m鹈!88?FyoeE;mZ{?Dr0 oKgA~	O_P(hGT?FKn;W;֋_Lߞ``%=9*dV?lwB/~|CF=z}pjmh?/We'`^t$CH5[JA~}wϓ?uG{#%5yG/4tmYI;(«G?wmwVagY=>ݣ-hNJ2jYkm?H(gc?🕛R
?{ڰ2La?P?zDy(73\[;ȿݨ	~cAl.K68|).Myg

ԏR?+\n#_5W[G4<v:j6j %
6X4kLݔe?vwf֥]u
Lƫ?ǝ-G?1,d`ֹҴ8eDyfL״sDsF;ݭW_A
֠z'a__yQa=<hKM]F9"<m]\bGNJ6EEjO_jǤt2QK8Ȕ$˲ӎw[^C%»K`]+!#~-X@6 'ހ[t}1=D*ȁeڊyj>N=SwD);vwI:%=N o*=9~p|_/eZyx4-wM^Je[c|*7-;l	pknѠ[w{S) r%w=#4˱Q"JMѳK]lXSSrBNdq|kޞF0Va{>YRJ=|ϬO{s%,-5'_i.Vi[j=|}7x1w&%Vzb(B˘sJ#I/-6.E\Raef% w:uNR۝2t~n5g1DCYcb4UOE=5H)EI$6wRgdOF }gbQTF]ݱ^p!t}vX`bʚ|Vf^ri%_W'KG'Z]|3=9'_G?s_Fw@>HT'|h Kyִ]l<@Z(=W2~Yو8]BtDCVXjhk!a|^[9Dx	,ԟ4@! O?}F2z۷Tn쌟|T PA&09HiҞ?-e>7U=H5WaT 9(MFVN1V,'
*hFS/C*lcR"u`iEZr06er	VwxYcAkM>DyO5N}C)hQ4ϜOAZT(\1zʘ¼w ?-hQavArԡ-_`GbxkU؜ACc8[ /YHwVxxIZM^KcpBg$KApOЩ=pQ8^a`x0h`"L%(i^NOc0۷&+|˩M>Ɵi5Ü2mc:9NqcA$>0kTOTBK(/>o,,P۬|*V7XJ܌s]̄fI$KW%s]2;kM&rkGv%tNY\?~vW72ngqCdOYۋah?::Qkgo.0Au>^ sKl~iIDd8JHKڽqCf}43~JVZ"9y>!{IL^%FuAF.T&RH	VYr]#,W*)5"f7N/Q][@
?Ͼ5ƾêLgʖ eU6p=Hgϔ> DVY4W+9PO?M@TdF>ͯAK:` 좪CIsIn2Z7ۧ&$z}i0Tg1{\C,^Fk@3HSUZeʥ\o~Y}(c_|6}Y1kZhmZ7:W@b\x=/µZV4S,џXV%P#'	#Y2pM`t']/ 7IyVQ- Hjr?*{8hI0{;\20=\DҼqfdRuuz
'(exH/5xpu#t-f9Bd0gaJhgݝ)(@>sm=$z6pjiIBؖA(e f٥jN#@AK5+%DgqmpdZM?@	,?g͵&iWwoŧ7xQJI'H:5HSV1|P-//vv^ZZb'\U4p[}s A-qha5 uKt^yhuBO9~RQK~)䰽 QKCҚES4QH6|`G ́aigf&47Ep<bI4Yc&0T1anu5ܷ^>uĈؿpy"-<= aέMZ{ԗi,`{V]QZHiB~ DeɱZ8mZTMb%'(`wyI*_ 0\d)^֑6Ѝv{wјK?c/E/acMj*n=-rp1nl h7j:b-'rl65(f 2[TңGIvxW@֩qߧu5Y{1U='/|kbnӦ'k'D9Ј68,jr!`;j*c^LI]:%}%ǛL'Zt"#l$;VGpE&>;g.l~1xދCh9>7S4CaxI{uNb P>zHW_<^(apG2daqC%05%]j; O*Nf{=jlBNlǖj|VNyU:5Cs#$HM4r&q`U>M&Z7qǊS_X 1zZp5>U
oztt|XEp{UU	qHaqh0iz+Lu&!aE%1װ5oZ+Pe|4DѩU<3;P^V:rEI"蠟ѻ &k ǎ{~aF$ontf֣w:w,oup
zqZe<:H,8 Q>T&M~T(nСȕp3|v>A	osO1^'3T ǹ&"ge[YbqGǵ&DD$CnʥhO(7rv`3o9Iʺ0lj+X
Y(]kՊ tcm9^P~:{rXP2?`'U0}hyZ) L2Dj\p]>-ް/박zw)Aw|)W9qT&^Bw]ԃ(ݍmMI3ꄩMNجsQ0 Xl.nkWNE{#ueH]oOh;l*$MC^'B )pDh89ܸà<HUT@^r/jS`$]wL{nX;
0n>Mo7ߴ^=o4VH#~J$v~ػz~C",	(Kة_('Pki-HQ#4k,h07ӥ*MwaX%g* q޹63׈n S t7`۞眅??=sq.9 uGӪLeA̽	Ȝ%
g~}oBA@ɸ׃Wx?k*}0|^W1 h",\PJk10i
pao0WZ,RRLMP&AxWK&NFa*27yAyOn9a.랤 Z^~?{vh+qlA˨PŴ-3"+SN(M+4U\tWO-w8wvFԕ߲1rL5vy';Z@?q)MLE4q:oG>|Эk7'(];>~<]뼖^M'g8L!}GZHרhGWk:]Zw:<v_Lrk92u;9an%SH"PQHf<Fa܍X})hUe@[Hyt /_B̋$ bK+igWE.	di0Y34T~lg
DE~OsVu<D"_/|=9aw5::<8xK*@>{KJJ\k6&ʜ׺=}vh2]U7hio$\'Bkk/o/ٝ|[F`͊'L:(ؓ%[uǙPdռQ8:FK~3Ԝ{d﮶SOJxCys#|7ެ,o(qIIF|9PFEz_eZq{Irp"eHսP/%-_Q`Ӫ{gVfpWUu	fh6oYfy~+e\/E!hl'BDͥ^:"񿎂 %|Je1& Q$='DImR@b-<LRMT?[2 {E5qyQYnZkAқݓ MX+/h8JW>VLtM5Ct/p4N26z>"{4QYXx.va2fg텭W@-{F<_06J2J{?}<Hz`Jmmv7z1`dhY'a_Oߧ0ewe	.UW4#FoS37_.eՙ~uJV	@Pk,,"r$l@#$&AՍ]<?|Mג:lym5!<M'ܪclakK`ԲoȵL|g `x$qt=~g^JZo K*_f=H5ʹxi'cdCwԾ0NO?W%I;x/Џ߄DR4%(}gT E^/AK{OܣuOY3\^
J 	ЯQ-da;/OQguYwƞH/{Bg!B3^0|t$_5n~l:ibMYA\w'YN,]xg&SO=phqE7C5$ <M4`Ao+²^d~d%<G~@X΂-M|Yw^0:c4.j"x> #7G;8=u~<HA 9ޣ] oCXr3-!9Fqhޥr<aEЬ fω>چL{LmlKy{H::+?juQ6+v)g	!>gE/449LDq`HֹFz5 j^Gj,?isSpdI2Ᾰ/yCe[[_~ i*`fZϱ+[9v&f@Jz5;0s}1=czL1=I? X 