#!/bin/bash

declare -r m2c_version="0.2.17"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]
        then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$(m2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(m2c_msg "$message $(m2c_info_bold "$opts")") " res
        m2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_msg "OS compatibility check.................................................  "
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_msg "Docker installation check..............................................  "
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_msg "Docker-compose installation check......................................  "
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_msg "Ports 80 and 443 availability check....................................  "
    m2c_loading

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 80 is already used by some other service." >"$m2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 443 is already used by some other service." >"$m2c_log"
            test=1
        fi
    fi
    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_msg "Locating archive.......................................................  "
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_msg "Extracting data........................................................  "
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$m2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
      ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c
      if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]
      then
          mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
      else
          rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
      fi
    fi
    m2c_result ${test}

    case ${m2c_os} in
        darwin)
            if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$m2c_global_dir"/mutagen/
                chmod 0755 "$m2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_msg "Generating private key for CA certificate..............................  "
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Signing CA certificate.................................................  "
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Password is required to trust CA certificate...........................  "
        m2c_loading
        m2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
        do
            exit 1
        done
        tput civis
        m2c_erase_prev_lines 1

        m2c_msg "Trusting root CA certificate ..........................................  "
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-certificates
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust && sudo update-ca-trust enable
                    test=$?
                else
                    echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log
touch "$m2c_log"

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c
    m2c_sign "m2c.test"
    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"
    m2c_msg "Mage2click toolset is successfully installed! \n\nRun \`m2c --help\` command for usage information. \nVisit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log
    m2c_load_project_env

    case "$1" in
        global)
            shift
            m2c_log="$m2c_global_dir"/log
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up)
                    m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|down|info|remove|restart|start|status|stop|update)
                    m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 qB] v䶒(
8-o)]LyWU-ʶ붥vLJddJ%<0su50|MD  H*h2@ " ;ݧ}lZ>vS<ifq\َt>1^ċ  aS4wswP{?d,oulm;f?
&w[NA8$'el9ߴNo8vmڤ}C?
' Wv_.dɤ*n;8-qwpovt(ex7:s>4XEùwp${/FӤo.gmN5ugoÜOVxd"a8Hع7I`,!ɠq8:#`aļS?Z#!;$ YGg~(4)&q 7cgG(<>$}&ū\;p6~E>xc__}Fe?m?(WK߭zBĂ!d4<@0śט9~s3N5L`2$qt`ď	h#GmM )[q;I$nE?|oޏx7%&It:&0xm4I>ʻ~cD9յ+bXa^c1^	~l`F]coJZ2y6$8w23&~$AaQR9(8pW>ww~~sǿ۶[7i:/hȋOւcF8<GF@4d*vypoPǃ(vK@CnGv(K~CѐM,W\. (C0g8X[RV3/!sdfUs+Ҭ9j>?$ľ2Zʴkۦ-ۤ_v FPB-"-Qmj ]0vGQQܠ6a  X3K(to*]#izl>Rd,@R~e}sz>V=Xd hW`1+9ꎆ?9 ?sk+>y/+u,KÔ9\zƞԇY}2&>ouQ4s./e 's)$y:MhWHuN,!C1fMFZApFC]ȟy|{+6
-7MHbm*%pT=PaF	{v~cJ!gk??`,n%Zy0胍Tjh._5j%q,h>xI^0B=za4~ V{'a~ c;VUjwa0@ĲҼL`̙7
`c_w4o2'W()oz֯?VwՏösd~sP>zujdOfфٜۤ!q$L(.r͆3tN;|DħqBxֿE wWXD*2SwDCB)yla47YjEéZ	k2ỪnXjx;&Q/nj7;϶v~ܲ+fJ>N@%hf&BlA8B^ }'uVݟ?giC9uN}wp+x5*E{DZWQۻ/_nxvu'\VB2`8E/cF~E?ji"$HYU&].xI^Ly)[WQ;!	{!gSM`'nL*YA!*) `zA+Hk)LMJփwWARѲnn=`N}ZT63A&~$cx
$zs	2a|lgI99Ka#3uF"ol@/^>r7:#֣G0>xZKÛE_xQ=	{O[dq	gOwwEyʌP\,cY˶n͋? /`۲h0 5ϔ$gs
ԌM/6Ŕ&0b֌yS0
n=H f6=V9 uZXk9o;B	cހ4`@8OgA!iWtEByvtd(rgnJ@)EtރČٹlpMNaԾeZ5#	n:G@oLgxtIki!M$4l1w^}juy!J`s_F_uyYԝ@ʲ$K%ڥ^w-;Ga*zßU5ͧW{OQdonn{.L%wF$DN	ŇGlG(#)ڇGh2.Ffw0Q\YDe7ؿ3bO w)Aq0bHK/`HG_B&+bNBF݄`k*#P 9NfY{?ws7?~ƿn?_bX>ۈO}[>y/_:Q
Y4\lb4Xh8SɢLƏF",I"9Lʈ-%Fg&C3&סs]Q=5^rJ][AB+9fVե)s䠫R	mʎ7fox̈kq |-FEk"yJ]c /dA7bF:duQm}W׾_WkBWūkghL?ULR5%ҁ^"Eܰa
* ]E;5yp$2E?\[#^tNW Y-e~E'36yo\c{נ=CՠjðeYHYOlȪRi~51͠l]k:筬wŔ*rw0
`#5OU zu&|&t$	|#SadIm-]sG4HaX4p	BC b>$aJڸGމ2~4dvҳYӼX+&Ɖ(z'^2yceS7{Qi4efyYzm*~r٬+]^.#⠯-]D o0*+ˁo.'e[gsQюO!w\g@TSE>f>9?|R*_
_

_
^f]
MAuxʅ/vՐOH>,6UڸchP5ѡhyEG_XhV+	|	_.rݰ&1%ݸ]e#MkVxSj^+,1)լGr8Y:	&$QQ7}-߯0^0Sh*[I/ۛ\Z%u?G>MBF[4u2mWOCEg47'LT%st%0aL)*`(啸ªiz_+=Q6@Sb?׹1JraZ(_qF]~:xTu1]U<N$Ep~r~jwwKdQ/ ś\F/~BOuNN&3oBPV̤o7JVe\3Mמ#ؘUʩ[=I8"u.+mGj7p8A~;f,`p3W3+rX3;ӫ+_^_]$֠O./$<
\t^'͕(o[mMm=eïž%t{z썸^Η|?CU8=vn\Np(kbo%tՌ8o'xh;oE27o<eTmDaac&e9-vLȷGHW-F*3EPf@Y9RbۋL>=KՄ|n}-̟e^{-E,$
#9CQ[Vʐ#LŰ]'y(n[A:hŠyHޭ,>rj	x+XTe`RFr""_1nڒ;*<0fU!?_)DT>Fjvwa~~&p9{p"v$Lt$AZ<~Ɖ/NIB蛵ժ`s?L{rRLE	[ti$	.! tBZ]ܓ#a':pE>tvJ 
bB`tA[&9Ƃ3ԍAsZ.qV5fyL ͡/L/GĶ90Y8q{| |b3hZBC?mӍTZ ^x}πɩaT#7CU질k-fS?=ULx}Mbo6v:ᡱ#RI2UN]pDd}D,Fh2F:|RL9%xj}NY^	|r,4p:y@P)LngSؐ/jySxJk![p/h[ZΒMhSEz:;^@),jЄ@DS$e.Fe}g9:.>+P2|Fsr`,4<v]3Re*knCIDQ
ަlefDEޝ*zOsAL>Pn27n++E%Ť<B$Sq#)S /yn9 38״lA;2aa8M6-kCۨScJU8>:$.U#fK[63z1Rfr#)eHgj10|>˰SjjOOqUB[;5 FC׊bg`8le._**HEczh2o"hws;>t}(q=Vg
:w&g[FKD-قT?BI0 >GRIY7|.ȴ k߆
??dM̋Vd<f#z㛓o=WUe]\e<Z.`{S̚UjCKga9#ǰo(є`;0\3zio5go<zqLJ3/7&LxHnz5
ϔSq
N  ˙E.{p{+Ty0<HNYNB
>1ZYIS)AzaT:<"eWEҤ6}^BPJz',d&ho+euvf!KhV"D=|	CHH5ANǹcVRBZVRkifd*i0H=gg8|!g0q)ƘA@\:` (D!XP 8d_K|,1<SsaTL`0
J(Vfp2o?ZǗG
IR)3T"ޔΛRO0L1|~%yG()Yea&PxfA:sRGTB
^THWt|RHO63^ϲ!JE> Rދ¡RtR,&8JA*L(Ww
.s  NH-ѣ]q>9ZAbw(oqxaf]؅$\lk#Uqkq)AC\K` /.vgW|vg[|gS|tyk`EЗҒ_KC~qG~1ײYCV!kŧ	-%Dޖy["oKmmF5YD!5
R9K:|FߜaRHG|ߺN~k7~7ܴn
-Y,v6g$KG ߊeԋ1H˒+-KWJ1DK#Xʲ
huhbcqZ%s*9h5FZ90t+LS|/N[+t<ّ^2Hkqm,{ʃPgEpZҬ0uN>k1ƮB]޳zl]đ&̍aY%iH`E{֩DELĸF%,8xc~5tH$Hq)' ^?s- ꓻ1n*}C)#|R]m7'f꜖ז+AN8J_L^MF>vq©_F(#F˲BbđǠf.iv?,)y˧)So0DM\pO{oyYrYHJcml+Bxu},ߐye77۹g[|R+rޑue+ӥ܂R*	K(K׵A3>èwXAH֙5'qYHZy:Y27"s^5n{2Zsx3>e'{l&򆨛D#yYH[Oc)uX#
̑u0:/Kү*%{a
lcr~v#[Ÿ,&]OVGyR#/+* Ak.Ǩr#=hOo4WymGxyiH(ˢLOi'"~k]s>;bM~>+?_ޘzVW?5jeaøA^?bOqy]}h),nӓp, *;/A9'wK1hL\~
,,Ø9"u	Uc%v,h*B?)xq8i`޼tOfeD7k;bo_e~7%QW[>M>Hvɼl#cI8
hsݮ^mTiAz>pj*R5Ik^=hu_9wp/6W|˺pRWr%Tcy<[g۝o*ޒnlpbVZ:6N:eEW&kק+4_+x"|]D9"D@YPg&«;务VycSش2G($ӗQ``.eeZQ[Wud%
ݳ{+/ZƸϡhϚwJ͚g9lj0hn˭25h_XVԖiӊX>y7BٜGafoYjhܯg1ZTty[sIJim|A
ӄtΥbh	gty:Wt{qpW՞7ӷ^4p}S쥢Kf	͵aKur|ATS)z!-7
:hueJ8U#~-"q	!z7^KCOlQcԼ+T-fqkDHUh#¬վ7G#Hd{O2HSD´ӵ[tvDk]F=<>7xbS#*A(8ł!~*,TuWzN-rxt#0}\ϡ,3d10N2ЂzC[99lj_#fw>)͏toq9ޔjZl6M(euꘔC YJŻiai+-,~{tPړBv?d~$?>Wf#vK5
YƠ?<*{s2VçovUV
Jlԋ0JW{O%ΠGsƺ0?vtDqk&|)n4ci-*cBgyr- TQ,:@S=sё79W*%~^&_\(w~{rgs$˒vVGAjAE0 oy!!_8SZL5M?v"@qWw_*<)/wA@B=	4@lXQ$Zzwj{~0G
Qps9Q#	"~=~gdCû=h)ͪeOӊ8TCӰ&:C(<Hpڧz3h 5u$pM@LCt^laāYK5.خ"7S:R\`\?]>8	6Nk׽syƧQx'903Q<YbDt~mRX{x~̦5\wi2eVIJs|_8PZzMyx֐7 W}1Zo|QĶŭVk򭓻Voג^~FLf1ptki+De[/Њ*NyK63UCsy,jЦ&GV_UL
_/q8I~qrTJdj_Uu|H*<%黥s7Hσ|R)|I{vXnfpu*`jRRs?c@u7WrJDE弡J@^Y'li'kS?ɝ18 qSoTZHqn0w)(:mXef[DS'l묭]W{$ƛJ񲳃 )d{*'mVbfpvѝr י\oxesJgvTk$q}PlUHƖV_-q~o<7d3eMf8ݞt$ 3a0k?4!SlZ5	o >%!ie9|'&e*&Jq)mJv-/jy_z6''vtn)nu=l̎2-3 S֟ʮY4CE<_d󫆋$gtg+&uKo2޽\E۶oV_fAqAi;[K85US||5jG$.(7?:*M06ܜaՆQ	.RsɊ u3<M.naC1;$X]q)H8kN8+	sqyq,'Ybp`LAWCc.>%؄
q7ʫiR*yΩZl{6u.5vu5S߬Nw<	n_,6t̞r'P^vvIEZI/%l{1^ Vg1]ÁlD籛b	q?'o*y-Hx~UN3i_Ӆ%'
sNxtY,Η\`DoIPkiJBDwj\=XB0kP]k<zA-{ܪO
%X.Ht󤕇ҩ:]8@O肝/s>q(P1zJCZI~NmH-"|Qz&=V*!lm"FURLEm)}Z=LFkfFE?{r[8̕ÂaIRX]
\;҈$1C҆`;:Tf|3뚖^hi+Zq9^⃳\Q5 HgzZBE$c?FuiE{	@1@cr>ԡcqεљaV{ӓW eQvw;9Bs7c]a !"6 n薯!yyHM,*QWߕ_<8)%E IџI%%>t9+LDTyzzir`F#^SI/ĩR
Cަ9X%WcX٘{e>%b_%WܧksVG*Ct	D}v9<κ]uueFKIri튜w/.\^.)s6֬[e<,pP+0KC*^INAYĀKষ9ơ1Zz>̏0Қ4+ .%a=@>9rhie[-ҳkoAm5њ;ҽtl,IeFǢu[g$Rn~,Wyd\Cȭ,3i,1fS#S'd
ޚ[SC*wR[3BX
'Ex$(|	[;r8F}L03|cy%),.w[\v6M,bk :Ltw3*\6k1MzUMǥi[J'l[+r>b擊~Q8\KkY{i;@l31nA60*E.	".gD*A7Sj*=|ss֍kպؠnwJaVƭKQ:%_(2I-HCgrG'cd,`.D .3bԂpv+QB|[*Vƭ`4[$g{Fe
E?Z	o|yQΖO9j4cqW)wcD/ځV8>me=ؠ$@p뛂qokY(AFyGyޚsZOi_*\l* ~񪕜GgQ O
]e Nif&?8;?NT,θ9>3{l[gePgdF7GZ*stYjgL=ܢ&`\|eR }TRUKdQdmzfA6ďkO~y]]$;}^wu,W1S%g5EG95D]<Y+Um:G^R,re6"NW^quǬ<f#=DCB荅j^>Alb;;}-<cVUL-ĵ߄t<V5⪗p'o|HX{jqƬ.
)uDjORtfv{:y04tV疊ۈXB6Nq^&ĳ<_۰䝆]^jȴ(\}&WP>j"i0}ͅ'eq`RBHrՄ")8opʇ RlIPFK(mmobIN-.]C;o3o+oΑq#XN%BqQN1?Qlf3@c'aKQiOb<\tU/B5Ib7xF<#x
w8\TJ}q09&'s(-ߔQ&xxM.dF-bd/bΏ^QD5\ީ6Azv{(y& Py<`A94%˒N8)4=aƾ)	PLlqY[a_1Ed^/a.US?
D*0IF*%ysE%UTUJ}zt-OL >YͥlK]{F	Q\yܨ)Ps@ܨʍG>Sǧl8٥LJ>Nh-8u!sVDUS=S/׳	_J@er7Z8RT|D5v7[Qjw(QI57'u?{%d%A;T8'b*!((J 	r0\:x}rEU\sg8QS>)K}	#/b]2sތ°mksw O	2ws#ŕ+E㡬2Zet,$,7?Cػ|B/ىw(Fcf-YwAr,~LE<N !,Lz]KcK<k;+:A~AC7M@)jktm⋟ >tݽg;o^/nbHPʺX=$e6G]2җҡ[r^a&"X;	`h$U+gAl,҆Be`KAb˗	|a?0JV.cA)jR-ziWWe7#P)ḯREG:/en,UJ"38_}`^Ut;%ڷ ,.Rxs1D09xk*R]@&
muna%fkx܅eqihAR~ϓfYǟiմ"*il炿W 8(x+h}J%b\{eoY~ Elϊ$M
w9'E.aLDZ78=B4:"x\*@(|A=f`Yxa#߽	9DO g(O	#+_Aڏ4K;1E,4McTXD|q}W~k+Ú/p؆۵iͰ<`:a275wˇѵ͉aJ-cb`+-X8YFR+n:^{:=5,U(dJʷ!!=juWqCpdÿdIawhJOY:	2̑I2&+{4c 9'.C̶aZ4O9׿Nyxmtn4:hWB×:Zۅ{yRrTʕ(Ih%وL	_"}]V`m9I~3h8BkX?R?1UFQ7`nch>r9߂w'nħb:SϡKH 8 rq@V  z?}Հnͫ6ru_߫o^ʷX|F$%z6nfS&Jsӵ^[E'[B<ɰO.X
7wl!Go'aY0/3թ.0le6Mm3o.[4֥KO=5o$ZTN3/f2.2ﳕUr4u%7B)Zt*
c[|ƷxwL#	CCiA؀Cq%`eU_M<̮Z)Do/OoS<03+\_>oWă0/f#O߇_DjE-\}^ו
'OaXzy7ݑw/kN5!3	riMKDϑre`\+̦'73}}[t?.VYR߇hmh/X3H7\7k\S:]fȃc[)kVrO=k{ʤ+>".r.^YB8
RJFqg[Q]Y2G@tV9ѱfQA=='RCS8 ́(E[Syikh9 R
i3zkBwK"g(8Y2L`zx:U5ƛ^O9g
gj|>7(ϳ7wϿ`Ho Q}p`8<) y<58Ь>kŘxIk΂zBOtv% @<;S0ҭE.N鷜[ni>=Nv m4	vfQķ3i^zvxP&ͽ=ȃFarΒS=`@{om͗!W#N&9ÓX_bxozƻ^y%vϗć&;HQ{grI?O_׾ސ֞|ٵ{xE{˲;}Po3	R5VJx.I}-Q*ܨЂLhR;gSK`9LxcVMt7g]|`N;g|_fk_3^W~u}xj1'a$>vZ,jjФ
XJ--˛?LZ2anv1,=A-SI`] 5YFV;	
!1Q>?ghr+ώ*W}o;N)l:ʷb=ԝzqHmJ،=ckvg>N)E햝sdgR]^(1D1l`1XU-'h\|r>vК9=5T؄Lz3H-Xq~._°X\QZ]Zw.G5򡘇q4iSDݲ7#<`ozߜKؗ.ߺ ~vtQ}:>R0@D}bu0ʖ7+xmu<\-lSveidQh_W?pu%Wέ#ޒmkmsWKrdxޓVW`[9bi;"}Tc:o[V-JjRrcx_R5 ͫEPxl!Hp0f"ww!(faZ}05;n7]a(@`0.iWwy7ȪQrCRyһ <Ճ
&Jh,ao͈|Us<D20j	w^5WHvIC"(򛷤cG~rb'ⶻEzo06;|JBX	5}+d;nߨİ_|oThS VENj-xIbFn6D׾ϣ_Q;yPTbԩNV5-sbe~gU
Y熝>ߢMA!~2_[zm6Ńp
m¡߷w_\ x>Qz=8En	u\c>g9>|L-$~Rh8<܎GA8d:;C[5qIQʜg	_,u\u@n]ʊf=eY<$%/^B pLg	9OJkN;/D.ihN@oxh~{Ǭƀń<QDyLOZ\+\zX٘{تHH,Uc5Qn(THK !ʭbjk0
=^pY&,s]}h㊡^~v,HZ6,4Z):aw&տ_m۝Vgn9Vձ0iڍ߱R|f8T^lsދvG颸:l4ZNm.OP*iA7:}S[n6߾5<z}|á7>ThX%k^&-1}vW(nio7'Ml1鏈LXrZޅSptFQ1N&ao	 BLq_"+"
8o4=X^Wt	đ >٪Ԣ QYAشI)7iF&ȀY}O}UMĈxOOYx0COp8$L<.
~҆5%exq^P+yMVPhMf2v% ONN1`^9a|"q 2X$l?BGnXQkU䕷[询5Ρɮ!=pVf9B Wcܿ(%1*#+S~YNyڰ!fD}!
iQ[8nf.s!s?Yvgva˪T~B{c<Ja?mYN\Y`Nb#?B3ґ0<JkUxAdA+wׁonE`nI%En9/ʾzɍa;yWZ%AY.hݝg{;?nYZW32fK}B+)yf"hovyYj>7;?w?ۭco4spl߽A(Ů	/&sl?}~{ާs_\wOC?T(S'c/s?#2k|'Afyjg?0iO{{^iifų~Y_Dk|N%~+-ybj~՛b/WozW{$!KՓJ3Z15+Ivz4~]߱kY7={oGt|wo^gcgk;νgjVnI?W@Yj=aΌe؛gʃ@!<.`"E%U|QL,-QZ᜺^*
]+̿*NY_P.4;;yZӱsnR@RtE6k7{Ͼ]&^Q08P8{
7?-ԇceI,Im%?ݍ
>}pw[^BK4Ң\#GuDƔQA]NmY8!S")8DiG~]%RqmTMGʚ(8epjAE,`^_[L5W7W6^GZS[@l?x#s??q&v~<#k,=fRsD%67IP%Oʂw*'vs2?xQ0}_le?k[?&;fʕ17#ja4}dByGGA2*`Nq4]<s} Բn5ȊgX߲50rsLm;v]0N*dJktQ[e;4i??[co0hͶxڊ C<4BBB3i%VWSXQ
Xne(_1X]`]Θb\T_?j٫JpY߰[n3'[n~ם<xjϯ1'kIO*{'4ēC_V"^%A2d0= 
~,䪐=	[rGӢaLIw*E@C?D˩0`OyH"J0A;YrF
Ч .ҫ(zt\s/i1 q0bpSo?*扃_vnpkpF[>@^Dik? s%[lm0<:	HP9򏡌'IɿZEf9nhm8Dl2ta6+dSB=>;ya<zUc2:v®vިI݅7rwm Wg b.N@EQ+1  ZlkȲ^K x@֖1ݣ&Ye˺G@W7eSqQ7i\, ΃8mw>,Dvź6oL3#[|ˉSZ~дRqx/8M 4\1Dt"n<DIw> *lpr$ 2R-,t켄ȲyINiI(93ALiȟ^B6Ҝ\h`	aC//ob.2;uX<F#V8'UNpCmѥ jo4l#Fx5h- +I
jBV`)fE`[\vyi!.izh0Nq~HZ@ql֮R"j 0=_/Tr@FGIȞ`|bn~NXg].|x́	M\4w5hGVqn9z$3.L?L!.<My"wQT 2K0:\YcyPFgT e'wZ6f(ң	8:Jkc&#a\#U㺰1Z1`D7.lO?Wd&cJq4,[04)vZ6JHirǺ^Wl)fj-mm&bn:`ۀ¨jШ5{Ȣ6\R!k)nmj`j7 Np{Zi4CnznNӭ9^ғPql<tZZq	qZi5܆uzv%w[58hNǞwfjv;Z]3q\`mu&$В2 8$Z(ؖ.`z]s^vd#pVmv:\]kj=t [Nivqzzr4i7{=vKjݴA. նHwǻzol@tBqjvq ٫NkLk6z8}сhvulݦthاMirX=v6q{v(ӄ*Z7{vSkhwի=%. 5[fRZm@AWøC$c=WЏnw܇HFt-y3&BȒ6mAC	m`GAitj8Clk9@t/iYV6!PXv'ȇZmvp5z(HY5 mk mNvq@d	Fi@Ln6n:0, =B"PS6 Nv8F6EB1s -0Ҙlhn.ժuL E>átM`TP|j14[.C	WtMZP]- L	h=@--haCdi6`4n@GqmdVHM]F@$u^ϡ1k4US?'z.%3t^h`?'PQ7ʔ^ y	tAn!(:lDoG8FF ]6(TV=70mmTJ-Lvnu1ݨA=L N-M
)I"tFWbNVuIÁQہdU9/IM2:xA"Ma;h(VK	 䠝 {(z-ovL Pun
	\v[-^Hmvm((ܚi9vc!tL	5h6AuAޢn6(&pk!9(2	`s@ ؝0zdgM@[7;l+kT#!evP$H'/iC\0V(R{@VhHJ.PS.Xn ͡pvFCMiwkTic "#b ; AE4{H&vH2HdT`uh4E-;EXIE>nv{Zf466¸Մ=6Hi=h#W>;	l[Pp8?UVISABZ:6`hжk5ў6bCCv 20R:@1t.bC4!5.7md喱l$r4EaLhp@wl94rJ %`t?`,}aFӒ\mдT*h+Nl2@}663`"AQT$Tj2h6`@f(Х[._jЩ;0yڢAl2#|9PCIHCp4Hp&NƸ}:0CyT$y \`m	3Q.@n8فh7pAFL/Zhw0h`1d	`r;M0q.AC@Ti Q,Csȃ_
6N~Oc,uK4ܕNiz]v{|\vQq@Bcwu}߀m40+Rqܡ(:9MV)Dȍ
&\0$,~A3p S:[,> &	lhׁ]M{OZ4QRwnw
ylԾ`ȓ̓f`}tuutH.Mf?GjluL5S51J!Gn&+@JJAai=O8Ò @N,$"0&'IWˌC_}hZ>ThD"}j"L 2GJE>7ͦLrF}.Z-W}0#ۢ>$fz=Up,קdF/:[?#8]P-Ma0_#!%_33CiIӤNj[dhzN~5fKi*(Iav0;,? ͆&@'ح*LӒSat3X @DmMaI:r`\AM!@Zz^ TCM8];t4AҀf763]|Natzf`7`_$+HRXS]=wUғ[q>~ܦFN}(#aA}6|G߅Kݱ[(AzmS
$@xxQ8u`r]XMb?_.!7t!礿΢O7@l#ojyW3?x8wYd?h&i(epwp慗Dvf~̗Ws@`v4-1Q)VYD?Uk8 /K҆B_w6og$7Tn#p79eé7&YWn{z6o|%t	Q`6=U_,W{~$-ZRڋqBF{.7#@X;F	F{aj~9:.p-vf))-(8leJa\ri?Gp駃3;j^%UEME@^Ekxv=%-])ML6R)&"j'dd38q9y%f\w4㧌HҨjT6f7P'%bF6
%ֺ':FΣcںd<: De[+Xex^r0 ȒGɤ6w `0JixR;pd)ZL9_)|!Y8'Ar:;£4&C~eSpV~}GV+!+n"<}Ԅ.T*|UP%Ufn![ѵXMp+/BKH4]؇qm։hcN^y7`]kY-wZVj&kx0H[`A3 {i$kͦ[gWl;Z;\.chXך]ρBa.\bmQ]^ZlLuEn!Yg;L?'jՑ\dn<H@fzx]}!h"[`ϱkvMw^u۬ql;l_* sl5sO909F)@Aւw-	V؆`r@xEʻ~Z0Pe#7'9{jhE*?y2($/X~\͓}cYk|z@<i7]&:tCL0ħc~7ZN@7 6?y'ϗ_Py̊ܭXknTCP13:jyiS:U]ڨʞ#ot8"NCDɊF)LxIY'V<*ä<BC._y؟1aa}^d5*R-Yn4::e!IrJ~s2
蜳u֨%v%!d:K 8!410P/(k<):$h\isnF_Oߨ/Xu|=_3#;? eAx2D8?F>{ujN" z޽bìϏÈ, *黡/!zPeݐK971N݄,nC=^po>
Dt	r?py( ?>Ǘ㫯~vNn{U*+˯՜iFU)cgH"Q<s4JrSSVfQe1H;@aIRkX:\fs1Te4Ĺ%/ѹ Xx	s9Ġ\z4݅j֥y}s%JjUr<R)Ȑ)QWǋ,+t;s](ic?A97CNW8]^{1& /'{6l=_ys}mx'i¥V^F7D2ExXA Y:*UEsp8
#Fyu(Ra}V./g	"w}GK9g?29Fe'xЫ# )V]7
㩰2%cYF1_ojoμQ02Ze@<<g`Z@FyOdok+VO(ދG?g't~PW7(cЬ};rZ1hZ"Mz5_t<V3fdY~+`((fU!T69R}lJ+8iMQKu"ٛ>{BbOrT7iQ?{} {hl
e;Xh.pYC8D*tXFBbi]I!p"Hcd>WI uA%L|=}U|0ِ=TCM#S"h2bIvS]vzQj؟Ǻmb1
@^]I*Ya,Pj!d!1}BHad<_eI}U-rD:,zSϊ%ٲ+Upx]%6Gw6S
X~,lYYlJL(.Xhft^28S`8o,TDbdQH,_c0Y4av;JuY/ hy2;QO(&owN{2̻I:yHUӫ}K^ Ek>URb-AWixC/Ћ΃%#@f/eпֳs	Ùrt}Ix6Hu;}'
{Mpp>Jh+l$NшŻyMߧ^|xh_P0TXE1o8Bď|C#9N`	\0FHFν(y9z)ʔT%g"P|m-A,t[vĬkl0FުCt4y`cYbghBJ5^^D˯\C=Cb/Q)_2קQ8<f-odVR34	A̼SlBg! ᬶ]}H#Zv5f1	ӥ^48(^tLwyIT"bUs
|
դB&Kٻz>yi`?ZU	9s_P0 5cjべN`3>X(w%EïSfEѫ~U#[ضM~4"=ٚeE.<~HZKTEoUK885<r6R0hlܴ?/vVr#x9COr<KpMR~(J:5\A@V%2FjCC'^
p" b|1) abYQ 0eִfWy^=9h+SEȇ|~#s<vP#\;bVc:CFLvVX(>|Yzg6 eB t`//Zxhg)%û"/\&YA*ӋyO`6{:RMnMaSu(|L ?R=D!$7*To&Q gcnPo,MZ:XU%nI7z.-eICpǠ&O=лYݲscLrgGa~K4k[fŵ|Dx\cG,c]
ͯba4D[jp{^'wqerUn/X<|njNDxRͽP*d9xs{$cyzY:@tkv!>lA&z 7Z4⢂q>Cj4>{VE^tQbpT8X(#0aG}nF-[7&Ž(;6BBz0MDK2)QX9fYxa}Xc:[4
 o3VڝE>6ۮV\5l^QF<YAiNQ{^-JvFoMW`JUY!xC<`> &v%LdۢJ+ț2)?IAkI8*;$6ǡ RtDp,9qw=m#_J-Hh҃rRUK5S󏿙هE)v>@ٝkByqẂ4k0z&=>2it V> YP%077д}QW|I켉؛>q?F{5sQltt#O`2M?GkSUKh%<P{Nu~Y*y!TeٲV-1J%y#琑t^n9߆]aGдӁmHl
mwP*ZyNaUę)00ʓ߇AnLXi|fguX{JVؚxD!_x@lѢWH2tGPK14ԇy&Mֵ}Qm&"qAwX@AGFhJ"(WcC-g0MfCfhCY[r6WׁU6,Z*z	olQ΍^)Y?}Qr#(2Eд3FXpT0Ԕd`	鸪i򩱥	1?C$No>V0Gf27I'U+5A2ut_AI62F6_LlgsQ6~u7/F&AO/vH(of~,禮e0ᄄފ5$.rT
aTXt#GxhEz%fqwHK<4}k]I UWb
l:+P8+Dd<KjP_AEV 믾j$)={	mKߛ;[{1`x)zyJ.s䳷Ӭ7wu'wuӸ_hSێʘ4O,6;X=^"Z:G\Vޔ.A$Al T8о87huwP}wWtɅ^P_[[m4ZK<ꍰ$G2Q|Sj9<7T_4\вol	"`	$X~DmuRTo-"FP'Gj]I#/w-yCB'ގ[Q)B"^AMM|^_E2Y}m,{Qp51qvg\B˗=!qW~oDw.ET%q!c,S{{ݦ;c@y̓chV{nݲcE̾}r}	u[=gWIXANӤ7L]wq.̙>9'0?h9 @1ғs:?׌@ocOacE˧߃)ux05H%)t"|
\Ar1 x2k]a-e=4:2!QQz18oz]#(Y2M՘p%'bhց㠵+^ztSAՋ]=?*tlme@B06\w"oǘ35NyF-=xgh:xlNqt}ViYġ0`~!'rn[cG>`vkIxI_Ri ݴڝ4ڃSH2G.`d!_:{ȿ\|r_]gzRI1
B\zaGC(veOIX7e- $E#A8t$;S5_wuihAz+3ihО IY'cz&|֋twH2Y}P'k|Xxr~*Дg(*+tw!2%; k4}.*ԕ"Q5-S0Qڴ1EB5$6 yhay=t@<,NlܽIA񮁇 髰YW\MO˦G>D fZuFȅ.ւ$e}}y*1~`!oX}=bCvϖC=^÷a\;\j8, f&5`ǳGO@;;;v滇ؑh1utU2#.3V {.,0'H=#%hA \xxDvaGUxz[0cN%U
OԹ%$|9_K#I'g"ʽcOYvvm=,%LvU%UC=;J	
28sO},X`,X`,X`,Xډz  