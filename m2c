#!/bin/bash

declare -r m2c_version="0.6.3"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_loading_install() {
    tput civis
    m2c_start_progress & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done

    printf "\033[0m"
}

m2c_start_progress() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏') iteration=0 length=0 log

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        if [[ "$iteration" == "0" ]]
        then
            log="$(<${m2c_log})"

            if [[ "$log" == *"Progress:"* ]]
            then
                log=" $(echo "$log" | grep "Progress: " | tail -1 | tr -d "[Proges: ]")  "
                length=${#log}
                printf %${length}s | tr " " "\b"
                echo -en "$log"
            fi
        fi

        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            (( iteration++ ))
            sleep 0.1
        done

        [[ "$iteration" == "10" ]] && iteration=0
    done

    printf %${length}s | tr " " "."
    printf "\033[0m"
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid} && \
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    local text="$1"
    local chars=$((${#text}))
    local cols=$(tput cols)

    if [[ $chars -gt $cols ]]
    then
        text="$(echo "$text" | fold -s -w"$cols")"
    fi

    echo -en "\033[0;32m$text\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_dots() {
    local text="$1"
    local chars=$((${#text} + 3))
    local cols=$(tput cols)
    local last

    cols=$(( cols > 80 ? 80 : cols ))

    if [[ $chars -gt $cols ]]
    then
        text="$(echo "$text" | fold -s -w"$cols")"
        last="${text##*$'\n'}"
        chars=$((${#last} + 3))
    fi

    m2c_msg "$text$(printf %$((cols - chars))s | tr " " ".")  "
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]
        then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$1 \
          only_y=$2 \
          opts \
          res \
          text \
          lines

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        text="$(m2c_msg "$message $(m2c_info_bold "$opts")") "
        lines=$(echo "$text" | wc -l)
        read -n 1 -srp "$text" res
        echo
        m2c_erase_prev_lines ${lines}
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_dots "OS compatibility check"
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_dots "Docker installation check"
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_dots "Docker-compose installation check"
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_dots "Ports 80, 443, 33060 and 53 availability check"
    m2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$m2c_log"
    fi

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    m2c_dots "Password required to trust the CA certificate and create symlinks"
    m2c_loading
    m2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    m2c_erase_prev_lines 1
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_dots "Locating archive"
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_dots "Extracting data"
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$m2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c

        if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    m2c_result ${test}

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_dots "Generating private key for CA certificate"
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_dots "Signing CA certificate"
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_dots "Trusting root CA certificate"
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$m2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$m2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi

    case ${m2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                m2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                m2c_dots "Creating the resolver file"
                m2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                m2c_result $?
            fi

            if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$m2c_global_dir"/mutagen/
                chmod 0755 "$m2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log
touch "$m2c_log"

if ! docker info > /dev/null 2>&1
then
    m2c_error "Docker is not running or Docker service is not reachable.\n"
    exit 1
fi

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c

    m2c_global_load_env

    m2c_sign "m2c.test"

    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"

    m2c_msg "Mage2click toolset is successfully installed!\n"
    m2c_msg "Run \`m2c --help\` command for usage information.\n"
    m2c_msg "Visit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log

    m2c_load_env

    case "$1" in
        global)
            shift
            m2c_log="$m2c_global_dir"/log
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    ! m2c_in_array "--help" $@ && m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    ! m2c_in_array "--help" $@ && m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    ! m2c_in_array "--help" $@ && m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ӑ] r#G(8˯.BU&Q$$NW$5(	$2YTc>cv^`vkK	YR7$ȌG{}5~S\_]e?)k-7W[:kZ`qz1WPTO}ZY^[na?DGw~|o(0k6Dvq&w;l.D:{i,8oy e|d=jƞ/`B#0z/y[0++4+kɘYEaYWgM5kWWۏCO)ƬOSv)h҈žg?5b?,^(=Oi03?Mi?ㄝѐAByX&)V>;e9CDh8y__or^nq,􆾬vZul¿!VOķug>X`~d< Fq/^v	Pg{o8nBa<JRVOIP?pDekKc4Ƥn}q?Dxi|!,{S9OQ9Ϥva፟x\VY'K5OVV1#PxvhRO	o޺_{~AσEVfƇ#6a	>Lt8\Q\@uW>t璥_otW-Jkq?H	iO|a!8jݳAtZoڨi#VY帹rkx{|ҋn)v~wv1lYr}F)q
8=\=
CAZB_vawq;G,UV
[wW2KҠ^3J?2w,jĿf5?1`X*UJURUru*TMiS5m{''A:E2uv [&Ȗer\*@Xkw2	3?诀lKUZ$ƈqt*K~@/rNYeQ5~xQf62Vؓײ	^*٨׍ǃku>mA״>̃wa(jk\S遜|!*I_nOQڼDO*KnA1VaWqFj!/x͉kv#_^[}ʾ3߮	UUZϺφ?(Nw[/vw^uv_>5z{;<z&:o=6J8j2}&ڸZq!q&rX=\G;QѬZdVc`<_y(gGe(=#$'/ {/>Kc6C/T>|`|2rq:D&gon*U7
>^O:a(*Ax.-bX !p֌+r(Wڐ?]o6x_7kܬ}~koZ7Z73ONtL7)hoZ
®ޕ5V~~]`Z|$iJxg/~۩1Pzw#Fۓѻ̔-چU9.HդZ fmrxji#/=5}D=ݷUsLq`p:17y`vqn29Y ̝G[;[?n47Z7%5,X;$^	jA[-E##h]E}d q{kYi}@69AbiUB+#.Ŭ'6_tU5NhB\#i1߸v?N*e[Je!к(5X%LYU&:mN3Q6>y;
MK8)c7$	z9K#@7JVȋ6`9XJ'52>Lt".S	U`1x{s#[Z3֪O*&VmZ$Я%{xɻnOY U4;N>oi`Ѡ9387nc\h 8n&(`*0ުKbe	v6X_~U
*^/*q8Tw]8nR%~?H
8=T&?o=qR%;:(ʠE:*wSI5~9:
Eyz)f[ԩ8Iz^u+>UkQq4v0szF'iRAʄ][&tiYzuoE+HޥH6P{/38r2qkFͺi[	Z/fMP/VbЇ`4>\WxV a(r3B7 I:z`OMإwg~nED^J^s0tTѷ]jB7UsYLC"7cռS~-_.]Iv:֧\^ӬIEHB4{m\YTOz}}s`Gv;|y{돇"aKCTqFDIo)'JݓhGfFrB8E(YDoDeUm+T RVC^|ԥ~F_	2#Dsa4TojC^8(X>|{y|I@zi~y/fpadt㣮c<F} {^77֘'Vjq.AZs؃7Awu47} jh4TQul&e68ڤњ9@;A)$[|sly!Zx 	L}24<N@To0B'JqeoC*uN!Ă78s7IMJBVN\ǽjسO/?=ٯ"$;KxFcWvktFM#ožJ+mRXP-^_A]nϟd~|q0Yj&B]]̋d|?8Hq $TFXqa$v	Y,ZUFTҊjyղ!L /'>	1(~y	zXt_#Z/oD5oޭz-ц^(4&DĆXcPOaGi}AC=JІf]4oO.D>AH1LM&T$Ơ|?!*J>6tHq	NZ'ZX^ӪTeLR/א%'բZ0eWq`PXZp!-.K]-av&$?9ߔGwvo 2]	J,ٸTU|i`*T>d#wM(qk>4%tǠJr
=5,Lj_{T`!~YZlNѸ:FQqȔʄ|pZ%8G]XƬ0+&ƅB\1
;AHvؖw~4[]ǯ UfBMb'Q672'^x(Xu9صəA{j>L^xbWqa*N͹(ߋ챯vQv,h~QbuDQmO 7#f89c[Ӫ8ܽ
G%	)$%Y$&\T
D$Gk4C`TcbR޽@*ӕ :5qC5ZHUJ%2 3gz"bC`k%E/QR+[[`!}bonn5➲f\ExwcXbx<KabF$C0RaPW͹d^P%eٮ$Ϋ$Sudѭܘq"ty @f~--~o|/+;}oZVep vA(ό$b|;~Ç/HnnS|\~H5ܚ^24fCh|QdBoj*CμR򾰸->^V.1n?Mdqn񴪷Kj3|4@+<PCW]^ف`SuǰUo`7yxnIH03id	Ls	Ijxjծz;-yH<[k5h]!RPѿ4yi89aw^hSUK9SDaxEԝİ
.( Je`@N :*+,W6=7ϞTh^C|^ن$>pӨyGс3%4W :W>z܎U qpvp+"?+<'s8V%,HIH++bLIi'kzxi6^ɲ@δunK.3=3qWLuEO)#ga
!.ro2e*s@V*߹ ڼ=C]\ P5d{. K_E kAp "aYupU0J}y˲HIZӹMNhMDKh9WK^0i<{3'xGSL ]f$'ڄHg8˘NARz<٬Z<O״03*e7+j&«0E44=a"'l³0h6Q.`.[`4/ty,"7Ssh STwJ]c^DP$3.\}.<H Ce-:	u{|4=ņ*O<` *+6nu3n-aCgBK{Vh5,s@9JWy+@7|(b]kd5L`DJ6F,z^PSH1NN0&:VTV`eI$)-Y#LZX0'7%Sΰ.4Q-IV+//c:zhMSYoL\RmxՊ A4h6x0ёxq_t)NuEn1|JJoIh7ToЈv,P|ji9<
9YXȭMӄOg`ZDzBP$x[twR_)Dni	OGTP**xKA2\Uր_k6f̐T^G]Tߚ%2̛(DM$3 -H{|ϣKϳ	Iƒ'qrGzIh~95D# ]*ka8FW'##Rs\X^݂$K)d.3
 4ny$̠5f!9^T"4zJg:Qd@]w xb[5p4=u 5?kt =gz݅Q
&q؏ 6m=PC؅:Z
nFXuInT[r{	&ׄsxH討0Hz4̪TT*H.Vao,o}Ӹ%H57O~s?h4̦"哪{xu&U.niL[	6i,5[88
02Ԝс;.0OO*vYH/}$t'MX>hZy_?	rr}6E#\^([/R7c<{Xqi@,_ZJ{#?L!z"Jhi(mOxyp\<WMHX\eYCz:Y2S^a4#ƀ&F8eg	Ŭh, 鮇Җ%]$FO==r",?lK<8VYTk}ɶn,řlH-(UvI:ĔK=B&088AR#oӑ>@)u6E6f\@!_I+Ĵ@8'FHOJ'g3f'f_n0j!@7rl%b0K5l~ ׫'o+c Pӓ5<gCGCHi#)3Dfp_|^OhL˝k#7C#ĝw4dV^xJ<?)ȌMerIf%OR8|u'Q(Ds!P3*Ar*},@P@H
3͆$ɀi:n,caUl`~쫩,2Q y	 !a?H>e\mC0I$X9!|@Ks3@MZq܋%(DHEGE#">,XDi 0O{X9 m>bᵈQY%[`s	Us+0ʦ՛4Ygf}$: Р]l[>*X-<JeשWN):S\0j.:0&6hf03fl6E|kEeqYD\%1Bd)Rē%eLIURƕT%E2dY;/VL}Y_VeY~i/-]lE6"ېMd~骽)oJ)oJ)oe+نlB POĤOa`+[K}#H	Fsm]}[SVԷe]XR B[VUڪvQ-U4Y>e[Au1[K}˯gSݑ{C\ zx&-=cxƏ}j5A25S6q]jHJI#2	Q;'p
uKZomz3Ojx[D!)Uċ2flG"Qr>s8U.΄2e${me׼{_t\G]6vۉ
`f&#Eز.XY%	bM"!Ӗ%sU4և*7yKlG`$1Iq-tJ$Y3cY۩2;vԓC(9Ӌ@}䳎K]&"VT&X}2fd3]qsN8HOýpprKy=K)T'+	eY&Z3q0brl3׎gZqY`/ByA/{_
:N+GQV̅AQWĻ#ɵVkI;hIq=4WpEQSҢ%;6]PBN_BC}DLEȀ1cs'g@enۚ=fi:QSJH9u3F?.a߷BKGwΡy0RȈwA	K#y{r+9SbY)R-xb}=B#`*B3B{m1XGzr#8p.E[A}{Os茫NG1R1Jb\M3Wz	=ٝPD;}DLy`nKA}s;wę|9k?Sܙy~yE3l޸lѿcaǺ+ fȡ<gnr9V|sitVw7"zsV9(93+wt2td>iu$4Y
Bf^Q3κG>S0Zg=~"OԲrReq	imfC`̻|Ǟ~ ,ѥ/-67Ot\^z}Ḻҷ}shݧb ߍFC7?JYPNuӪ(utZ)_$KʐZ=,͔e7lIUCfdp!LE17:ΤDUWco.b7
arz"	cARm0;{@)z1[E}/[Jn
Eg6n:
֏g2t-{d%sAb+.ZiI'jҳ(_yf[wXxDG0JFK8mOf7bɊ"E[eplڴ:m,n[INEg*å.#'**! |~~3gj;qCrnq=VF9DqhƧ`*T|d-jrǦ4;_vHJ&v*ٲzPJ~]ճ_~}2-ڨ;FM9K4`*_6dgsjƂwhՊv[\GP)C޳.|MU9|=d@>a:O茞w8Ia:tDh	Tաwnй.)vt@q
߃MЎ7nC=T	h뽃_|&nMqŹvJ5ƪi}5.7TkV=ԋgV$ 0VfkK@c=e5Sۚ72{gMk^8w%HOyCi<SB8qr)\zgGohDၷ]ɀ`(>	oճcx<@5Ci/Be),ZBPvUlIOLYEhA)O ~K~c(fTuJoDoHw䮐z9:DՂ(_tͣ6wQ):Jʗ{}sP\f%e7i`,rA5`,wOi'].I}{pxD5U=wy$N,| EiA{C=M׈Gx_;;gA2/6_OzWz;~*(C(48}{Zqe>ȃ8S2k/]˔2 iI!W`4}
?vсЕ	@Gᆂ^=$ a rx i$\4b-G[A!ome2Dnr> ]4Pj!QAοZ|8@Qr2C/ DqBxs:g^ۣz쏢"deDIz}hlaa/Z}46c(8;ȂUQ8wtŞXL0+ӡ|΅NkRLF.|d&	hy" ăW;	LTT+=QY#wU@ך&_S0|"2OMHˉ6S+&*fq`a2tG(d"'&jՃL?%vK ct%m Q 'l^fԿ`-R?5BE\۩ŏ9I%WWz]@߆fW#OD>/S#*b'RϢφgB'nP?쓻b;Ot^SGVj^Mf4%?)N;clEC	&:@_tx9]gɘh9CɸKrG|$6z)0Wݹh6CeOug˚PfJTB-qa-=&%531٪
-gdbt[7:<,%(<Ul*%mĬ.6TR@q7YZbK{ZU)[udU
wdߞ@cx#VvuP^LӄMO汏OK(ϡV)Kl#8?^䞋g͗DPť32ƚsc{Ѳ|ΘU om	mBdbQ^3J8/3N%LVHf&
([&Ժ__d糥+\Sr1a(NQi'N84:VReQ0k*jWRݦYy1Yۼ+|wmF21·mDMd"klM\l4[zE9Z3Mɡَs]Zagf87ڧz*1.~g=nu38J`u]{}!,1=.g`\2ELS;%+1]} kN.&D8jRp{ytМIܶGV_BTȐ )-c##(al]AvzzuG#р>HȲnSIsps%WA]AU),W&"?wSPNA=Q.꙱1\hbdUPlfU&#\\hݕ0}nJc%+凑}A֩y:ѣW寭vf!˫4Jb!q,hb_֛_Z F1'lC+*ᙢ@Hui<`Rh>B%0!Z8]@i5<jhgr}ݚu+YJ6XG}EAL28Qf6@> Q&1aQΡWUBb^MC;p8|fBB9_~eC9@a_Bu1V	*#BMURJ]q:VY\R}>|$"D}b@o1FI$z("1.k'qNV`rW 1Xx91	~+Gϧ{(Zz`,W*i*&w#Y܌t%BUg>1Tێ0(YJC~q۹Jǣt,߂s=*14UHp3YiAԫ3Ufq8fȞtꕮSAX=9d*=G$\kX`S~&:4W/$Lė_MQ'_*zmltzr(4-U͜%~0zOvqУHdn[{ʮХ+MSni!b2yR5mDQ3vN{IhVZ2ڒI2
.tNgbt_)ɄI-.ßLbzX^:CDh$7At\@'VɱiUʼ.,[x\O4a҆7 ^`,H{ 
,<wH
Wc9.Y<p[5f#TG1% x	SOdU_/_kZoD(D^jvz٢(98Bp_OU>2&ˣ1	)2E6N1=OL"\#TGm·޽50k'?kwtb#g5D`[^ ώ`]Omu۞ *./3&(ݧ؜^eyʔG)L	!>7Sp[&΂KnB6<7[&i/cduc[>얃7isĲ71_Y+5,2/:m;+,<d>pyEQl><=iY\SVN>l3GFgk񄴴BNӵohļA{+a.-it*a@/)m*="QNco0g	~YGXc[>䧭#ٷsD*9fj/w&9pELf9ye8T.Nd;YvCk^<%;1[ErqLyNgJs:Ī67Ft)<`4qE]4SϴKisqZTcķB푳$iRi(VE~q.=-85nem8*F6Ob7꠨
)CGl7>m-X?<w-*L|)}]q9.q[΀vέ=oJqcIeF/2%N2NA6NA/uqE.:qhunsNQVmzvxՊ}TG#`@s2i!18w:VãN&{y4y9=%cmyy9Bn`jb;Μ(roېՁh0E?aj')"6ɚ7sͦ^T~>$Jd'eI҆f~xj51:V&v07ny1Znm ciCV"y=HM OaRV%xF80fӔ}Pݾa77)>k!/yjo!JZv/>q#r["=h"t|):U^OFwv8nOSz(^~XDلOx'8GCU&n
6sh]P7Tʠ .[,9kww`XAѾR:O?| j/p&5%ZǛ\Sl/"V5#},L8]2x~I{}G!]ʥy&5DlY3LD}ZKQ\J d+)8)\&EթuSPS.Jn
Fh<Bo"~V_}
䓿Uik߇mѡT/q:o\T&CY~h>-?zApV#mv(xLMxEpsf^F;U螚hNДouRicrHey[f-p@\-WOi
}v#Q^QЭW]j_yJ3'Oís/<3}aYy܍QE"z	㧉>	1JA\(ZGhׁyGˆ|F-J9	Qf DlZ.s=Љz׎	ɝsSmpG"vl+az;wr76m9ziTT,gg_ۘI~!?vb晼`GSZw:26o򆎫eeJkBmw=πG#?^M"Is?ش6~nZj2R	o o"HVK~}ZJRaUdp韻9)ݒ?_\ySXVY^oh@5wҒcIFC)9~(Ղ%n2Ӎma*<oV3I"C6qW=%%9)cB8˖	 !l}!?b0OR[<Ia#f7rSIərviBZ1z_dƳ&(^RO!#Kor)h H<wvV~yM@pxdDĀ
%pU*&R&{4jf/_!<{uwS'o(Ew1=X&NM.&;@ނ)p+k=TRFwNUT@a& uɧ.nmK%}cѤ֤CX)7Eqphh#[f[!҈T$77iBK\Ht94.hNt2g.{j,ymp[~lQն>mSoQ0wd}gS>h92_*3P	 '$
uI&gp
\+·Yqnj#Nhx͂p+G<7q,O:'O%,8{UNm/G5va bif3y>+F%3mts#O&LV@SDhoyZ|~B#|E> Yx`+a~"^' c:::gʊP}B>:  (^Ё~Z|iNB`0]qt	[>̗KJ[
s^
I	&d3%-^/]'. l@
e;a:`B@'w/RK|r7ǲ'ga|a >>oS<a5tgqjo_0w#t~`"=1ߡ+?d]TqH23,1]hZfpk:~8)Zu?N,@WFMf'4͉7%L+M+WA/ΖܵZpbaPg"'|sZPiw\L%wA&T{sԦBZ F͏"8 |lyC-@x!9FpR@wT@@MBjV
BJyt+ rݛE Mwr!9M*C DꏬrP|DRK<e޸a{u`';*vr])Jb,jy'颭ot9E'f^xDR%gf=W wH·OcxV@g06rG9دktVm
ۦE>rsOC;ʢ0Nɵ?_'_G׶lWK|d] ZyJ+[ZZZ_kFyngWf5cJAфQ]2:'MUMϛZ)4eAxaelJ^/{Wj0<(;</:wՊ^rMQx#0h~{?zG^gW#K?R6د)Ԑ;f-|<:~#H)~8Ti7jNR+o\A.ّQ{=:gWw\j56b:XY]mџFjWy78~fsr&UHVMl$ %$7? ]aȅ:w\6i֜QFWeCumHף,kSHBRKժhNF۷!ٴi8dlHi$*`^xf8a5ٖz(EZ`c@#KuqԩucǸ3o^xϗUqrs|ħx;}wWL쪢RB.1@=lD\w̞8 Z9)8	^mnh**/ntȭdV&|xp^+H 1@:܈W;cE|
I5=TTʽ9N؃ND?9qУWUu7:|=̦: '_G8_	,
o+ovɭp.&]rݮҨhRbϴ[ۯ=v^m3y)^ذhM~0~oԚ7Us<5qB6Me1#t9VȖgg賺c$&OXcCcQ.3@cdV]ZeV6ܴsIʋ7x|-Y>[/
b}`h&9,H,JDcxAj2b9e\wL]y4X+gEyUŰT=iR3߸DLK#dACf;~{u@OU1
UB{IlP"LwY_Y3vo5^wv[2ʞ\M7'I )yIAOh[4}^Y(1rU55X{gXMD9f%"9Pfk;Jv~49EA8#e#06t8VBV ez>rwIޏ?ޕKu-8:y/ZTX%;}tWŪM\L@5w$l|%a*!FSf!,vpXH	'zy4OӼyC\nq7
(X  b4`dPQc@ŭI
,4pƶۂ|l;NZys"ጄQ*4z4&y.oB0US/4S۹桰n[t׫UR<ӇiĪͰwPVNEu#Cqth¤pЙ!̂]x P[#eL^f&v+xOqJEZ$YjZKPЩfVwP0곐Լsǣ֒ñ"KV+.(cY75t䫺KC$&hc5zIf+
8$tQ#mKN\\yIH3b>%?8""=?z[=ǴOr=-J{ )Ҏ{9Y&4DWǾEB+4O~x]0deY+i>MJ|(u95Hȿ!f*]$]?x~#	l)ʝ5CEj{ƥ=c0ђ^4;Qia% Sp]2kȢFmO3bxj$5 4coDrOC}?>[nTaLV7{lq?Yզ?۳/fUqWG5A4w8vhC\Fy6.DrȪ
/r"<Mq9.Ξ !6dW +α3f1Nb#GY\G2	5HjD^EDu(5y0 ,yiѰX}J1|]☂ z0vJ!?%hÅYo*5lOXkyumuuv\i[?(4FI@y+NOKދ~I_soc_n,/q˫I}mL9+Jy}eq"?>6`<VVJe*snC\ѥ\r;)L˅K/Hi0Ĥڟ|yLOknk+	uL?dQһL.#cYY.zF(dv%@f~T)n[:bWCso:7AU)囍F3J>aEzGgU.W)Hh<ޘI+j}O}Ш?DoOf34=/@hl?v&F
c$0Iu%J8,%*hIsVyV_O!.'xN AN9FQ僭oEֈw&)6V!#$T\_,,ȸB"fDnȇfl#Fݣ,+]Pݿ6n՘=LcT Q7Iʙȹ޺43r26 s^7;]V*O8p7^pR? q-/?HӮ,dXzH%Pc?m l]rAv_e֪ojN~BN'+n7u+,CGsw#x<{sG:/GCn9%feL]M4.LmL[$Cf{?H*]FS҃|7]0i;_[n1`nvs*r`wQR`m驈88?^ov\ߵ# Ja@.΂z>xѡwHv[vBz?=zJ{s@UȬ;-[V{YeybPz`Oׇ˝{.YO@rqx^P6@Z܂W
R냽|/qc>;V.YϻG7_8=<|k?JA^=q^okev7봚lvw;fV06wSGoO>vgQoD[-o-?I61Y)9`+C)~4Xy(3\[;ȿݨ	~cAd.K6XMM\@gcGD?+	F
/Wk!$?3៞hxmt4t;mԀKd=h	׈)e?vwHf֭+yuƫ?ǝ-G?,F$`ֹҴcL9ZG;Hh{at`4uS@dOyQzxЖn@RFŜaXj/>"ۑSmA(<1iD;%'lAAfC*2%~dy$n@5ع=xwIx@_( ܏Co->"Mţڊyj>N}=SwD);vwI:%@ oOU6b=2<[j-חkAҴ)ޕ>|Dc7*7喝zs4ecknAvU>
m?NNtI?CR/~F-(5"D.u!aM"N7ju`^9<z{X-Yd!K)e|v=[?,^i_o6օPИ{x.+Z}b(`GXJ#I/-6i.AR8efA =7[uR-
]D1s`mhh +|ZKXTDNS38($*2!6`&"dxOrF {gbQù\Tfϱ^p!tLv`bʚ|I"j&FqtI2Cl&_W'K9'Z]|3=9'_G?s_Fw@>HTG:ug ߣKyiXl<1Z=W2"}Y8C@MCVXjT*ƙs=9cAǝ&Yz_{ZqD0U(Qn+~v䃬qmdWm0*}b[j}Vy+bo+Un/~AϽ&UWIȭ z9R:ϞjuW\3jJN׈{	((_EBݑalQG^qe9C3՝Cim1?>'O<yg7;"'9UF:I1L,0R}z^`P@@~|S`w|U=,"e3U|Ѧ\)vYWp
ۣNmZ)tu@EZr6#ʞ	;WB\K}>ooP  DB8|Q&U﫜JAؗ$XZ"Hkj$Dț1=r4ͮ<`5oe#VYlO٬:usalfa/=ɿYE%cdsO*fo*|QO>βLL.F;p =qF{ {g^qrQLyM!T:&S}kJml\3fXU1urj}3Ț#/AS%>E1'+<=-_k&ܛ7Xva\fb&pL"Z , ,p1y55QX.VPE:bgq9Y\1Ȩ՝Usk=; dn/%'Yi-`8i zbp=7_2\fKK#$YB\Cf4+pc\?:)	#L7.f|25չ\\MBFcܰj%5.-;ZĞU䗎G.-2?Ͼ=ƾêĳw'Aʶ eU6p=pn.f!> &SF
5deg_D=4VUNU8-%%)eB{fx4~Ԃ.G78
]6	C%{	C5$Lnm
DRvU܊q)M܇R_lӗ?lM`FuSe%Rs1@z+jYQO%,-`&gfj(▘zU8T^qMNRR/ ԼЛ<zw+*t$|UdpvYP	RfC5$VT.כP^`!i,k2G#+4-ӻ-b+v3<m
%cDDfvaÕ֍E0h sQ$Lk!8@
{ɹ-DOX/CrGb[ģiDX^g^BCs
ݷ`9TT"컴:wU|dA!x^&s-/7ךt̼/xS.œ,.71R|/BS$:ehkCsbh&Ǫawk571T'кS<_)Wj:ջ^0z/R79m7`ЭVQ-h (RgL0{hflBP޸b%gɥAs'MT|_x.V-=`0&kiX{ԗnc,g c{B.ۨTw}4!m? XˊOuX]ĹVU&|CwvOHQ]}}a(6&jux	#	Ѝv	w&胒֗"
 XT׼TFōr6`;x%G`.YylFI վuj[_N`ImA5{0a A=d&_ipGlIvxW@FĽqߧuUMl1؄Փ5 e1yn/68$Y5IL.qxt"@K6e<>+̰(vWҧg`8tx</x B%c5Oګkt^Sbͽiu_ga~ˇOv67\QZm~_>PZrQ@UߡBk _Yl{;GWՉؼS%#8N=V-92́&f9d80*_Ϧm(4j~FߧJBsn ;fƋ$޹FBrу;ORdaV.L)CZK"\.iC0]hAspST|o9)9:fę+=Lfݕ6_(v^J	s3+.ܱ8tu(}hhjjL Dir7n`qOH峃T'>V{\E*S)"6
rDɖm>T[(9c(Ybcgǵ'DH8Cn̥x?Q10ě3֬橂peirG"0 k"K B]0<)'\z" D4rd8	jdյ Rc7+2iQqGexYQ~+
Q)~$u>o2rX&^Bw]ԃ(ݍmMI3ꄩ ҅4NجsQ0 X l.A啴zވi]a;=R:i4k6 ٸM~WB~Cx!T*
_]Yr9|M>
y]/8JaTWf6+S*+`8`#Mlt9'1-,
:>i8~yZfK45dPΏQ{WOOј{ԄMinKS}ف/ԣߔJTCč<$NiC^gidY@aP/MѠWtAUrvSs	r;x$Q\<8,痗	ݗL45;VUgO-n ]<8P{SK ;AOCm7:p0 z0A+y@HzJCv3_W`t:H}yLBlK=Wß&+){Fgx0:A:7Qp#a yC<˅Q+cM>t`{Ӭc;0uZ -o\Sy?W{i++lA˨P=Һ~vN94a*pMSEwjKqBk+pWk'oO]-+'\4]#w+az"FGثU8 4oP#Ε6_'2y5҆kхtZM5|αsŷk =uسZ87xt=|p4y?P9l&5J1y8oj[ϒ s2Lz+BD*694
nԖe#jMVm UKRlia>so!k߅@/?y㟁o[+iV WE6	Ad0Ygt~l,hOo<M\Y%vsa0G?ߋ6_tws|6:һJ>6ޒ	kvcI2nR&v\v:>|7']ElpvFBK?4@|?^ߏݮ9|2Dz4,dk!4">zd8lDj5oh2=󓰎CR5	BmqԓYT~L7++mip8hdm?:QcwQiWYaV<; (inbX+_bYBI26zZvvOlGUY 9z~lfd1yTI'reTңm"jh[POM_G`^CVI2G$HT(?<X{kY뤶@@R2͡<LVm[r_FuP >9oϿ0&66&ZnAқ킠ݓ MX+/h8JW>ltL5Ct/p4N#y*d%o܅.A(
q5=;O6̭	umu{m}J>$yy6*
bxy"<B/#{0,L&yY}0_~o-QпRUz5paAo65;!wA&ywn+Y9%' 1@u wlhi 6V7"rS5tÖV1餺[E@+I_ؽ{~]aϷ_Gxf0HҨʗQu{ݴ/Md7xc.
$)' Nn_~.OSzVPbϼ=[M>s:ZhVu FCF,a@?EsփՅf݁{#	abb֞ħw[CfՙOۯp~{} )+(|mFoeV#Kw$h$S&Y|F+7+@Dkǽt}P-,9GP䠷aY/immn|pgHk:Gq?Q΂N|Yw^0:c	n"h> #5GW=8=u~<HA /ޣ] oAX3-!9Fyhޥr*0"GhM 1PM:'>~t䰸::+?juQ6+v)'	0B|:Haa}aA _(>>ֹ7<oQk@ԀY~9x7<Q禠2=%r҉2ᾸR/-Q̡I[[_~ i*`f\ϑ+[9ʉ9+os 9o=2$\czLwI X 