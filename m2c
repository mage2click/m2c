#!/bin/bash

declare -r m2c_version="0.5.1"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]
        then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$(m2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(m2c_msg "$message $(m2c_info_bold "$opts")") " res
        m2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_msg "OS compatibility check.................................................  "
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_msg "Docker installation check..............................................  "
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_msg "Docker-compose installation check......................................  "
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    m2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$m2c_log"
    fi

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    m2c_msg "Password required to trust the CA certificate and create symlinks......  "
    m2c_loading
    m2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    m2c_erase_prev_lines 1
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_msg "Locating archive.......................................................  "
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_msg "Extracting data........................................................  "
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$m2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c

        if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    m2c_result ${test}

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_msg "Generating private key for CA certificate..............................  "
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Signing CA certificate.................................................  "
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Trusting root CA certificate...........................................  "
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$m2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$m2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi

    case ${m2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                m2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                m2c_msg "Creating the resolver file.............................................  "
                m2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                m2c_result $?
            fi

            if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$m2c_global_dir"/mutagen/
                chmod 0755 "$m2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log
touch "$m2c_log"

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c

    m2c_global_load_env

    m2c_sign "m2c.test"

    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"
    m2c_msg "Mage2click toolset is successfully installed! \n\nRun \`m2c --help\` command for usage information. \nVisit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log

    m2c_load_env

    case "$1" in
        global)
            shift
            m2c_log="$m2c_global_dir"/log
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 Q] v#7(_G_.%^u+˦mYm*%U]MȔ]d&+3)\^<̙=g3gy5kK&" dHd2IQ*[([$3q	@ Q{l67}f{Z+kJk5[Ս`kq;!}WH>'EZ]Y_ia+?Dwnxo$Pre{}}cq$zo`+^}hAϹm8h~/?(?`0+k?Dc}uh&_koHi;Oc:$if? C$߂_YX&i/>/inFq;ci̮?fXuƽFFH!skn;2;wϙG,rK7YY|Ey~cKSw\UC%	C?& 8|ggU&ka|`L|<?j}n wAH" Z΂g{ֈ::>pЀ']Qx`؍*J]ӠlV{wi㯭ۘ46>H}]?χao*q<,3*o޸iya
<dn^ާoVd6 {E\c$9ȵ7Aޙs`ҽȼMbxXLz/+";:qzPeO=ܙd(յY%q	iOba;jŏ@Ap0[oZi.VsY夹Jkxk|n1vnWSXv1,Yt}1q?q8?\?
C>^ZgB_v鄾]tq9G,U
[wW2bNJןSN*]5_^{NĜ 0r\*רJU6]mMմ6Uӆj2S/WB]!Vr\*WʕA	N*] :s(4ĶTeEXoM4W+2`@OXU\`?`n-c=+zYi`Yj$0z}軗<7haz^n
hdn9**s\K9(BT9,xq͎I>|IYtcHU+8|5Gnny}nc)ȫg]5;z0T	kI~lx6d~av{~{rwqgT3m<?t||Q3!qw{uSZ w+ϷQjjŖ4ǹasnf#F³j5{2p`3Qv".zց~T+6vI+pfrMЉ;=X4?+7
wG|;X}`rD!tgg'L;D0g&s5%㊜ǵ%:ɥ,qWKV_//Imcsyud~{R>biJݡC&"ʛ$bSuй6p.UƬAtgykwCһ[lO6w)z[B.ڄU96HA5 =Kji#'5|DI='ݷUr͔8]w82003\P,~Kݭ6[R}蜃;_nI[-##x]}dvypswS́l4'sDoӄ+.WuQGR^Oɝ[{^vUNhBR#ǴoC	+FqxǨR Z7r#emV,(Lst+FlM-_K0]ƞO-"2#`-n  m r0ЕŏO`	H0eC?H
,zooO⓸e]ZbK{ZU9[Cdj[	 ow {8ѻn~Y u0;)9o	1Eiօ[!rf@TVyɉ_LrD}!NWi%`z}ȩՏ{yR?7
tB>{[;O{QN;{G*3TW{G?MdW9UisbHOy=*ƍ^:! GGrK8HϺ\')vYv(녬*$j^[}t|^-A}l3BIhgY|D+)ޥH6Qwb}Y;EHw̪LЉ,㚸ׇ`<Mt>,y\CרTc|'@ETJ9@J 9wD]ֻps_7G)UU;H]qOh!) VĖRM(%2;jP5,Iԁ!GSVdǝS7WDeE|_IҴB%:_~aӊ<(qe1A~>ӋCM+72sl﷎v*a ?~DsQJ$|MQt>7{T5HXܷ'ED,FTRl{^a j7tkMWo>2kx%*QaU': #g/^f/`>_^/lLk.{5vv{{o8=ͭYcbRi-w<ϨF|2Yr)y!s薜Kô8 iFl RftMWi#r{ER9+FcRnacMjwʡ
m.2Fe"nZIwuB~>IM%j>RR,hcY$*dL.Ѥ.\xZ_\B{G:P?UQ<+#;߳dP
Z$a;tXzi6=b
(D5U5e*t|){w61ƃO
XN
 i6^gNx>&_;Ǿ/Oߴn	5&.CYDBz)mK%&Q$jeֲ) /__[Ɵs)1_#J/oD5oޭjmцZZ8ῶ_%;G@I0rfpxHC%4ĒJ*$=@쳘D9PDP;9W{xTzա]PF)GkT&׺uqfN1UL\e},8Ղyles/(3
}4wIkrV,sx䆰 bp".6^ۆ{W)W}giB>1M:Z6n&U)_',r#)n$n`&gT	SF&F)MR`
?,-LEbi\,yԝ`dJdYtJTk,N}k#qhU9f
[Pbasf$cKKbLlKsf֭!UsPFڑM';tىW1dXNa6592hzO߇/zo,ܞKKf]Z]iSr OCWT,9mornbi{G\Ҙw?m-
ey7OG'Ș{ή<)58NKbUY.Lb|R*Vـk0^hy3V_Ya
UQLE(av#`}MbzrZ]hz8 y$2M!]RfAQ5aVcERqɞ::\X'99{:虊;wc!0ʇzX0(4w=ȴ!{a.PW̤1%exdP7iRwj4O4$$_`cr{kǾ^9:r`R`hi~[Л|i%8^9]nDz5 P3SnJ]|؉D=S'>~2
$Ƈ(cGD֜Ua4K/F+8jnE=m𿕪qȰy<;azo*\?1qzC~5_4IiUm;Knw&CTFzJ!5웖فg^hfηG0w][tx= LBt[@ScGƠ?e5;iXOW-9BQzbcj]Ӵ.G*>7c7k+.4>G=n>ow*ʹ4b(rϾ?`f^*@#TȻv;@Qچf<$7}/"|O@r%~	A޳恏=*Mzv_y,SD]܅J5/rJӢB&cl,$+	N̔hwIjzxi:Y0sAN}v*S^*XmLZJfH7YJ@Nts:isvwB>E{,  ,^,Y*pmC޷=pWu vu<%kjͰL6e.79v]C;ZISй7>ʄsh#=@c3]CE BK6UasĠa3mL u=lZ`PQ+fmbzfjRmuῆ.l-j8O%ѕ*k4&+[߽Bs	S&վMacǭq-?šc`0*'Rƥ۷x kT%pBFn^:@|J'T?O&),- 'f26rʙ:〉mD푤},]feDJWk =
_؍(2f|uv_otw$y.qƋ0@S>W{/;ݤM<N3.ɔ`(S^Yo+ʜΚe֭`2j{T+6SO!'T
Pѧ*{oFt8Gy6G)=bl|lԆe=юO"%g@!P#[^ѭ",+gQ12X
r]rN.2rΌha`]$cl&U_ϐKcKڢ7ʷI)ypt>t5wt\HDt&-KCsVՒ*B5# r8._	Hrf+ZO5ZdwK%2%&.5=@($#C
$Zl6݅a1-D%BifH%!QŨYH!LiR7J*:?eY\\}m4}v ;iO r+S?5PϭT}Z8O !mƃJXA>O}aͭ^ul~OR5rzY6":C/?e"G7U6ʤ 9i[&}VH%Km	WWW}jV7nǺG۷ZRoɮ"8m2ICHV0ćy9䷞Qp.13I'sO#,ܭN{}үI4ޔmrMjTEy#B	QWhkߏX0IDRP+#Xv_D(ZeTGQCAZ=ӈ{4$,@'Z
,˙oMe*KnyFRo	q0y@1|THqJ+ږ^rOUXwQ'YKtџ^P/{׫TgH#E(d`)cE\Q?"TdI:cQz'x,{il~yU8
E|Kʼ0l(XK xj/B}zb;2#/<f%Aʟd2Hh?nOn2Fr_aʭ]ŐIlV V9Ձ@
sWCq\=hxByPR45Z6@Ʋ{D~LT^C.<#=?⡂P>&Ѐ3"' 1X|b!1_g9E@&3JKr/i҄V^IUذ٢)fj"ϠҭGYQVRVgiœ\,5ܟ1,`>Q͑U܂ZH(-;DIg6
scʦQjz ~@0#5.W۵-Bc~Ҋ`V٠unbm`4<g7EGG3S̰I"_5bjv}E[AVD=K?Wad>O ~vįm˫CA_5eU~Y_KK~Wx-[6d@Rޔ7%M	|Sߔ7%M	|Sߴ7وlC6![$Oϴ1UNo|#HWFFm=|[IsONk'>
y,,$KӞ9/KrlZɷ|F>93ę	2aGJȫjb`:oIg&ybT&ؾVFĦ&.K)hDq8qG~5m6^ab䊜?%C]Ayxb ;! }wIps
0u٦X2k++ v8u.ylCzr`єJ	b")Ӓ<*Z](J}&^5sX?Lm//vt|$FҔƥf*Lnd*KVռ>R>c񡦦<˔8wGfANuNB{*ғ\debh
{I,'խ-	lEY&abZЙ/,̍Ls=NLi!oHHFj0%߭@_̉xXryr'#Rd+BhuXܑxɍ{&5v;d)"{hҕ~du\2/! BF59h[GbG3C
~r
B<ﶬi:̓5CHHB\͐{40w!M=uc4#a`#D7CD!ޅ$MLds><sH5HCqHC*߅<雜3J`0;C6Ng!3&h's:H3rW< 	Lδ!硏QWɝ1|e\u3Wz̉<˳;r,H$J;tA}s;wę|1+?ߙr
<lojLڱegc`mTnK5`0#4:@;Q<'G=QfguΣ\ó$OxT-QxaRթr	3"vц1;bKC5Ge}w>j{!к$v?YlId%g`M$UU}fvÜwG`\bzJŕ[N7+|kQk?#h n0-zr|kB\Fl-˪$rKc:QQK`wٟ3b-H-EҎ2Q-jsѷwYۖO踾ŞZ; !C:!r9&r
42w#.O4Ä+Z^ߋرi&Pc+j({!3Vj=_#+Q	Ǔ̷\~7V;<k
HV+5Ir%{!xèarۚԘf5@S`U2@m67[WgdhmvQDQ'-&V{m=ݎkS򂙝m[Yަ*l/.\fpNB,SMpQ.M^X{عgT|y\B֤RRmv*+䎕4=witDz+X+pw_=~#3ڨ[bzfkn031n27*xFsy.o6y/ +^"vklKE
-k O@;3j)6z(oQ$(Q2R{Rաwvbƥd9Np O2f4Fc4>u@|7=6rzW$8ADa]RH0go˨PGjmѨ;a׊u[.%3a6󚇠xe؇_XRԶ4#LB&0X4G֨";uawwrC~iooTƀ^DsILj7dVnoY,Ef^_
3e2\/IFn˗Ëk w|Ss|+Dhr;6шyYGקFD/G7bkpOyERGz:~h6Fɔz}{[bDU3ip^e %{ذWμ0n{GT8Q8Ν3%wE wR{,R߯m@J[/rnk%W?5^ wн
؅_߿
fwu.bC.:h37t7nBy9 ,ءW?ʁ|H۲C"^>$$"H	I*=16#qAI(4 0{UFN# ^{w{Nʑ'pM(<o/|b>٨
>S,'MqLS8\^=tGA]1p\"$̀G㐌  W tX h\ob#Di=FNzi rH~gνX~ȧ褼T[>pFEg!rrXvwi#:]
h [hH+&ȫ2݂%+]QYݒ%w. V4IT{2λgE,V?8;VJ8L0i_{'-$W3:{'V)Hx\оCDsYE-ۥ
;f	`Ӱ"ͤ.AƊ:L(B(ݸ̵JV8G֯dJ@+YUTw9ϭσφ!X12	ͳ* p};=&*UXt
JuK~Jh8֬Tx-H(޼EZ1u?(WѴ5ŶtuD2׳FE&ax[HFE52͍"؊˩Qk9p\'o-mKO%$>)KKlicX>gkHMVpiMp*!ԍєTfAIL9*w\2T~ǽy"曐[p"9Փ F
zQ*y"ӣjz'lB!1&]4q!0I@BC_yhK>%]I#ED_tU3=*6c
[:OV{wzU%+s8p\`DgzJVME6`5P	Vǣ
ؔ`4+>&4kseE?VmG }?BV2xh䑥	1sա掲nlOU_ujȷ+m_a֎3Lqnu@2(U`	&-zdep_R]Y;>(,8u4{sIL9ͳP03Y,U^Abw I"ԧɠ,R%*y~sLVc?u$^^|ܻ@/j
1kJlJ?cԛuv"BJ(C۰3]>EP]=K:I">Eܔpb6pcLIePax!eقc_ަA
#	".K7ISX/D_I&-D\B\G-܈ʒ^0|vNc$#Fʑ}q֩y:Rh.ovOz!1Jb!qQ/c_՛dZZ1íl:v&hnpͮ8''!y!9zJҁ*n}R0F&4dba_S"N*n)zSA+OVh)tXk*Qao6p(8)PB5 u4uH|QtQ:CvzAJե{$ƪX4
\a'}fb̋"kwv-؁JK-әD^IiqH~L*yS"Z1qD&/sțjl-[ʍiI,R&25JN#~*⩄G+_zW>ES["ATd*fv,NRбt&@WYTɃ:/_5iiAܫS*)Sd:KK䕪USNd5Y7d*5G7!&/7dG,&4١W;%L$ O`o7$.z-7)|zr4-MB4ɫ0%qPQ~f=de֝YJ:ÔZtd٪LTEL\aJn0'AZ2`2rc6Rt`RbL+<e2?0å$SLM"^5GeNsĊ1YJA>ZeؘLČGyL+-x :N4R'L'PlC;K-xGԝfUoQ65l4eE)Geo̑J0gYJ;5]Ne/c2Mu	FlqwmDEC߿G6{]k.n#s2"[_7Sgt<v6S'߸׻~>M杆,mqMi,VЂYu^yfDՕnq@yq92&~2wیbT"&Ree@G~9{i]U:T((?u"<Zd*?cE`R{xgMym
wϦ<;:S;.,M7Ain L+2~)R΃K6i
WQJXH!&M ;k8h^<?9KxŷԲ7aw(djj:*9Ѭ2EXP7p$P8;2B'ԴTxy.jН]_
p
@&g}7ؼiǕSx3 zLۙ(ɧͺt{ٙ֍t+TY\4ZHht[u9Y6n %&ʬSzc;tj4eW1~;ŕcԞJqݼAfhg~N9͟#pnH%;-Rm9qfޖ!`<tU6v"'Q1y3tuEAD:pdiC3?#ICUݩQѼsró-|HKD#	v Q~^[#\*U'OB#=.{Ǐ[_^aۓy~DƷOYa9":DEHh|1ƭȽWo!L6m."*joQE>i4i("'L'$3_+@لrfpt1S*A-U4s\k{.$EK5\ -{@a;r(QLT0q2:O?~$?.ε8_#V㕡
)ulN"tSxWq)DO9x?!:ů5&b}N#a"ڈiOW(59?!J513;)l޲s,F*g:;dԔXm#VNB.Х.<Aȿ]X-gӬdҤD?-ϓ˒H{d=6k5I>"QJr@V.wf=%}Q6OlܪިWANmU<fSp'eӔmuޛ$$Ҽ-ܗ"0Wg״YMZh8@cŕi\(߾psݩvߑ0bWki_OMhvVE㔭^zT5x\7^⑥/-e@qfD7-x]1s򋄣,q#Kc{m9y@=ulr8$Ƶ+쉰E0.0P/T;MY{6ڽ!XBn.iwo5]~7t4ٝ97Y2sPwQ	';X뗀O5t|~>BUus7t}Nk˹zǞ~dĴ`qFnGbs? 6~n]8!bLjrR]z|qiijj=*␑V9﬉x*;k7Mč_~$ҕª:sRo&mzzi~5GmlώC^oQZp=<oU^#r[]#2nb{I#n49c\)73#a4gbƲlZ5ci-d,kx!;СT,Y;beD7-+H.Ӗ6Fb|z[>V@b/vV5Ai$:~s?5ї)"'1+ݙD
7Q8kI%̗u?PL闯
9;>?@PʢXپ\Tw48v97UG	]$&G7a&itW$l ?[K
(aZx`Qd_{idri6 y980-UZ1"C|m	Jp!f SvQGt7uS7(ÊgK@(_.ѿE¬(/?e`S8R QA}$ [$(1O$!*񙈱 8HyY,Mm8FOiBTiLNE}vσMg33`tԫq7"өܞw/yt<Nöd'{G6{Y*1-2hQ	 #D0=K*y]`C5Usa	ڑ@PZ- ,C93eWxڑ#BE-]t|}I^2]H<ǏklۼY)LZ;tn󕂡^1ߗpBҙuY-xJv+&d3ț?uO_NtG[9S庙xz$5!8NfWTJF>D3o	"nLA4Nz}-dK^YK֒BT;{à>zCU\ܱ+_#F{|4ܸ)!>IH)2Y&\jjF$;3N
B&v\4͊ھ->@*1Aº}ѝFuJO|i>HSJL*R.g^9yțd>ވو_%+~Pn.7
߲ekLh&TKfTlm`Y+3e'6xB@Ta.t8G5GMZqkp؟̬݈.v&GasH@wq@MBˑXVǁZJJq82ݛFMvrzϮՈ?VC<bOՐ(ȓirCMJHTgtСt.	k`E
`V;uJ~ڱHhv]tNiݔNZۨL)[vӳ`>r#t\CmMRtղMAw۔3ϋIBOt(z'CUE8q 8ȹ4Mji/ꢋ1-B)k}^'df82fRqn:=RKa`5bW)L1UA4`|T{ބJ&"t}"܌1H)}wGxXUfmEmk!|i?M)]v_jEe**EAȷC/u{I^FD[KrY%909Cu|uC_c?,
WYR7mN8AH?pƴHr)/,:6pM@Y%{*ƦfmO#F5 wm[.7No=2&+		ފ[]bm)Dkn.~DvhIqd#U>/"褠S ۋSAn0"0}()*Rωժhfc/em+_S!;mqOsM%^t@gaٶHz(N#,@tuwR^gQغtq8vqt2|b>tFSﯙXEpy# lTݰl_Dؕ&@`x.F;i4νb|9+ xvAKUo8&޲7\H4JAXEz{1 ]rqw,_I9lE8pPң7Iqt
GI`_z=ztF_'LG{~+(Wb:G䝛0q4GK577F~01~AEu2~%M]:+k\htQ&:kuɏZ6b'',xӮ(h^o@]_W(2?J|΍5!up2'C2ol:ҕjڊGx4P룣tsn\I Wa&滬ykTӯ/tMltANK@ν92.&u\h ExXF,9%˛T߇Lxzfdo-KEdp-(0/5`mCk`A(/
rK`4>4;/A&h^]cug︱-IФSyɞ`pݑELx0uI&2!ZK<Q1RZB5搋W-V2xDb"`ѯ!:aܺGOETN'5agl5P;B[M0a!W+ZVQ
~Nw`Zb&"7P+QPa2-[ggTp XxW;}_L/Sӻj?P0A̨`dPQce'o\ggVR;i:*ՄT)O7$\8r+)lA*apb)(0Ym&~biB'3tbzHGΖ^~V%u2XJAQfAdEO.٭v"*iGI+3E MF~ɡ.+/a&t@(,E${Q;F<i]V.i_AYXQA ByťGSw{?	?TP3cYLK(4g\a;<	H?AD>.0_ytAS7r]a+k7IW<`v]8|QU|3I`-*ҶS$esqL-A2vMߨD?/~oP2 "A0vCt;|;ie;2ƥ)vA$vbyYˑȥiKbf:[ёVy?6g	9tѶɆvvoBYJoവMseкt#Z3=[Ӓ`(hkQ/y'~zA4Ͱ0^D.5zd}uFp¶'[J
1d<1"_pv>ZK<"yB;Oy=zA4g3,EDXz"ң\Kf˼9?c {xZ	3#H+tW4Zv	΀lH`1@Qb7ʛ'&V>Fŗq	i]O3/n1}p"y	)? 2_jD &/_NŹ'5qd:ШLe<O?dru]FuD2ԝS#* &\u^jǋ%Ce~P%-`U,a? b2bA¡n<.!]$xjFX[c?U)k˵:kVkkJ6qrlggE?IR_F_i6p+ I_hn7V0+)3=@H0N 뫫2ƿ97
QuEuXhaϛ26ޓeWƄZooj{q?Ds&&?Wm&ڕs]z0$y~buً6S'#qG2oྤJw;҇ =^3]8ިS*TũC|hx	PYy@ʁ"Iȓ3o~(}coX뻎2]ߩ?γ>L؁lcq/63q<S@є'>@5r5ԣ6rFRPu 2vĽ>|NG^=sPv[Fi1oucVC$qް*+,:*bHr!}6 `Oʂ_B9[Ci飾;p>Fth-+{NM1'cl0+Ep+C`=7qM[oom7[8[IeYym}R	<>(CU&7t}--ǽWYk[5'<a%G]F2W`:*o'(VsS_YmYPzN'즽TRN[O嶚">OZaJqT8hEKl;_)aOsMq5&߀wc_؁>s
CFJ<|[hOMSo*Jk0 r2KE";<:\//ӻ5^B/:2~~w>tohhY[GG[J֋ݎC5ׇ>IWሥʽl5˟b#~u xJ >?I{Oݟ;C`wxz녥ڣ>-4-IrzOz[)s}լtwY7ӺvZƧ~:j/&|9[N=iϬ[-Co=J:	iQ@ӆ`]~~4tDy<(W!Sl]9Ⱦݬ	kA,,sK6X-\@7<H &ۆZ"MS3@okgqn`EM	{A5K	,W}pȽcXs8eJY<5kJ9"ܺDBݽ~ k9kФ+=/Ꟍy1z9Жj@;nDxHfq(xI<z_}OSҁwLGa:"%#+HffÚ;)wW"BGZPl@Nr7+cz4Q"N_h %W(TCjn{DS'0^g5є1͐&*𥽱B_[1y|l?vc6yYl٩f՞s*4@$ݢAvM}N蜞zI?XCB/~J-(UVfٰ':CǇTyf.#'a{>YPJi=|OuO۽W6[$+Ul>{Bu4JVoUES Z8;1 oK*^2˦q\|P ݑ^Ýp:Y9g]nY\y/m6J4>
[h`qT\Sw(ICLȺݩhٓ\A0|'i\ThnA8:M}
BHFᱞw)tv#X`b\PnriEӿ/S+C?_S37/	߭Wz2$<S	B'AI(b1m[OeD4A[heF6"Nt=Ð/N0ʌM1Z0Va6o[2\"&3?5i8AG>>ɛhͷoܚ??B͙dC8ѹj=\΄
Y)BQʵtWٶZye&5f+dmGŖ#Љrg=t8pj{̍=Ɵ;g<S&o)Zcq<'8bȜt1>wD8nتT
u C`DddBTZM$N84Yo:}D3PLgS?ShfۨTN1Nv{0;ۨ{EU~A{uTUqKN㩄&QAʀxB<;B\ OG$.1MU#"RF!`ru%6VY\>~vW7%Ծf}ޅ/cT5'c?ğS73Rۂt_-3qщp1w_~sͯ1G	i~Pw(%ӴfZ0»3#L#F]AAfjsq@LH*ȒKd,I/'1qB~e)-Jܕ@]}C]}5sUyS)Clgơ9D&^[nS_ZJ~U1
I[t9Xe3 e_@=<:aWgD@*`.*<L%YcOlRofO2ML\jLVPIqƤo2I.>2!1gb%f(&kKQVl0n_"gE%caYkݪ\7@"B;_ y+jith3`nlΛ`骄[bʢE$a8 T^)Dd~셤6$yV^mt/j0zQ\FNz}i'Y*d; ⤌!3mQ1)͌iCns\+bGGLk7kA`h1}3Q5Bw_8хwNBԉ`
}D'[9vd&C|@r\vD3;}_#EⴒfdYJφ*y83J*i(Kj/mh< b2[]]Yf++&icVsx,ϝ͜ᔊX2<<jam}N7SˋW*	W(Ò+Oޜ"P˷fRk4QHhݐzm:EE\Rs+?}o-MϏ|O띃M%ط+:Y?>y fU%xY>~)]hd;kFNY]@	L.EUe&$wZ$XW[bp!B< IbD-XiV{ؕJ5#.?yy	fj#bMOL9[y"P[	3V*aɻtw"k%=^%L!F\DƤ!hk~2Ge3JcVbu	Pf쏭C }QtV }~67O<fV;Htò$LR4QwGIzV@F䄸qu?uU,U6e1Wzf-&	mIm{c_ߒ޹ץ״sCu:^XzM#wЊ3*#t>cb9ö!#r/,ղdE\*aF9n^[ n?7Uv@#"~Yژ!\"iT][k~	_>W!kp_XI~;{ǍW(H։B`Ob89qJQ63<a|͠z(R, (83u\he8<z]ո=MiF^H tT)KУCĆ}ǚ5^xtGw<8z87 &N	7[
24_.p.Bڶt%Eo$sBTxLo1V9)GDđ=L>l"am8>LiytŹ]עUנj0)Tesҹ}Y_	tBmv@**OШ[
k7JRJf9.QQCdLl
j]rn ˣ:AbzfHm\Ae"MTYv:hN%?;*>kkNn@!rIB襖& 쩫A/'ج^p!4K
!p1eTPOd3 XE`,h8)*<e5/Hp7j+Iq#st$:jWNX?Q+3V	50SaRD
VwQדLkUzZIQ't͝il~wb0fn;}@ł`IumۓΡFy%^ġ3bJW?'B:YdӅ8.Յ	|ÐUH	8`PBSq:`Xuº"&r¸Vwy @zQR Vj7Oɛͷ .=_	V;?A\?a?cvᠺVC%T	١+T5'hEAk
5ay4Uos&+'\JƖX@b?L#yǂCV!#2c-e~i,N"9[NNդJd]Ŝ;M(R1K:A<t(V, {=-M}vJ`tKrX:0n!5!<*ANY>LAy#^$3N5:^9W+&B8a2(+L퓛Ƌ-$Is wcqU=O7*
LKSp(u>S,9=/~g.r@_0_N8TA^EnXLjlwS[~ö:2G7(e=zt(ίbLNop]'Ie>Cr..܍tq?9~|#\0<7BA]?ތ\ސ2fND?^Fr;XvDzLVYdȔQ$ٕR_eΡQ{R&4XG.`U)XJs=OIz>-.ZaìfNx>&N~i/ۗ^S&T *OK%x&jIݨAOsV{$/5Z]i77I`?<D"O/z==Qw5:^::<8+:@>{K&j__m?yT)u^j %wnOO/!_Yɞ2utTIxnĽ_\:UzdunhwTIv'ۖVңU>$Q$l*dV}Cq%)Fj5g)4<Üp?*Ndwĭ3G
ICkoVWW6[qAIn}84FEy
z^JqbutBi{XHSR|u/ԋe`'oQa#UoMO?ԛB^'`fsbË 'X)J}O^Kζy"D<k3C'CdS;7ӐUO|ִ5Q1Oo|@}2Oza.+T&B\wH0%t)]*)}Q˸_hotv\7_XgW?+MZ]Yo7px<Hz.=uX|aQ y?on}FzLP3}qܕ٦{1=m/lҸ~jΓ9S1a51ヤ7='=V76&^sxsB/Ca8X=ډgw?ޏ.^JA2{եjb`ߨm*b_ޅ=̓b/%/>jiw`Dhd0˞e&; ӦBn10
5^0j鏷&~3 ;<vÃ0ks~4-9׾QE-r߇DjZc81^Ay\j_g!5db{vt-X:\jNVլ
#q՟9})B&roU[A	 (5eXv)jtϗY~Vui+QȷRРΥ}7J;KUV?3aßv^!~}(Д(__5u2[{ĒA*l)"Q6UNM`@^<ݾL,#$O4ٶ6zq ,5#{Ѹ֗޹; `ːuy7y &ѽ.rst /io;P䇍^fJzhMe 60d΁%=C{9e ټK/
T<~E2 fDH+@&߇&n};`GiɌxQz ^9K I?-xErP-	5a,&:*$.s?XoQk @Ԁ%ͳ d7(<QJpQ1Iści%iy@\:e9̡IƆ[Xy T05gؕD5wlOczL1=czL1=~$0 X 