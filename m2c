#!/bin/bash

declare -r m2c_version="0.6.1"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    local text="$1"
    local chars=$((${#text}))
    local cols=$(tput cols)

    if [[ $chars -gt $cols ]]
    then
        text="$(echo "$text" | fold -s -w"$cols")"
    fi

    echo -en "\033[0;32m$text\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_dots() {
    local text="$1"
    local chars=$((${#text} + 3))
    local cols=$(tput cols)
    local last

    cols=$(( cols > 80 ? 80 : cols ))

    if [[ $chars -gt $cols ]]
    then
        text="$(echo "$text" | fold -s -w"$cols")"
        last="${text##*$'\n'}"
        chars=$((${#last} + 3))
    fi

    m2c_msg "$text$(printf %$((cols - chars))s | tr " " ".")  "
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]
        then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$1 \
          only_y=$2 \
          opts \
          res \
          text \
          lines

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        text="$(m2c_msg "$message $(m2c_info_bold "$opts")") "
        lines=$(echo "$text" | wc -l)
        read -n 1 -srp "$text" res
        echo
        m2c_erase_prev_lines ${lines}
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_dots "OS compatibility check"
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_dots "Docker installation check"
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_dots "Docker-compose installation check"
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_dots "Ports 80, 443, 33060 and 53 availability check"
    m2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$m2c_log"
    fi

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    m2c_dots "Password required to trust the CA certificate and create symlinks"
    m2c_loading
    m2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    m2c_erase_prev_lines 1
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_dots "Locating archive"
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_dots "Extracting data"
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$m2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c

        if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    m2c_result ${test}

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_dots "Generating private key for CA certificate"
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_dots "Signing CA certificate"
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_dots "Trusting root CA certificate"
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$m2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$m2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi

    case ${m2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                m2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                m2c_dots "Creating the resolver file"
                m2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                m2c_result $?
            fi

            if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$m2c_global_dir"/mutagen/
                chmod 0755 "$m2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log
touch "$m2c_log"

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c

    m2c_global_load_env

    m2c_sign "m2c.test"

    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"

    m2c_msg "Mage2click toolset is successfully installed!\n"
    m2c_msg "Run \`m2c --help\` command for usage information.\n"
    m2c_msg "Visit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log

    m2c_load_env

    case "$1" in
        global)
            shift
            m2c_log="$m2c_global_dir"/log
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    ! m2c_in_array "--help" $@ && m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    ! m2c_in_array "--help" $@ && m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    ! m2c_in_array "--help" $@ && m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 5] r#G(8˯.BU&Q$$NW$5(	$2YTc>cv^`vkK	YR7$Ȍ{}5~S\_]e?)k-WkˬjV.J$b 4d;=-y/>'$)ǿ\kDߏzH`n4ˏ$_@	A yL9+my>C$qK(LU8JmnkHY;c{i$Yf? C$ǿB㿲8^uu4i_[]ueq	=eWјi.0eX᧽F'HE1+~	;svi MX~8<H($
g' >~$}h¨ƛ\[h~>/_Ve?UyV+Xp= ]sBr=x!g^&סѹp4݄><JR~BUyvP?pDekKc4Ƥn}q?Dxi|!L{S9OQ9Ϥva፟xVY'K5OVV1#pxvhRO	o޺_{~AσIVfƇ#6a	>L0u8\Q\@uW>p璥_otZg8"}'^r`_  :]7-4e{r\^~r5<5>WV;	,K\,9ƃ>8WP!Q e`ah0Hλ#v*vUV-߫v%iK|/%SuFW
]5_^{Ŝ 0r\*WJ*U:[mMմ6Uӆjr wy:L-dT2ULU.SBN 5ZљvGqW$*@-`z8~o:ťeZY }jlu? ?s+IkJRHa׷J6uu_4`_-py]ϻq[5ME+|,u<~PqN=rP$.|=X=`k>|,1|Xm]o$DBA>7^?e,G鿼lou}m3߮	UUZϺφ?(Nw[/vw^uv_>5z{;<z&?lu7~%4^|>jyYm\r89c͝w|(xV{Vl: 0y:ʎQE:Џl%q9{Y\A;fQ<NÇ O/!N'w$V"M\!'Ӑp3g'L;D0 g2&Hs5%㊜ǵ%:e,qGKfퟛ//qmCZFT^}Ӫc?!MnE7-I6űwe
ޏ}XYσ<8Moq9#w7+؞lG*2S۷xĝچU9.HՠZ fmrxji#/=5|DI=ݷUrLqp:)7e`>wqn0Y ̝G[;[?n47Z7%}蝁;^	nA[-E##x]E}dYó -Ӏ́l4slӆ.WuQGRYO6_tU5NhBR#ǴoC	+Fqx2-Q2n4JFB7V	3e۬*XИ6V6>y;
M_K8]nH-"sG(6Z8+YA`
G
m r ЕOTkdrӡJۛ8YbV}V6Yx+"M~U@2K_Ec񸸳ܞYS\"8m&aT ߪKNbe 	v/*y}A~}I_PL*ҋo.nn7$UlN\TPş7^8gTeΉ"?lv^?zلɅz<=ܔDmzcש$Iz^u+>UkQq4v0szF'i.T3.ValХgMֽ4 ΃zG#l7*{(5ΆUh
l&zjFbHyz)(x.[(}x0@#?JQ|gP\xgJ"?#tC<L #Ԅ]z^xXO(@%>Tn9#tт* SM(@fj.0+RI[`CfbJPP7ׯe|V\+IڎҴuo}H9>f^O*b')KƕE%Otׇ;qd<<m\a7ۛGmB_<nPȧCTqDIo9'>'Ѡ.U6,4PB"^#*oRl;^zRM0j+.vk0Z_M(MXuA'zs5Vϗ_!@j=>W?tΣw/KϞ&w_ao?7ώ?kOk6FF.2>:X>L)y
%1'VHjq.AZsțO>T
[X5m4.ը:6wmhģ?i<n
_+[^SA( R\ًJ]S ʍdA4B|3l#Tfqo Ou ~261XU&i;Rw\ðiT
rc! A^C1x8Mb:π/`&1kCdAzːy٘l^:;b/?a|C ;TFqR,R*#iE<jP3'l6(~y	zTp_#Z/oD5oޭz-ц^84&I"~br[8F~(ȧ0{!AwdI@'X v1L&q *v)3sXv@W	^ׇwAݦ]~nTRgHZ'Z;OR17rYqR-
X\PfphUg2UڌrƮ6x ރ<08GvR!2 Ͷ{x,M'fJgmܤK`S!55%Lhߡ;*a)8`2),___^g؝
LgVqth1CCP&HK*9oJ2fD1F^17.Њ1p^ n%6hF2$ĶD;h݊Rך	5iDlS˔x,c`&G`0yw/^$;7Ңw~-{}c
ˮX&nuUT,EEؽ0+a9}LTmMp*<PHr/.Bg0-梒TXO4,@rF1(VY@J5&,b*>0]	3_=;Y\%T"]*Z`=sfs,r{~-{rt.P~ (}uDIWЪo1\rnAXIbغ-pʊ{&蹊~:B(qbH\wFA&aÐhAsɼbwJ^Q]H2WI	yX-'حܘq"ry(0R=ZZ T&_:	WNw@ĭ5?PJ}),끛H~;yÇ/@HnnS|R~H5DniQYIVm4dFE[Z'Ц3Tt/,nխIYL7-VSuQ~\W^h'jjЫ;;pLZ}&/O-i1;I&vF#r:,o#c0y4ugӂg#;qZֵ"(N㱟7Ý?nv7_u6:op]%y3a{#hfޥ@#T2ȩv@Qe
ަƆf<룧) !|O@50%aAN恏)gJh v_9 *+
WEVx$%Op2k Ed!yHp2e&'d%i;m--rU1N?E*PA*V▩- Y|j`u5rB<E{+ 
 ,}=-9Y)xgirBօ޷OWM(-"%kj2O>79%6q-e0\-y\]`mĂٙ ̂I/ O	)ٟ!21!xYAxNi5agU6RoWl;=Y%:3LDW?E5ajiTaz.DeOXƅg&Z3/m|]UF+Pi^bt%XE osh STwJ]c^DP$2.\}.<H Ce-:	u{rdCw'@0akҕM:|u!ˈ3I]=A+B&\2PCa|U
vi$
vr+0H)QS 	0dYINeQ@&-Sn3'%Sΰ.4Q/IV+//c:zК6ߘ槹~@i'l@a
#(@"!R6<c̟3]&P5C#ڱ@A?r,( `dyc!77=L:l.>9ih	bBo߁OvK}UT%8,<i9WS5,D{pWJX~ل2CRiNz=AvR^kT3o5]̳"yt:g;<.q$:<W̍%	5O݅rGzIh~!v}j_.t8.	Ș,3WdF`dkrzj'K)d)
 4ny{e	-60֘!3(ePz=й:6'00۪7e 6ц 	~Էm^=e.T}`6l}ޖc?7UXVoE^F{.[D/6 p.OI~8Y[ݓjTՅي4Z@/o^ܸ]pSߜ<I=<غ\*݅xKnu4Y4&MBs҆uzJLrj@{NO*vY)H/}$8u'M>hZy%_?M	Jr}6E#^([/R7<{Xqi@,_ZJ{#?L!z"Jhi)mCOxyp\<WMH\eYCz:Y2S^a4#HB
D_shbTqPrV tCiK`.ħ`Uč^y[oR\5d[r7 \uL6NN*v;'KsʥXLqdPH C:nE3jv+$
 P\ړ	#$'ϳȑWK_Ste5J(Ѝ-D$
^CvW_}B8|[Q_S)j	9=
i@!GRfS#p_|^OhL˝k#7ɡC#ĝw4dV^xJ2?)ȌMerFʭ+S g"wTDc aU	zoPa샅gqeh6	TApqCp$0-QBԭ	bLfC`,aǾ"
,\>;ⱆqMIc&Ѐ7""	l!g4bOt>;ҡy'F#Ps\q("F(
qsR"GQDӣ(">"DDi (O{X_9Ǚ m>bᵈQY%Q[sUs+0ʦ՛<QXga},: Р]l[>*X-<JeԩWN):S\0j.:0&6hf013fl6E|kEeqYD\%1Bd)Rē%eLIURƕT%E2dY;W+/ˊ,嗖Z"m&dUtޔ7%M	|Sߔ7%M	|St7وlC6!['R'F퀘
7R|eQ|B}\}[WԷmY}k֯VU}mՇ]TAKeiei,MwyYVe] RTwg&lPEl=<F^U 1~Nb<ǾER`F㚩Yi5K,(ǝEx~%V7F_h'5<-dt
*Ex]l_(v9Ic9De*Ylg{^IbɤyiHXXm'k(c
ԗbVf
g'5<T"PMKin*7yKlG`$1Iq-tJ$Y3cY۩2;vԓC(9Ӌ@}䳎K."+x*,$>0Lm\ŜӷU'^8b	ɼnT'+	eY&aaԙ?̵٭c{BFHFE<jPQK/DB,=Jal)}Tc!&~P,H}+µv;dII=4WpEQESҢ%;6]HBۜ^nEV0ƌ͑xٻ-kN:˚x$	LE$!#=@Y໐~ߊ4,#a`*"9GD!#B߅$,uɭ"|$LEgHHC6đy8oE*GTD0f8XG[zr#4p.E֠=z9ctxr'}#Xp%tWӌa&s"uxyxv'юES^iC)[R}P}q&_N&O+wf:yv_ti [7I5[/X1">u6r(,u~\՝ͽe"b5JL2qG9F.M:Oa`vDZc|.	y;h4ٽ1xT茬ng~u
.HO)x6ك'hID-.[*Uf?vͼwmh]bzJ;N7اK+}87Q>#n4JT:JwMVGMA"YRF7}gi-8GK2'nQfj/9h:U^pll't&}Lώo0j6;2皰U)$&PtVkm㪫 j8z!L7j2*_FV8*{Y|/⢅o
y}V+=MrUQèe6ۚԘH@Ӕ%:`Ur@m47Zn{z7	,'ߍ^_oDY'-6m&Nk3kS37,JQN*̺C(}=;ltvKϜn5tnߔp2J'n&n犖/ya|
Z܎J7QOX&wlAqede/- Q/zkOTDSutY{|M
O9nXvk<f,CVZ_<7GM5u+lO]$g( yBg34=mIС#Qe&SAVf߹=Z7llFl`e(uϟ{YڱWSF1z'_J?_yw+DحI2N޵8w߮TDbo˥&jmѪzq׊s-/%3a7󚇁yeR5_OYԶf4'B.~YZ4G =t	ғn^PCew=/N4;M)2Zl;Ǥ.N2KaђBQHi[kN>eY<^$зY+w߅95:rΥg\ohDAZb+8Vu%ixCwŎ]Aȱqb/:Ӌw;7EQÝ#/I.+yxO{(U$Æ0tIju=8<%Q,ZI}+(+fW s`e\~4,lE^x6zJ|Q &?]iٷ^] Qr^ e>lA95۸kן^tiAruOA7wăz (R@%֖!!iAҾHH艱hİs0 U]i\ y{+g6RBIXBi!pyC v='9WB%]PeN=PЫ(LRK^[;C8&; wè_#EB}46QV cs`d( o2;b)j,&U:so﯍9%:Rwi#8bƆqA	hyRؼ(2Yڕ^٨ޑ z*kNyS/jg)Xy;E&b)'8YRGq0:#l[v2]&jÆyJ 5-xU.$
smWs͑O-2=*6<b z WNE[X%7;>ᝅ
b*ֺq:@哳O~g$>e%w NI YzuߚD4$3)N+c VQx4X%үfY,3s^\:K9kZ@`[HQAa6Ո,\lϻ婤*X4oĖSdU
Jd۸ɲW3p<FSgy&&mP%	6=ADAq3ZP˻J"lTtyqj=Z-'$Zu&[ p|mEy( VW=_Tj$D@0#[GY@|-Kj^Mb-CyqA֢($&
Wm@jaj iV'4k䨀FS MSt2M2datjQ6N-e1U`D˩&z;ì&8T/R%omN|G,T.ՕrO{-OqVcu`>┙)b$Ux/hx}YՄ:>>Zb-Ur24WMh:|Wd?/#({.2$DF' >a̖
	,;oWhn@Ux)xњ|U$Yu6~HAxez68C_rBe'//MV%^|_e2 j_IŻj_kuHQܭٍ6q 4VmYW:_o=U}^_jo|oAkM$̂g&ju56Y{`F67&՞4
"Tqza_?Zcؒa&PSۭfa_-׭QwU",o+
5AIeM:hSDj}E_%4:,e$8 
Ch!$SAۆZ8K]V?
*(TGSOն2vӫ3U]z< KY[tp<J9	w1=O]n`펠b$/I+QLb'\N蝬@cRy[to0$WfR@~t|騇/rFjRhP^oȎ1^&*k6}]"XQu
CVũ40 ]`@ҹ,/8><W^%fJӴT"$,"{u,	ٓRt QUz*ޡ'ǁL6´㸕GDG&L*Xk<6ukE:גOOEŵ*
`һ&UǮ2]zZmkςu^wIaM-:DlU&(Jw	0{*.NK1YFaX== 0Ml*f&0&&ϭ52LԒ2> 'KoZH#DYOrDbŘVJ2NlL\ufYb#<o	ӕY &X~gFCnf(!)_MgUoI>psLR9)+)OdU_/_kZoBPLpb5yo9(9	bNE&l#qӆIOL[P97
|xgSOj;*mrNX,话@~P]ХU`V	|k<;w}v4R<$Nm{Õs"KOanbZ4\LydI7)wC? Lhҽ=,V)oÿ<e2N :O}ʑq[YhbH$,EsrԌ^peg28yBWӼZBN8_6><=iY\SV\Mltgni2Jϴ	iiNk[3FyW]Z{dL4P)y,rڝ8=myk6~Y_7D8mAw~|:«})1h-'Rɹ0P}n	ǆH8'#_vM>A2LZŉlp'Ѐ)z`ڹ{;;1ZE嘙ș;+ӞJc[ cۭmS#<`Ǵ҃oQvuфwBϴ%iȝMqW:Tķ7|0푳Bh!qGT}}˽l4dφB},]u6\T\đW1x*7JLWG5FV2tVB:9[/0sW?ŢRħM\ߵJiWw䶮vnyFS*[6~)8CX\4J,Z4Hht-[Wsn?΍J`բgWWXGNwYXdb秕rWWL-G1eF4yDtFhQl1d^^bJh*9̉3/Ycآh'l[EfnSXOg$lD!ZM`ʟلPn@m5/And4|J$#		 Q~Z[#'*U'{U77=qV~Hnn[4	#n%7".zi𿕪ADM`_
NӤQ7CT>(j^$(.Q60	Ы` y\ 7ھ}2&y.aݧK(&jbLTMȡC	@rp甾]'zdJȉK'r=x~{}G]w}M-k̳g7V6<]Us̕6AV抋P`XT9C')LS󦠦Ē.Jn
047?zr>ɓ(4bòP8e7.~I?O2G&YI:uBtri}Ks&Qm4έ~zVţ{j6q6MVY*mLbjMbh.[4s;5j|Mkp`K[SnBtFRk"fO[^xfQb(ED^OM}8KA\#@׼eCu>#[_9!$£H{< ˉٞ͵iQ'185׎	{ԓ;Ǧ4E6YqW6( Cv!NoHlsh-&Y"FQ[1IQ; )*C~
3yճ-ywud:wmDWa ܂+E;#:~0x	$sւ`Ѯ۬%yj9
MxNh y6Z\.kW
&#KMuͱNd?-j̫h²ʺ=:xٿ!jnҒcIFCؔnB`9"dX5"3ݐhpaDY1f94_d(&gѫ{ΦqXeHlf	Ǫ@;I*}2Cxc$Fa*	;9sRZ..MB6Fxދ@`'A(cor)h wvV~yM@HxdL~KpUUL$LeOW#qwwv~T.r5ԶSoOG5Y*i@);NT*.Ȑ0QSoo-K%}avI,r>7oqF-ͪH 77i\t9]ќ*l2r]ԘڨX>R-}<ߢVa,φ?|s&dZUf9 NRSI|咸M2VDotW10NdP<f!8ѕ8}'lX=fcZ͎uNpӀbb`\#v;ul7b9Y|L^lϊQ}L- q2*U0Guv)a t4Η<9?!_~A sr%lЏQkPzLG`ՙ_?\LYo8"TpPG 5ѻ:PoZ_/1IQ蓼}3Â?a6w؇JPaU|K_tnaKԦ!ׄlF˽D%(Xl7L̼_.e('s"{r~{=`'˭\p*\'f鬖|iUkF}6~]"ua?/lVDt?~?;t᧽^Fߪ8v2VgL&t*i!aShbOüiĢi}s4(!J`svJ#MD~i54̽Eby,sЋk>鮳)w&ܵn	_"d#v{S	,]	Uv۔[ Ü$A$Qk#mi'60w~~~v8s`lnzH^@aopR@wT@@MBjV
BJqt+ rݛE Mwrv^吜Tr[ꏬrP|DD%F2o܎0ѽҺS0^j;9%vOdtVÏ7o肢N3xDR%gf=W woOcxV@g06rG9XktVm
ۦE>rsO#;10Nɵ?_'_G׶lWK|]`Zy\J+ZĚZ_kFyngWf5cJAфQ]2:'MUMϛZ)4eDDLebJ^/{ Wja<7xQvx.^}uG>FxWIUal?D|Yv\Y\5XGCN/vyްbPCwB-|<:~G]Sp6eI 07nh=՜W8\#/'V:gWw\j56b:XY]mџFj@Wy7~?no9*X	ΆMl$ %$In,~@rhp"]:.ܰZCk(Jy6$X)vBRKժhn,ocW\ϦuH!cAVAb]IN~$ifcmK`^R4UP<RK1.N:unW/t
<N~?#`?:UUT\W8㐄M@t7s7gQXK: u=gA#Žw4gAz>>˻@Eeōnaʤ}=XZAX=Ez) p#
,_S6k{{sǉ
/s9GGou´|=̦: '\G8_	,
o+ovɭp.&]rݮҸh2ȟiI4O_?{*/dfR֫hUaњ`ި5oKz=q<5qBC&EzY2s:WC+bdbE$d)A86T1=4FfE:Bd*밲A禝x)dl	)mzQ˅@<Q䍄!L<h&? J_:y_5]FS 𰎵rp\WUX1,M5X&5n|>%fZ"`&#E_5C=OV	ωD|
&㓿Jcėvo5^wv[2ʞM7#퓀N$ S$'4ۀuWy>,Gj܏1rU55{gB֦{ fkދ|z$ɝa% ΁QC ʉ2NnGU4@޿jcAOwR-ulX8}tWŪM\L@5wNJ0TCNbؙa!g'蕞8Orru>٧'Q (`4aCAFM&y(xku:NRnUfXҲ8ersj醓Ua%-]%N2;&]ބkan#_h&Qs1CQ/YH4ҫWy:ӠĪͰwPVNt#CqJl:4adj8wf.<Gho{o2&~@ρ0{h8TX-TA^jZKPЩfVwP0꣐ajcqQ\kuXh%TXֱM6 G:\O4[Q <WyL.cO/}_XrM:%@F0c)8ѕ|3x-*s{pL-A2MߨD?/oP( "AaaطpÏiaK?ZT<.{eY+֗i>MJ|(u97HȿUH~x/Fzh+w֤	ЪˎFKzsD֋~iJ7N6$u#곮7PӃ3=ٚbP!km{ | ]bbmYZ>}4Hb-8ly;SQP&"=)4nLa78p'MAgsi;]ƫV㮎j3i-R=q=І:m>].ɡUE^\@Dxƹs]=EAlCʏm(Z @)WPqcgIkFc"F&Y-4*3bY\G2	5HjDYEDu(5XWoddX`z,o>S>XqX~pp[>6҈c<6*5lOXkyumuu@\i[?(4= WPT&̽)Zo/>C$})Z=17+m,Z |zU (IFk}K'Ra-^v`J? c=90a>mLC$<EX`RlS"l2]zW5mGrXpF!vCd#sA2B~ !3zKI|-]< +qGuxѹ:7AU)7F=G+;:wI^P~CG#A	nG'0UN)}alG8{џzdZ=	.w{cg>$cP7	y*c^;*)q5<<(Jػ|[18I_VWkېo?D\_,,ȈC	N"$n؇l#,+]Pݿ6o՘=LcT I7I~+߹F4u26 s^7$;]V*O4p7Ypom8"M;`Xa9&i [=e_/V~Sq"~s҅n?Q_pk[qHt4Gz;+7qDD1:~jrt;6Y2oZ&դqO?qEulo/7IQtJ~/F>?kk61՘\ݍ|nN̙[0J<|;=1$G3<Ǡmc_+t^}L#$9BYP/7_/:zѹy6ێ|W(SGgC/@vw
zyxO{<j/,/6_tQ^p[=<}{v:K	Xn?nP!zR_d}{Gށ`rz=8zQ4][iVdz[+s]լgt{Y7ivVg6n:z/"|D?~k%$jYkm?H*MM)[؟=mXJvwO#ԏ^(S bcyk5o:mEaaKɗҔ+w00}Lz`0/7WrsV?DgfsnDH;MSp7%y~]Fu)A=_qgяEKk!u4-y)Ѭe5\"Nwk?tWе5hM=ٰ/ꟌyQa=<hKM]F9"<m]\bGNJ6EfO_jǤt2QG8Ȕ$˲ӎw[^C»K`]+!#~-X@6 'ހ[t}1=D(+Mw'[k+v(=H;9_`^L쐞%Ct0=WY{4exLH kZ^^_&GI[A=A>vXq;yYn٩g=Lh(ÁIEn}N읜;,<H_ZQjZE]BdÚ:DoԖ r"e[Kŭյ4BR{fݛ+aiYzZj{_8"}FămB(h}G	烕f}ުد#
c9}D.汛oK*pfT:.>hYY8(@{NdymGv˳B.a1,/р<g6Xve%?
-4V?8V?;""e"Jx%nsh/YqFM$Giex.5[nKNAjѳBNnjхk7 (,>1Le4Z/gV2,={/Go]r7?cڑ<7go䣌4	OuFyH84JgMSmq1En#}%,%d=>YL0dF<Uѿ.˿ʟLBMim28j	7Ol$#o}MgzN dRp3flS|S#`ZK>{UHeY/"ڔQgHCrRPيFbf4Er=6ѯZ+,[WVT.nQ-Oj/k,Ar-5ɾ?Aǂp1/	bVr(-)"Hkj4fWTS7G-*3i]y\tfpF@6pj16'DFkU;|CR~SYv7"#!wh`!o\WE,X CnF5`?,أ?t:(Vm/SyS#|L(Ja/rgO g,b0LصNS\Xm }#Ě#/ ;.58&+<6-_k&7XJՎ~s]̄fI$KWs[P2;kM&rkGv%tNY\?~vW72ngq#dOYۋah?::/kgo.0@u>NsKl~iIDd8JHKڽqCf}43~JVCZ"9y>!{IޔrZFТɽTh `B:0UC\HD ˕JJ-bٍͪKGBc~.ﳯiMj/Šjo*%!L<6C@jcՖݦn iV왒a1q(>b2w*Aߓ>}%	r@5hIdX]Tu(y.m^[k{fx4?Ԅ.G719
]60	C%{g5$L.en
?+05K_5y]LS<Kz/ئ/T?+f-[ZFʴCZrtx[YVˊf
Ђ_!٪ZbD$a83T^țDet&)(*
8dhYk\Ye48	:kǲKKp"H<X."cbY8$6b>C5u,	%Ĳ`@n|.9GF,L	l^r.]D`[/N--I(2Fr" ?z>B)vBsd"hfD#<T;B4_Lig2a7ly$2.`M1FOP2	=zhcN}TKˋãWj	W(/\`xnߜ&HP7vYg0XHhݒ)]qVEE|/U-)Wj:ջ0z/r79l7aЭfQMh 8RɆb`v90,7̌ĞF42'W,>x&*F,̭kP~g7%Z_GHx'RYFd]N}6q/9op	F}G>Yh%`&BTF;uYɩvI$&X+
.|""vDQOCA6Q%linyg	>3R6ָkT&9#r(P)0}-~0ވ6qS#Vb|"Kn3	^b!,!HK%=xdodzdJޟ]}Z_Z؋9x;^۴s;6]=YFXFфFYũ`Q兀^/}bNye2%}vY\Nh"#l$;VGpE&>;g.l~1xދCh9>7)ه)!T0N<VA'1~nL=+/sP2
41z/G",nF}ܣ+W-y0"_YɌ{;GW(ՉزS)yGXS*[<t)<1;BA9L#Gl\T`!{wY;0{
w}^_#S@8GAǏ5^'_5_=0%yPwaBq?EԺ^WvMkEj׶ӕ40:cfxY5iGh0Cds0z D~qox!lPLYw\^܇Vـ&.5@I*wh&*7 TQ>;
7jVe*e\BDAdQX3ٲ-upwXe1Ze""T}7R4S9_;$e]F5b,.KkՊ tcm9^P~:{rXPOd VEO`d8	jdյ R8A4eո9|Zvam+^a+_?7qSV9Ń0S<aSz	MvQt75%=lv6CJ7Y;MbE>bA͊"D˺6Q^;i썘#uG<]Hq\\X79y)' s.*bhWHK"EWAPy˽Myjt:1 b?O&(4ii|jo{xZ-P.p#%`'cS4faIxDYTGNB9MB5A\A GZP^g	,0.|SOhN6-PaUĭ{\#eCNs<܀} Fl{.6stŹD+~M3ݣo_3Bb$\T sNP8 }[LzZ 
Hƽ~\TqȎVظ*NAajsrU\dOS F4{qfz\fb
n2It74_2q7p2
S!֗'[
v{ u5u'SI
EI*㪮kW:y
ULp(M>.]b9/~kr@4a*pMSEwjIqBk)pWs'ogO]-#X4]l`z"#*
STAYʯL^vtݪVqrB5s\5kr}Z7xt=zp4{?PY&5!ϯq|ǡC}a$#3YS vX2jt(*nT{mshFݨ	ܗҫ)XU T	,ɱgJjM-.߾u.~lLRϋ"f~/_]I;Ͻ*RvI n'K3wPc;S&-O4Wjke\OC$bÝ?nv7_㭣̓7cG~i_irkZ{݆aRywYNmw:=\, UEPpvFuBK/@\?^ߏݮ~9|{2 hV=dB1	"=YU_}	LZ/>s@cP:CzGj[\=W<772w2wyD$z/?i4p73I%z0`T:]T`wUV~'nN(7\K){Fz,$Uu
VY=z]o~6ooUowNxUUOm0,ϣ/:cl+?U5d-mDy"WoM_G`^CV>Y2G,HT(?n<Q,뽇uRF qBacK(>STrh'q˿^]F >߹o&66&Zny&y 8$Ha8RFUB? 1GBA/ ӮMT޸]؃ٙv{a<PKk{;O׮(̭	umu{m}J>$yy06
bxeBExx{2ς￯Ӆq2x2˄eҫ/}y2O:%+ dj^M6q FF.{?UkI Ӧbn105^W0jُZ&z3 {<8o3/~S@7yaڥQE/r߇$zWfZc41^yXj_C+Ȓh<ǯdu21f?M9J߯Y%@ׇƋak>3hSL>ߪ@a4kTYS=g=Y]h=KYHC惼h$>WMۢ2[΄9~Xi@SVP|m&oeVKFw@$hmS&E|FA+7*Djǽt}PM,#$Orۊ4ٶ67|q ,5Y {	Ѹ֟ xKC֝xGj/o΂7N#lg@]A6>d.0{P2@CNzw [;}K-aa\7w\G5L@9Q0G`wx~m9oWGg%3}G.&{.,0'H=#)hA _pcI:wHADHM\8@zun
.٣^2*'x{,$-3m"W91I^_kˏ$M%L9veqy{=}H	[tfc1=czL1=~7 X 