#!/bin/bash

declare -r m2c_version="0.7.6"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Magento Docker
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_loading_install() {
    tput civis
    m2c_start_progress & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done

    printf "\033[0m"
}

m2c_start_progress() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏') iteration=0 length=0 log

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        if [[ "$iteration" == "0" ]]
        then
            log="$(<${m2c_log})"

            if [[ "$log" == *"Progress:"* ]]
            then
                log=" $(echo "$log" | grep "Progress: " | tail -1 | tr -d "[Proges: ]")  "
                length=${#log}
                printf %${length}s | tr " " "\b"
                echo -en "$log"
            fi
        fi

        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            (( iteration++ ))
            sleep 0.1
        done

        [[ "$iteration" == "10" ]] && iteration=0
    done

    printf %${length}s | tr " " "."
    printf "\033[0m"
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid} && \
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    local text="$1"
    local chars=$((${#text}))
    local cols=$(tput cols)

    if [[ $chars -gt $cols ]]
    then
        text="$(echo "$text" | fold -s -w"$cols")"
    fi

    echo -en "\033[0;32m$text\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_dots() {
    local text="$1"
    local chars=$((${#text} + 3))
    local cols=$(tput cols)
    local last

    cols=$(( cols > 80 ? 80 : cols ))

    if [[ $chars -gt $cols ]]
    then
        text="$(echo "$text" | fold -s -w"$cols")"
        last="${text##*$'\n'}"
        chars=$((${#last} + 3))
    fi

    m2c_msg "$text$(printf %$((cols - chars))s | tr " " ".")  "
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "${m2c_log}" ]]
        then
            error="$(<"${m2c_log}")"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$1 \
          only_y=$2 \
          opts \
          res \
          text \
          lines

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        text="$(m2c_msg "$message $(m2c_info_bold "$opts")") "
        lines=$(echo "$text" | wc -l)
        read -n 1 -srp "$text" res
        echo
        m2c_erase_prev_lines ${lines}
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_dots "OS compatibility check"
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"${m2c_log}"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_dots "Docker installation check"
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"${m2c_log}"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_dots "Docker-compose installation check"
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"${m2c_log}"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_dots "Ports 80, 443, 33060 and 53 availability check"
    m2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"${m2c_log}"
    fi

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    m2c_dots "Password required to trust the CA certificate and create symlinks"
    m2c_loading
    m2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    m2c_erase_prev_lines 1
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_dots "Locating archive"
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_dots "Extracting data"
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"${m2c_log}" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "${m2c_global_dir}/bin/m2c" /usr/local/bin/m2c

        if [[ ! -f "${m2c_global_dir}/ssl/config/v3_ext.conf" ]]
        then
            mv "${m2c_global_dir}/ssl/config/v3_ext.blank.conf" "${m2c_global_dir}/ssl/config/v3_ext.conf"
        else
            rm -f "${m2c_global_dir}/ssl/config/v3_ext.blank.conf"
        fi
    fi
    m2c_result ${test}

    if [[ ! -f "${m2c_global_dir}/ssl/certs/rootCA.crt" ]] || [[ ! -f "${m2c_global_dir}/ssl/private/rootCA.key" ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_dots "Generating private key for CA certificate"
        m2c_loading
        mkdir -p "${m2c_global_dir}/ssl"/{certs,crl,new,private,serial} >"${m2c_log}" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "${m2c_global_dir}/ssl/private/rootCA.key" 4096 >"${m2c_log}" 2>&1
        test=$?
        m2c_result ${test}

        m2c_dots "Signing CA certificate"
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "${m2c_global_dir}/ssl/config/rootca.conf" \
            -key "${m2c_global_dir}/ssl/private/rootCA.key" \
            -out "${m2c_global_dir}/ssl/certs/rootCA.crt" >"${m2c_log}" 2>&1
        test=$?
        m2c_result ${test}

        m2c_dots "Trusting root CA certificate"
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "${m2c_global_dir}/ssl/certs/rootCA.crt" >"${m2c_log}" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]]
                then
                    yes | sudo cp -rf "${m2c_global_dir}/ssl/certs/rootCA.crt" \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"${m2c_log}" 2>&1 && \
                    sudo update-ca-certificates >"${m2c_log}" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]]
                then
                    yes | sudo cp -rf "${m2c_global_dir}/ssl/certs/rootCA.crt" \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"${m2c_log}" 2>&1 && \
                    sudo update-ca-trust >"${m2c_log}" 2>&1 && \
                    sudo update-ca-trust enable >"${m2c_log}" 2>&1
                    test=$?
                else
                    echo "Currently, we are not supporting yet trusting of the root CA certificate on your OS." >"${m2c_log}"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi

    case ${m2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(</etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                m2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                m2c_dots "Creating the resolver file"
                m2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                m2c_result $?
            fi

            if [[ ! -f "${m2c_global_dir}/mutagen/mutagen" || \
                "$("${m2c_global_dir}/mutagen/mutagen" version)" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "${m2c_global_dir}/mutagen" >"${m2c_log}" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "${m2c_global_dir}/mutagen/"
                chmod 0755 "${m2c_global_dir}/mutagen/mutagen"
            fi
        ;;
    esac
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="${m2c_global_dir}/log"
mkdir -p "${m2c_global_dir}"
touch "${m2c_log}"

if ! docker info > /dev/null 2>&1
then
    m2c_error "Docker is not running or Docker service is not reachable.\n"
    exit 1
fi

if ! docker info > /dev/null 2>&1
then
    m2c_error "Docker is not running or Docker service is not reachable.\n"
    exit 1
fi

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "${m2c_global_dir}/build" ]]
    then
        message="Install Mage2click Magento Docker environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "${m2c_global_dir}"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "${m2c_global_dir}/functions/m2c"

    m2c_global_load_env

    m2c_sign "m2c.test"

    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"

    m2c_msg "Mage2click toolset is successfully installed!\n"
    m2c_msg "Run \`m2c --help\` command for usage information.\n"
    m2c_msg "Visit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "${m2c_global_dir}/functions/m2c"
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="${m2c_project_dir}/.m2c/log"

    m2c_load_env

    case "$1" in
        global)
            shift
            m2c_log="${m2c_global_dir}/log"
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    ! m2c_in_array "--help" $@ && m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    ! m2c_in_array "--help" $@ && m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    ! m2c_in_array "--help" $@ && m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 _] r#G د˯&!I ")&Y}XJI2*3AUy}؇1ۇ>%#"#	JFHE qpp۽65͍5F^"JŚZpQĉ(/ i{;Iu8<$Js^iQ{GeJcmc>hO75n$=Pra*?|c$IKQ?̰W`WV(I0?\0ۦk?ÁXLO̲7qp'cg=4a?|_H}ԛ0GAĬ^WΓd\y3YXx9,0c.|c/xX~O_c1ޞn`uu3Fñxvbh\O1o޺_{~AǨ>,ÇqN%8ǞLumƊZ'9? "toЅz`=$~ȗl|j>7WV^Zi΃Ž('V>KFghY|>,%&	`p*l	k-}7""]xQ?m;˕z*]U?$ž/]kw/YabOM VFUQkT%x\6UӦjTMiC5~GI]^ήd+
UBUP+TJYȠ/N*Ӏ] <8p m>PbI7_,s$OXU?hYou? ޲?X+I[JSS^?r¾iF8X?9-yfr}-_=y.amw9=ӂ/D%{`ZQ?v^Qw'!"%T\vSwoHql^vxSx'#0hژ[tGAN8S;]^t3cch/(zIC =QO <wgmnn*95,b>}/B$;FegI4יȅW˹rOg{/G{w_:7z_v{۩J&j8,xP/[/1^l gARӲ??ykދϋZW^X&`OuU=sqRSAQsV\=::zyЩl:k]\̲K;/oǍ:IF'9N7$s:k7LG65ɇdiA?>d}.*LYVG ` w%Gip/\$oj*rC	[jc9[};g0Mzw=?Yҿ!Zbd*d,q֙[c,!5O;"3~dOW7ԋs?Adʠ|v҅7 v agez뮨_|aΈP3/ȩѶ.ꎱmcW0+Um^Zo7_{_jY2T?4nLoR9L	
,ڛl{Ewe$W7֖X
iBxρ_yl98Nn؞lUdwohVdp6Y.HՌ[ rJ5] 糶!cqMkJw?'Nȗ$JgrYл|*_x'طPw\K&?^boPpߍ3QWKУuU/=K~+KoY&,gщ/OwDp6\o7O+7-[np%)|G_v7?o84񘴊@s_|-DyӖЃ!T3żfd8zg @r |#d|y}PyҥU`t5VRm0':}5e~Wn`~Tg7Fr!1hnn䂝׿IbB-~G07}d=/ F,}k؁@6ڍXM\b.n$_aQ&Ӥl^YTft ;'p8VJT&py&= QPǯonESofœ1rɂa%-UjNGX"zZᨢQs2*
,onbd]^fˋSGUJZ$Я!]j4p漥)zGiq\	;PVUsS/u;J+y5*^_U~Nqx3s/
spJ~Tqw8
jVɮN5r2ny=jrt$QD8R*SO"p-~)-&Q*()SکP>229+Ӟ<Egtjv?D=7);4JOhpGTa&(rYj)$td	N&01gn۰}d03؆>ܾe]IgV+MQ)Qn63i
뽅0f~޹;15PxO*ժx}]']|
eT&N,TY]z1PȭX5/Ĕj<n~f[_UY~Y$
;JӆE_:֧]H
i%%\	RuXYTχ~}u{c_Tfgh݊Aq@'op܀bᒱ1Z䜀>uOF>{*R?<:7ǡ."P3V̲oDeU|+T VVC\}ly2;(YU'
Ɗ+ϗ_&!@j=B)޳?v3w׭gP.ō^fo>ٛώ?kK5Z,#S!` 9&MN̡%(&i+~(XMG;A]|#l{!"iH|0`N)<dj(劽щ;E"4 jpU^]6cl|wqGz
??V DWMbRT,E;߳E4EQtilGH#/>{K}D! U0JsxnfW
N27tpUAp)úU`٫m8M>U/uv0	[4gF$Nᜠ!'1a6RkXi W{i-rJ(Ρ`cWug{z=V+SU嵨{ͻF/-qcذD`LFc?oSXBqR_P&pxb&vi;M]k|;C	`1(?3s| Jb uAlL6M9\@"IXWbSd&Ɉ$M!+hU2ȤؗkȒLj^-UV2dXhw0-r8日׮ɻVR% 	0ɏpp>:o0z;+xUUYO΂_^W\q;kBkXK'qV&u)#"-cc`(_1#|-:R`!/03Ѹ:FQeJ/zȄlZ%#\GMXƬ0+&ƅB\14p)s4#	]Zk`j["ߝҌn:~9j5Sj2831?*nCYwf2b'e9?hf ܓ}Ƣg/z47;HU/["ٽ#jWumb+\lîb+#mWQ=`ìr2zbk ǀY@d<i5
/.C'!0-ZWX&;ڣyֽziP,4LW~mQk5vh WVϲ`sf늮ZpȅXo4!}uP_`܄nXb.y;z}qy>%3-YFnVz49jGFڬLMv#PRz]Bgn/՟aoԼN-v``zA~:0Nt8 i[Y|)( M8{;77 .$9N!r!)ppk^FJJܰCs#IcTCLerҹw/lFO^}:{LKqY,m77ŗz{tVN~[Io秅GjjЫ;; uaq];tYpɫC%m>Gʅ´hHNg>3v$0.jvxjծz;-y"䟅';C{кC=
hg|p/{ۻݭWxhSUK]Daw4P* di]y+<`X3Ӕ~xOkY7ې8p);"xJB ;ţ-:Rw_.wJ5rA|ΡB"cEA'gRaW,5Sݦ
#˔`pt),V.҇kRMgLnJ{/@6oPW' -Th u%vB}/ r6Eȕ<Ҝ$7QkyZWԘe[%}nI'Nm$ZR &рgRla瀃	Fz4.RgP:Ϸ}M`ǍNAR!hYAxF)5ٷ7l48F|nKMtf~MkՒQ	y[vqx	'6w7ܯ AՉeccCO\/'[&CD̸O2˺8#[$NSPs-av߫фx E=RT\gIWnX6P4g!.Ϙ'.s*j0YrhWoMP-D0=~qty>M!$A9
+Y-i)J8LT`~)#eɔ1:Mԩ CY$F}a(gii3T;Zq$P8@Հ>Tk.)P#çf8zS֛hF̨!h!' `!L:qtʲg]1#CoҭցOL}U8l<I4rRQ	kXfB0F373z2좥z,jf^BTtM>O`ږvSL?Og"tjC<IѪ^Z_8:h^јi5/y)\8g~DifU+2Z25x)b%r@C2BQYBͦrf3/*
=RMPгC(s%PՄ7 OlÒz͸eMP0QViV P1Njઊr5|$
| zS|m|vL'֭teŭaA\AS!Y^&/6e	Oq~8(wu?Jr.ִ+lIZY-`ܷCo/}{8tˊ._|i ZYS &l9{ڰE0dNLACc|vNgDsg'>HkO*vYϱomĸ:'XLgp6a1`eyr[~Fc\޷#s\"*! Um |ƨr15DBm/Dw^(?Y/cLR/Wa	2Mso:vikhd#EiGۍEʸIFHwP̊!J\r@g(m_ }wS{O\"x/ي-O7;R(O|U2d3o\5P4S['RJa)ӒbPY0NP;t!qJ,B5PWrb (νt'ϳșWKRQ-3RtuڐPHB91ST|o=űtcdMp+OِQ.jHj:0./jIƴܙ62Sb>4BOyCf'άOճ'9qWf"9R۬R\)?WXwRBh? k2	aU1dPa=TbgD\h
3{pi):n],caeU	l gĲ~`)R y	t?J%\mC01y$X!|@s3@M[Oq5ǣE%E\/Qn'YD998g,E(C#I= p^v>c9;$e}jڇ#qr!jA>b=]ܿ6pX%yD!9ߢl=I3x$`l =Bv@?*Xm"*N
{Aa7(Ԧv!FP4<|G43Л)zg[D/Ү(+"N_"-2.jqaxyb*˺&/+K[~i/e+نlB POWM	|Sߔ7%M	|Sߔ7%M7M|.[6dـ_|"&}bS_FZAͼB0_o_oۺoUڪV*h,,M/KrlZ[v=#ꎽU<gU5n	㷠$3~X(U	o1{VDR
92omrc_ۍW觼[>zcT{hv|rR-BQygevَ~!߇$}A=\jk
-SeibˤY %v񐻋BCn;5@nԜ[˅kiTT;OY1dڲ${JP% ޙ_w ,5$&I6NC:U)xJz,{p;v[|Oz%Yy^]O|qSޠˤP
wdL_fUqbq2\dh
=m(J_Qi#Й:9=19kǳ[6_B~Pf:jPasW	y[ryr'ĕm)}Ts!&~T,lrmZm1).qPW`--f^b%4u+t0D92`CWA]?9" wu-5K1G	Ly(!f=πiڻ~
5,10!,ATaF:VhsSbE)R-xHL=Ba0!<6ƘywtSm=ӑ9`}d$FV{P6>1:j<>f!Fg\i\i0JZ{Buxyxv'юEH)?̭B>}n}g8/FqMgҕw;SNA7w?s<b{Q8v^?<sv#/sqgFhu'jO<nEHX{ i|
L>>!1N~KXȬ"4brw:5
BF2\5$^H	MZ$xM**H_d0{Pw-} ,F~ج,Uȷzy&4arasoϐ29&
kHm'$88Ґ_m	~MN`duӗŽS>U(%}%P&h\ϰY`(D
yx ;'ӗr.:ҾY^U:Q
rzCɯW^L>4F9H*fXBH!M3V.
)7!3t(xAh{*yf2Jܟad;(RY4͔k,u^ߋ֧krP*@)AFCpβ5\
Th [kln۶SΕݳ&G$~m"C\4ތU]'j
{6T<8u-J3U3Su]6xIPPuS/Lazе<pSퟸ&m1Py
7+f|G\:oUÔضwԤiW{H*i+	Pދٯu~Bm%gkNj0qtJT2gʹ<d}_@WƵGno}J-0 |+ei6J**=hGY>7z8tYiu)۬OkκcF5,]rPW-+]ONs=ߓOFϯ[g"R4V,늜;oWTC&j\o;0ǕjmѪxQ׊so>En3JӅkmߢs62uϞG!Ey'/Kz'H㍴߽4o|亠=t&l:E*8Qdߨ7o<&71Ddi@d縚Z9Pf$jzgǡXᜭf0lN58B=yNvg&"흂n WedI9)Yք舨.S$l^00ǯq:g+YnD/7U+H~,: n]<3)iu;bCWXrwˌ8El~ySԚi1Bwq~K4.y;8<*@m<j~.=BNڦky#/N# }N2]xgb̳[碽+?I++E^+0ȿQ%a?fmkrw5!0Ҍ7>r?ۃ=oÆG-:P2̙!=pЫG@_>,\(ia/v,퇁؜Fq9!9-l՘nYmlozyPAʔA.!
.P/B9r$p}I4?)d;3.sz^ۣzGuKv̚V$";=H/`A~NTrjњH!s4ES6zgAWčEA :l׹ЏR)JNZT+by!6yuZ]鸐P1Nw:pvJ_TdӉ%Sw1s6_Fu?HuJ?eT@BEԺ(Aa`J?tQ#j~,E#mkZ6EےجZtf1 @9-
ѬR(G"Yi[de{̶)u]nC(	|vH>J!#ڧ}ڞF}6==9E	utjAgCߦDϮ{FA:Adpnm5ݢ5RLo7pDVd
rEk:UBp;v<:&?JcxB>|s|##e6||;(>E1T[˱[7S{zy "wbwYk^̲%l%.,⸳,{}>,cªBY%)ˍ.;d,/>M6Z&0E*
qrT2ٗb>g*m2ȅj/Q\9(Oic&?:64ӟµ쳐;mbF <{H!qSN5wZ(Ւ viZ6jTG+I;%U籶 p!!J6YJ#5ťYԽ`EF#VJ9,	|Î_;D5HDr)Zfkݚp՟Y(eujhZͻ2TEF Eviɗ\`}膉#^ay
([V[I*}7A3r[W·%[Ss9tْ!*L󲭘:!ҦQ7H_ΊK9{ffmprl
|pnDx5yh,fkJU;˩+-=#辭,lFvKl(qwY:^0Gh#v1F2f.ח&-zt8}P]vwO{X]6莻n/[L?Ċ!i
kE[N].&pjRspyyֶVito$-au)U6D}b=\6X6pR޾#r/Gݣ?,6=)@O̭In(s+$UےQ^cG_UuqZhHxez$̢rBe'sUH&uZ%Q^|_e2#_Kkhȅ7 20%Mid貯1:5Oz)*zi,d9֚FI,$)zLkL(fÂm{hEb
iFಌcL=q6ftǾ^Ǽ+{öLJۭf;&c_7Qmedy Yn*)uf:h "<e5	Ͼ&n:<RP٩V0R忊}z2GkeV׸*K`|re-*7P@]ЇWZ8crh8-4D^E$~e$1HzL'aާ~bPF^+& Еrc.h|?Huţ9cy$*\*5@xh^k^xuyYG4L7Vút,psq*1k*y ۃ˗i)wXrLTʬn[^!*qN9Q80w4_@p-ʮX?M}i3Wv/|̓_OTS
-Q*)[\+n1z}v햩Ѓ Pn[{EЮ;W+r3)U>ֹ+;-Ť<Iy-,$ㆩRMM`RBdДdʤLROkH=Y:~\,/!"4hf>"OcӪ!Z9I]9SwY2ˎ]+mx 4 k{$w:~WUoӤQ'}R9	\8EDVNEKzbkMdf<䲲qˊ:̕q-WS}[Rd<m6c&z,䋟DPξ[v;[*j)qT=|r;_:37*ݵ]X*9ؖ:XolaSZ"3ȅqK\13wWe\ղLYdiwj>ɨq)^	^>NM',R}kܑU?dﾙ@cL]8#Ȓ".ց2F46i_K	y3 !mA
Ԣx:7Qi!_Ķ7GHi^&/G[͘
{aUʞ|4/)\jk^vb5<g:Rk)TɸӵYhļA{+yDBe`NTrt	AWuYFe4gIiě/Q>^Q}G~s̰*fMQv]ٞY!T)]cc|MF-Nt'(&ymk S'.gΔ4.dG1w9ww6%iƔ}o.
]z]SKh0uMrp+ëvverwK4rdmE(BlOMi#k]廈B8ѐ6n~?rX -F_B$saK^IyC,b_٘Y!H#uU("w.(4>C;{@3:ω`yZ-8G__S/L-|̍k}ܒLzA?G,NY#NmwOzm׬V,.ӻVK"m|,XEb
|l	'w(Bʇ@jp]@[ z7Twd('@~Lȋ]:jM'l[ȵi0H CezEbEže^
9[Ucn:BJn.v@hkZ؍.MZ|9ISNY#1uCNߐp,hX9z;HMOc]V%RNLjDxХ{;77G8ctf<fۣKJH[v>q#r[,.]:8ei=& Fwtw8nO͒rA˕kDs/kS6ѝЫg`TIԆ^ 7ھ}]"襞^ -ʴ'	&jiu>| vՋg^-
)za>Is1m"=h^8z`"Btr@Ʀ9?`\NSu2d6?vx]A+Rk#P{W5r[2C2)à(T#g'GLkiq [^ޞ;l``"/BVh<(Y6\Qd=d|1[f;Bky=Ԅ(wIKGzq}g[$iR)( F	ږӈJ>^Mu١(Ĕ6Pxuu^gK* *k0G#5`!]N;9hNRGV`^;4GS:/xkIm=Q9NqfdW32P-AYo:orݤ(y$Wh}g~<Կ[I^7 +Cr-px̝F!3ݼTs<׬At>cmJdi]eKxG˸	|.6\Kxfկ͒!/{kUԝgO(b1e+̒	*kiɋ,KB{,do=~xٿa?hQ6]hr]f:;Z#]Uφ܆bhҦ+sx/4J1ޓ1PT\܃-{1D*3,wS	?uKHĊ_Nkw@G4L-8g4!Q]Jԧ5FU^5AkA@7?
Eu'	 FH>̨A_~Q
YcQ3lzR"fETF:)WG7n<0V6T,c}VZIse
ilΛſu|g	-UrbFHs#Xj@(K&&'wڍAALBNqΔ' ļk9MҚR!~G'JCG%L"]^|)~s3΀yP<:vpӧ^yO?_nT5gnu~^g˿́yNٿ(X
0g`ͩ71/r<0580HHXndY4?HQ~SJcm7<։m+#۔]iMv.jCbnV(̿/"Ч'6G6h1n/сZ<NC }@-Q4AƋih|A6,9FYxhkP[b:ps`xGj*ji8)zLoϞ隁9]Wͩ_cKoė7"/*E>6v
ӾaA='l:P^_V(hR0NJ4!Q\h7!|<qsV
0{]O83鐊\jߞK!=5]Vhh|zYsG\tߪ:EhA##hy|?~?່Ǚ56.x$9cR%s4,YOZmynn
I_ąev>Xe/K49J|K;K3 T[*͕[0O;|^Zk6џ~3yel݂<23*cGs7WQUL[mmfhm{4Erq#z= oA}ȭWrG*jjUcY%**1ѭtovojq6T[T?B@rHE.1dUHl"SM^j3ᨦB0v'xaC8 +631u 2wIHg Fi`ϔmF^L*Iz6hS!w6/AglS6嬺}}K-.Woq%uuoe6>pn~VGJv1@j_l4]M»7r^dXUܞRSUv4	::eZ"&hI#ӔWZ*.{{;3:p)`9ϠOMA+*lf:hj}фJY2_J"M볾?Ja/s#TG\1cɃqAEgmb/ɦLNSU\wA?=Yڟ=e<Z#W3!aF?|#EZ*e3Pk@ݪB1Ngbh)4O-~8TϲiNSkN;]QWJpsgOtu5;y2{vxVë@jc֬kk-HЙV-ԣHo<)#7BV$Eyl$ 0kC	>J.%iL52+ n3ϢVbqkHl-[r(PbޤIRA  ]Utdl[\3z=ջrV`YyC5unw/abt<	2y
?c#`ǿ_:VTW0IH4G`t%xq 	(.:=eA3%ǳ 9F9vBɳ#3E&3MiG570|赂*í\|;Qg̿^cC-Pި[8<>Uh$9g[C?
zꯪ^X>VP*Plzaz8&v;XN~|]&%Dk2KbXҤ΋gK&z8뛹}0~o֚7mUs<6E)mԜ$(teki?7[x'R7SyUqސ^ٚuGꮁlc|Nqiؽl<`}:#Z#wAVÊ&v5IYH\(I)uNr! `K"#d09ȍE*U\0Y܂+?9JG^{_;S@*H;ZI:L?U~vV}lzSeŅo]C,Ӎ\
ЕG {_p
uۭ~Ye\cTG3F1.ON*<iAmQc[z6goCSǱܣ4(4Zr߯5DQ溏Ah	b\}LooL'mo{QֻV戂.wb`	g^(L-=$MAPGw`輶I5\/8彪!ݭ&yUw4x[Xۻt1]p%!J*4_eUJbL@ 5wr%`*FbY{8ե̣)GǮ4OcLt`uqf<(uC`d]XQce?o\`9_@-DW&V\nH&qWIaFWihL8;O&qsk!J/9S۹籰̣߬t7kUҩ,6F̐X)${>>1λxow*GӡUM#F	0F'G/w^n2rHE)&r?L䡙]Pb`$Fj]V.`絺8E>X|zX?񄳜i4
: !}t	g׹uVC-/IF73TG)@>0$.Hh{&hӱVtWInsO.}_ZGN;@Zk8k\XDGWc:S@"|˼F[&0f䙾Q~6#ߞ1@Q6Ex#x Ēw(}+#,urxҫ+7O,L1V\$fm#sN;[dYyu%9kh$hƹg]j%Hk!V{ߑ7Q4W1SF]2blTlO7۸g(Ĥ588M~Ah
.Q6lͬ>$g*(Jvȩ[8UY2EoyO^_j5s	+W]eh[F[$>.	7աo%)42Y$YM8/!7}os8l!c5$Ny2{XszQ3KF}84Qy&>AuԽ+˓L3dp=FdSDLϲJ*V!"/\1sLȍP%o;<NYvʊc>vhG* ?^#l67}f{Z+k:kV?%&((/ i{;IKǽQv76`q۫?i~6JFsچ_XݘcAՂhYF߼7
?Y{ѥ<v	LK/HI0_||O_;6꺵C|?F£&&?9l%ڥwUx4 禌g(7vы7S7c4$2`?Jw;ҁ D=^7{ި34?|F>< XYե7?F8}c&y]I+z=E"֯SYc%Q)}ab%̍q4Oz;eҟh?<N{]~ƴ<)z#|^oZ=o`9Ɍ]zI</W<1P |+QEíoչq6i_vk6kc$qȱ*+2:<()b%I!}^n6Qc!S)~
a1Toi5?@ԍ\Wj=9A/Awo'/8M[_#o}mm	 Tv-V*exVɆ {z_KKqſlZM@SqVBD}0r.HhV\\sQcqi4xOMw?ӧrt;2Z|
Z$O@?uvoGm@f{:_
׿1hIz-F>>>:<>:i^ ܍1f)r`wQR)`mT|ltGNY*mc_M~^Hb!y,[;髃g?B{GT?Hȷ^B[:2l(U!ZN/+*˳[v;~ըۯv_lyu=w/_v3t|gC5k7畂ˣlQ|~D0Xdzr-4-I<|YxhF9ji:;՛i<[w?nt>i*V Je9Ts?+[۟>mX
$;He+bw
LApoT"v&hUm(>-`A[Ϸ67]r{OS=XL+͕ui	"*k94LSnXp̾MQp7% T#̺o!q+NQ4^6R~D1l82%Z<h״8mv_aM3?mEG^dT$YCQQ%勏zdԠda[nR0tK^f6̠ !)i^"4;I5{Mvfxl]Rj^9?ׂ>
H"p;Cfu>pZ_U_kmn(3uG*!=K")
|{j{`5єanAN6ks,w%t~"ƫ+7.}(`-=li8B*n}HS䝜iQR!s?D*ѳK=lXSSJBN$i:|k.0=,d)ngzHy,Lߊ6jo?J	>X]X\W+$Ҭo+PtZ-UoGˋR5S60uS&hYi<8@¡/:Y9g]î1,.р<6XvE%>
[h`8V/ Glteꐤ!Wd}.|9sPY5ɻl2b?y.5[TQjBNsѯl7 (,>1Dg˪+Nob"?ghÀBxY^-1_K-EOg{9_#/#r_Fw@>HTG:wǪ yiXl,wi-!-qѬlp!b`:dO!-,k*З̹9cAƝ&Yr_Fg>2 TxVpԩZbkb@ʾ4sn(RE/i]:`~X*=pEMX+ b?]3ļ
w|/EEQ&- Pzy9E?gjW\3jJN׈{)h4P4ŰAtSd9SU3>g;'v(=c>|Oǧ~z3{=͛n*7vOEO>s!u cY`$$ν(G//V߫zE*jg093Mj'.S\aBeePe9qޯVC*l6LkU6kaی(L޹Z4Z/E}6 b^@ťpILz_1W9E/IbLx-ժI4P7Cdg-*3m]y6k)y<9gm<fӎIh8hhLg|ǚ1У'
bIT$ҴFHt}|eq3+/~}P
Db(\uas̵x0B?^,앷޽Nύc7&ަͿ5:1?gkju!=VD{}a8|,4z/_/	}XXYj`k؃Szz1dL|mF:.B?p$)Dq҂ᐧZSɳ-I;+هF,9c%$L-TGGxzNTt 0GobѹHZWFHD?;iW`eM&tSG46\M ME-jzoPs[ ,HǈaKD\d[w*ɮ="V7.ȯR[z|}j?U4TME/v.ԫD<2ZC@,jcזݦn6VT,#`<dH@pkOcQ4{в0:P\]:.a豥כ曥Qyv@n$'L Ӑ3=*Z(z&vIajyV)M<z/ܡ/R?+f-[ZF$!J|-"p'|~VҢ0JG-XTLw%TQ#/1#n߈ğw Ӭ'<y+*tI$|AedzY͛PIRf|l%I00 M*XscIs[^ZՅ@^h80ms\K1S8JX<10KDƨ~AnσUGCbZcU8NrcHDMJ^'''B'QŎG!0O.H4P?R'j vG*-FAh{TAܴFh3f_4Օleޤ]x+"GD(2Ը=:5GmclZ_`$W!JXU4}s4vZ)un	[+ĳ(HOrN0rx}gﭣ_ۿ>i{	nU'o@@
>c2E3f@3SdhdRX'W,}6#W1cUܷ>)P
P{$߅xE64;Zt;cؽfX(K' PK6+U?I4~VWfrצП]pZ1{$|bac0dRƿvh/;hAԟW"W `t׼Tfōr6`xG`.ayhA}նٿ!pMZܔjaA[:~H;naE(CLw{bOkN\M'/|++t>ð%;5 EQbN0(5PYuf)}x/Y\+P"ĤmGaE#>3,&N
[:N0]Yi|xڋOCh)H7)i4Ca{q{mbT[>abW_Qa9Yła݄M5@@֚_QvZ|QG5Bk0_Y?6^5_ gV'RdsU5D,`Ş'U`.쒾;BF>L3HztQT`#{eZE!j)Wp5b>U&dsSA7Cg5']5_=@DM&Mǅɡ$X~6uʖYG3X).a!25fl}:fM&unnIo08/i$-sdr
ϒC-@/Lp?@FA(dW0a 7MI[8?[it\h|#a5D 육P6/yO.k7SRJ8qp/C$Llsz]|FY+`~vj\L3l*kho#ӢϺ:;kMvX*s\!z]lks^?B0&<'eLܷQ~Dg9r$x8	d`)c.CD"WdWeDٯ([G!pԧH{e3U?QE݆&05'۸p|' SRYlVG X,tM{IJ"yJ	H"o̴;RW: (WYHF޹a {"  Uj%򜐟AED*x#^{ZW\7pOTVDf@AJ:N&QAk[p=l{>& rc9h1'~p:A~ﳥq9<~m=FcGvK45E?&G(򮞰Gv6΁GP̐6xbtzot2l. Ib+Ydw=L6hQ̔UU2Wfэ#$qrxB.ƙ|*utZOű˧.v~]DM-_ݪESZDQ˔ ~w2Tt`A<`NWB?TE>uĄ̕4 z1L*?I[1"qlao0
Z,tRT&AxWKK&&.Ha12YЁO$o<|օoM`VpJ41QThZj]SVzߋ6x;@lvL/
\ieBm.;(NM]>u!d|qVma:WTҖZ8YT~}H!.|o2p/yZb\\CѵQ~c j!פFZ80Dw:<v_r+R};9YaF4)WCQCHftlE`9hU@d[ډyJbgn</W	ǿ,~w0xw%!*O{(4,M&k.NCB[E~iYkmemeQ:﷞uw{z:һ?6`I_i_6VZ]ncBj@)wiN.:_|'%]EpvBK?@|?^ߏܮ9|d2q@z4̧dJ!6">zd8ڌtDj5ohAu d_ WO=Ofx|S"Md47X,)oz0aT:]T`UZ~'ώJZGg=#WXv:VݮS?oUoUU=edl6o3|I'rTң>D<k6"[&'Nk+cҟ8BXZ֤G\-P7eOI%`|+P[hl[{`/,nɄژ&4@1%woI:\bap[]/2Aju/p<I2:z!l~]KȘ_E[__{G{ ^1eoo׈yGI{^{,6:^siD(O<ЋT=ȓ|}}=y,Le<&*]J.,hVަf .d2O^`#+ 	ςIꎈ\<5~.T7][鰕tp1<m:8ⶣ|# WzZ&^p `O1~4oEg^J'Do K"[Gb'Zfc$	Z<] /L/ d0y+~O+؝́\n$ZWȫC0q5y{:|.ZG ЯQ-t($;OQguYwK^B0h>s1اS̪wCfՙ0;/p~~@SZP˴G IL)<SgLDٌV]o8V4Nz$[ZXr <-4 Ao{eAŶֳ Kx'Fi?8o<l)d{܏<7趏,x|+oæAOfJh2U2x2~S=o	9%O18f.;P19BK hq<%7x<K1qmGGQVh@jp #K=*%YhFHtqxD =@z<`E_ЯQBL<RKg)t6OGF:W@Q/`=N_n_=1Mذ+oJq3z\YTޢ^OQN4șXy[~h@7`o><<<<<<<<<<<<<<<<<<<}K;9  