#!/bin/bash

declare -r m2c_version="0.7.5"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Magento Docker
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_loading_install() {
    tput civis
    m2c_start_progress & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done

    printf "\033[0m"
}

m2c_start_progress() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏') iteration=0 length=0 log

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        if [[ "$iteration" == "0" ]]
        then
            log="$(<${m2c_log})"

            if [[ "$log" == *"Progress:"* ]]
            then
                log=" $(echo "$log" | grep "Progress: " | tail -1 | tr -d "[Proges: ]")  "
                length=${#log}
                printf %${length}s | tr " " "\b"
                echo -en "$log"
            fi
        fi

        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            (( iteration++ ))
            sleep 0.1
        done

        [[ "$iteration" == "10" ]] && iteration=0
    done

    printf %${length}s | tr " " "."
    printf "\033[0m"
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid} && \
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    local text="$1"
    local chars=$((${#text}))
    local cols=$(tput cols)

    if [[ $chars -gt $cols ]]
    then
        text="$(echo "$text" | fold -s -w"$cols")"
    fi

    echo -en "\033[0;32m$text\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_dots() {
    local text="$1"
    local chars=$((${#text} + 3))
    local cols=$(tput cols)
    local last

    cols=$(( cols > 80 ? 80 : cols ))

    if [[ $chars -gt $cols ]]
    then
        text="$(echo "$text" | fold -s -w"$cols")"
        last="${text##*$'\n'}"
        chars=$((${#last} + 3))
    fi

    m2c_msg "$text$(printf %$((cols - chars))s | tr " " ".")  "
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "${m2c_log}" ]]
        then
            error="$(<"${m2c_log}")"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$1 \
          only_y=$2 \
          opts \
          res \
          text \
          lines

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        text="$(m2c_msg "$message $(m2c_info_bold "$opts")") "
        lines=$(echo "$text" | wc -l)
        read -n 1 -srp "$text" res
        echo
        m2c_erase_prev_lines ${lines}
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_dots "OS compatibility check"
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"${m2c_log}"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_dots "Docker installation check"
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"${m2c_log}"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_dots "Docker-compose installation check"
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"${m2c_log}"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_dots "Ports 80, 443, 33060 and 53 availability check"
    m2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"${m2c_log}"
    fi

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    m2c_dots "Password required to trust the CA certificate and create symlinks"
    m2c_loading
    m2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    m2c_erase_prev_lines 1
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_dots "Locating archive"
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_dots "Extracting data"
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"${m2c_log}" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "${m2c_global_dir}/bin/m2c" /usr/local/bin/m2c

        if [[ ! -f "${m2c_global_dir}/ssl/config/v3_ext.conf" ]]
        then
            mv "${m2c_global_dir}/ssl/config/v3_ext.blank.conf" "${m2c_global_dir}/ssl/config/v3_ext.conf"
        else
            rm -f "${m2c_global_dir}/ssl/config/v3_ext.blank.conf"
        fi
    fi
    m2c_result ${test}

    if [[ ! -f "${m2c_global_dir}/ssl/certs/rootCA.crt" ]] || [[ ! -f "${m2c_global_dir}/ssl/private/rootCA.key" ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_dots "Generating private key for CA certificate"
        m2c_loading
        mkdir -p "${m2c_global_dir}/ssl"/{certs,crl,new,private,serial} >"${m2c_log}" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "${m2c_global_dir}/ssl/private/rootCA.key" 4096 >"${m2c_log}" 2>&1
        test=$?
        m2c_result ${test}

        m2c_dots "Signing CA certificate"
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "${m2c_global_dir}/ssl/config/rootca.conf" \
            -key "${m2c_global_dir}/ssl/private/rootCA.key" \
            -out "${m2c_global_dir}/ssl/certs/rootCA.crt" >"${m2c_log}" 2>&1
        test=$?
        m2c_result ${test}

        m2c_dots "Trusting root CA certificate"
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "${m2c_global_dir}/ssl/certs/rootCA.crt" >"${m2c_log}" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]]
                then
                    yes | sudo cp -rf "${m2c_global_dir}/ssl/certs/rootCA.crt" \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"${m2c_log}" 2>&1 && \
                    sudo update-ca-certificates >"${m2c_log}" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]]
                then
                    yes | sudo cp -rf "${m2c_global_dir}/ssl/certs/rootCA.crt" \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"${m2c_log}" 2>&1 && \
                    sudo update-ca-trust >"${m2c_log}" 2>&1 && \
                    sudo update-ca-trust enable >"${m2c_log}" 2>&1
                    test=$?
                else
                    echo "Currently, we are not supporting yet trusting of the root CA certificate on your OS." >"${m2c_log}"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi

    case ${m2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(</etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                m2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                m2c_dots "Creating the resolver file"
                m2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                m2c_result $?
            fi

            if [[ ! -f "${m2c_global_dir}/mutagen/mutagen" || \
                "$("${m2c_global_dir}/mutagen/mutagen" version)" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "${m2c_global_dir}/mutagen" >"${m2c_log}" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "${m2c_global_dir}/mutagen/"
                chmod 0755 "${m2c_global_dir}/mutagen/mutagen"
            fi
        ;;
    esac
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="${m2c_global_dir}/log"
mkdir -p "${m2c_global_dir}"
touch "${m2c_log}"

if ! docker info > /dev/null 2>&1
then
    m2c_error "Docker is not running or Docker service is not reachable.\n"
    exit 1
fi

if ! docker info > /dev/null 2>&1
then
    m2c_error "Docker is not running or Docker service is not reachable.\n"
    exit 1
fi

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "${m2c_global_dir}/build" ]]
    then
        message="Install Mage2click Magento Docker environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "${m2c_global_dir}"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "${m2c_global_dir}/functions/m2c"

    m2c_global_load_env

    m2c_sign "m2c.test"

    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"

    m2c_msg "Mage2click toolset is successfully installed!\n"
    m2c_msg "Run \`m2c --help\` command for usage information.\n"
    m2c_msg "Visit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "${m2c_global_dir}/functions/m2c"
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="${m2c_project_dir}/.m2c/log"

    m2c_load_env

    case "$1" in
        global)
            shift
            m2c_log="${m2c_global_dir}/log"
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    ! m2c_in_array "--help" $@ && m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    ! m2c_in_array "--help" $@ && m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    ! m2c_in_array "--help" $@ && m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 w=] r#G(8˯&!I ")ua)@I If@e&Ȣ;Oggck{}5ۯ/YwKFDF&ԍ 2^{xl67}f{Z+k+kkj.J8" 0d;=-x/>'ǃā߂_ia+|#G~`(Pv4q76${}u>h;@_]ۀo+8u>hO'a/	Fa080- ʜ{$ًm͇)M!h'oe_o8d4c?|s?JdIt?
$fr$SFqk?f1wsCߏkl~ѬGz%o}\v+7ųSoFz2y$8z^odf|C0͆pe>t(oLq\@uW>tgïop47VV[ZYH<!ω/,6XW{6x.!9Cd{#VY帹Jkxt,E8aY2b'>Gdg(7{7I'TasW>HXk4XX1 >^QhYVY:|e'A/g\Ae6:]wEԈy
;k~j5r\*9kTlU6UӦjTM;NNdN
uv [!Vr\*WBA luVᙟt/lUZ$M5TǗje_#}jAzӨEz]aO:__WXXٖM_4`pymϻp0-LkBwaXk\S遜|!*h=ooww[G?)Ѧ*tt{8@cj`;<oQEKhc?z~Gpy욽	0C{٦FK: Y\~Y,Ǹ8kssSͩqeo{e*T$1vp(>M\?D.$ZΝ=n?}q={Qg3m|p޳NE?T59Wfe܀B؀$:xwӍb0=<*֟i[;^l~^|< 7i϶w*_j~k
7⚆M.˃NeY\/b]y|k=nԁ_N7m?aQ%ltJ' He3YQ_er?M>\d%KC!KUnsQQfʲ|?| {T~xٍ_'.9
O3|"|3T[-UN`-BnVBo9\h;_-CQ'@6"̖E&SA& >Dfx(xeHfygs x!dT4^	"SE`泰.AY  ;-c77XwEwF-ryY5<WEN}tQwEnچ_j{,ګUڗotue~{\~.VΙdLP`޴d]/+k &ʿR8NƳ|wc)Ѧwr3d30|"3ů{C"cwAf 'PTI4<=DWoT?XS 7w8qD^ϧׯDD'Q:˪[V
e;ȕ7>

<^z7'|^%ony_ℿ:^Lx][Ybm}2v^f9N\xq|xZ J&@qzÿyz\irc/I[?g{xyǤUj囇nf`8&ʛ4x|̮7~2q7.l4Ӹl'Á]5 ;I"&e7'#.oD'3Bo3 Q?qЁa,׍/2u3_u\81i<Asu`- Mjqo4;A&y78`0:gA[l| nLmpEuq#%Ҭ'C
6&emM*~7-R2p8րcTD4q3	4Dxގ:~|så(E^H|3[$E,s]L<+iANGUw:XGQ	U`1xss'#2[^Ue5=ZU2"M~(&UWIUt@͇3-L;4gHkM؁
򜣿z-7X`}UZ!vVǽ<sÛi{Q|ۅUr8ݝiYUUJvuSA=vxОT^/]#Poؔ((&)RUzA+l;Oia0QƎRFINrgI%MiYiX=/mT@h<~Vp'#!aHܡQ|~Gf̠>ҧ3A9ȚPH! Kp
4Y9pކ,Cm'A6a-
Mb<C\hJ"ǿ tC	NS@^-1#ν܉Q5}RV8R5?U@l-cwm5wvfjo:0Dnmƪy!T9u3lݢ"W$QQ6,/H}>|>B2VPDH+)J
ʢx~>ӳm[`7;[G[oV#?`/k@5aЂ^X&{2\ޣVl9uIGb}#*WTS6~-0;5/~ev@QʫI1O$:FW25	5/0MBznSg[/~lg0G?[Ϟ];?=x|?7րrk6hX$FFBrTM,~?CŋfK&QLrW,QuQvNfFVB4EҐa0h0Rx8h>Q{5R+vDi< xd8F+ll2&lYI}qOӧ?=ٯŤbXJvgWtidM\؎|/DG^|(Z)
1^zC5 ya̕$dnB0W6SuWpt2/:}<e_`
hjI69ACNc0=mKְ:~AǯZ6;售Q(C4ϯ`f Gz0WVkQw^h[#	$?a)~(ȧ㤾L LҮwh+X"  v&&v*xcP~xgz`;A^@ؘmvrvRE"J&MICVѪTeLI)/א%ռZ0 eW	Ȱ`[Zp#/K]-wKb`{|ta<wM{W ի<%X)# #Lv:rׄװ3NFLT	SFD֓[d2Qc|-FZu:Cygy_`f8rqu䍐n%˔^	''.1HJFY;aWL&9b,>i 7S1$2hF$ԶD;+ourPkd qfblsO-U܎ d|Or~A'#E^~iTov,5%^:Eγ{3GծڞW؆]EŶWtGۮb+z$6z7IY1d@*wRx0k1^\NB`[@%Mv4l2G90$=!#{1.t1\)rX&hңj"A*կЭ>e]h CF_8~&!>"4	??|\4Aw,f|KgZZsޭh<]O3s, Y̛vGwq<y\,_R7˷۫?jI͍y;q[ 2Khy~Su`|D9^99q@*iSP1@7eK	qb>vnn~y\H|ssCCRּfa5+75_1|ǇFC[Zs_)u_،柼t^SF9X<n7o/US"j0O9f9Ԑf;Wwv@\.Twk}WJuK|oiѐ*0|f!H2a\ H]twZ0#E?IO"lwuHAGz^'
w[BQ.8#&=7\h4%UD+bF/VyTef9>tf2볧) 0 n!	Gq8FRr/wPE&=@RwG[t
2v|]~jUC;D$$$˕1N&Ϥ5=>4dYj nZMFf)L]4SJY\bnJ^Vm졮NZdJ^ m^y+y9_;I%n>ė$1˶JXEN(I@M3&'x$h ]8tolӛ6B$dZ]Sj4o{Qonh&K!^q<dݖ3Z<?ȇ)%NvA'"!xO"/WmFn2_J|+B-y+1^RMOFwǍxs1L#qdۗuqFHM*+ҡ߯[`&09W	; >{	;^Lݸ/lˡh%B\1O]	U`t%5NѐE aߚ䡰[pkwխazx&ұ1"}BIs01!WZ^ESp,#Iln):%SFד˒)cmu(SAݳIV+QYg).w^HP!(7Lp%}$]JSZ<FOI3	q٭7ђQ&-C!'ЂCN" )Bfe=vueΌfHcG"zA9p[̙L!'rKqxhMװ#SąZka$f*nfHKdEKzY"̼f}-hG~;*%DL$scIyH͓8vwU$JptJl1j_Rp
&Zq8ξ)H
WdFddk(y9y=%R/4Ke@+`M$̠5f!1^T"zJg*QPJ]K.	eo& ؆%q4`&@
bUkFI/O :(O[	ʊ[փ﹂&BL_l5j%1^pP:\>ciWGْZ/ov.e+_q2A5] Rw1] M4{c*sfa#`Ȝb 0:`ޅN|%T첒ic5ZۈquO:(4	Ἃ3tm&c^}ƸdS5oG^ǅnDjU2,Cz k7nȫ PQcj˅R&^P³_6ߧ^6Me*Kt>G^d#וqXGCL"=Pږ*$`UE^y[ovQenfrߚ-kh:e6OЍu'^KSb%oX*`P)w, C8
Y 3jb7  P{ O
'g3f'Zf0!rl%b'5)l~ ׫g{&c PɚV!]!$ԴǑ"wua!\_ēi3md#4|hOY9gOr2zSErY|2%R~H?
~db?<êbt +
{ϢИ?g9_ҕ2bS)tHݺ
X ʮt9@ΈeuVS6Hӓ=*\=J"7`xcKI&JC&āNwg;=g7jG!J (_܎O6@sQOsq"Y9x7Q-̇Fēz ^}8r<wI@db{gGx-BԂ|VA-z꙳l.JVCrnEt{x͙fH: zVcU?ETZpz5z^oPMAC?1hRyhhf
!17)zSζF^]_QWDcy׿1Eo[Fep\.〷jTЗueM~Y_V䗶Ғ_)^Vd#لlA6ڛ)oJ)oJnf]"m&dUDLĨ񍾵7$y`_T߾P6ԷumU}[Qڹ,9 U}mU_[*hURYZyY*Kӝ^d3ԷzF:{7ĕ	xHjb :oAIgX=PVd(c5k,f4"se$:0Oy8[}ƨ>j=[.$3VbrCIԃ$*{T:Z,,ŖI_^{AJ!wvjũ9Q=#j9~hIHvXӳH%*bȴeI\8!JUA^3sXkHLl\/ǇtV-FSXv*Ld6KN>P>pAIɘw$0=I;*ғe8b10%{*>Pޕ,F3u0s{brl3׎gZl,0epC<+tԠGE߭瀽
:N+9Rh+BhMYy}+ĵ9bR\dYR44[ZͼdżJhV`sd4
~rDNﶭ:̓[nkcPB͠{5еwAC=umjX
9b`CX8H!%,uɭ"#<RZ!6ȑz89o*99`C38xm1؁XGz2#sH4l}ctxr'}CϸpWӌa&ƕN(ΑSVi[H}T}q&_&Ϥ+w<=/n:4~y,-q,XwE!L8XyG`A_x?ϊ-N៞8y܊2cP% AT8}|"Bjec-8:<YEpil%t4AkD1d&ckHdh<꧵hI.U*Ua4-[@.Y2.hyYYґoqMi|
:u!drLrKy*:xO"7I4qp
!ۊ\%1Ȟ/{|Q&2K2DKL~7S,ua׳c"Q zw4N/]u}]-u֣%_7}gisT(ͰD'3Bf@!6]6(S:n*CfQLU> R;0e,?02w]wQi)=X꼾O~ZUSeOkr߹.bNf (wֆl	m+1gM&4H-Z%E,6i0
OimfqoMchyvq:[nfr&gd!$!m@įˡ8_ky3?qMCbnq=V5T0>{%j);*u@fg))mMXIӮ,qtU }W20׳_~3ڨ;FM9K4`*&6锨\me;sy*Dk!FW(Zaxt2W"gmUT*z"?1tЎܳ4}n&q2{ѳR3RաYTuǦk>Y3ZWлf1Нz'/H_{+DiX9w߮TMԸ(nDwXa+ڢUO=ٯ4MM}4Vg<	c=e5'S۾E&6md/=ZCN^;'=OZ;i{iL.luA{j.Lt}-uTq9QoxLocH!.
 q57rT葨+V@g#;qq`rSw]ɯHA}<E+DRnmdyJ5g:"Kk	MYbVQKΦt
?'F#nOs
zZ/?=lm}uVܫ݃2c//GQ?[n^EZQi]S;8˥
P.zĩ}t-?+,haq^|ӨNqxX/ֳ<`hJ/`9E`
J/r|?|
c-/ AXwEbAY|Za&oH"/4㍠A{wLsfHb97ৢ9KZnXǅ]Ka`!F'f` DNH`tK8$c5f[rxF 2f^9&92po+fԌP\>B/'>qo&@=Q
όӭܣl(B(nAQ]fEՀr4z?aX᨟	յx0B&zf'~0$.F30lFY;qc~P&hƬ+8u.xT
}BiՊYsDvAv!261M^hW.2zg#3띫m=?҇%yz>>&tD	pT@)A̜ΗQORe%Pp3.Jf R'9]aH?CC'KrHᡧw-cZjMQ=t 6VN]aLh9H??ew6CPNC4+_QV*Y^7-gwJoz]y`k>/_s7Rx{iশgQ}Chς~NQk<Z+w?`&>ѹ@QwNA*Y%|.;c[Mh [$ͳ;B\gY¼\{Z+9N'ʏҨ,y<1"oAv.QmE2s{f(iÞ_dzx]X]ּWP/[l+?m8,CF_e;PƷ*FIJ7rc"ˋOStBI|C~A%UA<8NJ&2[^Ue5\MPM!<0kw 45fx3RvɁ}rMlrGxϵi6<.v)&"xV?|ZS.MVF~`JhE>i< N7D;\a&BidbQ4`Ʀ64hXY 紶b%Xbokȝf].3^Lz[<[12,|CXUy"]P$(n19-8^Aq/0t+#Ze܊u;IE&hAnVdtqA.6\4ġAi^P9[#D5vI4Yq)goӬ<~Ҭm΂X.M4SNQM &elM*sg95}ףDPݻ5#svr8;0K&՘ht3Cm.Z9ܬv@7ߤYϞx?'WpR])}qWc9zX<(Mr혣h`~ ש NMb.U21ZU:ͮE#.
߆1A_lˆˆSV]\7␻Dh{ hӦC;H	ùS ieӑ
Ts[2Kbʠ N)t,S"?YSNQ 0BiļN41N"}ՋLF$qWkxQD&&Vz)@#]5F[V3e8\e_oWb?훅,Z(Meᴑ}Vo~i,~XmJ? BA -=\qI'±!Fìrp/Q|eoؖ	T)xp<ld53mTl0 PqT1T@>ٸ&6aQUBbYMCSp8BBY

݂7;
Y<XQO:(uT"_eHRut,uOξR[eq =sf
Hs \wLn`b &VЏqD3I$ԳQLʨY`Ӌր~t	@r#RnOSIx4g#7DeK4JMkO!Z.s4:yq4c0f^q{wY3Yp~Y+.^%f-S%y{y2-xKI*^R}ruKD%)'f2⎞&kA5+{Ô1MwX@y5ׂ^uJ%9:J%p+U<yi>cv}]!&UϮ2]z@mkOuzqR&1e*':p;cǥ/	2%$#7ba0Zʽ	LQh2LԂ2Bt'Ko3D_LGcrlZ<D+"78Gc33Q&~ro@Ճ"Y&46dvR/*3]@yj~?z"9O*'A2S(Ȫ_I(pBP,pt\V6κX|YvA2poKBg#qӆ"qD|S?wˎ|zgSEV-%J8Wb10\tfYY9[%1'۲xz\/]<,J`V+_$ruݲ 1.o_t1&`.˴Z)`8_Ɲ6?63ǩi`[ݐE;A7|)gdYBd>:PFF٦9kZ8of];İ-YZOǿw7rb"2-/d?q˔	9͋`KsXaO:SٓϜ&;EZtˎP!uRW^J=|}-3%*wRbv4m7|%S"] ̉R.!*Ӳ8>H5ޘ,75x%^>v3
ܧ+oWTү>Bz^컉9֎"03KԜR8<C3e>kt`pɨERɝ.Wd3m}ʳbD圙̙rܓ(&!>.NӦ;͘MvaRK_kjr	νi\}xŷ~xuN®YC|FΚʹhP)msdK|qWSg^6Gpwk%+_Ȳd.l+;:O<x%V:3+1ip|#N r=^
eVCYܥ]8wuHp0T`fV91,VcXg(kv	y![I3)kĩ2Bn	wWՊե{zj~{iCd3(RB-de^q\PHhp@vT9JDhЏ	y`XG	bV;	dAH]\]°(طKT!!~wstT4sMG!1BHMuBq3%YO:#|jé5ku4&nV	b+^cV}Z[x*UDZé]IMHϖC}o('wLn,l{{t\i4"n|4nD=tS+UűKGB,#RܨǍ?YRNҀ6p2`wem&![9zBP
"Ɂ2F۷QԳ\v5V$sbDD-҇ώչz+P\u[5ep"B_U3 9R0ic4Fҽ\dk'^\ZS.B8i.Uf̆o+hEqwjF\z5[s(bRFA9$4A9A5'GjO4BVA=qsnnEE"xxQl>`3z`bBwVb?z	gQ2B0W5pLwH8ӤJPR ,)Ag|궓CMA)G-m2KWo"?T24TdTLaDFkBo)qМ%%լB1#ܽvht^HZd{ri%"̶F%fdz;o[btΐ=N:I-@&(6O"y^n;B;'9%AW49ZAx9%y y9|;仕BŻ|˖>03 ؏q\l>e-ͪ_%C
^6:H;kϞVQ}0YKK]\M^DYDc!x~v'@nz6|YoC#H43֡|zv6tö˖+sh/4I1ޏ1@TX܃{1Ă*3 sS	?uKHD_Niw G$L-6g41]Jԧ5FU^5A?kA@7?Du	 FH>̨A_~Q
YcQf3jzR"VAT9)WG5n<05T,c}VZIse
ilΛu|g	-~UrbFHs#Xj@K&&'w|ڍALBNƔ' ļkMҚyR!~7'JCWG#L"]^|)~s3΀yP<Vpӧ^yO?_nT5gmu~^gC˿ʆ<'_Xq
3cUxTjK`_ΊXajK̂$,FD72r,ӇW()1]D6NpӀ`4m4qw&;!1a+bvnOmQdugoy#Vi
@ΎP'K!LDU 4W4 q[|c\	c,|45z@(X-f1CuM0#545&ѧet+믱7K@"{;i6~ep+`e/+lz)'%Xf(.4Nry<)`pPtLN'CP̽tHE.5KoϥÐ.+x4>,ʹ\~f:KoUjl{VoٌK4pf~84>Cx]<c1Y)9'aؼi76̤/@w_sF?S9gYIUo}ɗ`gif՟xYer& t皯t}^y-&o|&r4AỌ[' S;_v_T AuT[{3
!^8vJi˿uwqbϗH4ѭ?|C-/@ ">JhR9@wTb@MBj,@e#Wb@%<͢Mmwr"XjbGV[(>B%f\S߸
	R$|QKmt?THw4w`QRцu&W.?4( ?4r Cȋ^%)\&`m*ra?謖m
ۦU׶p<E06..nqFh`<.FkƢ\1[IxU[C܋Sj"N&?~ڛ\_׶lWKs-2頻ZydJ+!Z"Zeoo|gFAnw1#1G	)5"XxeVE]RA,UM/Z5KAJ	ןZD	{}xY)ynsĂB:al27yNvxv4,V%47s
J!,%KGz|&$HGC/ wy]_,_rw[U7,~vW,-)Y4~3Ӊvji+J	rIN3Pf'oVtϮjxPm̚uosumE	:Ѫ½zɸ' %Tq]zFj(_M&
Hpn`XQr.Mkfj5gѝȬ_POTw|*_EfkC&}MzZs %0Xg⚩ޕZ ~/ruc_'[o]xII|S|ŧ{/;)WL촢RB1uNBY8S.[O݄]ODqN)b)?4r9H9(2iJ>گHq8CUWanO	">G8jzFޚIAqB&9QУWQu7:|Rf`Lף1ٵ,U-uvZABTܱ˄q6hW\fi\ KWUyYyqXlI^}Ut}3Z&S7W }aǦ6ո&僞6s-f$S\f?
33[Y5S-p39.sMgdVkN: vjuXѤ>pq&)+iB32i9n)O.QtI`[#G4qHj%K[ptG8G 8|o+Bzg0s
QeiT+I?67r1#jMo\khқEbK2H`OKVNnÑ/k,J(ScFX9E_X7 m|;jlor6m|8⸃{>Qy_\(\1X555XoXSz/z*QЅ<[._,!,5!IEZǗD)ז i0rY 75D$ok{W.Pd:_ɚ_;櫌jSi\R] A殼YLCۨTl2sTyT0ؕ}욁>5{LN29lcnȖ2jT⭕t08,e4ʛ5N2*)l*}g4bn~-P63gu;;<y.8fJ:2ب60EdR'yxPh:jZp)md0<ƨMFn(d8@Á<4SWWQTAhPʥV7 qg"{Wc\'p!׉k_K' ??v..[K8b@{PĔ<hGM-Ga1`E(~ѝN-.%av>s%]LtLe:!2{nie23hg3
 `St72rb!=,Ɉ.~W?Rt,=r_`=Z5|oju/E2kR81K!OH詝˘\?ΙrFBhkx֥fPskqo4;0R1*8;h%FlϺx<@u.t{BLZ~\PmHФAryxQ4og̋\AsZEe:,^g4 JFZ.|j-ZMPe4iOBpC\Fy]VDȪ0nj,xq{䜻#gKt!qyjŚӋ_Hw5Әđ2Hf#.0ڮ]Ydg'95""dznUbP Hyc.ns/yvƌSV1 DC?"ƎWɧ4y*J$
lￍfs6۫S$ZYX_m7Y\o[Pi"+[PͿT{em}c翽>HShn47mՍ?FڀX_]-5k4{ k]o0]!חkD=_􂤛Co:Gyzico[?doc$<\`RoO6Yr9]zWȏGrqXp"Snx3ut3Fc~~"3zsQ|#݈+Lux:?A87x=<m	K|	U]zyIz~c47h}_(<O`?h5R#z^(Gؙk&)'! X8oL̓7cvإ

qusz·21Z]>y`hi3FZkAoC֜?FR_,,؛Hc"bn<o39F8WsNuڐVQZc3pQD8po~d=ٓi"y0!(~W5֚  __YHeߥ,<xrQ6olB^fUomԀQ%wj%OW&蚄n:5
gޜF#\t3}G[Cnw,cƧL]M4S׿rvt` dl`Wps?02n`ãݭ6k/21ݘCލ|n"qwQ%~-OEFyz䔥B6U.9 JaAn/΂z:x wpxD5~4|.(SΆ^00P2~^t
2~<{lPz`ϝW;nGi/?MχzFO:TiFps^)Hݯ^<I{Oݟ^uG/GKk>ѫgji()ײOӒwWlZ;f=ݝZ-Ӻ?}|{G[|3Fc =hUZ	0ZZ_GI:1iU@ӆ@⿃_"Vx 
N%o7kXuٶ|o#yӥ)W0,PaYa4߃\Y ֚GĪ</xve۬({ dwSB+{A5Iͬ[	z+O?n#?)hwD$Ζʎ3/Sr3vM+|&nw~/k9д+=F_?}EF5QA[AI:5uP]\GFJU&OGiԎJ'I 8ef
1rP(KԻYdgFG%!#~-裀d@.r?
ػ<=tXwU N>SwDs$rhN2ȷ*VsMi*aZ+mg>\jOgW*hQrJq;҇Sv[Ιh,tpV^y4GIaf=ko%93j@DJ=ԃȆ5U8߬ԁz!D̷[k2ZBB{fZ'A^KKHoe}u|?F	>]]XE^+>Ҭo q^(bbuGJFx<Z^lVoi)r6A:Lbt~FI|ɺwIn8+dvgqa`n(*QBkƱIcS_8(S$2%siI~ght܂𲪼
DP3X/sg1lG?dg	e:[V]pzhtq<Cl_nJ_o/}7?cw0@ݙw(#-SGV.cYau$c-.aGzxFGq܇'=Ԯp_F743ϯwlg9~=0,
RAZySwkՊA֋Q*b6Ӡ̹6Hu1|lZ-b>7*cYb?|g^tx+IUDz8{Bu>Ue^r|)%k8^#W8C,ꎖ:M+fU0J`h>>~x7o>??Lϩ2r@ԁL
a|f4;)è3[|,K̈6şDO1v"p
UdixZi=MvN;W
ޘW.n3s2eTwxjAӔkoM->Hy%2}Ŭz_T
\¾$2AZT& B-Ftc̴ivQܬH-'i8BŶM;S7'H1-kF>*T@&RH~]͠lb-m4| + =cppսgl10oD[ x>[DLW޶{B:?77Yoߘz6&x`0LCEqDԵND\XmqKhE~ |~ٿR#0&yc!ceփU~W#Nkƕ1W
9/,# g"K,nC"kMM&jg:H'A,dR?;⻳|1'~@,F0qğS:VۂR-C=~C<G"i5_Y!voPi_EOcȖ5ANaNap17śT4!鍾idejro4b #U,qmYߩ$"Xݸ rK5v>wGoa}2FǪoV|P7)a|^0RƎȠj[ Ѳܪ][vjQXU7KSq)"2q賯r>Gd[A:`䢪CIsYw鸐ǖ^oRoG-"|}#j0Tg0ʃLC
Fj4 I$YZVg7"?Lh,>/rQoml?6k*( otLxX
[YVKx*aT`nFWl S3ݕP]DYČcYR#hw"MNn歔%6e5oC%uHAU^bX' X6(#
c,$m%w@xMvhURchzᴂyrzQlp.}L(ad/#}}<3We4j?Wa@.}aEv*u
^$z]D>;2( # ?z>bS@~f#@@K5,m1"ޫtUΣjQ);,q}Θ}|VWWzVw=NcȃSOZG7@ ~pQj1~ywxՒ\pf+cU0{L	jԹ$nq@Ϣ"}>9zqڟbfnG?^n@&&ZU*ʟ E* fq@R|LMH6JWĞ\x4GLr\0=^Wqz@k*@@.|ZV=`0hi`{ėca,=g |B.۬Tw~4&u?2Yˊ_u]dĺV]6|CvOh>}6tMHDH?Q%SZ_x_]R57ـ}7h7M:HcVfPLjqS>އ	g!l!5F=xfO
2)'퍋>):ًr5𭨯|6ִ,!GB:ު"֔b@Md{יIզ8fqٯxBV
'KՏ<B+̠$W:)goa8tg&i/<˧#0(vQ챚uh:AzsSm9d]m~G	h
4jPgaQv6= ]Zk~	_G}jG{W ,NF#''aNjxw~YHUq{VF3LU`
K@+3 uEkoSMM"iу~`:ؒ\]׈uT)"M`5ExD^t;iRR7zp/7a4&j`(֭+[f]+8h@{c\ou԰.iQOd7	Թ12%t¤70S Aɝ+v>K 05OsTW~ I.!d]
clO4m&mXpnQ>Mr%"WԠ`sBټ =AosM OJ)Ag' *2ٲIukeaN٩qb2* ^{pq|N>&5aqΆ{t鶳y{FØ\$!2p
DPyF,H''ׂXq?|d._]o__튗ugnE(LTvzQ"AW<KcFauJcHx:bjl:A<[f LIeYg^[`5#$)\*5+I'"1ӺvyH]=8n \e!Mz	Dk\H L&VYsB~MBx!4*G
[h]ُrR4M>QYE͛]k+8~BFUnYnvosLsyb Aϖ j)v/FȻz~MعT;-@	40Cѩ_e-ɨ5hhD'C^ghdY@a60A<E1SVnW
H\iD7XW ןg8yʗI/hi<ǢO////hq]wU7-~w.FMiypE%N,S)v~,okPс׃I:N^IDRU`_:_I>22WBЀ@X0$AnǈltĎI |+TzPk}I7RhI_A./8Cěd  fC>Z8֏ZeY7U'~6Z-MC8+90DQmj&uQNZ}/!x2b*pV
886wFWԕ2rΆL52Y'bt\R~JK[Z
;hId9kSqr/_#
>_$F{ý5kr}Zr-^<FׂϿFu8^^Nkzq·z}~=˭8JdT\uEE[#v=4
neBjaVnUKmi'b)m@C￐;^oC̋&ď/lf7ޕ4C̫<Рz4y34z8EmikgnyGIg/z==aw:;:8xK*@Ӄ%}X%kkuj5_
Ϋ T9t~}>3SGwu7F9.К={}?r+r'mˈ.0z)c lɒPh3ռq>u~l1z^
h }GjG\>$S?_47Sy,Met*4I^~֓pc8hNcmQcwQiWiaV<;.(inbX+_=bYBi26zZvvOlGUi {WUټb0QN'R6ʕR՟*ZKދQTDkb8{pl#8I&3b)jkE[FqBܔ?%܂!xb_BomBzC csϞaqK&4I?뭕͍(u{ HG$Hba~#~؇zA܄P3t}IҕsdCBo^B0(;;O,כֿ)m}m{}cF=Jz`ImouDH$BEx婅^Da4X@ da&~/ci6QпRUz5paAo65!uA&y*Y9% 1@u WO~lxL >VwDw٧jJ3ciIu#0iK`o5Itg `x鿌E|(:W:8 z}7x]Ur>
[>r/8 4%ILЪI8b}a~ K1[[x/\d6r$!}gX E^/A[{Oܳuys:Ȑ Pu ~jYC y&~?ͺ5^j%t҆AAY/h>bVMۦ2[΄yWb҂bWmtşL6^E8xHrfJᙿ>[L=e%fzñ	DvK&
O} iAz#,b$-. |EH^<4OYxaO!n~籼MMׇ@}e$#e@]A6=xG.0{P2@8zw @;}K-aa^7w܁g5Z@@)a0t_wx;~mn?:rX\͈G[ P!g$^qGP9t(1,8,DW4
fG#u-*~gZ:+O9y:^52OԹTz%trp_ܜ~ߖ2.iƆ[X{T+3ʢzrAH;D9+W}oiiiiiiiiiiiiiiiiii飤$D  