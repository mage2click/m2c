#!/bin/bash

declare -r m2c_version="0.5.0"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]
        then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$(m2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(m2c_msg "$message $(m2c_info_bold "$opts")") " res
        m2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_msg "OS compatibility check.................................................  "
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_msg "Docker installation check..............................................  "
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_msg "Docker-compose installation check......................................  "
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    m2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$m2c_log"
    fi

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    m2c_msg "Password required to trust the CA certificate and create symlinks......  "
    m2c_loading
    m2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    m2c_erase_prev_lines 1
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_msg "Locating archive.......................................................  "
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_msg "Extracting data........................................................  "
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$m2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c

        if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    m2c_result ${test}

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_msg "Generating private key for CA certificate..............................  "
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Signing CA certificate.................................................  "
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Trusting root CA certificate...........................................  "
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$m2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$m2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi

    case ${m2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                m2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                m2c_msg "Creating the resolver file.............................................  "
                m2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                m2c_result $?
            fi

            if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$m2c_global_dir"/mutagen/
                chmod 0755 "$m2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log
touch "$m2c_log"

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c

    m2c_global_load_env

    m2c_sign "m2c.test"

    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"
    m2c_msg "Mage2click toolset is successfully installed! \n\nRun \`m2c --help\` command for usage information. \nVisit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log

    m2c_load_env

    case "$1" in
        global)
            shift
            m2c_log="$m2c_global_dir"/log
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] r#G(د˯.BU&Q$EIdX%$]@& *r<}؇=;{}Xî~|ɺ{\2"22q!Ȓ%@f\<<<<<<<vMfss}lH\hm6۬j7`wqz1WPTO]Z[XmnWDߏzH`_퍍͇DO_{ca#w+㿶	VpG?4nh`lo^`п6 kke߶6`ͻ)K㿾!xH3Oc?ݕ0l!a2_>`W6h6>1ދ²Κ&mHSvY?
S&Ȁ}~k~.4X3/bQzK`?eg~҄%~|	;!Kσ LRp%}vSxP	lAЇ1})j%x3^%i_	ZX(:X>:`}@y;'$z -Q} k ~
GMh Σ$<z'Th.G}ITiPFɻ7YO`mL{I}0 ao*i:<eT.-o1>*[7+đ {[zb=W*f1NAM [zϏ4y0{d^&1B<,IN8\?km*_5ZkmaGiO|i)8j@ݳAt0[oZi#VY帹jkxk|ҋn)v~WXv1,Yr}F)q
8?\=
C>AZKR_vawq9GT
[wW2KҠ^3Jn?2w5*jĿf9?1`X:UNUSur}*TMiS5m{''A:E*uv [%VUr\*W@ؤw2	%3?@Hl+UZ$qt*+~DA.vNYeY5~xQ
f#62VأײUolF߿hc[Bwc^5ME+|,u<~PqN=rP$.|=X=`k>|,1|Xm]o$DBA>7^?e,Ghtw}mخ	UUZϺ	φ?(NٳW;=<}y={Qg3zpѾGτ?x;G5F	';_Z	6V\9~rV1{cf>lh<Vg
O+6c<_e(gGeaz~G윌ҿx@|,a.L(ziC {V駗Qo;AosRuSiH8[ԳMoAYn$aqEAr2JUCYfWuotue~s\>rqIݱ㐉&"ڛ$bSAػp>UƬArgyk򷸜CһlO6w)y[BNmCjP- p@O69<S4ݑښF>۪A9'f8]8JQ2087\P,Kã택[B>@AO٢Ii2q{kYi}@6AbiUB+#)Ŭ'W/^v_nؽA%kNlFi1߸V?*e[Je6hhʍnf&˶YU&:1mεm|&vɛq[&E,Pm,uVO#@`*+`	0mC?P7qZ1=a*#mjUVEț
*>P{/yM)dv` qqg˹=-!!͙px!D.qLpÂ Ue$@%d42%LUa?M`fR^xϾ+&Urg{*T탗{?NdWUsbHE=.O^6! GGr PgSo;L%5z!k'/7J\-jϦiKlP=P z8k{
r<yt>Ҫrԅ];~Wx6ΐ-6GA{%=sD:t"$%g&6XF O/KאG*ա<?G>b81PEF膨u#]z^xOX1J^s0;I-bEl!ՄR.7UsRL'Q<j^wA\[_UYqYC$;J
A_l:Hr|}6TAӗf+Jϻwα}xZ`y}X%,Do|Y;*3qXIo)ݓhGfF	ː8߈?{PHZmZz5R;5-i/ku!'&jeJ~TCU-ǉ!j=zY?tvs죟wKӚ'g=x~?o峷րlz1]gT#N^>5f<LE!s薜8 iFl RtMI#{GR9+FcfRnaMڡ
M!2Fe"n;IUp uB~>R&{5R+vr)Du41F,GhorWk}<?/Ɔ=?~j@)̕c}ʑg߱\hKaM[-d؉}/^΅>L.rr`dJ޻X<yxK%,ƤtA|wat2/>a\gP'oZ`q`,`B0FʚRUe$MV{Y-[®	i+]UKh9рyC}I5©*FTzm%Lk9J/ȧ0!IƧ:i%M`UHzXg17sww+~$P7CׇvI٦Y~"nSWg\Z;TR17rYqR-
X\PfphUgrU,sxǰ bp".67eQAm\뽫LW}geB>1M:KF6n&U)_',
#殉$a&gFT	SN'FIaZZ`Z:T`
?,Ch\,Erԭt02eF}2$E:%V W51k'1򊁾qиVɇ*ps(q9G3ݦ%1&%ݺ_E3Vt[L LHXfZīO~Ng0S[dv篾~^l L%٩9žk1mJv%Z.l[,Sm?`m4}$ME˱va1Iu<枒p/ؕPLD"[dii'ªoa
՚V4`Te*ʀTL+?vi^!׈ WΫȊٷ֯~O"_'e k%E/Q5V$5Y9>C@̅)ι٧,-lc,9F]KF&s46#,E^ꊖ1̛:v7u*&MNIXݤ!!MXS3=_ĝ#A#6&_G+K'r#'>q28f@O)RtiF
z&_8N@ᗗ }$77)>DS|?$$"4
$Yrx6_2|Qs#elTSw%vq~b8i?k#q^pnw*ӚC_\mc-^ف`fSu0]l`n7y{nIH031o	snlٮc=[<gFىuк9_GueogUhSUKU~qxE=0R( f`@:*?X,W6=764Q]=M%Ѽ	C|BNOɗl(	|qtdgrq;eATUW/R-#=y?thX) KeE)3)IM/0&+Yf.Hۙom[e`&r;m82tAB,X&[Hd3_Ъe@eB@</XhtzYd,F.Swz
]5YHԗM$52۔|N(mtCuks&Mc~d+Sd$.T˴QARz<٬.=T!03t+e7+N=դR-)ܟ04>bDW,/lCNLU\t6=qA2S9rr>nE/xH~U㾬?SMQiᄌ`~ށ6^x WM2PYZRgAWf2g6]\iي6HR]>AB7˖rD|U
Hzy"v#1YXa"#IQ=/өhC4rխ++0A2ްM]q@qnMCE
rn:-k~EP/(:kZ۴eKiqTZq$xP8Ҁ>T{3e)=<҆Os;`Kd7T/Јv,Pxji9<
9YXͽ*O2pZDz)CP$+t|)Z_)s4E+#J,Ph/T=_	ϯ53Cf,-#.Z,iD!*&
`ڑnѩ|j<đH<?C_MH[27<	3 %UV匿`qяNGƤf"5$[ݠSNTC^Jɔ&K\4P )ؾKhlƌ<ZAK(RYH!LYnPfUt~ Ѝh
 nv$Ӟ FWЧ~f|_X0e3qm^B#`DK|RhyÖ[׃.gj&mS?F~Iu4AҫeVw۠*UArb"M0~ƅ7.//ac5|خ7g#T+Ol*܎uvn2ӵJw!ޒ['W{#M+q&eaqr-o=v]`(?dNP$9mGX[' _ː.M#Y)RԨ*GD~_-pf|t[~ yR^E=Fɻ̒,OT<O);(P("iP=鑪G={-TV#+^@$-)	iRbÊ?qHS5J,E ZBgN@x}ʆ0u	_P$E/>"ݧ'Eę5#+RF{+"y)W`=rc8ǈ2	<ê s
oph 8e4!ILvS;!uoЦF	(X~ɕ	ȃpfT<P~;
/QLF" F4bOt;⋈y'(dn(@xƉ^:E!
MuoI|JfVy|u_<Usb֟Xq+}:ݳ}:#kZQZhr-D*IuFxXSaMu- ,H.\zhXkc"Xj6)&ڤp[ȋEȻb@Ѥ-&FbakR$oؾ^]_VE|U!}cտD1sLFqd1{L.㏵zyb(ˆ./K[~i/e+نlB POWM	|Sߔ7%M	|Sߔ7%M7M|.[6dـ_|"%}bqzo- g^%/ԷշMmC}[SVշva*KmU_[V}h
ETVQtgoY6o--?OuG^qfj2jÑWļ't߂ϸzY=HVl(cܿ1kXf4"se80Oy*_ݣƨ>8h'5qH:M:oܢ.6mG}gpOe6g3ٯ,ĒI_%U&jƻf6Vۉ^Ce	.ز*uU)7	d2iӒ@*q(JU^3sX2Lm\/\UI\z,8;v[baz%y]Q]O|qSeR$bc2ħѪD8|X}ei2d)4=m0JTYIuv&"&2sx6\p,`S~ZȘw71h0l@*W~KsOnERy [JlXɰt[7~Enl1))ƄꢑDHW4[Z\dGIhk\`luS1`T)!ݲf$sO\,MI`*"	+2Gy"Lކ<Ե{.Ұ^0xY
3z4׹'sEN@/Jj<đEy8"`*"3olpsVuq4ғ;yLӜ_&Z΋肫V
1R;Wӌa&UFw_ykǳ[v,@$J;/#^}s[wę|9k?Sܙy~yE3#޸'laecaǼ+-cӢ<g=.r9'GV_itVwE{7[#WD}(%&sG< L<0Lv
©rrtцQԏ1ㅏQfƣiݩw=jg!к$ߧlId%?F-*+D*&f;9di4.xeYy\[Gݥ͕uXuptC7t|gB<Y^N2t֣TMifXKʈZL"MU7hI5Ef,e+LC*MRfѫ}wm[or:"p63AqFx~g'\Ԋ^67Ŏ3y>XW]PG3u~Q˯5ĹH"b-|s˳n ZYmS;R\=F-֤Ƥ5-&h(/Ljn;O`9N7E{mNuM޲ij6&:^0szD0+T ÌW='_mn_I[E=s	|1ùSSM n=򸙸+Z)dMF]SoWLrMT]_pXIo1}%8#
{MmX1gm=5Mf7ʙGW7MxNsYyhy/ 3EW0TËE~Z
Q (?)xygh{荓4{CDHM5;sD.،u'E\ԅ6i|o5	]f{Ȋt{L8$}rJj18M!>5\F8TkV=ԋgVͤB~))qa̜{s(KzjO3s9!ert__֢9p<rD؉;^׸ۺiA=\nmR*c`ojYr,EKfr-Eu9Ue2\/B+IFo˟ W@J`wf8(ֈ9xix!Q^.^H/u$boIoθ'5t)r?)*w؋lhݛR(#WAa$Qϕ><W%QQ2rga~%4&[}wpxDKY5
6Wr ^VB	z'2/<	 iY؆lxjgyܭwey}pr'w4F^ދ~]-/ awUn®]l4¤K]<̾,ݏ]vhep$n(=AO
/.ܐ	I]@BJOE#(@xpA4% 튽.#+냠}_qG>C\r	 \@
[;XCq={6jןbUS
WQT+,	s`_hqJaaԟ1Wk`-l0kwjȮ٠}|))+ֿƲ`Y%?:)#5Yݦ\b[j'^9la#U;@[-lxCW2 tKćz^|Ee$Hl~HSOfy|Śfʙ&{'Lfk3:w'c)HxHнCDs[鴋ZKy w	=BaCe
I]2#Q
dI*߸,J^׸@o^W!,#CЩwRE"1wܟ['EQ}G.b`[T :;.Cώ	|K`=VXXRS1RhDc$5+;^ay$CoޒXkGPhZr[aM:+"ZfͿWIgTxXƖ?PŸQэLCr#L&̨UAe427Ylba$SIUci6ee,	kU٧liɪUjDRai`7Xx'Jf/Vkܿ\Q=؄DނaIW(2Z0
@Tc =Ѫ|ΎzUI o!OXo099HBdC]Iu%R}U<`,G2uz(n<Y7ÃBt/ѕ\q	Ϊ(j*
n)jaG5AQq)iV|Lh6rFUmY۶yR_AaR&Y0[CPj(v͖TwN^u׭ֈ|Sr/0qJ=pvܝa֎sc}AK7Yq&['>j&P]@aũ}{X]6nO8ecyaJf7";(c8uuA5!|e*W΋/cr&F`;}:|]Ơc?/S!;1ÝR̃b "#)2Q3o	{RBچ흂@u}brw,*,T%WA]AUWg~C{*N('TvB` .)XN<M&NAN1~ՋLFq+Ixk)б%2	c7`ܜJ8XZd˕#
:St:1\6_[`Bc8hiBFYpƾZ7εb[),ضQ+:&hnp.qNI'!y9j
J6
n49jiW,dba_Q"N*n)zA
 
RV(+*a1o7p,(8PNn@j,uYP>TWQ~Lua7ʠRSե=kU,
\i'sb#kA`%%TuzaL&Q#D1rY;w3ɏI%o}[(&Ȕ_n-ө^ [˕
m-irEP+xq4,3.MP2c =I+ͧ	hO_vՂݪE1(7="@_Qx]5Y>c38E4GSdK:++Jרb*ւqTP횄ka.rP곪UY_]'5ׂ\L:~גOAlqͥ
[$/.pGb(ٵZ*խc+|ZkɮЫ&ʑ:ϵ*Ń435SpUࡖ:dN¸C}Mt5bW`h6ba2]caݠ,'9҉i5¡q0J;􍸬w\w;1d3b
1iiS,'Ӵ*/C{sԯM JeJ,@ij1ޭ.[3ye~>vav9ʢ҄ߴ[XLɐK&߸-Hل&-yg!=T` 8-"90;m79YAʾV`)30XlRH4t2Sײ\nljraڻwk tìHp,x)ږn\6EKowlMgۯ;aS{mmF7bmWucE1zݼ~)V1ѳi}j
ua/ݡRdU>vPpqcGrmLZtոub	liG$-I2eO :"ZzqHMkҝOO/N+-vP`m&,AրF,kgn_b3ܬUϘut2(1oȻ Qb)k`"A3b.sn:2CjfS+UʮZ4bd0wYI:Ӯb9\;ŕ縭p&uUϾPp5~hDgOŖl0$C{
EKV1MgAY|eE4}z~ . b/M7brYiA$4ʗ,m`FxVرd6q3I5T5o!u[kPh9'7<½5Yd8!.$Ok>cYXXQ<2YcS2ᗗ8Ňhw'cVmc^*I#k06_2|̱q#r[{H=nㄓ-mmA׊kqҨǍ?y2e3|W$k(АlY7xs49Xd"ȦQԆzo!meTԵ-pb!Y䏼DB_y]Pgu?
 hm+8={WǥNv8Ao-|7B[f^CM1E<Dѷy3w[0!?!J1׉7\n@Nы*4g::5o
j*@, CޗSw.Z쓧j|@M(_>,eh[YVMg%E$~o8^4Y/g'gZMRNԩKL-/iӭ[52魊Gwl|m.zTژĲ՚Ĵ\iwrF2kYW'V9;^\J{1.v6893<v==BuE)uû|81o':]r`8+uVow<.y@]5>'t
PxiDu9Sק]?Y1-qƠ?pqp3bzrSƕӮGtaG.8NmCnMyڽt͍iR.io]~kwtg'oat;er\pg-^oa>E,	[X0OA,5iv|䅪VM6

E}g2x48>OY	j<l汫޹q*O ڦܥ+=++-VVQƌu~upuy%D6Z^@keV
O#-"RneԷjL}g>Ϗ^oڕQZr=<o,T^#rGF]#2na!E0o3ZމIM-SYT6LD⚳tjhص箖_#U7B⛖G[$dOӖ6F(z~ߋV@b'A(Voyw.h$:~uﴣk/3vU\+9D
7QykI䚞S}wsN.W Ae+b*{0CM;0h<tqs#ni)mv<P@7a&w	l ?)ZK
)aZܓcQd䎜;idsY6 E	yrYI`̨K}rY.4'Gp! vIGǪt2uS7hÊ'+@(_Zycʻa<'2j=VAH 87Hn%󊝹KBTsci	rjA4?gFES29u6t~KM&>A,QfrDLr8{i@Nrn *j:6̋nVPz,W'/gŨĶȠE}NH1tdg/*Gܣ:;}0zkViÎ#!_~aߑ0#,Sɕ0	EG B1YЃwVg~#ʊC#BE-	,}yA^As]3HA	2+l"_y7)LFg%/l^"ܺ<J	ٌy.˹|Q3` q)8]YRK|r7%H$Sh0|W[R1
	o/%^OU;èO޳zCW\ܲK_?GCaX|4)!>HMSd\449rj?]EiO}׿9n4c
Eze:)=QvnT"}ϴbbQXr$lF^x-f#m|&r,A(Y|eݞvTqjBUcFe:
m %R>Sߘjm~i- DnCstQs|)|[ndnFr.3:{]F*jZU:RrTb[Ǒ,ZhmaZc~~F1P|DD%F,N3jURS -^jcU:-Rvg!.ŏ>5n肢N3)xP%gf=W w^Cm%MQi)g܅V8+qrA<׉wѵm&,<_6Ekv;؅VҊ'f8fV!5#KRt 4-(&\Q Y5j6,xcp:?oj}ބJ&"vhƊWq``ek1|?-w_ѻjEA5	"gTCү|VsS&4:gFV[4H/`6~f-O-@'G9xt{͔"Pʒ9ks	G="15O72հk2*[WV15okm}E)opiv1E\w^IXMVg'HM ^ހpkr@K#y	$^nK\zuP^/SU啞jEU^VD9@Fv*:X%xqlq^P!q*wXl}1^0 nA<N~
?U<B+WwGq4 O!IH])O݋bh}.?eA4gAz>>{ځg<;U(6I
7o.v ,".A?vǈE|I5=Ԩʽ=N؃ND<9qУWUu7(sot/cڒtIpf{à@/Xyy|mmz.rc	.niD^i]b崎G^?{,|xbâ5UkWlz΁'xj00j6 DLBVdDsn\ЂplhG郳b<`OYNƼqp*0GWi'e<Cq7uFV+<L>GͷYDwc7י_u^L<%σςIh(EEyUC`Q׀Oj\|:5DҰe&_,cvhB!	%Qq	0`L'eƫoA]QcG^I7g?#/I:PaU!4!z<Q}^WQiH~Iv<l{ J(栱m.
\|\LTYN npX3BV ez]HI^?ޕKuvXUʸֱUBUػ]6uSj1ljm(ӕ$ap0KUt[>S? $0m³ͪgw89,\x`4}AFM7>/xku:.y*Cif/J^ܘ{apbi1ϭD7/m#_Twuxs_KF:Pp*#nOm4(j3#D\T1||b.nmQM>JZ_G-݅PuzjAr'/`O0{h8X-TAάjZKgWb+nVwPy?꣐ajcqQO)rX(,%LXֱ-6 -G:\Ov(LhK<W]P.cO/}_~M#x#[W/_t7`9XIdo|>}e淐7*g/HGmdoD/,6]f?_n~vusGܸT<.[e+%i\J(3يQ93MȡN6OˇxFzh+6	кٚF]Kz<֋~iJ7Nz&ux#볮7P5=RbP!ki | ֒]am;I}4Hb8l9a)'XV{l3'MAvdiE;]ƫV㾝j3x-!q##}Ԇ:-D].ɡUEa\@BxmƹsCL=ƫHAlC(Z<@)WPq-ggIkVc"-4*3bY.\G5HjDQEDu5XWodV~dX`,o
@?E=SêXqX~pp[J5¤/fs6kS$Z]_l5J>q
ߕl%E?$i/Uoc_m6q۫/ILim\knm>} !Ѱ:;[|lfu (IF}K;Ra-K^v`iM?y/c<9c1mLo7}$<ZbRWl3,ؒm2]zWOd,8^S=?.DU`{&U +aLuxѹ:7@8Sok!*+O2HV$wtVu%yF#q4eoLl}_$[֟~=ԯ랞z[n?v&G
1~$f(^qyF@I
Z=Ơn`U.wUS	kyxQkwyo?Br+[-m77ց!$6Xe^YZPwFg&BEI5>Ve9"JY+VsmH81{Ǩ nu7?
W 	z<tXU|?dI7{4ϢᝲcV*G`@H~ڪ͛w.tC̈́
L[Mmފ
uyޑ<ν9#U\ArJʀYVR߈p:6^m>J1 _|}}xs}Vm&Ƹ۱/ͩ؁9sJCN0J<|;=1$G3=<	p6&5:m`JaAꖖdg/ 6n=~JCtnDLEj}+#۳xVTj><W:x`^UY~CF=y}prgދ~r#4^ݟfxx៟Sn+WG<Yo_yãhՁ`rz;8zQL$9bz~gm?jֳa:}wY7uxVgnş;z/~"|9[N=hϭ[-Ko={J6	Y)%+CɎi+Av
^@p1v"v&Ut(>,,Q`I[/S4\r߬o MAo[4%x[;5s[5 },5nJhewSwnof]JXlW"_:WǼ̔h2όVxw.hwnw~@/kkФz'a_?"zxЖn@;nExP[V|Ŏ
l<l-2%FiԎI') 8ef0qP)#+HeVÆ;)wW"BGZұl@Nr?+C4Q7n#N_`y/k3uGCznwDS0^ec5є!͑&A&𥽹J_kν=)÷lz|?vc>EYn٩gמs&4@$ݢAvU>m?NNt-I?X}R/~F-(5"D.u!aM"Nju^92Rqk}c=`,|2z>YOϷ{%,-5KnnHho66|>yDu+5殭oJ^oVESZ+Ni7f<e L*:,Ew}'JNރsAvY!Ck~h@3fv?dX+ai{Ylt2%Y	Yqm/9ZqFM$7iءy.5[NUcQAjBNNtl7 (,?1eZ/gV2<{/Go7?cڑ<7go䣌4	OuPyr2JgMcmy9ŕc%,2%d=>YL0dFɜEUѿ.ʟLBMim28j	7l%#o}MgzN dRp3t(Hj{9z0.)ZP"k˙nmLjUN:-]rxʣk'#U'pFPHM_X0΍24
}MR%4xVǍH<bȼt1}wDoܪTU`	3Dd	ݼT:M$N8޲Yo{}D3PLU?hfۨTI1^w{8;ۨ{eU~ )$z[D!1c@3	EA6Qc@҂xB[B\bF$.!MU#"2F#os+E&F',R?;kƛoj_w>Yq:ZϩљpےtC_f.~G"m5_ZbvoPFY_;͌Ց_u圔3#L#F]AAKBjrsq@LHܰjȒKdH/'1qB~_g,J@M}}M]}u{+U{S)yg//+XPe%c`WV<aU '|A2SGVY W+9P?Mr |<	{b%1)SgxIcV7[&t=QH킴	H*3ΘR!gryU/#ĵ?(~&Vajr`Vr)ʋJ]_|Ido-l?j+pZQ(;spv*t3bCtޔ!V%S# #	#Y2J`t'"/ &=$ɃѶbXVVͫC3$跛V (%aG04'eܿ5T] Ifcr]ad<B-?bBDe'On_i0\CP")@KehvNS-
>ؒLƃAd`+^g^B<ӷd!
9R+NK5+5d)>(U[LմXM;iq=a7էlu$m*.`M5g3g@8,X51b/.±XS$:ehgc|h%
|`qUJðzk0r7:#TZ^WPPQ`>iA@KzڟbfnG?L^˄|Og[KjiVtZx|&
4 ̪dKj6{M3b. wDW\$,1\I65'MHnH
m|vS2v/C
x>=@;L"ϩ/&kNb1\~X6	#}C/4JzGOqpL94[焹}g+Iްm\C/r#A.Ql"DG
{c4E?{}G	k})P~npy#K	MVvb`f(s!qRW`>Y :w#Xm+\  ?RtMO$:aY&BE#[(;q+ #IrBܸX:*O_LUڦmbPɚu02J&%m۶z/Nk,/~|K{_MufLdY$+p,n2Ofܽ7B+z̰0nY30{hп|* y
bnJaF~3?<?io@c7[j'SZ7KB?<m.4*.˭7Q֫ZrlFBu䯬xɌ~^w;/Q< q8ӱ8L=`VŎJD7ILJ&qa){w]:uz2X>߯@R 2<G5k<N0}OUyqHpxh`1iAL"&}ZCeZi&e忆]\*k/GJH
Q13ZOx5iGh0}?z D~XBؕŹљ77:;-sCB/Buo@T`Xz!Jsh.7,TU>;Q7joVe*HDEAdNF3ٲ-uʹ,Ya#{HVItNVKNnT~}\'uݢ<BpKLASW+^Oбy)D^Ch41ЁGCbr˔x7!f@ZVVqTxʪkAp7iIq#st$zZW^\?Q+SV	5Ń0SaSD
VvQףZ*=̬6{C6Lw?;1r>bA͊"DR]sQ^ii썘O{GBH',xF޹f$orI#
FSh*NAXwU.]X*.O
 UcZsS 
~{:fP܁Uq8~yZᖖK45Rb(Gh=T
2$ѩ<:;j(_zfAi^fY@a\UAZmd*9[bxklsKr9@Ov8yYq/hZ<GO////Ehs]w4ԤZd]͜>8M(RK:ANtHI+R Hƽ&~
!;Os0:YB8&*V@l$0j,A.L[HMtJ"S|SPȭkE/j滩Ƥý0Ho
Q"^'X_e& t{rc9T0u}P -Ry?W@h+qlI˨ӠδҔ3;0˒SN(M+'4UЄsWU--y.|ov9BG6BSO>M7:& 8߯F>|uk7'(k]:w9䮥ÎY<kzH05ꚯz@-BI(_wVx"·WXr'+ vr"fGBuEE ɭ\*xx2yJz5~t|Usy#-fw!jgc^gK{u=eLrT@gR)ag8i?<M\['_vsɚ}$wϻ=nFKGGop]%ȇtgIӄ\SZ뽤ROR(v|t~zJRs[vF|.rVG۵S'o'ٝ|[FX!KVܓLD(ؓ%[MǕ7dռQ8s:FK~3ԜN{dﮞ[ŧVfnY[[R.oȓDg=Fs&h!$eKJJο
/vIpgZNN_Q`Ӫ{gvVfPWU~l΃Ytx+e\/=!hl[$BD	>:z:D6A{YEK*fM_c Q$6'DImR ug-<LRM9r\^-f{}3? N=8ۢژYmFk^қݓ MXk/h8JW>KltJ5C!t/p4N243:c"t4XZz.vd̎hK;/Z__{Gd͔amL<Z{?}x/M˦σ)Uަd? Wk./~.S^tȭƃ%ܓ|}}=}.K)h}@\&/T^<\ZMzI˻'yWL$Y9%' 1@u Wp,h  1V7"v]B7]Սl6\wsUQ
~/]/Q~]"o7KΟ,ɴ*ޏ (>W:H{}7x]UTr>n }A^rAxyk5K88'{Uqz9侂,IvϰN|KV';+m6ӔܩURy}h!.3==s!>eQs:Z.*(! $FCF,!}<?ESփեfAGz	(:ih|PR+7Z;OUvV?3aD@SVP|c&]oeVKFw@$h<S&E|FAk7*Djǽt}PM,#$Orۉ4v~~,5#{	Ѹ֟ xBݰy'j/oΒ7N#hf@]A6>d.0{P2@Dzw ;;|}?'vN؟ba׭mz!WQ,r!00}JoѼdW;<|ĭbvurH::+?iuQ+v)g	!>gE/u449LDq`HֹFz5 jȞGj>isSpQ9Ic$iᾸt~'˹sX@?MK^TR̴cWS'L̼큔 `k@7`o?6CzH!=CzH!=CzH!=CzH7VN X 