#!/bin/bash

declare -r m2c_version="0.2.23"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]
        then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$(m2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(m2c_msg "$message $(m2c_info_bold "$opts")") " res
        m2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_msg "OS compatibility check.................................................  "
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_msg "Docker installation check..............................................  "
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_msg "Docker-compose installation check......................................  "
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_msg "Ports 80 and 443 availability check....................................  "
    m2c_loading

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 80 is already used by some other service." >"$m2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 443 is already used by some other service." >"$m2c_log"
            test=1
        fi
    fi
    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_msg "Locating archive.......................................................  "
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_msg "Extracting data........................................................  "
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$m2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
      ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c
      if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]
      then
          mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
      else
          rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
      fi
    fi
    m2c_result ${test}

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]
        then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_msg "Generating private key for CA certificate..............................  "
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Signing CA certificate.................................................  "
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Password is required to trust CA certificate...........................  "
        m2c_loading
        m2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
        do
            exit 1
        done
        tput civis
        m2c_erase_prev_lines 1

        m2c_msg "Trusting root CA certificate...........................................  "
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-certificates
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust && sudo update-ca-trust enable
                    test=$?
                else
                    echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi

    case ${m2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                m2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                m2c_msg "Password is required to create resolver file...........................  "
                m2c_loading
                m2c_result 0
                tput cnorm
                while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
                do
                    exit 1
                done
                tput civis
                m2c_erase_prev_lines 1

                m2c_msg "Creating the resolver file.............................................  "
                m2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                m2c_result $?
            fi

            if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$m2c_global_dir"/mutagen/
                chmod 0755 "$m2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log
touch "$m2c_log"

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c
    m2c_sign "m2c.test"
    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"
    m2c_msg "Mage2click toolset is successfully installed! \n\nRun \`m2c --help\` command for usage information. \nVisit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log
    m2c_load_project_env

    case "$1" in
        global)
            shift
            m2c_log="$m2c_global_dir"/log
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] ]w㶲(x+ٶMIV'vgms$*$eYއy;gZwZ0k><̬5f* $@do3iKBP*Bujqzi}gmO0jvZl㴜?GƋYx77d;>^#<U8}LXfݨ]Qw.a8xGNޮ; .`BS}C?ӑ$|l7-670Nٮڤ}C?
G WF]<ǳI}Y0~:fs^X㡔=l|jOO"?},` ]<3^'zwNguN5ugoÜO{l]36'	;&	lE7d5?"?Gg,7`arGk`?d'~$1̏bvc1a$Nf畇ڟ c$ykrgΆߍgoKkTgsax2\|wЬ6p${2;?D$"8>~&lC5f@
_S7*fa X5c1}CsQ] 5Vsog5	ǣ[co:9ߛ.FI]
	>{c&z3ޮoSW1&qgVnA!c5A>{x}&qfw-ҎQ+([8x0̘
/!.bb\SD%r/
Qp(+>uw~~sǿn84}?3Z;ӵeOF7:z`<!;83hqj8רALQ%!j#P%j!Oh&ao`+.F(}0g8X[Rv3/!sdժUǪs#/NA{@+ӮvLڡmۢM۠.uobb/| %"-"l%0.q	K`\ Shwjl0kf  e1ʻBoZqN/fj$fQb{@~cf+9kꎆ?9wmKeaR"`+YV?Mfs8͸.Ja.Lĺd3?3$Og|Jə)% ;()bU,?	g`Tk/8O%;)wnǹirӄ,ަRPj{jG5~a'/wtp_>vfy?~JˣfBJ{Ow^~CV!pr2ʰm%j<ڪ|U4دPZI/Z_<`^t3ĦP^Eo}yϪ/<h,W~*fp+eQ,.=J"9FC>̡ƨPBߛBdK'BzgmK_Z\)*_T+pV^٨E'hK\yȑot09Ȼ5|^	}Y[$>҆]	c} d7o	(RآKÄi?9o:9>K4FS/9]6Dd÷	*D/41vnY#׍;>fQ__ gwwnUr8)Y;\	EBߎy!ۃp(<qj$9kJZQ5껃[C1U)u*:O^>}qbӫC/D=TAFo/^Xji"g9R#H,7Th"w$y1M8oo:	N؋\Y<m3BYp`beArhdO?|R<3ӝ +HoҲnn=`N}ZT7A&~$cx0LL0>-P✜%o0ьWrff<6zEG߃aRXL03b}U% ^|xëfQ^xO-moA\bE ̝% bwE@2&76Tֲo}Os7K)4,Zv8,9lvZ)֦|d]O̞1o
vAޭUߦS@1~Mh#0z9NZ0OP t6j?0@&xG,M&g DD1z=ѩ7x3f~79U+7#}	sR1#	n>G@oLgxtIki!M$4l1w^}juy!J`s_F_eyYԝ@ʲ$K%ڥ^v-;GuwZOuOzv=ͩ3xO/X<~S]J"go|kpB^\rʢyx(Kh`^zsXE\V|#?{-L	mo'S?EZ:>~a't%dR?NPH#$`ԕ:a*G_#g	t2 (؛WbmÞAgSu3,F\{Oް_ϛ_RȚ!e34/L:e64eI"a7Fl)4:8Y0b)4M49j?E>:sSت"fڿMnZVNlᑃJ%$)o+(m: 
[xV>`hbA4W#_d-ȂoKZ!+vUYfpcʬ++kã&؃/~ϿدTɯwDO-LR5%ҁ^"EBa
* ]Ղ@5y!q$2
E?[#^tNW Y-e~E'3y7?Wl"G#')0;B,a˰p(UZ(krJcAH /,5[YYL`Gk
Oh-{ÛV-#PQM MgLHN}FOZvh{i;ui ļI(qߍeIW5gg"N&b5'Xex,w
̓SuBLgFSe鵩`neRR{܏`2 t[[o!o0*7_Ӳ<UaO"w\g@TSՠ>f_>9|R*_
_

_
^f]
MAuxʅ/vOI>>/6*Jdh5Q5ѡhyEG_XhV+I~	_.rݰ&1%ݸ]e#MkVxSj^+,1B)լGr8Y:	&$QQ7}%߯0^0Sh*[Iۛ\Z%u?>NBZ8u2mWOCEg47'LT%st%0aL)*`(Vl[eZ(Ş(a)d1
0׹1Ŋraڴ_qFH݂:xd:*78[ V?	(@_4εfgiIG\﹋f捱i^ks쒥%u~xca	\xu?K;`u'? +\S\f%eMľgt_F/g6fV9u+i93]2ym߯*~/ǁi#cf}aseπJfeXòDЗm$>Tw\]1 D4}!qmF/rZ+8iD]WJn!65D-['Wy^R7Z_:OoTU꒲5=/8P
9֐6f2X^ثp,mR6n4dn6y$rfɭ"(LN+s8|e[(toR4UgiMs|9rlŶIׅ}z#	-Za˼,[ˋޅYUFrpŬ!J1Q
aXO/PN=vtZіD[AYw}r<VN $/D3[I'Y<gE!?_)Hv[}>
G>lvOb~~&{ss"z$Lt$AZ˜~Ɖ/tBժ`s?LuRLF	[j$	^|;8Cd,՚xŹ'H͉OI5uOE>t6vgJQ
b`tA&93=CsZ~5fyL ͡L/GĶ[=08Y8q~ |b3hJBCnҽTZ2Xʞ{|πɩa#7CUl϶?+LB&\d17Vs\nvRrL><GZ|,=Z<+Qt|>r:0yGf	nȁ pS.HV`WV)3N^4j
uę7fԨ ny2ҚV$|$v12%@b2N] ei"bq(HOUqiYwr`,WS=a%gJQc#ɡ"SHyHa!;PC#˻kWή\Y,`3(='ó8aZfsͪ(4jb!DjȥjU1
EA.55[?ϑ1-fΑq\gX945.{*Z[&UN~Û)šEQ#KHpfy/Zs,Y1ξ@Br?b,jfP*Ф^ 5CꨠD"0pdڟLMXm2I;Mhk'&ވp[Xk(
}x\A7&&{/IvWSe8%>6n߈4?ţV%dAr ՏPB82gYxRߪqj2-HZd!V|];"N4ȃΒSӫ*θsUv \d.`^TjCaF1n%(,EvauK.A48^7Eȃ08G?$OTǙlN	hLn/W1ͼP,aNqf|<p@
>/:(:X(]0wAc{L΃4%$&"R!2R8i89Hma:HW䏰a;C}׼&g(*Um+O1"HyiN؎Ld2l~(Wل?6I"0C6FN#z"(2umj.BJLk>N9cVRhZVRzOq0y!Dg$N1ʲ|\THa VOIA WvW9M#)fC*	0h-a%+NX22CelG
IRsTh#ޔ7R:0L1'5W"JP!R´Ob˃u<'h0NI4SN5ɽ&hP5_Tb20R#LWLV@ iEx]s2׆ڐx8}cWarL٨]qS@(@s{oQJ4^GG4?Q튃Y
:tyF.cᑆ_Ç?Q/&ߧRTZbm"n!h>]"x#Q?#>%>S$"D\#t 5+:嗖Ҕ_+8|OJd
Y />MD.KD.KfzU"+u*dDN\697'F371_{n~kߚF-f)AM)<7mp 8i,K=R7g$KG ߊ%ԋ1LۖAWbBG-$ƝiJl[(y_&6%2NZسhmlbFvz4@i>qώlIHZ%o exXm_ݿY#>Ŵ\kiAnׯv}	eJ_0zG`hdx2irn/ܐ2]mTz[E?u:ɔaI!KL@T7W# Z.+	KN~и"޴3)o>[b2XM7+Q2'eM?L^rs"aio+	G鳃WBU8Lp,i',a%1KCڵƂA|ByF7S))n?y޳[b^a\Rnĸعg[z>)ۊD]`)*7d^mnr}-vԊ'e]M{)={nRu-vЦ̀O3JVP+0fjMI\Rr{%EYW`z枺k^Oc
l*´D#yYH[Oc9uXC:̑]w0:/Kү*%{al{_~x#[Ÿ,&]OVGyR#,* AkjǨr#=hO/56WymGxyiH(ˢLOi'4k
u>;bM~>+?_ޘzVW?	9j hq7"t=B3?]gueN_4Rn:x۲o,SnlL-KJ3qipd*E`KXК-0~Spx$#@g̦ˆ4)ovNSd1{K&/w߽|MTxD]2@AYs?\W6* =a{}`{nusv5p4t0a8M~FX^.24I]MyfPIZnfCYn~%f)D(rtu7
&M֦OWhVD(V's.E:\(ΈMWowzACƦiqoP/1*Z]^rG뵢,H+
d/5W^qCў5
H5r@Ԓ	*{ax/Gܖ[gQer7k<0ǿ-V}|&C̯92&5޲j}3и_[bǵѩ򆙙Mfe*a+@	7/頝K(z3rLu$>jᜯL=/oid5KEkqÖ49rkR.7,BZ,n/(u|ur<%78ʔpG0
%"&[D.}Z(Ct!59(,_(xޢƨyW[Z$W#I%Т[.Y}g;tet	$<HeKi3n0V61OwOD|{Xo.e®U!X0$گ_jTcbT/j͢BQZbksPc=f6ƴwVZ0RVpэ,4G7MWȇٝßaaQ?LeVQZͦim]rDuy4Ki9x7-MqWe2ojP{RP,H;ВJ~ 
փtW5o:X`JV1VcI<:[2)fư	 ãb8;W=iOlv{UY)P{%^ѰP?{b.|ws[X3(Nr3v_S9сg,~E}?[(6Xb]Tʼ"*M33ccai.:&'3Vĳ;Jj%Ώ{{O_d.cp鿼|QRΎ(H|k:8x-UD$>.Cs;j?ڏY7uXf՝WJ/n:f<˻Ý{x1P`7#h.V_94ZQ08|_pF1C,r.GSC
3!z^bNWӲPiEt)`PiXA(<Hpڧz=hD=p}YRt^laāYK@6."ܳ[%(b2J.B	%jѺwy'pxOG҅M(Y|KM@1":?94	1L=@fT.yYr|KHJs|旡jb^_o 2ްn['6(֮[';ޮ%W-.'cHa%B|Wfʶ
ؠtm3øPi><gˢ͏9_p
4V뱊~[zM,/UXH_G	8+˰*zIP*|I6{vX]}f;su*`jRUs?o+Ϲ@jےTh*.]Uz?aG?eNk>\PqquWZl7F_eMG.RukL@i(0ۜb8Y\gmZ}+pjT2-$Iq&\T<Yg.?ڀ;յ s7#zSFS-P:@JduT9[%olx 4s}.N7F2	L%0c'Mj7[T+r:OąsHڳulbÙ2qIYG"
h_DmJ];AHɭ
]&x
]h/۟L\E(oH}Ue7Pࡢks/{2UE

˫6+^19S\XPm~[B\P(ڶu#j2"J+<D4hk\ު紴9!Xs=xAپȭQi6ozEpMV֫#irq[!*3OA¹^q:]YOdM8lCf9{sF
,8(c_&UksW^H;e«wcܴjM9Ïw[Ug/~CEn_,*u̞p'P^^vvIYIZ¸%l{1W Vg1]OÁlDQb	q?'/qyҵNx~UJ3ips$
sŹ{WxtY,\HFgPkiJDu\=XB oP[x'Z/U?.ƗbPX͓VLt =AsvL|ĕ?ȣ`Bq^+r):>#>x2AnأF]VJVXP.
{DdqVgK6"i
w3J0K'=:nY!m&!$Kan,vu*rHcGIXXRu *Z
ziy{I>~bGZ0#@ä
h-^!THե}$ *3 )%,FVL,>6~*;QG꘼(Ygk3VBp&)4ɶtw|&C&(K~[(f1W-=
&H/U1roIL6.Y,tșmG2$ąVz]r`FRҫx*ksPAw}3{=JV%1V6^lzIr7*PY1J"Q]Q/y]..EW]jpRyZ"iS!KF
/y5V-8Y*<`0Xadjcw ?+sӜs#GuT2FK=#1SZbrY7rᣇ'PX/`}>/Vz+EzvAX9as$w,ٔi(M_e`_B[V
fZ[jr
ʽqa ,9+47hffw+6+=h|k^77=ml K͠:!]P5AH>EGTxjr[Zͻ
"m*ZLӲ`Ef4eՙҴ-sMb|Y8F0VTnQTEہ'Eͩ
3f[ϖi6,_dӞ"Q}VA!2Hq~Kt3uZn7;7anZzznVkQozs[p_&-&Zlp!"65qYIŷGɂ节䨾ܒJ
I+ƍPr+LFL7p`BU+aۍ//=tbRn[LvzL2
nue\;
l7hk}S4-q0JFޑ?>h*vUEjv_+[D6Vyx+oG k9B6~Y-&SZy㆙	Ǐbhm2KG=3n9ֈK
U$ZoI2/Mpfc_Şo`	FwWsuu1vh%Kd'OH6F4C<iۂ:MJ+ǝع,+¹Nn<-;pFY X_>}ۑUQKI9ym$Ç+_^5BWW	&A}v]]m0c]'0ɊkYDZ+ɜW".VEC"q'o)0e
*Zj/	VC?j]9(f )
P6!AӱW-* Q7"Zs
ZoB3iv+Kq}EK8Q`ԓth7>|]g8^cf9D1Nw5VUZ9Qql:ݞ!6.qN7<	7\21meρye1h.A&<o#*2m=0WDZ2^LusIqtsa|elJmG>Ο eF95o4fmexNvx6漹_ٶd5yUFidp*LdVܸV҉;Vͦ}L`eneʹ$겼[j,S 3sMV~"Y(<D'x>>	7qL9`sMNxZK)0LL\X?&X]@%mݬ/K=zq!r;#lsLgC5f?K<%pSpi
#s(/6MIpe2+r\}hj Cz+M1([h&u`e_-%EvZKgJgzT[Z-+ |KS7@Dvw7M6Rc|1y6Qե~{r~6&Zq́h.|Ů6LN~&\zmJ3'fa
RIC]\lwqT5hq/Q5j}SRQboZ*>$-*hDrd|}QHjg\nɹT9v}Y^Ğt7DMy,u$'䎼wM̛~3"j%IF]-Xܫ[('3S<c}R4ʊ	(SFẐ(r8 OA'D2ۉ.9"j$z{R
y$W GD^/ct(Aʊ֤׵E;V:5,	w^}|(d<Q[뿧*=yr~q@Zbi.6`L"Ng#<̮hħ/)I30')9C]a&w;	`hW$U+gAp,҆@KAb˗	|?0BX.eI){,R+.zBWWev#P)ḯTE:ٗen,UJ"38_|`VQtW%ڷ ,RxKa,W~m=`d0Bfs]yuɆoZ8'y!}Yv\%-3CS/Uxy̗7˻#w58^[vX\R0}kb|P$Q[`RC?l:ˏ3hii@H_302#Dr%h@^UGCGSh/`V@BrĨCBퟠwRe~ʊp GĊjb#e"uxIHS`b#y,a-O\=aMZLDlZ D2g؂Wt1eNVK|_յ͉aJ-bP/BfdIEӿ@|z@wh*CWk:"vW^2(Rׇ8l=T_#Ua_z*q3%1ߡ)5?fI$0G'Q̒2p7
ncԌ981Ri<\n!QҲ+!oӹV{B_hel&OsUJEKk Q)W$|L^f#2b4bڗ"'|9wY1k|࢝%Z 
Ua4YcP	Fo`)ן*u~a0{rr71z[c4 S{9NCeok{7S1)qХRPz$ } Ix9R8 q >BVj@mP:Ո7g~J`jY'j,>WCT=O7)ljJ-^fo)3ej!^DwGdاZ?O\;$ꐣ\RtxԯaY0/3թ.U1le6Mm3o.[4֥e!9
'bSOa-ТK٥7˿L/le,uhɍkPʣ/+JV*Ź ^<7=zG2r>?sPPZpP\h+NBܶG٭+uYJ="[L
WӋE7&w('Qbk*zNz=A0֗}ͻ鎼|_sz+oNVHୖsL{_%j$%o|+Za6=2apʒ>Dc5t9&Ҝ\?ʓuNUlzշSV[Vˡ?$cW$;?I/ހ\{_l!Sqr_U`)%wí(Ѯ,LZX:+ߊ|P5(ۓe) K^ia*/mm>@JSa;M{^sFOcMnI# >Kf	*'0JÛӋq)PU}U3g^0"48y>1~zS)~H&ۋd(ǳ	Y]1sC^μ^
4;,wxZ$HNgGx`V 4/95#ݚZr~)ƙcdW
Ϗ oƸR|?ΐInǁW{e@o۳8<h&,9ec?
/)݄;"y5$FX_bxo{^y%vϗć(;HQU3Y䤊dX'/_nskO_<aڋ=<fqQ޲WE^A ΄(d3DS_!2?XLrɍ
-4 s6 h.~τ7vNlДHGAxy;\qx.xJXӚkx|7eF5uWYڇ'sb`OH_z+{WŢMU"Zd)`@E m拪qrb2a"L3Ԩj#oa7W@!D98lT\Mr_U{˽(#oNGV쒼_SS/^O	ydz'OC"fvsdgR]^(1D1lXn1XUm'h\|br>vО9X5TmLz3H-Xqn._*°X\QZ]Zw.G5򡘇q4kiSDm岝7#<`ozߜUؗ.8 ~vtQ}ׯ>R0@D~bu0ʖ7+xmu<\-lSv;筍Qh_W?pw%uϭ#nkmsWKrdxVW`[9bi;"}Tc:o[V-JjRrcx_5 '/EPxl2!Hp0f"ww!(faZ}059n7]a(@`0lWwy7ȪQrCRwyһ <撕]%407fDCtDnFѸ;L/B+$;$QL!iN_yR#?9}Wq"g=ʌ7BbEy >b%HݎDVxw2oTbX/>7*) "'A(~U#7k_QҫuyPTbԩNV5-sbK*sN~a	oѦ҆vt?ү
Ikh }B'~ۃpK.bc<ei\m@ۨOt.1L"ĖCIe)nwDxDn F:;C[5qIQʜg	_,u\*Bn]ʊf=e<$-DNqk[Q pLg	DVpnɁhN}oxB1dOQS׳|%K+s/[YWi?@ZROo8fPsfB%j"
(V@ne=R#߀6*cAaiUL??Ǉfڭ_G^Z>6xh5;q]VwfXQ)>3*/wsA9E;ɣzKm6-6Z/0WM H8&h7sE_5<z}fECo4
}@MX9Qν 9L{vw7G_Yӹ:vrt.\Zcҁo:7n<Ͻ;ptFaDN&ao bLq_"+X"
8o4=XVWđ >٪D[&QYdC^oشI/)"7|iF&0ɀ٬}O}^MOYXx0Mp8$L<
~?%exTq^P+yMVPhMf2v% ONN1`N9a#qo72X$i-.kx{YjZ[9o8f$( >Hs[QFQʂ_ pV;b4G"Ǩ n6v`W1-bFo| ixf_iՁu۹ɳ.:s[ס,7-&=!{;+e;Use9w|HG(
B/e܊UD<Q\8/9Bθen'wggv-Oǿv	Btrm<sǿX,||xl{vjcx3qsK}B+)yf"hokvyYj>5;?w?ۭco4sFp?L( ښ̱9dqY.$ϥJcxr=	ܫP_Luߜ`+ջt@Ȭޓ>98tF˝gO;?=}S'iO勧}ަ??	jF?/~JkDU˗y>ӫ^I^\.	WO?+MiԬ$}4ӤW?wRfowɷ}^ͺi~Z`wlMg{~j"1[~0{_Ј`w;zY߯fg喴sٟro0_ƨy<N
&,RnB_`HΩmbʺKq`Uu<-X ovZyӱsnRARӦ}E6k{O.@}V(/IstzLFʱҲeyuF	u>yzw/%iQ.ã:A_"cJ(.u͇l݉)N`Oh#?u:T_*#et28cOx5"KDW/N-&Ě+P_H`+/#~-G	 Mu8v;pqӼy'KQhM9Fɣ ݅(ǭ5LfwSoj]<)6a춮ɶP5uwTԎyP;OͤG{;:
/7Pvnq/+e߯u٥'DV8C
ݨ?&c|mi;2q:V'PZW߾CfOZ*kO}N:VxГzu,q&::."ß1;.sͳP@4 T̒c+)+EbYoUw_5Y
	~'7c5>K2"$v-Q^]GZF۬co[n3'[n~ם<>{rO2kI'&1Gc?[?ZU$#qvqգOQ
 [g&E$o}<&M?1XE@C?D]d0`Ox"hJ0A;YrF
' .һ(zt\s/i1 q0bpSoU촧mGA8
-qvr1ucT-6txch~P'IɿJf;nhnNNxӅY4ڴ
Z|vx|eu70V]Q#3o0o:[Wo|x
 Tq07pN0I pa(F,뵩|t;nuIC=@mB5z]n/tuݬ|Y^65{͜V%H<v# 2@kZmƴ;:ʷ98ztN.p~:s7yJHФ; svvl68
9@ fUJe&:z^Bdټ$$` 4cO}/XkiN.gxkI^NsBr콷Son1^:,{I+Q̓*Tw!kXs5uf#KXȕ$5!}0~`3"0m]Y=鴀/4s=4RM?AWm86kWh)Rm~/`KvO9 #$dY0>17?	[Q3n.|x́	Mh
{jЏ3 r.Hg\2g1ZC]x	$&`OE@R &e`2
&}w($,N@N=-6꘡K&7H^R$*?[Xr@s4Vſj^~T㳋Gh08c]%+4=bܷ>28ofRɔz5zbf^Mj%῍4Suu9c]/+uZVmm&buQKhQmEMm.B&S 40\nP3)n iիMѬwV6.{4ݪ5[-=wCթv@ǩvVm蹡Zh7ZrU7!MسNlv[nGܩWmuWXw[n!bt{	n4dǁ- =h 
عYnSwd#=wVmv:\]mj=t [NiWvhnz:Y[*};U;zrvف|{'WNX^@0Nr&i*mk@ z=ц@_4;:nGtaw:PӦ4m^9,]Ht;Vz(ӄ*Z7{vCu
w;*;nWmu{NSKv] kA40ZvƁЃqH  {u^~tP>Dr5:`k]94BF֯È`*dh@?840LvF `s>dVW۝.7_4:-5+Pj׻MH  k6pa)	pq
`Vnh 68vq "@u]t? 6Y­4 &lznQR7چ\!(©ˉp[mjk;	`:EB1s -0Ҙlhn.ժvL E>átM`TP|j14[.C	WtMZP]- L	h{ ZZjGkɈli5h ]&&ȋ~בYf"5at]JP_	 rԩz^
<vQ~(F8P8MBpAсTwAtv3)H`HM`%_^ eWʪgfJ	I@q4N2&Uht  iPaZsu %@@ɪ.i80j;Q*G%ɲ@&T&j8 &4i`ХTmrN=ACzL Pun
	\v[-^Hmv0PP5rNajDD0%Dvʎ	yjQoA65[;AM Ճ ;n=ں  `t^XђRwp:jBT%060t2jE*xqЛi@*`9.h;nU tC*m`@dtzD8$p5fIԄanQ88I
l.mFh¡eǺșA+'=nOˌ0n5 pRau`abO.6UOn>$66DUT0Ni{h۵hO[@j}!HcTTJ:átNud喱l$r4EaLhp@wl94rJ %`t?`,}-.KAb%iP(U:/4WԑF*v t0\:Y:D&'RRu%jWAD 2cG.5j8ua솶W݅N݁VFg#CnȁMm@L\A3hD`X0qm6f'%`
ݠꔼ(%AoG-Orr.(En:zYGNntP(U85 pAT .{ӆ%KA=w%/jFBzn=dF@ `B;i4aVCQtr SI L`HX80fLu2Y|>M8(4PihYJ؈}w'3h+n]|1 ~6긥əQk4jbhC7
&XN]`)I*	 a>0F`>(K93,0CØ$]-3f|E^k)P:xʢ>w`[tLS3чt`D)1@Ų"h4.N3чZ4;UhO\MFoV&`
TTy	{P^} l!ptA=4]Z	))юȤ2LK&pR"{G~XhfsCq@6[HSyEH:mWþRwU?5Qyz
8j"T!`7L!Bd<)Qif[: j\8WPH6oWp& PyD<gM4ML;8|Fn:W%Ɋ4R$v փ>G~GTWFd`G-O`?bnSe#d>`{߰p[¥ԁ[(AzmS
$@xxQ8u`rmMb?_.!7t!礿΢O7@lȏg#y3{8ɷYd?h&i(epwp湗D{vf~̗Wu@2hZr1cSƉ$~d'DWމq ".>_6mI8nqF$"*or2@So$M/wl ߀J<C.m{;خ4H|^^L9[I',%lw T]o$u}GwXZ	9rPu\f&Z]:SRZQqB٢1ʔ¸ ~tO7fvԼJxaJĵ-V3j0At6A09J6Q;l<!&γݝ? qo2#ETZ\J?R٘V80C|M;i$-VK5O|9uԍGGur*xG5/ʊ/*VWt=̋˰V&` &kɒGzMa;OS	W|04<)򜿝b82ſxf}RB-/>,^n+IΎjm0ME'	~GoMpN1؏"?o}OpjlU*_ܦ%<}jBg*A$Kjk0pkXKb&&7[/BKH4]؇qmh#Nn=Q0Ǯ;-c7Nv<d?m [=ԴafӆM+IpIu;j;\.chXW]ρBa.\bmQ]^Zb ݶC8v@ϮԪ!YaЙßyxCfD0QSڅ?:h7k.#xmƙ̱݄E?;.g[޵&jh'޵6M]F.+R`*z9T-F|/ڬT^a &W,SB"OqG5N<g:Vy8kƧ}t$Aϻx	XuFGiuNӁw;u]<FŧkkCG3;rUUa߇b7gt0Ԏ%߱t0zjR({2
0?8E%+v0E[[)'fEXڞ
s~a?cڼ5?
sk!Tq7q[3hqj4H$)G\2+\s[ڕvb,aL,8xLC?8r9֊͍/I/Q!P+j?{ .9_3#;? eAx2_#y`McsI'h}bo00b& C<}++}7YC%d=8Z,]YaN}c	[+0M6M&XkC6aZLD G<'Q0יKN||?go۷_^YW_L3L)8GJ_57ỹq8H! *+Q9u9eeUf*>v 鯻Z*UȟUeL=k
CULsLQy9esO3!pУ.T./QV*pJ(dCO:^d_4,ߙ#2/~MGNqʩ)8t_dtqxpZZg$WjY 䭡[N҄K魼|od)𬱂 )<uXEM9ƋC|8#<kXϬ,vy=K a**S-Y(Hz9'9C҂+NZw^^f(_X"QdDjg9FK z˘~HkJ~  i.>jֿ*O(~Orz&oPƠYLk2ƠAj4"|{G|-XY@vΘYMFHf HhWXRِ(K)*H,1q(~14uD.I fo1):=C+QUXҢ~	Ab,D; v\0I0qTP+BӺB*5DPXE)w}4šx0:K{$t`!{TF8YE=dLEŒ$43lտv8ұ?uy8*b8XYa,Pj!d!!}BHad<*9|"^	}cҡd~?8[s
p`+f`J/m;+MIɡE͌.K}4>s
͔+X(l>[bF~2&Rl,(f>NTnɛSfL`NRrRG(`cV
W̢E49j1a zy0`0鋯c_ٹL9`>CW$LX< :GBC;gӟ2R"}1?9
[0o4AA^m2L:7VQCk#ߐHNXѹ#Qhcos/&J*d^k9BDA8i2%A`v	H%#_dK*$K!.閥[Ɉ{]b֭l0FުCt4y`cbgE!|@*/SM/WPD|KT
ich(*xjg/F:vB3o9`q8YH+92z8-g8cWV>n$-o]q}LBtN1
]b+]^fUB.t5)P	`$xa>%|s4LWVEr5)	8&a k s' f|A4J &_aW7Gz2]7fk\2jy|:ߪqpR;kylv㳥`F'i*E%i4^ʵF:8oa SJ{_,R6SnP5<|MELjrOKnI#{ƅh1æB~fi	?P=D!] L&< NI{m2A8Tvc=ĈT#~p2)ƵE[%Q`sshzC?1tEV=gIv/̪g+?w_v^)U%ٕ7l> $&W;b˕-Pn~;!5b**LC/Ǖis[ta--{G_cSD?\rjUP:I.L Y C4,©ޮmc<6CPt=y΁՞G]_N=0Ek kn<<|#<.PTereG&(YHkW\	b `qQ+;_9A57u>j(t^<} m7ּ	LۢBg,Uvgp6;)6(Hƹ|O~Ià4Ei\ՅbS7cm9~.#(Y+:/Ʃ=؁E*i[)|gf\W8-	ٙٙпs&-Pj_s9)'ns?_BiZFY'7 cD8GkZFa8rǮZGqӌR̝eBR/8z'тEhכ5).cCؕT276 L:	o(@LKm&'1z2,߀~{P܌Xo_ł a\csF4Bb[[U*P}qfўdE7P(h{t Iy#Rs;VlG+kUFrf1֡-R}u0@E/J
|xyVtI$o0@Zj;xΘ sm$!nWVY-#{a*]1_<0,#B8L3ŗ0D[UEjl)G`ƙV!^ATo9b*0A_p@iӺjR	/-Q7Ǉm{f5kupȿxU[vބad9qf&'*8v,	dEtMMAe^fM#w"D&D7Z)K\J>%z'WPD(0iM וsu~>Dx}cAlQw:Y_̡oKS,Zޓ	v:_`lb/3QfhFy0Jlm3L#㗙/n?d4[_4^zy5tzO3'<w`&$VYdmhhQ44^ɄCo8FX>P7,ך婒vdD}27#맠bJN_k<`q0ݚ"v)N_#4=  Ӕ݇0T:"EeR&*!L\9	M؎"ۧ j;#m'1^|EKœ)FIscsA<J*G,!R7b
4=bR<~(sF/VkV8<bXgx+-^Cn%XT&YBlEFOՏ!SA: Wv4K#`}#hvX?LkB(jzh`NfPXC(/ȧegGc7>^w]wz^n먺)Kֱzl}=Dćv4z|`
;b4R2Jov~>50	?^&{-'^xz}?\I@eqzP	vhrgiV>n;EaIr]auf%3m`è<qA9(p1va/<IR6Fnp.Hկl_˖v;贺xx/qÏb^$bsا`}Vׂ>,s1B͵	
7$XDqRw(n#FP%Gn[-$̑DOD^H=UuwGnR͠nr q'w.בL|1o[y2w.<#[ܗNb:^8R"/̦51qWs_vSz,I5Ut?}̩G;۽ߞϝP-CON߭"dɋl/Ev`_A(|3Gdȿ3&2*G^HBxy)㾦a3}0. aI6NBug#8u?Z[_Coa_USlK7f&eM!H8%!?Fx_wpLޏ(49/jߨY"MΧٗ_BJ}x	&HJeD}($q9%0*M'9x#!ChK+usc3!|#;Xe Zem}7܋]y-F\'gK17-hG8`6sk8>%sd I<y	Wd爞YjG)2E]il=P
*,Wԛ(L?ZWj)y;@.h **Š1/9矼DwZ7yeiHB	Rs]6
ҵu01Fg҆ANC$}(ok\\_r4e9ʏEr}&EfYdtD2C`tSB%*'0hMqI Km'FOCk+$_6@D^]${ިxS/}<gcuH:{ g.wWgDvQ
ĳbP[čtCN/s͕q/|
s{~c!^ǻa\酘6j,qS au`ǝM/:7S1Oyhut_2#)JYԣhHc}r=-z8F;т*A>811T$A2ςIطa%@i Av΃$tLLBЅnPy e y8^.6ďXjIZ$8zh?B~aTSNZ޴^W)_^ussމ/4W6t8WWATPATPATPATPA_A  