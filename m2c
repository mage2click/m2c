#!/bin/bash

declare -r m2c_version="0.2.14"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                                       ___
                             ____ ___ |__ \ _____
                            / __ `__ \__/ // ___/
                           / / / / / / __// /__
                          /_/ /_/ /_/____/\___/
    '

    echo -e "\033[1;33m$logo
                                Mage2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner & m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]
    then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]
        then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$(m2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(m2c_msg "$message $(m2c_info_bold "$opts")") " res
        m2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(m2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && m2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $((( res_count + error_count )))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

m2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_msg "OS compatibility check.................................................  "
    m2c_loading

    case ${m2c_os} in
        darwin|linux)
            m2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
            m2c_result 1 1
            pass=0
        ;;
    esac

    m2c_msg "Docker installation check..............................................  "
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_msg "Docker-compose installation check......................................  "
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_msg "Ports 80 and 443 availability check....................................  "
    m2c_loading

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=m2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 80 is already used by some other service." >"$m2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            echo "Port 443 is already used by some other service." >"$m2c_log"
            test=1
        fi
    fi
    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_msg "Locating archive.......................................................  "
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_msg "Extracting data........................................................  "
    m2c_loading 2
    tail -n+${archive} "${0}" | tar xpJ -C ~ && >"$m2c_log" 2>&1
    test=$?
    ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c
    ln -sf "$m2c_global_dir"/completions/bash/m2c /usr/local/etc/bash_completion.d/m2c
    if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]
    then
        mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
    else
        rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
    fi
    m2c_result ${test}

    case ${m2c_os} in
        darwin)
            if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$m2c_global_dir"/mutagen/
                chmod 0755 "$m2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]
    then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        m2c_msg "Generating private key for CA certificate..............................  "
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:m2c -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Signing CA certificate.................................................  "
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:m2c -subj "/O=Mage2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Password is required to trust CA certificate...........................  "
        m2c_loading
        m2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
        do
            exit 1
        done
        tput civis
        m2c_erase_prev_lines 1

        m2c_msg "Trusting root CA certificate ..........................................  "
        m2c_loading
        case "$m2c_os" in
            darwin)
                sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-certificates
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 && \
                    sudo update-ca-trust && sudo update-ca-trust enable
                    test=$?
                else
                    echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                    test=1
                fi
            ;;
        esac
        m2c_result ${test}
    fi
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]
    then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log

if [[ "$0" != "/usr/local/bin/m2c" ]]
then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]
    then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c
    m2c_sign "m2c.test"
    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"
    m2c_msg "Mage2click toolset is successfully installed! \n\nRun \`m2c --help\` command for usage information. \nVisit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]
    then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]
        then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log
    m2c_load_project_env

    case "$1" in
        global)
            shift
            m2c_log="$m2c_global_dir"/log
            m2c_global $@
        ;;
        init)
            shift
            m2c_init $@
        ;;
        sign)
            shift
            m2c_sign $@
        ;;
        --version)
            echo -n "$m2c_version"
        ;;
        --help)
            m2c_help
        ;;
        *)
            case "$1" in
                up)
                    m2c_local_project_check_dir
                    m2c_local $@
                ;;
                add|down|info|remove|restart|start|status|stop|update)
                    m2c_local_project_check
                    m2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    m2c_local_active_project_check

                    m2c_res=$1
                    shift

                    if [[ "$m2c_res" == "m" ]]
                    then
                        m2c_res="magento"
                    elif [[ "$m2c_res" == "mr" ]]
                    then
                        m2c_res="magerun"
                    fi

                    [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                        exit 1
                    else
                        m2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
[ו] m2c.tar ]w㶲(x+ЊmH};Nw'9ξ'ǡ%nITHnӝy;wZwfy5`f֚_s~T  A}nw%@P(T
@?|ڧ^wZ-FmYwS<iFh8zXE,NPy鿟y/ڑ~A?Gh7mQw.a8xG`Fx`+u[NA8$'el9߬7<翃pv&ޏ;yGniw[}C<>`4tu =wӡ=h~nO"?*̀{L5hv{'yM]Y0./1glN6vM&؀%!|oj~2E~Έ5X1orԏ־`N$	&',Hbљ8
,9bÂI ّ?
ϫ? 0	c$xkrgΆߏgoKk_9X0<
}!6'4&$cPfD/ބfpPͩ:x3ɐhv	Ёى(JG{M ([q;IvGXǢjurl7]<C؛g$x}r$#Fq[?n10Q>luH1d#D yGXg+h6}"žNF1ޚ_?J`{'3c(NXq=޿(dF򹻻?;77N^Z;ӵ~cOF7:z`<!;8Ax|poPǃ(vK@CnGv(K~CѐM,W\.(C0g8X[RV3/!sdfeViN폼8	ELBݡmۢM۠.uoh_ JE [E 9-ZK`\ ;:
ja A A bw	mVeka~r8¿B#mVGL"6EHj|ӯoNχ-fʺhYxO[Xa{YaYpa5Jl=d61ɟcaM|ތ뢄i2\^dA+N;S:It>8 ̯tI)iYB0b̚"Lo-_'j	d'?e9$W4mz[nT
J\-/ipT=PaF	~?F~i>˂S><6gƾ-Շ&UV+s`ՃE'1x|h
UKO>ww_os+R50Je:4SRbsi^&w@C00O;L@i7Woȓ+g
66u󛭷۶/u~i	ֻsd~s`WpQ5f'hۤaq$?L(.r͆3tH;8o<C3ߢGл+AwOVw)~;lJ<X0aONR5͢KNWMQ5]UcCK,C<M[ֈuYTn?Jݝg{;?nշ+fJ>N@Ņh6&BlA8B^ :7
Oj?9	&~Φ0sknVkcU!ˈ'W/w_~P*QeOj+dp*^\܍ wم*D9R#H,ޫL4`M\f>I^Ly)+(uwBr"#ϦhL:T C4URjV?>Hk)@MJփwWARѲnn=dN}ZT60A&~$cx
$zs	2a|lg=99Ka#3uF"il@/^>r7:#_g@^P/y?.)o~E&n?n=% =_/ܵP/{/w\*3J@irsah*e-7/<{l@@BQJnˢeìB<qR+P36eS`LY3M>'Ȼ0
p tZa(dwkb5CǢ?^S$9%y^tӠ; !@<FxO 0.еjf	; Q)QnG@)EtރČٹlpMN]͈Gj_lnRe#r3<:Ĥ&	6׻SAscHU5`:}EмKgz%/[@,N eYik%[RN;Ȗ]ãuwie=Ռ?O*̚_oW{OQdonn{.L%F$DN	ŇGlG(#)ڇGh2.Ffw0Q\YDe7ؿl*Ş~ SdY`[O_otk}	O9	B;u=U
GAAr&#
u/o~~~0|מ>~峽W}_zW5&ih3|ip
EEfYȷEr2[J$M-
g0M֯Cg2Zfk&juU
_s&7PK'?RAWo(m( 
[xAk"yJ]c /dA7b;[VY2^Dw {?~(')^]c<0Gcdrwb	EE-)SPQ:T-Aț퇻V Y0x_/ri%dsj)($<0/:6ȃ_ֿ=f{נ=CՠjðeYHYOlȪRi51͠l]k筬wŔ*rw0
`#'S*VyfS:rT>Hkn:S_0^K\b/m|.<\1IpŁ6w?b z7ͪ]l],_iDTfQDk/Lyw|L2lѨtX|2,6M?lVJrcCL@NqWĆi.W\7_Ӳ09uюO!w\g@TSE>f>9?|R*_
_

_
^f]
MAuxʅ/vՐOeH>(6UڈchO5ѡhyEG_XhV+	|	_.rݰ&1%ݸ]e#MkVxSj^+,1)լGr8Y:	&$QQ7}-߯0^0Sh*[I/ۛ\Z%u?G>MBFC4u2mWOCEg47'LT%st%0aL)*`(啸ªiz_+=Q6@Sb?׹1JraZ(_qF]~:8b<:Mߊ.*z'"F?c?r?r̻V%KK2 q.B_x?t?Kcں`?t'	Y +\S\f7%emtWĦgtFi~sJ9u+WWgr6	~gKN=ev-\(_U&_9oǬ̝>nRvaEZ`fA_xG`?|h>b%XAhBZ^J\UKǳk㤹Evq]Tsٿl}XDnOj|vP?QUIiWƕt|ǁRȸ̱/.1aYOǞmlq|[=K5Gx-Ґy%%n$
09-oA`eB=Bjq4hWi5--J5Nʑ^T'e_)O$^ү&shf-kax,/zg V߲(P)`*b=C9u
iG[.CZneQkVN[AXƖ*C84
0aɒeӖ$iT.qN'-o8~7rTS3^0܀cϙ܃yIΎf0mBh-tb\'8,oVy	RP0I1Bڎf*2v#I9\vp:JYxŹ'G͉OI5uбVZع<@2$肶Ms${g0TQ5氵\έk(q;ACL/GĶ90~Y8q{| |b3hZBC?mӍTZf/>g@K
0֑xя*S6)0|K/l'
0	iXLͦvn;-,SwQ3:@_ K7N2j&iݮOp,4}!Yn+&X'AʲLW*ğFqfM>75*(H[F,	ߴ;8f:Uy̬9E|nDL¢Mx
D4ERkmTw SaY,g`4((='6kٵ!0-3W]s"H$
W6H՗g-7#-&'(
|TWѳ#bZrq[\\X.25./&ZP$N~t)šh_ڑ
A<nhYFTYй.g_ t1[bыʴ<4@Q͐N)C:UY!YvRV}
|Ytk 7"V;Ãf+s"TQ)D*ӛEyt@{#C߆7nGox4;)AܺmA-dR$x`9mV9Rȴ k܆
??dM̋薩d<f#z㛓o=WUe]\e<Z.`{S̚UjCKga9#ǰo(є;x0\3zio5go<zqLJ3s@yerhe
gadpC7A
PlygJЩA8	'G A"]=c<r$,a'!MJ-G,H) =G0z*?ֲr٫SpiR>q!( _2ك4ۅ_7
~2Z:B;H	%b4+"ψH$Lz]K{Ry\ob1+)!-+O)Ɍ43UN2I4O՞33SĐ8rcG  AxXBx
MNeL2r>)0*i0h`%+N3_dEK#$I*kMoJMcz)GD:VIf>{eƼ#R0Y(<bX aO	9ģSr*!i{p n +:kHb20Le׳lCRp(!	ν[Pb#
5;F*8UBhnwy0H߱mM.pG>z+'gU>S+P tA74>\z0	::]Pk#Uq톸d!0\aP+>;->[)>5Br[K[~i/M!#kYD!5
R.KD.KDnF.۲YCV!k'rt |FߜaRHG|ߺN~k7~7ܴn
-Y,4Kݜҷ,~+cYS/8"-KF$,1^)Č[H-Cc)*@+m֡ŹjI̩D,ixP+0N;nF5rgGze$#=iC+.B}i]Z.KD E;iO
=҇#0lbjwax)w=G۟27eӧ!?\S 2,)փ	q#J"cYpj4Cb%HbR~ω!O>g2ѓ6[>A'w-Fc6T#鋯(SFt,ڄ;)nN$>09--wU^bqL^MF>vA©_A~#Q#eYDQ
d!1KcP3k7n
SS~ļ,,܈qs϶|V}!<SUoȼ2Zܳ->9]{
qHʺ2ҕRnA){w܄%ZMu2f;d
z$W`~Ԛ擸,\S<,OKț
l9}B7a=u}-92ؓ=uWV`
yCMX"瑼,\-
~{1:Rs9|	{ӗ%b=S0m1_!o{ɭb\z
#<OtPvmcTUK?CprW}J6#]4݈Ee{&m?̵ӹSy&?OW/orl=~e+ן]̃jڲa͋ ^Ghw츼LC[rMO@Wqŝ׍%4i&.M0fym]4jзĎ"XC|1o9g1aL?|ll{mG-˺Lӯƽ$jr|˧^8.wm|@x,	Gm׫WUZܰڽžo=otҚWE!w_Νo!x.C#մi	n՘D^<喩h6_vg",6ESofQ䕾ڴ|A)

ހBsH'+A/hb}36-!eqT:&X%XK+tYrVԖrYBheʋ1s(ڳ]RY(ZC?Ae/(r,Lf͡|8U) UrD4wi,<dlΣy0Zo4ֳq-bt*affx9Y٤x6qXq 
Pzdriw:hR1W43L\TH+lqϽZ8+jO[~iL)R%Zܰ:M9`څM=|q_bi\e	2%*?oDY)!>0~J!C(Olj^HݸT1*o;33et4<HYBY+L[j=yv67xbQ*A(ŀ z*,bsWzxQv7Be$/eZb+9mPc~;fvVZVpw*F7Mq+vM`0ǋJMSFIZͦiEt,Zr$ey|4Ki9x7+-aOe2ma:RPG,/UރGVr*uhd]nɈ8#GeqW~~twϮJaB핖zq|FBSsITtG7G@S?A'f{o2F٢>8-|?W,G^1.@e^xAOq"XiR)4Bɾ޳;?$-x/^ "<
&7`뱅pțćԅ`yyQGAhѷ.،RL	]1I8vxw; ` zg 6F,N(\z=rr\=i?`p޿b(8é(Sx>B^1i\޳fUӲxiEt``G4Eg`b	ABof!ZG!2+^34ԙoOGVAպt]S҂j8/}3#hc僓Pz>aq4^faIx۫-K6F.<0̨nRG20[Z dA)l6LKarbat-]2֤rA^ePΒ'[Z'4+32oUvb/Ci%U[½ '^`aE['VWk򭓋ke'sI&BQ48~4Y-Th'<$h*@H!<5hS_*&kNR_j=қ}nC5Wa"}%00R Ï
OIne	d?nwC6=6f ּu<B٦/[
Z9O9!%Pߕ\*/fR Ot9o@	[<)sZ󉨄N_rg#䯻2he[7*s=o մ?r?`;&]cNEEG|:kkݕoGDѦiAk 9H-67z2ʾd-:V3H][gNܟL}E>כ24j܆ҙjC#κo
?ؒWe<b~yKIn`&fӱ&5d-Tu1]DڧPR3$ٺ1|1`8V#|XDI4n6MnhfC좑yrkqoG.R36쨮-2Sa)8XC#[<TtreM:l\ p<{0^19S\XPm~oBpL(ڶu#j:"+J+<D4hg\ު紴M9ۛӫqHs=͜%qAپQi6LzMpMV#irqy!*nJ3OA¹^s:]YdM8lCf9xE9#]uAowdc*լ+B^K«cܹjM9O˫//6]i/6Sx_Ux!v?Aj׼e7	!-wc]6 n2+p`fһcq@x	^)08pLp`8xl"`QE6{ vDh/H>\|Q0uMU-:ͤ=!='(̵OA_}fI{+Wrq	c@U(-~{ܱ'z_rQΠxZ,eןjKZ\$,I+ХSup ;_=>i}Q0b8FavI~MmH-"|awr=4+jR
a2#*l)cB>-WB	&qI%Ub^-Ca0b$r),zŮNq\Vi@!iCK_t/_mIKRi^fs&oYLT,}(T\fdr2=H t!Q"
_d 1s|ЊOeʀٰx+^ezV:˯n0^z|b\l ޅHdWJ<$mזUKbSQ~(o.[oݗ"V$.SٕChv_&"<3fx?0#]QSQ里TZ&V#rlzI؋rە)Rzn`Q%!r@KN%RR#eFKIri	湋;(ӴS¦U<5]f5*gW݋Y@}*7Z#t*ݨL6'ZXTɥVePq	=>9WVr3Q:|@YZ[\G*hQ0C"NGnH;\tQ<O2Wyc~~eGⴲfk֚!XE#èDh^B?V2]5DI";eQ'hȧao}[Bm̹WJa5sg6o+Ji.LdOV_ߢ+ߎҷdɧhf[0-h/gE;ռyU亿h\iZHیfj1.M۲h<$We*9Z[33K<J[B_rK{Vg
ȼvuiχQ(pζOq8[%Ru\WTouWn\[7uk[Pz7ʨ7n]ҹ-A/AFYMZLl٠JD:;m8!jWok}#s>"+
6TReX1n=2eGnmZo|yQec-P6έBi=h_pgsv>y6aG⒋
():puxSyG{y^[TE3g5+Vʯ.W"<_j%烢]}G k996~Y!=PZy#ďSD.m2K=3n9kY=̑V|>mSီ"/_@WUj,R4@ob6ڼᗗxuAON|ߧMYWWX~iUZV#QVa2ƕȽgjoH{E-VqV؈kW5vP1	Q67S֯tV=.DY_ğ[ĵ߄t~q+Kq}MK8Q`th7>~09טU 6]Rg4A*-y\'Ngf)ŞEz?>ysz͏}Cߜ:<=<%nZY9Idy,8aa:xmֹ)|ePib롹L!|Β2`HOz@c P	+EfS<'ȽQjtp,c}
;hd.
O=&F2+<<\U/,4Sa7o^#<Lx\o_Pe*LvNɉ~N)Jr1
O)ɅLވ35p'*i.*朕%WoxD =9mMf0Drlǲ>{
.MAdn@燱oJN2/sYV؃>߮u,u6,HWAղK}5^n^ki0CIL/?UãjB{KC%5ӑOVsnK{{<`^">k
o=/&7Xyq<˯ob9J
ūRv)y_m^h3H=W`rs6R]{~7FPeI:ǳ=orIYꎙOysOfD&=" ݨWCSbcfvjowHGbGL˔LaˈV$n>i%WR$6SeEa>GؚzfqBޭU Q07J`kh
ޥUt,p/w-3LJ_Oo޳7~7/V\l (EֿF0#n0/!>}^Iye4@tOh:tK=DW22U
se^,5EQPlYp)Ul2OAE+g#E ܆Z,Z#V|-s!ᅂo\@L}儉**?jIKg[/|Y*n<[W WF)Sa @
d0BfsQy\^ɆZ8'm!}Yv\%+Zg_ć/9ow'jZ=u5X\,R0ʾv3P瑤)bފe-v0Qo?EVr=}V4 <RV9o>[,|ЕFec78=B4:"R\*@X$=f#0!O.^!&= 
8%6ʊy#bE5g1|vF
MX$Ҙ)%1<_'0Dߕ,+FZkZ-v-` 92ld)ԕtA'NXhMeZI`	hO1JCH,#ȕ||77O=5eZSM[*U~iRxGR
~`vMU9"i#vןCw?<Mw6KR'A9>ZfdM30fq>qQ|1Ri<\pejCX߮r!1:.LX+ͫ .RDIB+.Fe:/hhDN?(7|kscn/YE]F-:6ThpQ;+G'Jy(\M~ǰ^>t{nލTLgJ|9t	 xC@^>*| DGмUPۭy5FN{5ukӫ!X6bՐ$D<O`S+m«mEzNP}TAXps\rKtU.@5A>˴ra&:]QM`l!ކreƺs!񩧰Dct4|f?қ]_JFnƵAP(Q˗NAal+V /[r0p-b9i9a(v(-81}(Ъ+<Bܶ٭+uY{DWa)+ϋů`QE/O}W
.DSw2+чwy7j2@jQ5<[-[KHJ)WƵlzy9'ٷeNWb%}8jkٽ<_|<}^]yxpʲ'ޗ8eujZ%V}pRtGBceҋ7 3KTܞ=׆*QٻGhW@F&Q-y,P`t`tmE>{;
WQyh
@zK5˅5w )M4y=5%3lށ&6ާL'B7+'q)P6{H|0_'Oo*>}w^p=yS@x6!k+<_qY}=қVx11QCJyv4a[S\o9%ޱ8|{JAPiuo!gճRӼ8j=M{{'86m?%l{G^5ԣ3v'C0?r=FLr'%#X&_7׿^y%[)3)G?,HQ{grȉdp/6wm<{}dtcWJʏ-~Uz䝁N	:ls!H+A痰,$TFLf?Dk9Z{_i?g;'_Ze}fh]Um |8PluvhM!r50oˌvMkJïOB-b\qBEWAQam"ZҲ)`@E -拪qr7b2H`] 5YFV;
!1Q>\\Mr_Y7ºQ0x_{SMmG^ %@]Kh.Ъp3.bhiX0 00W,;fjζ= CPbN/bbl@ZS	Ï-rكJl1 bbbU>H'PY>p8:Bx>*yY5դUy1hunW|7y y G˕6%Iʜ^1+y;]殷͹}r[)rgGǰXW~#dLԫ F[
3l~B׶^ǣY>u2ʶ~8eHν@~mԫRWTf#׵OyWc^%^έ#rkkm5Ҿo{Ҫ?jclK6',C4mGB 
|LUMb|1*vHIMCHn1FKsXӚ	 N/޼zjQ8
&ϖ[c&pwUbbVqSv%p~
nqE{wn/-7$Gv;'10T5PBc	c}o4䫚KI$:iA@KD=l"dBN(F$_#;s{-qp-rx+Y.V?T3#VRĊGdo|6>[!
F%Ō\=}3BX9'q?_N~ꊲtCQ"NuҭBquM#,7mR670yPm
--hL!J^9o,S/Wok~=v"y^;SЛNGA.|p8N"dSL>|&ĖCIg)n7LxDn F:;3[%qEQʜg	wVr:k	/[PYOYd[|9)%YӱΚAIy
%mɁhN}op'z()_uɿ@׳|%Ks/[Yh=VYROo8fPNtCG
|^QnUDXQ 72aɞ_{m@W*cAaiJ)]<49n:zbu?ÜFr]3֝fֺ}TgK|x{ю(/]^ǒpF`}cEu;u =fi;mvmNGh}XrZޅ&_8:d'0򷄂<[)r7 ~ӠYAT@V-phzmj+5q' 뷭ZmN&-
n	M쁹C:}SCg,fCSh)0~H)C51r Jll3j*GI	`w7^Ǖ{Aw5YAu6!vعN3 |<Mp8A:% ^{瘆q;E/w=s#eHK5]<b*kMܘ9TDj|>lEa#ċ(~E0KPe?O9Fuxwqw<K%I4ČÛ_D]A6-|?lvϭIx?Yvgfnu*e٢*b5=/}[c;+̉@wChF:GW:WIfYR+wt
on	#u?Bc✩R{fYҊp]ƿp<sǿX,||ЯPvW3f֗ș#
VRD"F|nv)vX$MvQo8o^ bՌtO{tg.ݽ7TKi^=j
ea{28W=!޿w6,_l?' &Mio˝??Mx/^> V3:y麪Sb^#%RLͯ^zS̓ş_jM_Ozj/D8rIz_v vy_izO+f%N&ucJu޳]`}lMg{}şj/~&1{~;v,v^3~5?++ ,0gY2Ft3v
P0	vevr*Dz(&(pN]_lsS]s_߭oY(oavNs7"_^[x:V|;`mY`AjHjڃs9fotDU5
Wmʆ~cRwJ9[^ZԼ̒V2Np^ݨ0ݧw^~>ZX1<Z 2ďRw*|h	ѝ6_\FH!:<RV=GQm|:Zзkvīu)YWcy}YvnY0V}<;o"9tU7llǰ~4F|WbP]778wJl$Ci<)B]تbxG\ʾ,`2z?&ܒݶ;f17#;ja0}dByGGA2*`NqQox+ΠEe'jv9+Si»e5l0rsDm|.ca\PΉ|[:k?ͭVԗ;48۬4N]<ix4X$'Lufu]<ܷ.y1;.sp;6ɳ>P4x
̒c+)K`YoUw_5Y,"2⑱X1I,&٫Kp?YߨfN;y?xjϯ1'kIO*{'4ēC_V"^%A2d < 
~,䪐=	[rGӢ`LIw*E@C?D݋0`OyH"F+0A;YrF
Ч .ҫ(zt\s/i1 q0bp]_o`;e@[78c}5A8
-qvreucُ-6txbYP'IɿY#f9nhnNNsӅY4ڬL	ї$o`躭
;aIͅ7rwF-چܫ7l<ptq*8_ P'$ f\@TV ^pt2VPf^.:]]7+htV*?M~El3r	R ~c8H4@2ڽvۼ1~lu.'BNiA^*;Ӭܻ{>?h\MRu 4B3
;6 	 |TKe&:z^Bdټ$$` 4cO}/XkiN.gx	I^NsBr}So7l1^:,{I+Q̓*TwRDXs5uf#X@iJ>sJ?4{.e#o:- ?ᒁF~ S84f !E3lJ)d	''t5
|&8Эх90	6M]a߬0y`qy[Kf7,SkH"AD]jLFķ`2>W|X$c%)8pYɿ]F3zzфfK
aD5xgy1ˑ?0CqƪqMˏk|vSgl0&|Kۓ8p*4/*R73)czca?5F(uña]XJ-,pݪD۽60l[v׀,jju!6nVCͤf SpbUNY>r-6.{4]i܀;Pg]E'sqj=7TfSKzqt[n=tfjv;ZN3q\`mGu&$vihɎ[ {h 
عY]ש;zL^nntݮN(iۭ[m=CТG`vI;mQ9NOOn&fն۹n:6f{lTw_B\:`!x8vM ٽ*mk@ z=ц@_4;:nGtaw:PӦ4m^9,]Ht;VCiA-Azc{];j٭nij.d clAk6t5;D8߫c?:m@u@老%"waDYrY#p[l@r[09QvA6|4z-Q۝.7_4:-5+Pj׻MH  k6pa)	nF	0+\x<]܆6;q]`+d-@Dp(	ۭFԀMf
mY" 8 զqZÑ 6#Z$d3080B S;;.IΆ6@^p[-]`*.nàj*S3i].vi 4`'J0:nl҂j`hja@L@	R;8Z;6DMF,XАfNA@6i4q4@^g
5	TH @Nsh(MT^Ch5	=u. 2D> Ah5]BtdLAFj# .Ie`:(TV=70mmTJ-Lvnu1ݰ& ho&C]hyՁ$:X1'FYՆ$˦Pכx8D vФQ&C6PylAA;AVPZ׏M3A[@չ-+&pm{!:٭t@At~L˩;=.q@wPq:);jj$\-7vnRm"k v2" 6G) ëAv6A4{u*A -ABV%uH+kԄ"	0	K`l0`.d2&TХ(C37;-Ҡ=TDTHs9]Pw]U t#*mކfwЎ1\֠"=$Qyц^F`$$2*˺K		"g	"@7=-3J:6¸Մ=6Hi=h#W>;	l[Pp8?UVISABZ:umj=lmĆ =nPe`;Q)ub\hB*j09]nׁd r\[r(S#x0Yk	ȅ*<0P5ӁN꫷,un0jBuTA8.XX4\g<pRG9!li0s&d5FIza]MȌ`#ׅY^v:uF"X} O[4]@fdt!j7I){V0q	Πai]Gccb(<vS3{#<a&ʥ#:Nv`4 -i`1d	`r;M0q.AC@Ti Q,Csȃ_
6N~Oc,uK4ܕNYG	1CTMbz] lDYmDi2LY$%Fn,T09 a3rhgq4AO`@мjC|B֦ZfpeU(E`#EE|n4g4Cvi2U 49Pc&gGќ!TjI(`= 8:vi
$Y$ m &ރ>,	*ΰH+crt(>=4هx!C)*p܁mA$2ѧ*OMDЁM/} ]ˊql8Dj1 gTu<r53"-X)LRaS'0.:.By}Jf 9҄vik$kb~F;"~0-i6zImMa}A)Ul"ME!)0]=30KUrfC `jFUau*LӒSat3X @DmMaI:r`\9M!@Zz^ TCM8];t4AҀf76]|Natzf`7`_$+HRXS]=wUғ[q>M̓QGCÂ.mmSnUGӷM)O Fa1w^'c5u|`C҅>]
L7 l#ojyW3?x8wYd?h&i(epwp慗Dvf~̗g;H`v4-1Q)VYD?Uk8 /K҆B_w6og$7Tn#p79eé7&Yn{z6o|%t	Q`6=U_,W{~$-ZRڋqBF{.7#@X;F	F{aj~9:.p-vf))-(8leJa\ri?GpCxԼJxaJĵ-V3j0At6A09J6Q;l<!&Yݝ*A6޸7x/?e\GFU31paT͇R;)v7ҶIVXM,<Q7rEO֕'m|\  ʾ(+تX]2^ <""K%ʓ7m#yʯ)7y-QJOÓ /  Sk	m'5 bj2MƩ<	UI7 +0C/5:ȏ 'W~ 8JTu*_)_9_q)\d&tqR#*"5He0pk؊*n@޴_}Z_AJX>;hNDuesleiY1v}O$D,!Un 졦 ֶM76$1$"$H}&w\а]ρBa.\bmQ]^Zb ݶC8v@/Ԫ!YaЙßyxCfD0QSQb4Ǜȵfbw۬ql;l_* sl5sO909F)@Aւw-	w-؆`r@xEʻ~Z0PeX=Kn~6{f
O0ifJyH,?Kt>ӱCYL\->cK7]&:tCL0ħc~7	AIyN/Py̊bbn*!bvɼl4)Fm׫WBٓQxu4Ol];Sёڞ
s~a`ڼ5?
sk!Tq7q[Ax|hב(ISj>dVD眭+LF-+kWۉҞO3HNi0AOY@YOq&AkrOOMOwUoҐ<=|+NGiQ/O޾e01rvݹڀH^w00b& c<}JnKzpTwY7de;vN8-Mp-&lc$`f7ې7}	֓?M*d?e$%ȑ(Isu _/|zU>"_9ӌ S8ƑEwm`r)()r9r:`N]NYE
r|O ]'!H뮖Jծ)'cU#pSP
jDLD`2fd9G̙8s]ttM[j́(EU}8Hp?)C

ҧD]/oPY̑Kt&\8_U:_dtqxpZZg$WjY ~ϵ;Cɷ❤	[yGSYcOSxfTj1^
(PU֡HY
T~_%{U*S-Y(Hz9'9C҂G+NZwY^^f(_X"QdDjg9FK z˘~Hkj~  i.>j[.3d<Fcg{/f?K<!H^?E2DAf3! %dQѯWEce	9cfM6!巂 Qbf\bIeCz,Ǧ4"qCk#jwN@0{gOHYɟZyW"-g/d/͂MCA иl.1kHHR,4+)DRC	~U|~*IS3ǲO7&Gёji䟑zUCMTU,InJ;q6nQ[6C-XMҁ!Fȫ+C%K2LE*SM:,5$?O)a,E8HE{J_)Yѡd~?:[s
p`Oռf`J/-++MIɡE͌.K}4>s
͔kX(l>WdMX=Á:,YQ4<}pi᝘R';=d
$<>å/	Q ?cEhrbA0`rIȫa _gпҳs	Ùrt}Ix6Hu;}'v=ɦ?e88LDb~r`'hă]&S/>e</(tn*7!G!ё	'.sG$g^L<UrBqjeJ3JF(6ɖ UZǍIB]-K;·Ĭ['7m`ޙUvhN5)7Tǲ
l^N/"Wn}үSШQ3ufPϊ7^2+)t f~Ȏ.X}
@{j *շ4¹}I[iWslF)9]ESŖtD%"FY>K ]M/a*4	!^gOqc:xȜ9_ -U	9s_P0 5cjべN`3>\(w%Eދ؇?2k{
)W9		"+r)GqEr
\Lfa
39 qpR;kxfl#CY:nށh,YuGrFnͥxzDQtڼXz<Ee5bSΙ',^
p e|1)ard9R 0eִ>0IDrV4}׆n팓G8x荇xiصO~Qlo /bN擅],Ob_<VFٶ(r_{b vrCvdQ?H|DC!,'%lU,KlG"ӣA4z4	LxˢT7q<?v[m}8-ZMY:XT!m`Ioˈ-	Sx3CރЏAezDwFUύ5"\0Qώ*WlHO7hۤ|x\c',[=]ůha4DcXPp^'wdrt;,C>6 DxRͽU/AP)vdv3xs{s$Wcy
 zY穨V`iC4}P8EK|V. l#*3<o8i!Egq>Cj$>{V{E^tQ'bp8X(#0k=S	UxYKJsQv-ltnkQυ/SҊ?VwSs6ŵ+l?:t:g'bIV\l0*tƂ쿻XkwۘoZbsOְ){*Gd)JJ89DzW{(1['t=߄:H;;-ztS3ZEx'-.&|J:#iEyV$7eJSس}nO9R$u^e@hӎY Al0y[4e.B<N䛒gA|9ϗbӍ(a7+oqu[Fo_[~$u~Ȼx~gCߩF1D:<V'c=_x"A{=3`@Am
mQ>o
++^A[A&F6y'w*Q1O#qx<:MGIyGⱥ߶ts#3nK _kNMjz9	Ќ~07_x9GӃ_5#hqT:=,Z,C9衇`2͆0䥏21E:ͬ3.'Ena%v0M?.)nRx<k0
A?	*'jrUTK'J>ofyx<qÀ:m_!}h
ǵ-XѠaOW-ƃ~!Q.
IyW8&$/-y6!܊*p9mS_v*=rm^.  \UF_>|Dב`
fxπFVo.22Pw^LOٔaͅ/H,'Rea<bja`4:ex{l2Z^T`oeaoS3Xy@ڎދ'Iv\kfl|o7!;ƪ
n}»RsL+<4K+K)2vߧ/$Nl߁m2*dUʝ`g0+idտ[~aWvsap%b_>׬7{loql[qÉi?Vur!ٝs,nVm]@xoޒ$7̓'AlK ubا^h1*	u?Caҋ\]g+W۔;Oq@6y#.-%9$GȬ8SDlN t5^TO!,
Zq^x׳%%I|DkwRD9NybfUow7$ahOUʬB|;l3G`
n|-U"T&7zzC"sO6_;[E2Uc<,Y<^&6qbS;]6mgyEWsnO\cܳngCs!	_jcpt[]Q?Da-,d)H΅jI@L Fy܇0&"~4R~Y_~W3Hi2hT{[2E!!gkskY{kcG/@[.:vDp3?`IcYD *`-$)u">T 	Wy"b^	;yHH_S:F3C\&Ƽ*H$D3rMoS R`FDؗEL/km E3BТaċ#h$]0aǀa#.'^?̫֘hY !a1HS1G?^Y+"ʖ@߽:dXtjfGlxSY,~)ϛKfi<[G}FСuB[ܝ/IX)E1S$Xj'irwK Y p8'af!_Y;;1GŗVA \J ĭ=4l0Չex[A@(S^W'As)F:9	i-1Ԓph-A{n%eKh,S2xDէu~sWk$坶I1x)("; xNB;yD*-GPE(Pm:IRF}9~/,>F<_h ²>y~Mr ^+poQix3g'A25n"y;|Cm?%^|ص{u~O輵`H)us%4~.u7ϫttru 2_)>Ⱦ-c^{Fv.G&IS0 CFKG~ B}gPO;
-JfGԇ.QKK E+DâGvZ-(aɱ`:H_X.G<`#?٥Lʗ[N.Y'>-GE$~śsi%i<>o~oO6Ʀ:2,u{
v
2j'ؙ\y _z +7}wpˆ\GV X 